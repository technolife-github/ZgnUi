var el=Object.defineProperty,tl=Object.defineProperties,il=Object.getOwnPropertyDescriptors,Hs=Object.getOwnPropertySymbols,sl=Object.prototype.hasOwnProperty,ll=Object.prototype.propertyIsEnumerable,Bs=(v,e,t)=>e in v?el(v,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):v[e]=t,gt=(v,e)=>{for(var t in e||(e={}))sl.call(e,t)&&Bs(v,t,e[t]);if(Hs)for(var t of Hs(e))ll.call(e,t)&&Bs(v,t,e[t]);return v},cs=(v,e)=>tl(v,il(e));!function(v,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=v.document?e(v,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(v)}("undefined"!=typeof window?window:this,function(v,e){"use strict";var t=[],i=Object.getPrototypeOf,s=t.slice,l=t.flat?function(a){return t.flat.call(a)}:function(a){return t.concat.apply([],a)},n=t.push,r=t.indexOf,o={},h=o.toString,u=o.hasOwnProperty,g=u.toString,c=g.call(Object),m={},w=function(a){return"function"==typeof a&&"number"!=typeof a.nodeType&&"function"!=typeof a.item},_=function(a){return null!=a&&a===a.window},k=v.document,E={type:!0,src:!0,nonce:!0,noModule:!0};function I(a,p,y){var b,T,O=(y=y||k).createElement("script");if(O.text=a,p)for(b in E)(T=p[b]||p.getAttribute&&p.getAttribute(b))&&O.setAttribute(b,T);y.head.appendChild(O).parentNode.removeChild(O)}function N(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?o[h.call(a)]||"object":typeof a}var L="3.6.1",f=function(a,p){return new f.fn.init(a,p)};function H(a){var p=!!a&&"length"in a&&a.length,y=N(a);return!w(a)&&!_(a)&&("array"===y||0===p||"number"==typeof p&&0<p&&p-1 in a)}f.fn=f.prototype={jquery:L,constructor:f,length:0,toArray:function(){return s.call(this)},get:function(a){return null==a?s.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var p=f.merge(this.constructor(),a);return p.prevObject=this,p},each:function(a){return f.each(this,a)},map:function(a){return this.pushStack(f.map(this,function(p,y){return a.call(p,y,p)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(f.grep(this,function(a,p){return(p+1)%2}))},odd:function(){return this.pushStack(f.grep(this,function(a,p){return p%2}))},eq:function(a){var p=this.length,y=+a+(a<0?p:0);return this.pushStack(0<=y&&y<p?[this[y]]:[])},end:function(){return this.prevObject||this.constructor()},push:n,sort:t.sort,splice:t.splice},f.extend=f.fn.extend=function(){var a,p,y,b,T,O,D=arguments[0]||{},P=1,C=arguments.length,d=!1;for("boolean"==typeof D&&(d=D,D=arguments[P]||{},P++),"object"==typeof D||w(D)||(D={}),P===C&&(D=this,P--);P<C;P++)if(null!=(a=arguments[P]))for(p in a)b=a[p],"__proto__"!==p&&D!==b&&(d&&b&&(f.isPlainObject(b)||(T=Array.isArray(b)))?(y=D[p],O=T&&!Array.isArray(y)?[]:T||f.isPlainObject(y)?y:{},T=!1,D[p]=f.extend(d,O,b)):void 0!==b&&(D[p]=b));return D},f.extend({expando:"jQuery"+(L+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isPlainObject:function(a){var p,y;return!(!a||"[object Object]"!==h.call(a)||(p=i(a))&&("function"!=typeof(y=u.call(p,"constructor")&&p.constructor)||g.call(y)!==c))},isEmptyObject:function(a){var p;for(p in a)return!1;return!0},globalEval:function(a,p,y){I(a,{nonce:p&&p.nonce},y)},each:function(a,p){var y,b=0;if(H(a))for(y=a.length;b<y&&!1!==p.call(a[b],b,a[b]);b++);else for(b in a)if(!1===p.call(a[b],b,a[b]))break;return a},makeArray:function(a,p){var y=p||[];return null!=a&&(H(Object(a))?f.merge(y,"string"==typeof a?[a]:a):n.call(y,a)),y},inArray:function(a,p,y){return null==p?-1:r.call(p,a,y)},merge:function(a,p){for(var y=+p.length,b=0,T=a.length;b<y;b++)a[T++]=p[b];return a.length=T,a},grep:function(a,p,y){for(var b=[],T=0,O=a.length,D=!y;T<O;T++)!p(a[T],T)!==D&&b.push(a[T]);return b},map:function(a,p,y){var b,T,O=0,D=[];if(H(a))for(b=a.length;O<b;O++)null!=(T=p(a[O],O,y))&&D.push(T);else for(O in a)null!=(T=p(a[O],O,y))&&D.push(T);return l(D)},guid:1,support:m}),"function"==typeof Symbol&&(f.fn[Symbol.iterator]=t[Symbol.iterator]),f.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,p){o["[object "+p+"]"]=p.toLowerCase()});var B=function(a){var p,y,b,T,O,D,P,C,d,x,z,R,F,Z,fe,pe,Me,qe,Ze,Fe="sizzle"+1*new Date,Ee=a.document,tt=0,ze=0,Ke=ns(),Lt=ns(),$i=ns(),st=ns(),Xt=function(j,M){return j===M&&(z=!0),0},ki={}.hasOwnProperty,xt=[],Ci=xt.pop,Ot=xt.push,et=xt.push,Ct=xt.slice,Tt=function(j,M){for(var W=0,ae=j.length;W<ae;W++)if(j[W]===M)return W;return-1},Mt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",je="[\\x20\\t\\r\\n\\f]",Ue="(?:\\\\[\\da-fA-F]{1,6}"+je+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",ot="\\["+je+"*("+Ue+")(?:"+je+"*([*^$|!~]?=)"+je+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+Ue+"))|)"+je+"*\\]",St=":("+Ue+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ot+")*)|.*)\\)|)",nt=new RegExp(je+"+","g"),Et=new RegExp("^"+je+"+|((?:^|[^\\\\])(?:\\\\.)*)"+je+"+$","g"),Ti=new RegExp("^"+je+"*,"+je+"*"),ls=new RegExp("^"+je+"*([>+~]|"+je+")"+je+"*"),qs=new RegExp(je+"|>"),Ws=new RegExp(St),Ys=new RegExp("^"+Ue+"$"),rs={ID:new RegExp("^#("+Ue+")"),CLASS:new RegExp("^\\.("+Ue+")"),TAG:new RegExp("^("+Ue+"|[*])"),ATTR:new RegExp("^"+ot),PSEUDO:new RegExp("^"+St),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+je+"*(even|odd|(([+-]|)(\\d*)n|)"+je+"*(?:([+-]|)"+je+"*(\\d+)|))"+je+"*\\)|)","i"),bool:new RegExp("^(?:"+Mt+")$","i"),needsContext:new RegExp("^"+je+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+je+"*((?:-\\d)?\\d*)"+je+"*\\)|)(?=[^-]|$)","i")},Xs=/HTML$/i,Us=/^(?:input|select|textarea|button)$/i,Ks=/^h\d$/i,Mi=/^[^{]+\{\s*\[native \w/,Vs=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ss=/[+~]/,Ut=new RegExp("\\\\[\\da-fA-F]{1,6}"+je+"?|\\\\([^\\r\\n\\f])","g"),Kt=function(j,M){var W="0x"+j.slice(1)-65536;return M||(W<0?String.fromCharCode(W+65536):String.fromCharCode(W>>10|55296,1023&W|56320))},zs=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,js=function(j,M){return M?"\0"===j?"\ufffd":j.slice(0,-1)+"\\"+j.charCodeAt(j.length-1).toString(16)+" ":"\\"+j},Ns=function(){R()},Js=os(function(j){return!0===j.disabled&&"fieldset"===j.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{et.apply(xt=Ct.call(Ee.childNodes),Ee.childNodes)}catch(j){et={apply:xt.length?function(M,W){Ot.apply(M,Ct.call(W))}:function(M,W){for(var ae=M.length,U=0;M[ae++]=W[U++];);M.length=ae-1}}}function Je(j,M,W,ae){var U,de,he,we,ve,Ae,Oe,De=M&&M.ownerDocument,Pe=M?M.nodeType:9;if(W=W||[],"string"!=typeof j||!j||1!==Pe&&9!==Pe&&11!==Pe)return W;if(!ae&&(R(M),M=M||F,fe)){if(11!==Pe&&(ve=Vs.exec(j)))if(U=ve[1]){if(9===Pe){if(!(he=M.getElementById(U)))return W;if(he.id===U)return W.push(he),W}else if(De&&(he=De.getElementById(U))&&Ze(M,he)&&he.id===U)return W.push(he),W}else{if(ve[2])return et.apply(W,M.getElementsByTagName(j)),W;if((U=ve[3])&&y.getElementsByClassName&&M.getElementsByClassName)return et.apply(W,M.getElementsByClassName(U)),W}if(y.qsa&&!st[j+" "]&&(!pe||!pe.test(j))&&(1!==Pe||"object"!==M.nodeName.toLowerCase())){if(Oe=j,De=M,1===Pe&&(qs.test(j)||ls.test(j))){for((De=Ss.test(j)&&Os(M.parentNode)||M)===M&&y.scope||((we=M.getAttribute("id"))?we=we.replace(zs,js):M.setAttribute("id",we=Fe)),de=(Ae=D(j)).length;de--;)Ae[de]=(we?"#"+we:":scope")+" "+as(Ae[de]);Oe=Ae.join(",")}try{return et.apply(W,De.querySelectorAll(Oe)),W}catch(lt){st(j,!0)}finally{we===Fe&&M.removeAttribute("id")}}}return C(j.replace(Et,"$1"),M,W,ae)}function ns(){var j=[];return function M(W,ae){return j.push(W+" ")>b.cacheLength&&delete M[j.shift()],M[W+" "]=ae}}function At(j){return j[Fe]=!0,j}function It(j){var M=F.createElement("fieldset");try{return!!j(M)}catch(W){return!1}finally{M.parentNode&&M.parentNode.removeChild(M),M=null}}function Es(j,M){for(var W=j.split("|"),ae=W.length;ae--;)b.attrHandle[W[ae]]=M}function Rs(j,M){var W=M&&j,ae=W&&1===j.nodeType&&1===M.nodeType&&j.sourceIndex-M.sourceIndex;if(ae)return ae;if(W)for(;W=W.nextSibling;)if(W===M)return-1;return j?1:-1}function Gs(j){return function(M){return"input"===M.nodeName.toLowerCase()&&M.type===j}}function Qs(j){return function(M){var W=M.nodeName.toLowerCase();return("input"===W||"button"===W)&&M.type===j}}function Ls(j){return function(M){return"form"in M?M.parentNode&&!1===M.disabled?"label"in M?"label"in M.parentNode?M.parentNode.disabled===j:M.disabled===j:M.isDisabled===j||M.isDisabled!==!j&&Js(M)===j:M.disabled===j:"label"in M&&M.disabled===j}}function oi(j){return At(function(M){return M=+M,At(function(W,ae){for(var U,de=j([],W.length,M),he=de.length;he--;)W[U=de[he]]&&(W[U]=!(ae[U]=W[U]))})})}function Os(j){return j&&void 0!==j.getElementsByTagName&&j}for(p in y=Je.support={},O=Je.isXML=function(j){var W=j&&(j.ownerDocument||j).documentElement;return!Xs.test(j&&j.namespaceURI||W&&W.nodeName||"HTML")},R=Je.setDocument=function(j){var M,W,ae=j?j.ownerDocument||j:Ee;return ae!=F&&9===ae.nodeType&&ae.documentElement&&(Z=(F=ae).documentElement,fe=!O(F),Ee!=F&&(W=F.defaultView)&&W.top!==W&&(W.addEventListener?W.addEventListener("unload",Ns,!1):W.attachEvent&&W.attachEvent("onunload",Ns)),y.scope=It(function(U){return Z.appendChild(U).appendChild(F.createElement("div")),void 0!==U.querySelectorAll&&!U.querySelectorAll(":scope fieldset div").length}),y.attributes=It(function(U){return U.className="i",!U.getAttribute("className")}),y.getElementsByTagName=It(function(U){return U.appendChild(F.createComment("")),!U.getElementsByTagName("*").length}),y.getElementsByClassName=Mi.test(F.getElementsByClassName),y.getById=It(function(U){return Z.appendChild(U).id=Fe,!F.getElementsByName||!F.getElementsByName(Fe).length}),y.getById?(b.filter.ID=function(U){var de=U.replace(Ut,Kt);return function(he){return he.getAttribute("id")===de}},b.find.ID=function(U,de){if(void 0!==de.getElementById&&fe){var he=de.getElementById(U);return he?[he]:[]}}):(b.filter.ID=function(U){var de=U.replace(Ut,Kt);return function(he){var we=void 0!==he.getAttributeNode&&he.getAttributeNode("id");return we&&we.value===de}},b.find.ID=function(U,de){if(void 0!==de.getElementById&&fe){var he,we,ve,Ae=de.getElementById(U);if(Ae){if((he=Ae.getAttributeNode("id"))&&he.value===U)return[Ae];for(ve=de.getElementsByName(U),we=0;Ae=ve[we++];)if((he=Ae.getAttributeNode("id"))&&he.value===U)return[Ae]}return[]}}),b.find.TAG=y.getElementsByTagName?function(U,de){return void 0!==de.getElementsByTagName?de.getElementsByTagName(U):y.qsa?de.querySelectorAll(U):void 0}:function(U,de){var he,we=[],ve=0,Ae=de.getElementsByTagName(U);if("*"===U){for(;he=Ae[ve++];)1===he.nodeType&&we.push(he);return we}return Ae},b.find.CLASS=y.getElementsByClassName&&function(U,de){if(void 0!==de.getElementsByClassName&&fe)return de.getElementsByClassName(U)},Me=[],pe=[],(y.qsa=Mi.test(F.querySelectorAll))&&(It(function(U){var de;Z.appendChild(U).innerHTML="<a id='"+Fe+"'></a><select id='"+Fe+"-\r\\' msallowcapture=''><option selected=''></option></select>",U.querySelectorAll("[msallowcapture^='']").length&&pe.push("[*^$]="+je+"*(?:''|\"\")"),U.querySelectorAll("[selected]").length||pe.push("\\["+je+"*(?:value|"+Mt+")"),U.querySelectorAll("[id~="+Fe+"-]").length||pe.push("~="),(de=F.createElement("input")).setAttribute("name",""),U.appendChild(de),U.querySelectorAll("[name='']").length||pe.push("\\["+je+"*name"+je+"*="+je+"*(?:''|\"\")"),U.querySelectorAll(":checked").length||pe.push(":checked"),U.querySelectorAll("a#"+Fe+"+*").length||pe.push(".#.+[+~]"),U.querySelectorAll("\\\f"),pe.push("[\\r\\n\\f]")}),It(function(U){U.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var de=F.createElement("input");de.setAttribute("type","hidden"),U.appendChild(de).setAttribute("name","D"),U.querySelectorAll("[name=d]").length&&pe.push("name"+je+"*[*^$|!~]?="),2!==U.querySelectorAll(":enabled").length&&pe.push(":enabled",":disabled"),Z.appendChild(U).disabled=!0,2!==U.querySelectorAll(":disabled").length&&pe.push(":enabled",":disabled"),U.querySelectorAll("*,:x"),pe.push(",.*:")})),(y.matchesSelector=Mi.test(qe=Z.matches||Z.webkitMatchesSelector||Z.mozMatchesSelector||Z.oMatchesSelector||Z.msMatchesSelector))&&It(function(U){y.disconnectedMatch=qe.call(U,"*"),qe.call(U,"[s!='']:x"),Me.push("!=",St)}),pe=pe.length&&new RegExp(pe.join("|")),Me=Me.length&&new RegExp(Me.join("|")),M=Mi.test(Z.compareDocumentPosition),Ze=M||Mi.test(Z.contains)?function(U,de){var he=9===U.nodeType?U.documentElement:U,we=de&&de.parentNode;return U===we||!(!we||1!==we.nodeType||!(he.contains?he.contains(we):U.compareDocumentPosition&&16&U.compareDocumentPosition(we)))}:function(U,de){if(de)for(;de=de.parentNode;)if(de===U)return!0;return!1},Xt=M?function(U,de){if(U===de)return z=!0,0;var he=!U.compareDocumentPosition-!de.compareDocumentPosition;return he||(1&(he=(U.ownerDocument||U)==(de.ownerDocument||de)?U.compareDocumentPosition(de):1)||!y.sortDetached&&de.compareDocumentPosition(U)===he?U==F||U.ownerDocument==Ee&&Ze(Ee,U)?-1:de==F||de.ownerDocument==Ee&&Ze(Ee,de)?1:x?Tt(x,U)-Tt(x,de):0:4&he?-1:1)}:function(U,de){if(U===de)return z=!0,0;var he,we=0,ve=U.parentNode,Ae=de.parentNode,Oe=[U],De=[de];if(!ve||!Ae)return U==F?-1:de==F?1:ve?-1:Ae?1:x?Tt(x,U)-Tt(x,de):0;if(ve===Ae)return Rs(U,de);for(he=U;he=he.parentNode;)Oe.unshift(he);for(he=de;he=he.parentNode;)De.unshift(he);for(;Oe[we]===De[we];)we++;return we?Rs(Oe[we],De[we]):Oe[we]==Ee?-1:De[we]==Ee?1:0}),F},Je.matches=function(j,M){return Je(j,null,null,M)},Je.matchesSelector=function(j,M){if(R(j),y.matchesSelector&&fe&&!st[M+" "]&&(!Me||!Me.test(M))&&(!pe||!pe.test(M)))try{var W=qe.call(j,M);if(W||y.disconnectedMatch||j.document&&11!==j.document.nodeType)return W}catch(ae){st(M,!0)}return 0<Je(M,F,null,[j]).length},Je.contains=function(j,M){return(j.ownerDocument||j)!=F&&R(j),Ze(j,M)},Je.attr=function(j,M){(j.ownerDocument||j)!=F&&R(j);var W=b.attrHandle[M.toLowerCase()],ae=W&&ki.call(b.attrHandle,M.toLowerCase())?W(j,M,!fe):void 0;return void 0!==ae?ae:y.attributes||!fe?j.getAttribute(M):(ae=j.getAttributeNode(M))&&ae.specified?ae.value:null},Je.escape=function(j){return(j+"").replace(zs,js)},Je.error=function(j){throw new Error("Syntax error, unrecognized expression: "+j)},Je.uniqueSort=function(j){var M,W=[],ae=0,U=0;if(z=!y.detectDuplicates,x=!y.sortStable&&j.slice(0),j.sort(Xt),z){for(;M=j[U++];)M===j[U]&&(ae=W.push(U));for(;ae--;)j.splice(W[ae],1)}return x=null,j},T=Je.getText=function(j){var M,W="",ae=0,U=j.nodeType;if(U){if(1===U||9===U||11===U){if("string"==typeof j.textContent)return j.textContent;for(j=j.firstChild;j;j=j.nextSibling)W+=T(j)}else if(3===U||4===U)return j.nodeValue}else for(;M=j[ae++];)W+=T(M);return W},(b=Je.selectors={cacheLength:50,createPseudo:At,match:rs,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(j){return j[1]=j[1].replace(Ut,Kt),j[3]=(j[3]||j[4]||j[5]||"").replace(Ut,Kt),"~="===j[2]&&(j[3]=" "+j[3]+" "),j.slice(0,4)},CHILD:function(j){return j[1]=j[1].toLowerCase(),"nth"===j[1].slice(0,3)?(j[3]||Je.error(j[0]),j[4]=+(j[4]?j[5]+(j[6]||1):2*("even"===j[3]||"odd"===j[3])),j[5]=+(j[7]+j[8]||"odd"===j[3])):j[3]&&Je.error(j[0]),j},PSEUDO:function(j){var M,W=!j[6]&&j[2];return rs.CHILD.test(j[0])?null:(j[3]?j[2]=j[4]||j[5]||"":W&&Ws.test(W)&&(M=D(W,!0))&&(M=W.indexOf(")",W.length-M)-W.length)&&(j[0]=j[0].slice(0,M),j[2]=W.slice(0,M)),j.slice(0,3))}},filter:{TAG:function(j){var M=j.replace(Ut,Kt).toLowerCase();return"*"===j?function(){return!0}:function(W){return W.nodeName&&W.nodeName.toLowerCase()===M}},CLASS:function(j){var M=Ke[j+" "];return M||(M=new RegExp("(^|"+je+")"+j+"("+je+"|$)"))&&Ke(j,function(W){return M.test("string"==typeof W.className&&W.className||void 0!==W.getAttribute&&W.getAttribute("class")||"")})},ATTR:function(j,M,W){return function(ae){var U=Je.attr(ae,j);return null==U?"!="===M:!M||(U+="","="===M?U===W:"!="===M?U!==W:"^="===M?W&&0===U.indexOf(W):"*="===M?W&&-1<U.indexOf(W):"$="===M?W&&U.slice(-W.length)===W:"~="===M?-1<(" "+U.replace(nt," ")+" ").indexOf(W):"|="===M&&(U===W||U.slice(0,W.length+1)===W+"-"))}},CHILD:function(j,M,W,ae,U){var de="nth"!==j.slice(0,3),he="last"!==j.slice(-4),we="of-type"===M;return 1===ae&&0===U?function(ve){return!!ve.parentNode}:function(ve,Ae,Oe){var De,Pe,lt,Ne,ut,dt,bt=de!==he?"nextSibling":"previousSibling",Ge=ve.parentNode,Ft=we&&ve.nodeName.toLowerCase(),pt=!Oe&&!we,at=!1;if(Ge){if(de){for(;bt;){for(Ne=ve;Ne=Ne[bt];)if(we?Ne.nodeName.toLowerCase()===Ft:1===Ne.nodeType)return!1;dt=bt="only"===j&&!dt&&"nextSibling"}return!0}if(dt=[he?Ge.firstChild:Ge.lastChild],he&&pt){for(at=(ut=(De=(Pe=(lt=(Ne=Ge)[Fe]||(Ne[Fe]={}))[Ne.uniqueID]||(lt[Ne.uniqueID]={}))[j]||[])[0]===tt&&De[1])&&De[2],Ne=ut&&Ge.childNodes[ut];Ne=++ut&&Ne&&Ne[bt]||(at=ut=0)||dt.pop();)if(1===Ne.nodeType&&++at&&Ne===ve){Pe[j]=[tt,ut,at];break}}else if(pt&&(at=ut=(De=(Pe=(lt=(Ne=ve)[Fe]||(Ne[Fe]={}))[Ne.uniqueID]||(lt[Ne.uniqueID]={}))[j]||[])[0]===tt&&De[1]),!1===at)for(;(Ne=++ut&&Ne&&Ne[bt]||(at=ut=0)||dt.pop())&&((we?Ne.nodeName.toLowerCase()!==Ft:1!==Ne.nodeType)||!++at||(pt&&((Pe=(lt=Ne[Fe]||(Ne[Fe]={}))[Ne.uniqueID]||(lt[Ne.uniqueID]={}))[j]=[tt,at]),Ne!==ve)););return(at-=U)===ae||at%ae==0&&0<=at/ae}}},PSEUDO:function(j,M){var W,ae=b.pseudos[j]||b.setFilters[j.toLowerCase()]||Je.error("unsupported pseudo: "+j);return ae[Fe]?ae(M):1<ae.length?(W=[j,j,"",M],b.setFilters.hasOwnProperty(j.toLowerCase())?At(function(U,de){for(var he,we=ae(U,M),ve=we.length;ve--;)U[he=Tt(U,we[ve])]=!(de[he]=we[ve])}):function(U){return ae(U,0,W)}):ae}},pseudos:{not:At(function(j){var M=[],W=[],ae=P(j.replace(Et,"$1"));return ae[Fe]?At(function(U,de,he,we){for(var ve,Ae=ae(U,null,we,[]),Oe=U.length;Oe--;)(ve=Ae[Oe])&&(U[Oe]=!(de[Oe]=ve))}):function(U,de,he){return M[0]=U,ae(M,null,he,W),M[0]=null,!W.pop()}}),has:At(function(j){return function(M){return 0<Je(j,M).length}}),contains:At(function(j){return j=j.replace(Ut,Kt),function(M){return-1<(M.textContent||T(M)).indexOf(j)}}),lang:At(function(j){return Ys.test(j||"")||Je.error("unsupported lang: "+j),j=j.replace(Ut,Kt).toLowerCase(),function(M){var W;do{if(W=fe?M.lang:M.getAttribute("xml:lang")||M.getAttribute("lang"))return(W=W.toLowerCase())===j||0===W.indexOf(j+"-")}while((M=M.parentNode)&&1===M.nodeType);return!1}}),target:function(j){var M=a.location&&a.location.hash;return M&&M.slice(1)===j.id},root:function(j){return j===Z},focus:function(j){return j===F.activeElement&&(!F.hasFocus||F.hasFocus())&&!!(j.type||j.href||~j.tabIndex)},enabled:Ls(!1),disabled:Ls(!0),checked:function(j){var M=j.nodeName.toLowerCase();return"input"===M&&!!j.checked||"option"===M&&!!j.selected},selected:function(j){return!0===j.selected},empty:function(j){for(j=j.firstChild;j;j=j.nextSibling)if(j.nodeType<6)return!1;return!0},parent:function(j){return!b.pseudos.empty(j)},header:function(j){return Ks.test(j.nodeName)},input:function(j){return Us.test(j.nodeName)},button:function(j){var M=j.nodeName.toLowerCase();return"input"===M&&"button"===j.type||"button"===M},text:function(j){var M;return"input"===j.nodeName.toLowerCase()&&"text"===j.type&&(null==(M=j.getAttribute("type"))||"text"===M.toLowerCase())},first:oi(function(){return[0]}),last:oi(function(j,M){return[M-1]}),eq:oi(function(j,M,W){return[W<0?W+M:W]}),even:oi(function(j,M){for(var W=0;W<M;W+=2)j.push(W);return j}),odd:oi(function(j,M){for(var W=1;W<M;W+=2)j.push(W);return j}),lt:oi(function(j,M,W){for(var ae=W<0?W+M:M<W?M:W;0<=--ae;)j.push(ae);return j}),gt:oi(function(j,M,W){for(var ae=W<0?W+M:W;++ae<M;)j.push(ae);return j})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[p]=Gs(p);for(p in{submit:!0,reset:!0})b.pseudos[p]=Qs(p);function Ms(){}function as(j){for(var M=0,W=j.length,ae="";M<W;M++)ae+=j[M].value;return ae}function os(j,M,W){var ae=M.dir,U=M.next,de=U||ae,he=W&&"parentNode"===de,we=ze++;return M.first?function(ve,Ae,Oe){for(;ve=ve[ae];)if(1===ve.nodeType||he)return j(ve,Ae,Oe);return!1}:function(ve,Ae,Oe){var De,Pe,lt,Ne=[tt,we];if(Oe){for(;ve=ve[ae];)if((1===ve.nodeType||he)&&j(ve,Ae,Oe))return!0}else for(;ve=ve[ae];)if(1===ve.nodeType||he)if(Pe=(lt=ve[Fe]||(ve[Fe]={}))[ve.uniqueID]||(lt[ve.uniqueID]={}),U&&U===ve.nodeName.toLowerCase())ve=ve[ae]||ve;else{if((De=Pe[de])&&De[0]===tt&&De[1]===we)return Ne[2]=De[2];if((Pe[de]=Ne)[2]=j(ve,Ae,Oe))return!0}return!1}}function Ds(j){return 1<j.length?function(M,W,ae){for(var U=j.length;U--;)if(!j[U](M,W,ae))return!1;return!0}:j[0]}function us(j,M,W,ae,U){for(var de,he=[],we=0,ve=j.length,Ae=null!=M;we<ve;we++)(de=j[we])&&(W&&!W(de,ae,U)||(he.push(de),Ae&&M.push(we)));return he}function As(j,M,W,ae,U,de){return ae&&!ae[Fe]&&(ae=As(ae)),U&&!U[Fe]&&(U=As(U,de)),At(function(he,we,ve,Ae){var Oe,De,Pe,lt=[],Ne=[],ut=we.length,dt=he||function(Ft,pt,at){for(var zt=0,ds=pt.length;zt<ds;zt++)Je(Ft,pt[zt],at);return at}(M||"*",ve.nodeType?[ve]:ve,[]),bt=!j||!he&&M?dt:us(dt,lt,j,ve,Ae),Ge=W?U||(he?j:ut||ae)?[]:we:bt;if(W&&W(bt,Ge,ve,Ae),ae)for(Oe=us(Ge,Ne),ae(Oe,[],ve,Ae),De=Oe.length;De--;)(Pe=Oe[De])&&(Ge[Ne[De]]=!(bt[Ne[De]]=Pe));if(he){if(U||j){if(U){for(Oe=[],De=Ge.length;De--;)(Pe=Ge[De])&&Oe.push(bt[De]=Pe);U(null,Ge=[],Oe,Ae)}for(De=Ge.length;De--;)(Pe=Ge[De])&&-1<(Oe=U?Tt(he,Pe):lt[De])&&(he[Oe]=!(we[Oe]=Pe))}}else Ge=us(Ge===we?Ge.splice(ut,Ge.length):Ge),U?U(null,we,Ge,Ae):et.apply(we,Ge)})}function Is(j){for(var M,W,ae,U=j.length,de=b.relative[j[0].type],he=de||b.relative[" "],we=de?1:0,ve=os(function(De){return De===M},he,!0),Ae=os(function(De){return-1<Tt(M,De)},he,!0),Oe=[function(De,Pe,lt){var Ne=!de&&(lt||Pe!==d)||((M=Pe).nodeType?ve(De,Pe,lt):Ae(De,Pe,lt));return M=null,Ne}];we<U;we++)if(W=b.relative[j[we].type])Oe=[os(Ds(Oe),W)];else{if((W=b.filter[j[we].type].apply(null,j[we].matches))[Fe]){for(ae=++we;ae<U&&!b.relative[j[ae].type];ae++);return As(1<we&&Ds(Oe),1<we&&as(j.slice(0,we-1).concat({value:" "===j[we-2].type?"*":""})).replace(Et,"$1"),W,we<ae&&Is(j.slice(we,ae)),ae<U&&Is(j=j.slice(ae)),ae<U&&as(j))}Oe.push(W)}return Ds(Oe)}return Ms.prototype=b.filters=b.pseudos,b.setFilters=new Ms,D=Je.tokenize=function(j,M){var W,ae,U,de,he,we,ve,Ae=Lt[j+" "];if(Ae)return M?0:Ae.slice(0);for(he=j,we=[],ve=b.preFilter;he;){for(de in W&&!(ae=Ti.exec(he))||(ae&&(he=he.slice(ae[0].length)||he),we.push(U=[])),W=!1,(ae=ls.exec(he))&&(W=ae.shift(),U.push({value:W,type:ae[0].replace(Et," ")}),he=he.slice(W.length)),b.filter)!(ae=rs[de].exec(he))||ve[de]&&!(ae=ve[de](ae))||(W=ae.shift(),U.push({value:W,type:de,matches:ae}),he=he.slice(W.length));if(!W)break}return M?he.length:he?Je.error(j):Lt(j,we).slice(0)},P=Je.compile=function(j,M){var W,ae,U,de,he,we,ve=[],Ae=[],Oe=$i[j+" "];if(!Oe){for(M||(M=D(j)),W=M.length;W--;)(Oe=Is(M[W]))[Fe]?ve.push(Oe):Ae.push(Oe);(Oe=$i(j,(ae=Ae,de=0<(U=ve).length,he=0<ae.length,we=function(De,Pe,lt,Ne,ut){var dt,bt,Ge,Ft=0,pt="0",at=De&&[],zt=[],ds=d,Fs=De||he&&b.find.TAG("*",ut),Ps=tt+=null==ds?1:Math.random()||.1,Zs=Fs.length;for(ut&&(d=Pe==F||Pe||ut);pt!==Zs&&null!=(dt=Fs[pt]);pt++){if(he&&dt){for(bt=0,Pe||dt.ownerDocument==F||(R(dt),lt=!fe);Ge=ae[bt++];)if(Ge(dt,Pe||F,lt)){Ne.push(dt);break}ut&&(tt=Ps)}de&&((dt=!Ge&&dt)&&Ft--,De&&at.push(dt))}if(Ft+=pt,de&&pt!==Ft){for(bt=0;Ge=U[bt++];)Ge(at,zt,Pe,lt);if(De){if(0<Ft)for(;pt--;)at[pt]||zt[pt]||(zt[pt]=Ci.call(Ne));zt=us(zt)}et.apply(Ne,zt),ut&&!De&&0<zt.length&&1<Ft+U.length&&Je.uniqueSort(Ne)}return ut&&(tt=Ps,d=ds),at},de?At(we):we))).selector=j}return Oe},C=Je.select=function(j,M,W,ae){var U,de,he,we,ve,Ae="function"==typeof j&&j,Oe=!ae&&D(j=Ae.selector||j);if(W=W||[],1===Oe.length){if(2<(de=Oe[0]=Oe[0].slice(0)).length&&"ID"===(he=de[0]).type&&9===M.nodeType&&fe&&b.relative[de[1].type]){if(!(M=(b.find.ID(he.matches[0].replace(Ut,Kt),M)||[])[0]))return W;Ae&&(M=M.parentNode),j=j.slice(de.shift().value.length)}for(U=rs.needsContext.test(j)?0:de.length;U--&&!b.relative[we=(he=de[U]).type];)if((ve=b.find[we])&&(ae=ve(he.matches[0].replace(Ut,Kt),Ss.test(de[0].type)&&Os(M.parentNode)||M))){if(de.splice(U,1),!(j=ae.length&&as(de)))return et.apply(W,ae),W;break}}return(Ae||P(j,Oe))(ae,M,!fe,W,!M||Ss.test(j)&&Os(M.parentNode)||M),W},y.sortStable=Fe.split("").sort(Xt).join("")===Fe,y.detectDuplicates=!!z,R(),y.sortDetached=It(function(j){return 1&j.compareDocumentPosition(F.createElement("fieldset"))}),It(function(j){return j.innerHTML="<a href='#'></a>","#"===j.firstChild.getAttribute("href")})||Es("type|href|height|width",function(j,M,W){if(!W)return j.getAttribute(M,"type"===M.toLowerCase()?1:2)}),y.attributes&&It(function(j){return j.innerHTML="<input/>",j.firstChild.setAttribute("value",""),""===j.firstChild.getAttribute("value")})||Es("value",function(j,M,W){if(!W&&"input"===j.nodeName.toLowerCase())return j.defaultValue}),It(function(j){return null==j.getAttribute("disabled")})||Es(Mt,function(j,M,W){var ae;if(!W)return!0===j[M]?M.toLowerCase():(ae=j.getAttributeNode(M))&&ae.specified?ae.value:null}),Je}(v);f.find=B,f.expr=B.selectors,f.expr[":"]=f.expr.pseudos,f.uniqueSort=f.unique=B.uniqueSort,f.text=B.getText,f.isXMLDoc=B.isXML,f.contains=B.contains,f.escapeSelector=B.escape;var Q=function(a,p,y){for(var b=[],T=void 0!==y;(a=a[p])&&9!==a.nodeType;)if(1===a.nodeType){if(T&&f(a).is(y))break;b.push(a)}return b},X=function(a,p){for(var y=[];a;a=a.nextSibling)1===a.nodeType&&a!==p&&y.push(a);return y},ne=f.expr.match.needsContext;function re(a,p){return a.nodeName&&a.nodeName.toLowerCase()===p.toLowerCase()}var le=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function J(a,p,y){return w(p)?f.grep(a,function(b,T){return!!p.call(b,T,b)!==y}):p.nodeType?f.grep(a,function(b){return b===p!==y}):"string"!=typeof p?f.grep(a,function(b){return-1<r.call(p,b)!==y}):f.filter(p,a,y)}f.filter=function(a,p,y){var b=p[0];return y&&(a=":not("+a+")"),1===p.length&&1===b.nodeType?f.find.matchesSelector(b,a)?[b]:[]:f.find.matches(a,f.grep(p,function(T){return 1===T.nodeType}))},f.fn.extend({find:function(a){var p,y,b=this.length,T=this;if("string"!=typeof a)return this.pushStack(f(a).filter(function(){for(p=0;p<b;p++)if(f.contains(T[p],this))return!0}));for(y=this.pushStack([]),p=0;p<b;p++)f.find(a,T[p],y);return 1<b?f.uniqueSort(y):y},filter:function(a){return this.pushStack(J(this,a||[],!1))},not:function(a){return this.pushStack(J(this,a||[],!0))},is:function(a){return!!J(this,"string"==typeof a&&ne.test(a)?f(a):a||[],!1).length}});var ge,xe=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(f.fn.init=function(a,p,y){var b,T;if(!a)return this;if(y=y||ge,"string"==typeof a){if(!(b="<"===a[0]&&">"===a[a.length-1]&&3<=a.length?[null,a,null]:xe.exec(a))||!b[1]&&p)return!p||p.jquery?(p||y).find(a):this.constructor(p).find(a);if(b[1]){if(f.merge(this,f.parseHTML(b[1],(p=p instanceof f?p[0]:p)&&p.nodeType?p.ownerDocument||p:k,!0)),le.test(b[1])&&f.isPlainObject(p))for(b in p)w(this[b])?this[b](p[b]):this.attr(b,p[b]);return this}return(T=k.getElementById(b[2]))&&(this[0]=T,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):w(a)?void 0!==y.ready?y.ready(a):a(f):f.makeArray(a,this)}).prototype=f.fn,ge=f(k);var Ye=/^(?:parents|prev(?:Until|All))/,Xe={children:!0,contents:!0,next:!0,prev:!0};function Ve(a,p){for(;(a=a[p])&&1!==a.nodeType;);return a}f.fn.extend({has:function(a){var p=f(a,this),y=p.length;return this.filter(function(){for(var b=0;b<y;b++)if(f.contains(this,p[b]))return!0})},closest:function(a,p){var y,b=0,T=this.length,O=[],D="string"!=typeof a&&f(a);if(!ne.test(a))for(;b<T;b++)for(y=this[b];y&&y!==p;y=y.parentNode)if(y.nodeType<11&&(D?-1<D.index(y):1===y.nodeType&&f.find.matchesSelector(y,a))){O.push(y);break}return this.pushStack(1<O.length?f.uniqueSort(O):O)},index:function(a){return a?"string"==typeof a?r.call(f(a),this[0]):r.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,p){return this.pushStack(f.uniqueSort(f.merge(this.get(),f(a,p))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),f.each({parent:function(a){var p=a.parentNode;return p&&11!==p.nodeType?p:null},parents:function(a){return Q(a,"parentNode")},parentsUntil:function(a,p,y){return Q(a,"parentNode",y)},next:function(a){return Ve(a,"nextSibling")},prev:function(a){return Ve(a,"previousSibling")},nextAll:function(a){return Q(a,"nextSibling")},prevAll:function(a){return Q(a,"previousSibling")},nextUntil:function(a,p,y){return Q(a,"nextSibling",y)},prevUntil:function(a,p,y){return Q(a,"previousSibling",y)},siblings:function(a){return X((a.parentNode||{}).firstChild,a)},children:function(a){return X(a.firstChild)},contents:function(a){return null!=a.contentDocument&&i(a.contentDocument)?a.contentDocument:(re(a,"template")&&(a=a.content||a),f.merge([],a.childNodes))}},function(a,p){f.fn[a]=function(y,b){var T=f.map(this,p,y);return"Until"!==a.slice(-5)&&(b=y),b&&"string"==typeof b&&(T=f.filter(b,T)),1<this.length&&(Xe[a]||f.uniqueSort(T),Ye.test(a)&&T.reverse()),this.pushStack(T)}});var He=/[^\x20\t\r\n\f]+/g;function Be(a){return a}function oe(a){throw a}function Ie(a,p,y,b){var T;try{a&&w(T=a.promise)?T.call(a).done(p).fail(y):a&&w(T=a.then)?T.call(a,p,y):p.apply(void 0,[a].slice(b))}catch(O){y.apply(void 0,[O])}}f.Callbacks=function(a){var y;a="string"==typeof a?(y={},f.each(a.match(He)||[],function(R,F){y[F]=!0}),y):f.extend({},a);var b,T,O,D,P=[],C=[],d=-1,x=function(){for(D=D||a.once,O=b=!0;C.length;d=-1)for(T=C.shift();++d<P.length;)!1===P[d].apply(T[0],T[1])&&a.stopOnFalse&&(d=P.length,T=!1);a.memory||(T=!1),b=!1,D&&(P=T?[]:"")},z={add:function(){return P&&(T&&!b&&(d=P.length-1,C.push(T)),function R(F){f.each(F,function(Z,fe){w(fe)?a.unique&&z.has(fe)||P.push(fe):fe&&fe.length&&"string"!==N(fe)&&R(fe)})}(arguments),T&&!b&&x()),this},remove:function(){return f.each(arguments,function(R,F){for(var Z;-1<(Z=f.inArray(F,P,Z));)P.splice(Z,1),Z<=d&&d--}),this},has:function(R){return R?-1<f.inArray(R,P):0<P.length},empty:function(){return P&&(P=[]),this},disable:function(){return D=C=[],P=T="",this},disabled:function(){return!P},lock:function(){return D=C=[],T||b||(P=T=""),this},locked:function(){return!!D},fireWith:function(R,F){return D||(F=[R,(F=F||[]).slice?F.slice():F],C.push(F),b||x()),this},fire:function(){return z.fireWith(this,arguments),this},fired:function(){return!!O}};return z},f.extend({Deferred:function(a){var p=[["notify","progress",f.Callbacks("memory"),f.Callbacks("memory"),2],["resolve","done",f.Callbacks("once memory"),f.Callbacks("once memory"),0,"resolved"],["reject","fail",f.Callbacks("once memory"),f.Callbacks("once memory"),1,"rejected"]],y="pending",b={state:function(){return y},always:function(){return T.done(arguments).fail(arguments),this},catch:function(O){return b.then(null,O)},pipe:function(){var O=arguments;return f.Deferred(function(D){f.each(p,function(P,C){var d=w(O[C[4]])&&O[C[4]];T[C[1]](function(){var x=d&&d.apply(this,arguments);x&&w(x.promise)?x.promise().progress(D.notify).done(D.resolve).fail(D.reject):D[C[0]+"With"](this,d?[x]:arguments)})}),O=null}).promise()},then:function(O,D,P){var C=0;function d(x,z,R,F){return function(){var Z=this,fe=arguments,pe=function(){var qe,Ze;if(!(x<C)){if((qe=R.apply(Z,fe))===z.promise())throw new TypeError("Thenable self-resolution");w(Ze=qe&&("object"==typeof qe||"function"==typeof qe)&&qe.then)?F?Ze.call(qe,d(C,z,Be,F),d(C,z,oe,F)):(C++,Ze.call(qe,d(C,z,Be,F),d(C,z,oe,F),d(C,z,Be,z.notifyWith))):(R!==Be&&(Z=void 0,fe=[qe]),(F||z.resolveWith)(Z,fe))}},Me=F?pe:function(){try{pe()}catch(qe){f.Deferred.exceptionHook&&f.Deferred.exceptionHook(qe,Me.stackTrace),C<=x+1&&(R!==oe&&(Z=void 0,fe=[qe]),z.rejectWith(Z,fe))}};x?Me():(f.Deferred.getStackHook&&(Me.stackTrace=f.Deferred.getStackHook()),v.setTimeout(Me))}}return f.Deferred(function(x){p[0][3].add(d(0,x,w(P)?P:Be,x.notifyWith)),p[1][3].add(d(0,x,w(O)?O:Be)),p[2][3].add(d(0,x,w(D)?D:oe))}).promise()},promise:function(O){return null!=O?f.extend(O,b):b}},T={};return f.each(p,function(O,D){var P=D[2],C=D[5];b[D[1]]=P.add,C&&P.add(function(){y=C},p[3-O][2].disable,p[3-O][3].disable,p[0][2].lock,p[0][3].lock),P.add(D[3].fire),T[D[0]]=function(){return T[D[0]+"With"](this===T?void 0:this,arguments),this},T[D[0]+"With"]=P.fireWith}),b.promise(T),a&&a.call(T,T),T},when:function(a){var p=arguments.length,y=p,b=Array(y),T=s.call(arguments),O=f.Deferred(),D=function(P){return function(C){b[P]=this,T[P]=1<arguments.length?s.call(arguments):C,--p||O.resolveWith(b,T)}};if(p<=1&&(Ie(a,O.done(D(y)).resolve,O.reject,!p),"pending"===O.state()||w(T[y]&&T[y].then)))return O.then();for(;y--;)Ie(T[y],D(y),O.reject);return O.promise()}});var ht=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;f.Deferred.exceptionHook=function(a,p){v.console&&v.console.warn&&a&&ht.test(a.name)&&v.console.warn("jQuery.Deferred exception: "+a.message,a.stack,p)},f.readyException=function(a){v.setTimeout(function(){throw a})};var it=f.Deferred();function rt(){k.removeEventListener("DOMContentLoaded",rt),v.removeEventListener("load",rt),f.ready()}f.fn.ready=function(a){return it.then(a).catch(function(p){f.readyException(p)}),this},f.extend({isReady:!1,readyWait:1,ready:function(a){(!0===a?--f.readyWait:f.isReady)||(f.isReady=!0)!==a&&0<--f.readyWait||it.resolveWith(k,[f])}}),f.ready.then=it.then,"complete"===k.readyState||"loading"!==k.readyState&&!k.documentElement.doScroll?v.setTimeout(f.ready):(k.addEventListener("DOMContentLoaded",rt),v.addEventListener("load",rt));var Qe=function(a,p,y,b,T,O,D){var P=0,C=a.length,d=null==y;if("object"===N(y))for(P in T=!0,y)Qe(a,p,P,y[P],!0,O,D);else if(void 0!==b&&(T=!0,w(b)||(D=!0),d&&(D?(p.call(a,b),p=null):(d=p,p=function(x,z,R){return d.call(f(x),R)})),p))for(;P<C;P++)p(a[P],y,D?b:b.call(a[P],P,p(a[P],y)));return T?a:d?p.call(a):C?p(a[0],y):O},vt=/^-ms-/,Pt=/-([a-z])/g;function ft(a,p){return p.toUpperCase()}function ct(a){return a.replace(vt,"ms-").replace(Pt,ft)}var _t=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function jt(){this.expando=f.expando+jt.uid++}jt.uid=1,jt.prototype={cache:function(a){var p=a[this.expando];return p||(p={},_t(a)&&(a.nodeType?a[this.expando]=p:Object.defineProperty(a,this.expando,{value:p,configurable:!0}))),p},set:function(a,p,y){var b,T=this.cache(a);if("string"==typeof p)T[ct(p)]=y;else for(b in p)T[ct(b)]=p[b];return T},get:function(a,p){return void 0===p?this.cache(a):a[this.expando]&&a[this.expando][ct(p)]},access:function(a,p,y){return void 0===p||p&&"string"==typeof p&&void 0===y?this.get(a,p):(this.set(a,p,y),void 0!==y?y:p)},remove:function(a,p){var y,b=a[this.expando];if(void 0!==b){if(void 0!==p)for((y=(p=Array.isArray(p)?p.map(ct):(p=ct(p))in b?[p]:p.match(He)||[]).length);y--;)delete b[p[y]];(void 0===p||f.isEmptyObject(b))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var p=a[this.expando];return void 0!==p&&!f.isEmptyObject(p)}};var $e=new jt,Ce=new jt,Si=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ui=/[A-Z]/g;function S(a,p,y){var b,T;if(void 0===y&&1===a.nodeType)if(b="data-"+p.replace(ui,"-$&").toLowerCase(),"string"==typeof(y=a.getAttribute(b))){try{y="true"===(T=y)||"false"!==T&&("null"===T?null:T===+T+""?+T:Si.test(T)?JSON.parse(T):T)}catch(O){}Ce.set(a,p,y)}else y=void 0;return y}f.extend({hasData:function(a){return Ce.hasData(a)||$e.hasData(a)},data:function(a,p,y){return Ce.access(a,p,y)},removeData:function(a,p){Ce.remove(a,p)},_data:function(a,p,y){return $e.access(a,p,y)},_removeData:function(a,p){$e.remove(a,p)}}),f.fn.extend({data:function(a,p){var y,b,T,O=this[0],D=O&&O.attributes;if(void 0===a){if(this.length&&(T=Ce.get(O),1===O.nodeType&&!$e.get(O,"hasDataAttrs"))){for(y=D.length;y--;)D[y]&&0===(b=D[y].name).indexOf("data-")&&(b=ct(b.slice(5)),S(O,b,T[b]));$e.set(O,"hasDataAttrs",!0)}return T}return"object"==typeof a?this.each(function(){Ce.set(this,a)}):Qe(this,function(P){var C;if(O&&void 0===P)return void 0!==(C=Ce.get(O,a))||void 0!==(C=S(O,a))?C:void 0;this.each(function(){Ce.set(this,a,P)})},null,p,1<arguments.length,null,!0)},removeData:function(a){return this.each(function(){Ce.remove(this,a)})}}),f.extend({queue:function(a,p,y){var b;if(a)return b=$e.get(a,p=(p||"fx")+"queue"),y&&(!b||Array.isArray(y)?b=$e.access(a,p,f.makeArray(y)):b.push(y)),b||[]},dequeue:function(a,p){var y=f.queue(a,p=p||"fx"),b=y.length,T=y.shift(),O=f._queueHooks(a,p);"inprogress"===T&&(T=y.shift(),b--),T&&("fx"===p&&y.unshift("inprogress"),delete O.stop,T.call(a,function(){f.dequeue(a,p)},O)),!b&&O&&O.empty.fire()},_queueHooks:function(a,p){var y=p+"queueHooks";return $e.get(a,y)||$e.access(a,y,{empty:f.Callbacks("once memory").add(function(){$e.remove(a,[p+"queue",y])})})}}),f.fn.extend({queue:function(a,p){var y=2;return"string"!=typeof a&&(p=a,a="fx",y--),arguments.length<y?f.queue(this[0],a):void 0===p?this:this.each(function(){var b=f.queue(this,a,p);f._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,p){var y,b=1,T=f.Deferred(),O=this,D=this.length,P=function(){--b||T.resolveWith(O,[O])};for("string"!=typeof a&&(p=a,a=void 0),a=a||"fx";D--;)(y=$e.get(O[D],a+"queueHooks"))&&y.empty&&(b++,y.empty.add(P));return P(),T.promise(p)}});var A=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Y=new RegExp("^(?:([+-])=|)("+A+")([a-z%]*)$","i"),K=["Top","Right","Bottom","Left"],q=k.documentElement,G=function(a){return f.contains(a.ownerDocument,a)},V={composed:!0};q.getRootNode&&(G=function(a){return f.contains(a.ownerDocument,a)||a.getRootNode(V)===a.ownerDocument});var ie=function(a,p){return"none"===(a=p||a).style.display||""===a.style.display&&G(a)&&"none"===f.css(a,"display")};function ye(a,p,y,b){var T,O,D=20,P=b?function(){return b.cur()}:function(){return f.css(a,p,"")},C=P(),d=y&&y[3]||(f.cssNumber[p]?"":"px"),x=a.nodeType&&(f.cssNumber[p]||"px"!==d&&+C)&&Y.exec(f.css(a,p));if(x&&x[3]!==d){for(d=d||x[3],x=+(C/=2)||1;D--;)f.style(a,p,x+d),(1-O)*(1-(O=P()/C||.5))<=0&&(D=0),x/=O;f.style(a,p,(x*=2)+d),y=y||[]}return y&&(x=+x||+C||0,T=y[1]?x+(y[1]+1)*y[2]:+y[2],b&&(b.unit=d,b.start=x,b.end=T)),T}var ke={};function Te(a,p){for(var y,b,T,O,D,P,C,d=[],x=0,z=a.length;x<z;x++)(b=a[x]).style&&(y=b.style.display,p?("none"===y&&(d[x]=$e.get(b,"display")||null,d[x]||(b.style.display="")),""===b.style.display&&ie(b)&&(d[x]=(C=D=O=void 0,D=(T=b).ownerDocument,(C=ke[P=T.nodeName])||(O=D.body.appendChild(D.createElement(P)),C=f.css(O,"display"),O.parentNode.removeChild(O),"none"===C&&(C="block"),ke[P]=C)))):"none"!==y&&(d[x]="none",$e.set(b,"display",y)));for(x=0;x<z;x++)null!=d[x]&&(a[x].style.display=d[x]);return a}f.fn.extend({show:function(){return Te(this,!0)},hide:function(){return Te(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){ie(this)?f(this).show():f(this).hide()})}});var be,Re,Se=/^(?:checkbox|radio)$/i,We=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Le=/^$|^module$|\/(?:java|ecma)script/i;be=k.createDocumentFragment().appendChild(k.createElement("div")),(Re=k.createElement("input")).setAttribute("type","radio"),Re.setAttribute("checked","checked"),Re.setAttribute("name","t"),be.appendChild(Re),m.checkClone=be.cloneNode(!0).cloneNode(!0).lastChild.checked,be.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!be.cloneNode(!0).lastChild.defaultValue,be.innerHTML="<option></option>",m.option=!!be.lastChild;var te={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function _e(a,p){var y;return y=void 0!==a.getElementsByTagName?a.getElementsByTagName(p||"*"):void 0!==a.querySelectorAll?a.querySelectorAll(p||"*"):[],void 0===p||p&&re(a,p)?f.merge([a],y):y}function ee(a,p){for(var y=0,b=a.length;y<b;y++)$e.set(a[y],"globalEval",!p||$e.get(p[y],"globalEval"))}te.tbody=te.tfoot=te.colgroup=te.caption=te.thead,te.th=te.td,m.option||(te.optgroup=te.option=[1,"<select multiple='multiple'>","</select>"]);var se=/<|&#?\w+;/;function ue(a,p,y,b,T){for(var O,D,P,C,d,x,z=p.createDocumentFragment(),R=[],F=0,Z=a.length;F<Z;F++)if((O=a[F])||0===O)if("object"===N(O))f.merge(R,O.nodeType?[O]:O);else if(se.test(O)){for(D=D||z.appendChild(p.createElement("div")),P=(We.exec(O)||["",""])[1].toLowerCase(),D.innerHTML=(C=te[P]||te._default)[1]+f.htmlPrefilter(O)+C[2],x=C[0];x--;)D=D.lastChild;f.merge(R,D.childNodes),(D=z.firstChild).textContent=""}else R.push(p.createTextNode(O));for(z.textContent="",F=0;O=R[F++];)if(b&&-1<f.inArray(O,b))T&&T.push(O);else if(d=G(O),D=_e(z.appendChild(O),"script"),d&&ee(D),y)for(x=0;O=D[x++];)Le.test(O.type||"")&&y.push(O);return z}var ce=/^([^.]*)(?:\.(.+)|)/;function me(){return!0}function Dt(){return!1}function Ht(a,p){return a===function(){try{return k.activeElement}catch(y){}}()==("focus"===p)}function $t(a,p,y,b,T,O){var D,P;if("object"==typeof p){for(P in"string"!=typeof y&&(b=b||y,y=void 0),p)$t(a,P,y,b,p[P],O);return a}if(null==b&&null==T?(T=y,b=y=void 0):null==T&&("string"==typeof y?(T=b,b=void 0):(T=b,b=y,y=void 0)),!1===T)T=Dt;else if(!T)return a;return 1===O&&(D=T,(T=function(C){return f().off(C),D.apply(this,arguments)}).guid=D.guid||(D.guid=f.guid++)),a.each(function(){f.event.add(this,p,T,b,y)})}function Vt(a,p,y){y?($e.set(a,p,!1),f.event.add(a,p,{namespace:!1,handler:function(b){var T,O,D=$e.get(this,p);if(1&b.isTrigger&&this[p]){if(D.length)(f.event.special[p]||{}).delegateType&&b.stopPropagation();else if(D=s.call(arguments),$e.set(this,p,D),T=y(this,p),this[p](),D!==(O=$e.get(this,p))||T?$e.set(this,p,!1):O={},D!==O)return b.stopImmediatePropagation(),b.preventDefault(),O&&O.value}else D.length&&($e.set(this,p,{value:f.event.trigger(f.extend(D[0],f.Event.prototype),D.slice(1),this)}),b.stopImmediatePropagation())}})):void 0===$e.get(a,p)&&f.event.add(a,p,me)}f.event={global:{},add:function(a,p,y,b,T){var O,D,P,C,d,x,z,R,F,Z,fe,pe=$e.get(a);if(_t(a))for(y.handler&&(y=(O=y).handler,T=O.selector),T&&f.find.matchesSelector(q,T),y.guid||(y.guid=f.guid++),(C=pe.events)||(C=pe.events=Object.create(null)),(D=pe.handle)||(D=pe.handle=function(Me){return void 0!==f&&f.event.triggered!==Me.type?f.event.dispatch.apply(a,arguments):void 0}),d=(p=(p||"").match(He)||[""]).length;d--;)F=fe=(P=ce.exec(p[d])||[])[1],Z=(P[2]||"").split(".").sort(),F&&(z=f.event.special[F]||{},z=f.event.special[F=(T?z.delegateType:z.bindType)||F]||{},x=f.extend({type:F,origType:fe,data:b,handler:y,guid:y.guid,selector:T,needsContext:T&&f.expr.match.needsContext.test(T),namespace:Z.join(".")},O),(R=C[F])||((R=C[F]=[]).delegateCount=0,z.setup&&!1!==z.setup.call(a,b,Z,D)||a.addEventListener&&a.addEventListener(F,D)),z.add&&(z.add.call(a,x),x.handler.guid||(x.handler.guid=y.guid)),T?R.splice(R.delegateCount++,0,x):R.push(x),f.event.global[F]=!0)},remove:function(a,p,y,b,T){var O,D,P,C,d,x,z,R,F,Z,fe,pe=$e.hasData(a)&&$e.get(a);if(pe&&(C=pe.events)){for(d=(p=(p||"").match(He)||[""]).length;d--;)if(F=fe=(P=ce.exec(p[d])||[])[1],Z=(P[2]||"").split(".").sort(),F){for(z=f.event.special[F]||{},R=C[F=(b?z.delegateType:z.bindType)||F]||[],P=P[2]&&new RegExp("(^|\\.)"+Z.join("\\.(?:.*\\.|)")+"(\\.|$)"),D=O=R.length;O--;)x=R[O],!T&&fe!==x.origType||y&&y.guid!==x.guid||P&&!P.test(x.namespace)||b&&b!==x.selector&&("**"!==b||!x.selector)||(R.splice(O,1),x.selector&&R.delegateCount--,z.remove&&z.remove.call(a,x));D&&!R.length&&(z.teardown&&!1!==z.teardown.call(a,Z,pe.handle)||f.removeEvent(a,F,pe.handle),delete C[F])}else for(F in C)f.event.remove(a,F+p[d],y,b,!0);f.isEmptyObject(C)&&$e.remove(a,"handle events")}},dispatch:function(a){var p,y,b,T,O,D,P=new Array(arguments.length),C=f.event.fix(a),d=($e.get(this,"events")||Object.create(null))[C.type]||[],x=f.event.special[C.type]||{};for(P[0]=C,p=1;p<arguments.length;p++)P[p]=arguments[p];if(C.delegateTarget=this,!x.preDispatch||!1!==x.preDispatch.call(this,C)){for(D=f.event.handlers.call(this,C,d),p=0;(T=D[p++])&&!C.isPropagationStopped();)for(C.currentTarget=T.elem,y=0;(O=T.handlers[y++])&&!C.isImmediatePropagationStopped();)C.rnamespace&&!1!==O.namespace&&!C.rnamespace.test(O.namespace)||(C.handleObj=O,C.data=O.data,void 0!==(b=((f.event.special[O.origType]||{}).handle||O.handler).apply(T.elem,P))&&!1===(C.result=b)&&(C.preventDefault(),C.stopPropagation()));return x.postDispatch&&x.postDispatch.call(this,C),C.result}},handlers:function(a,p){var y,b,T,O,D,P=[],C=p.delegateCount,d=a.target;if(C&&d.nodeType&&!("click"===a.type&&1<=a.button))for(;d!==this;d=d.parentNode||this)if(1===d.nodeType&&("click"!==a.type||!0!==d.disabled)){for(O=[],D={},y=0;y<C;y++)void 0===D[T=(b=p[y]).selector+" "]&&(D[T]=b.needsContext?-1<f(T,this).index(d):f.find(T,this,null,[d]).length),D[T]&&O.push(b);O.length&&P.push({elem:d,handlers:O})}return d=this,C<p.length&&P.push({elem:d,handlers:p.slice(C)}),P},addProp:function(a,p){Object.defineProperty(f.Event.prototype,a,{enumerable:!0,configurable:!0,get:w(p)?function(){if(this.originalEvent)return p(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(y){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:y})}})},fix:function(a){return a[f.expando]?a:new f.Event(a)},special:{load:{noBubble:!0},click:{setup:function(a){var p=this||a;return Se.test(p.type)&&p.click&&re(p,"input")&&Vt(p,"click",me),!1},trigger:function(a){var p=this||a;return Se.test(p.type)&&p.click&&re(p,"input")&&Vt(p,"click"),!0},_default:function(a){var p=a.target;return Se.test(p.type)&&p.click&&re(p,"input")&&$e.get(p,"click")||re(p,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},f.removeEvent=function(a,p,y){a.removeEventListener&&a.removeEventListener(p,y)},f.Event=function(a,p){if(!(this instanceof f.Event))return new f.Event(a,p);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?me:Dt,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,p&&f.extend(this,p),this.timeStamp=a&&a.timeStamp||Date.now(),this[f.expando]=!0},f.Event.prototype={constructor:f.Event,isDefaultPrevented:Dt,isPropagationStopped:Dt,isImmediatePropagationStopped:Dt,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=me,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=me,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=me,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},f.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},f.event.addProp),f.each({focus:"focusin",blur:"focusout"},function(a,p){f.event.special[a]={setup:function(){return Vt(this,a,Ht),!1},trigger:function(){return Vt(this,a),!0},_default:function(y){return $e.get(y.target,a)},delegateType:p}}),f.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,p){f.event.special[a]={delegateType:p,bindType:p,handle:function(y){var b,T=y.relatedTarget,O=y.handleObj;return T&&(T===this||f.contains(this,T))||(y.type=O.origType,b=O.handler.apply(this,arguments),y.type=p),b}}}),f.fn.extend({on:function(a,p,y,b){return $t(this,a,p,y,b)},one:function(a,p,y,b){return $t(this,a,p,y,b,1)},off:function(a,p,y){var b,T;if(a&&a.preventDefault&&a.handleObj)return b=a.handleObj,f(a.delegateTarget).off(b.namespace?b.origType+"."+b.namespace:b.origType,b.selector,b.handler),this;if("object"==typeof a){for(T in a)this.off(T,p,a[T]);return this}return!1!==p&&"function"!=typeof p||(y=p,p=void 0),!1===y&&(y=Dt),this.each(function(){f.event.remove(this,a,y,p)})}});var di=/<script|<style|<link/i,hs=/checked\s*(?:[^=]|=\s*.checked.)/i,fs=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Fi(a,p){return re(a,"table")&&re(11!==p.nodeType?p:p.firstChild,"tr")&&f(a).children("tbody")[0]||a}function ps(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function gs(a){return"true/"===(a.type||"").slice(0,5)?a.type=a.type.slice(5):a.removeAttribute("type"),a}function Pi(a,p){var y,b,T,O,D,P;if(1===p.nodeType){if($e.hasData(a)&&(P=$e.get(a).events))for(T in $e.remove(p,"handle events"),P)for(y=0,b=P[T].length;y<b;y++)f.event.add(p,T,P[T][y]);Ce.hasData(a)&&(O=Ce.access(a),D=f.extend({},O),Ce.set(p,D))}}function Jt(a,p,y,b){p=l(p);var T,O,D,P,C,d,x=0,z=a.length,R=z-1,F=p[0],Z=w(F);if(Z||1<z&&"string"==typeof F&&!m.checkClone&&hs.test(F))return a.each(function(fe){var pe=a.eq(fe);Z&&(p[0]=F.call(this,fe,pe.html())),Jt(pe,p,y,b)});if(z&&(O=(T=ue(p,a[0].ownerDocument,!1,a,b)).firstChild,1===T.childNodes.length&&(T=O),O||b)){for(P=(D=f.map(_e(T,"script"),ps)).length;x<z;x++)C=T,x!==R&&(C=f.clone(C,!0,!0),P&&f.merge(D,_e(C,"script"))),y.call(a[x],C,x);if(P)for(d=D[D.length-1].ownerDocument,f.map(D,gs),x=0;x<P;x++)Le.test((C=D[x]).type||"")&&!$e.access(C,"globalEval")&&f.contains(d,C)&&(C.src&&"module"!==(C.type||"").toLowerCase()?f._evalUrl&&!C.noModule&&f._evalUrl(C.src,{nonce:C.nonce||C.getAttribute("nonce")},d):I(C.textContent.replace(fs,""),C,d))}return a}function Hi(a,p,y){for(var b,T=p?f.filter(p,a):a,O=0;null!=(b=T[O]);O++)y||1!==b.nodeType||f.cleanData(_e(b)),b.parentNode&&(y&&G(b)&&ee(_e(b,"script")),b.parentNode.removeChild(b));return a}f.extend({htmlPrefilter:function(a){return a},clone:function(a,p,y){var b,T,O,D,P,C,d,x=a.cloneNode(!0),z=G(a);if(!(m.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||f.isXMLDoc(a)))for(D=_e(x),b=0,T=(O=_e(a)).length;b<T;b++)P=O[b],"input"===(d=(C=D[b]).nodeName.toLowerCase())&&Se.test(P.type)?C.checked=P.checked:"input"!==d&&"textarea"!==d||(C.defaultValue=P.defaultValue);if(p)if(y)for(O=O||_e(a),D=D||_e(x),b=0,T=O.length;b<T;b++)Pi(O[b],D[b]);else Pi(a,x);return 0<(D=_e(x,"script")).length&&ee(D,!z&&_e(a,"script")),x},cleanData:function(a){for(var p,y,b,T=f.event.special,O=0;void 0!==(y=a[O]);O++)if(_t(y)){if(p=y[$e.expando]){if(p.events)for(b in p.events)T[b]?f.event.remove(y,b):f.removeEvent(y,b,p.handle);y[$e.expando]=void 0}y[Ce.expando]&&(y[Ce.expando]=void 0)}}}),f.fn.extend({detach:function(a){return Hi(this,a,!0)},remove:function(a){return Hi(this,a)},text:function(a){return Qe(this,function(p){return void 0===p?f.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=p)})},null,a,arguments.length)},append:function(){return Jt(this,arguments,function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Fi(this,a).appendChild(a)})},prepend:function(){return Jt(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var p=Fi(this,a);p.insertBefore(a,p.firstChild)}})},before:function(){return Jt(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Jt(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,p=0;null!=(a=this[p]);p++)1===a.nodeType&&(f.cleanData(_e(a,!1)),a.textContent="");return this},clone:function(a,p){return a=null!=a&&a,p=null==p?a:p,this.map(function(){return f.clone(this,a,p)})},html:function(a){return Qe(this,function(p){var y=this[0]||{},b=0,T=this.length;if(void 0===p&&1===y.nodeType)return y.innerHTML;if("string"==typeof p&&!di.test(p)&&!te[(We.exec(p)||["",""])[1].toLowerCase()]){p=f.htmlPrefilter(p);try{for(;b<T;b++)1===(y=this[b]||{}).nodeType&&(f.cleanData(_e(y,!1)),y.innerHTML=p);y=0}catch(O){}}y&&this.empty().append(p)},null,a,arguments.length)},replaceWith:function(){var a=[];return Jt(this,arguments,function(p){var y=this.parentNode;f.inArray(this,a)<0&&(f.cleanData(_e(this)),y&&y.replaceChild(p,this))},a)}}),f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,p){f.fn[a]=function(y){for(var b,T=[],O=f(y),D=O.length-1,P=0;P<=D;P++)b=P===D?this:this.clone(!0),f(O[P])[p](b),n.apply(T,b.get());return this.pushStack(T)}});var mt=new RegExp("^("+A+")(?!px)[a-z%]+$","i"),ci=/^--/,ii=function(a){var p=a.ownerDocument.defaultView;return p&&p.opener||(p=v),p.getComputedStyle(a)},si=function(a,p,y){var b,T,O={};for(T in p)O[T]=a.style[T],a.style[T]=p[T];for(T in b=y.call(a),p)a.style[T]=O[T];return b},Bi=new RegExp(K.join("|"),"i"),hi="[\\x20\\t\\r\\n\\f]",qi=new RegExp("^"+hi+"+|((?:^|[^\\\\])(?:\\\\.)*)"+hi+"+$","g");function Gt(a,p,y){var b,T,O,D,P=ci.test(p),C=a.style;return(y=y||ii(a))&&(D=y.getPropertyValue(p)||y[p],P&&(D=D.replace(qi,"$1")),""!==D||G(a)||(D=f.style(a,p)),!m.pixelBoxStyles()&&mt.test(D)&&Bi.test(p)&&(b=C.width,T=C.minWidth,O=C.maxWidth,C.minWidth=C.maxWidth=C.width=D,D=y.width,C.width=b,C.minWidth=T,C.maxWidth=O)),void 0!==D?D+"":D}function Wi(a,p){return{get:function(){if(!a())return(this.get=p).apply(this,arguments);delete this.get}}}!function(){function a(){if(d){C.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",q.appendChild(C).appendChild(d);var x=v.getComputedStyle(d);y="1%"!==x.top,P=12===p(x.marginLeft),d.style.right="60%",O=36===p(x.right),b=36===p(x.width),d.style.position="absolute",T=12===p(d.offsetWidth/3),q.removeChild(C),d=null}}function p(x){return Math.round(parseFloat(x))}var y,b,T,O,D,P,C=k.createElement("div"),d=k.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,f.extend(m,{boxSizingReliable:function(){return a(),b},pixelBoxStyles:function(){return a(),O},pixelPosition:function(){return a(),y},reliableMarginLeft:function(){return a(),P},scrollboxSize:function(){return a(),T},reliableTrDimensions:function(){var x,z,R,F;return null==D&&(x=k.createElement("table"),z=k.createElement("tr"),R=k.createElement("div"),x.style.cssText="position:absolute;left:-11111px;border-collapse:separate",z.style.cssText="border:1px solid",z.style.height="1px",R.style.height="9px",R.style.display="block",q.appendChild(x).appendChild(z).appendChild(R),F=v.getComputedStyle(z),D=parseInt(F.height,10)+parseInt(F.borderTopWidth,10)+parseInt(F.borderBottomWidth,10)===z.offsetHeight,q.removeChild(x)),D}}))}();var Yi=["Webkit","Moz","ms"],Ei=k.createElement("div").style,Oi={};function fi(a){return f.cssProps[a]||Oi[a]||(a in Ei?a:Oi[a]=function(y){for(var b=y[0].toUpperCase()+y.slice(1),T=Yi.length;T--;)if((y=Yi[T]+b)in Ei)return y}(a)||a)}var ms=/^(none|table(?!-c[ea]).+)/,ys={position:"absolute",visibility:"hidden",display:"block"},Di={letterSpacing:"0",fontWeight:"400"};function Ai(a,p,y){var b=Y.exec(p);return b?Math.max(0,b[2]-(y||0))+(b[3]||"px"):p}function pi(a,p,y,b,T,O){var D="width"===p?1:0,P=0,C=0;if(y===(b?"border":"content"))return 0;for(;D<4;D+=2)"margin"===y&&(C+=f.css(a,y+K[D],!0,T)),b?("content"===y&&(C-=f.css(a,"padding"+K[D],!0,T)),"margin"!==y&&(C-=f.css(a,"border"+K[D]+"Width",!0,T))):(C+=f.css(a,"padding"+K[D],!0,T),"padding"!==y?C+=f.css(a,"border"+K[D]+"Width",!0,T):P+=f.css(a,"border"+K[D]+"Width",!0,T));return!b&&0<=O&&(C+=Math.max(0,Math.ceil(a["offset"+p[0].toUpperCase()+p.slice(1)]-O-C-P-.5))||0),C}function Ii(a,p,y){var b=ii(a),T=(!m.boxSizingReliable()||y)&&"border-box"===f.css(a,"boxSizing",!1,b),O=T,D=Gt(a,p,b),P="offset"+p[0].toUpperCase()+p.slice(1);if(mt.test(D)){if(!y)return D;D="auto"}return(!m.boxSizingReliable()&&T||!m.reliableTrDimensions()&&re(a,"tr")||"auto"===D||!parseFloat(D)&&"inline"===f.css(a,"display",!1,b))&&a.getClientRects().length&&(T="border-box"===f.css(a,"boxSizing",!1,b),(O=P in a)&&(D=a[P])),(D=parseFloat(D)||0)+pi(a,p,y||(T?"border":"content"),O,b,D)+"px"}function wt(a,p,y,b,T){return new wt.prototype.init(a,p,y,b,T)}f.extend({cssHooks:{opacity:{get:function(a,p){if(p){var y=Gt(a,"opacity");return""===y?"1":y}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(a,p,y,b){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var T,O,D,P=ct(p),C=ci.test(p),d=a.style;if(C||(p=fi(P)),D=f.cssHooks[p]||f.cssHooks[P],void 0===y)return D&&"get"in D&&void 0!==(T=D.get(a,!1,b))?T:d[p];"string"==(O=typeof y)&&(T=Y.exec(y))&&T[1]&&(y=ye(a,p,T),O="number"),null!=y&&y==y&&("number"!==O||C||(y+=T&&T[3]||(f.cssNumber[P]?"":"px")),m.clearCloneStyle||""!==y||0!==p.indexOf("background")||(d[p]="inherit"),D&&"set"in D&&void 0===(y=D.set(a,y,b))||(C?d.setProperty(p,y):d[p]=y))}},css:function(a,p,y,b){var T,O,D,P=ct(p);return ci.test(p)||(p=fi(P)),(D=f.cssHooks[p]||f.cssHooks[P])&&"get"in D&&(T=D.get(a,!0,y)),void 0===T&&(T=Gt(a,p,b)),"normal"===T&&p in Di&&(T=Di[p]),""===y||y?(O=parseFloat(T),!0===y||isFinite(O)?O||0:T):T}}),f.each(["height","width"],function(a,p){f.cssHooks[p]={get:function(y,b,T){if(b)return!ms.test(f.css(y,"display"))||y.getClientRects().length&&y.getBoundingClientRect().width?Ii(y,p,T):si(y,ys,function(){return Ii(y,p,T)})},set:function(y,b,T){var O,D=ii(y),P=!m.scrollboxSize()&&"absolute"===D.position,C=(P||T)&&"border-box"===f.css(y,"boxSizing",!1,D),d=T?pi(y,p,T,C,D):0;return C&&P&&(d-=Math.ceil(y["offset"+p[0].toUpperCase()+p.slice(1)]-parseFloat(D[p])-pi(y,p,"border",!1,D)-.5)),d&&(O=Y.exec(b))&&"px"!==(O[3]||"px")&&(y.style[p]=b,b=f.css(y,p)),Ai(0,b,d)}}}),f.cssHooks.marginLeft=Wi(m.reliableMarginLeft,function(a,p){if(p)return(parseFloat(Gt(a,"marginLeft"))||a.getBoundingClientRect().left-si(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),f.each({margin:"",padding:"",border:"Width"},function(a,p){f.cssHooks[a+p]={expand:function(y){for(var b=0,T={},O="string"==typeof y?y.split(" "):[y];b<4;b++)T[a+K[b]+p]=O[b]||O[b-2]||O[0];return T}},"margin"!==a&&(f.cssHooks[a+p].set=Ai)}),f.fn.extend({css:function(a,p){return Qe(this,function(y,b,T){var O,D,P={},C=0;if(Array.isArray(b)){for(O=ii(y),D=b.length;C<D;C++)P[b[C]]=f.css(y,b[C],!1,O);return P}return void 0!==T?f.style(y,b,T):f.css(y,b)},a,p,1<arguments.length)}}),((f.Tween=wt).prototype={constructor:wt,init:function(a,p,y,b,T,O){this.elem=a,this.prop=y,this.easing=T||f.easing._default,this.options=p,this.start=this.now=this.cur(),this.end=b,this.unit=O||(f.cssNumber[y]?"":"px")},cur:function(){var a=wt.propHooks[this.prop];return a&&a.get?a.get(this):wt.propHooks._default.get(this)},run:function(a){var p,y=wt.propHooks[this.prop];return this.pos=p=this.options.duration?f.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*p+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),y&&y.set?y.set(this):wt.propHooks._default.set(this),this}}).init.prototype=wt.prototype,(wt.propHooks={_default:{get:function(a){var p;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(p=f.css(a.elem,a.prop,""))&&"auto"!==p?p:0},set:function(a){f.fx.step[a.prop]?f.fx.step[a.prop](a):1!==a.elem.nodeType||!f.cssHooks[a.prop]&&null==a.elem.style[fi(a.prop)]?a.elem[a.prop]=a.now:f.style(a.elem,a.prop,a.now+a.unit)}}}).scrollTop=wt.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},f.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},f.fx=wt.prototype.init,f.fx.step={};var Nt,gi,Qt,Rt,Xi=/^(?:toggle|show|hide)$/,Ui=/queueHooks$/;function mi(){gi&&(!1===k.hidden&&v.requestAnimationFrame?v.requestAnimationFrame(mi):v.setTimeout(mi,f.fx.interval),f.fx.tick())}function zi(){return v.setTimeout(function(){Nt=void 0}),Nt=Date.now()}function li(a,p){var y,b=0,T={height:a};for(p=p?1:0;b<4;b+=2-p)T["margin"+(y=K[b])]=T["padding"+y]=a;return p&&(T.opacity=T.width=a),T}function ji(a,p,y){for(var b,T=(kt.tweeners[p]||[]).concat(kt.tweeners["*"]),O=0,D=T.length;O<D;O++)if(b=T[O].call(y,p,a))return b}function kt(a,p,y){var b,T,O=0,D=kt.prefilters.length,P=f.Deferred().always(function(){delete C.elem}),C=function(){if(T)return!1;for(var z=Nt||zi(),R=Math.max(0,d.startTime+d.duration-z),F=1-(R/d.duration||0),Z=0,fe=d.tweens.length;Z<fe;Z++)d.tweens[Z].run(F);return P.notifyWith(a,[d,F,R]),F<1&&fe?R:(fe||P.notifyWith(a,[d,1,0]),P.resolveWith(a,[d]),!1)},d=P.promise({elem:a,props:f.extend({},p),opts:f.extend(!0,{specialEasing:{},easing:f.easing._default},y),originalProperties:p,originalOptions:y,startTime:Nt||zi(),duration:y.duration,tweens:[],createTween:function(z,R){var F=f.Tween(a,d.opts,z,R,d.opts.specialEasing[z]||d.opts.easing);return d.tweens.push(F),F},stop:function(z){var R=0,F=z?d.tweens.length:0;if(T)return this;for(T=!0;R<F;R++)d.tweens[R].run(1);return z?(P.notifyWith(a,[d,1,0]),P.resolveWith(a,[d,z])):P.rejectWith(a,[d,z]),this}}),x=d.props;for(function(z,R){var F,Z,fe,pe,Me;for(F in z)if(fe=R[Z=ct(F)],pe=z[F],Array.isArray(pe)&&(fe=pe[1],pe=z[F]=pe[0]),F!==Z&&(z[Z]=pe,delete z[F]),(Me=f.cssHooks[Z])&&"expand"in Me)for(F in pe=Me.expand(pe),delete z[Z],pe)F in z||(z[F]=pe[F],R[F]=fe);else R[Z]=fe}(x,d.opts.specialEasing);O<D;O++)if(b=kt.prefilters[O].call(d,a,x,d.opts))return w(b.stop)&&(f._queueHooks(d.elem,d.opts.queue).stop=b.stop.bind(b)),b;return f.map(x,ji,d),w(d.opts.start)&&d.opts.start.call(a,d),d.progress(d.opts.progress).done(d.opts.done,d.opts.complete).fail(d.opts.fail).always(d.opts.always),f.fx.timer(f.extend(C,{elem:a,anim:d,queue:d.opts.queue})),d}f.Animation=f.extend(kt,{tweeners:{"*":[function(a,p){var y=this.createTween(a,p);return ye(y.elem,a,Y.exec(p),y),y}]},tweener:function(a,p){w(a)?(p=a,a=["*"]):a=a.match(He);for(var y,b=0,T=a.length;b<T;b++)(kt.tweeners[y=a[b]]=kt.tweeners[y]||[]).unshift(p)},prefilters:[function(a,p,y){var b,T,O,D,P,C,d,x,z="width"in p||"height"in p,R=this,F={},Z=a.style,fe=a.nodeType&&ie(a),pe=$e.get(a,"fxshow");for(b in y.queue||(null==(D=f._queueHooks(a,"fx")).unqueued&&(D.unqueued=0,P=D.empty.fire,D.empty.fire=function(){D.unqueued||P()}),D.unqueued++,R.always(function(){R.always(function(){D.unqueued--,f.queue(a,"fx").length||D.empty.fire()})})),p)if(Xi.test(T=p[b])){if(delete p[b],O=O||"toggle"===T,T===(fe?"hide":"show")){if("show"!==T||!pe||void 0===pe[b])continue;fe=!0}F[b]=pe&&pe[b]||f.style(a,b)}if((C=!f.isEmptyObject(p))||!f.isEmptyObject(F))for(b in z&&1===a.nodeType&&(y.overflow=[Z.overflow,Z.overflowX,Z.overflowY],null==(d=pe&&pe.display)&&(d=$e.get(a,"display")),"none"===(x=f.css(a,"display"))&&(d?x=d:(Te([a],!0),d=a.style.display||d,x=f.css(a,"display"),Te([a]))),("inline"===x||"inline-block"===x&&null!=d)&&"none"===f.css(a,"float")&&(C||(R.done(function(){Z.display=d}),null==d&&(d="none"===(x=Z.display)?"":x)),Z.display="inline-block")),y.overflow&&(Z.overflow="hidden",R.always(function(){Z.overflow=y.overflow[0],Z.overflowX=y.overflow[1],Z.overflowY=y.overflow[2]})),C=!1,F)C||(pe?"hidden"in pe&&(fe=pe.hidden):pe=$e.access(a,"fxshow",{display:d}),O&&(pe.hidden=!fe),fe&&Te([a],!0),R.done(function(){for(b in fe||Te([a]),$e.remove(a,"fxshow"),F)f.style(a,b,F[b])})),C=ji(fe?pe[b]:0,b,R),b in pe||(pe[b]=C.start,fe&&(C.end=C.start,C.start=0))}],prefilter:function(a,p){p?kt.prefilters.unshift(a):kt.prefilters.push(a)}}),f.speed=function(a,p,y){var b=a&&"object"==typeof a?f.extend({},a):{complete:y||!y&&p||w(a)&&a,duration:a,easing:y&&p||p&&!w(p)&&p};return f.fx.off?b.duration=0:"number"!=typeof b.duration&&(b.duration=b.duration in f.fx.speeds?f.fx.speeds[b.duration]:f.fx.speeds._default),null!=b.queue&&!0!==b.queue||(b.queue="fx"),b.old=b.complete,b.complete=function(){w(b.old)&&b.old.call(this),b.queue&&f.dequeue(this,b.queue)},b},f.fn.extend({fadeTo:function(a,p,y,b){return this.filter(ie).css("opacity",0).show().end().animate({opacity:p},a,y,b)},animate:function(a,p,y,b){var T=f.isEmptyObject(a),O=f.speed(p,y,b),D=function(){var P=kt(this,f.extend({},a),O);(T||$e.get(this,"finish"))&&P.stop(!0)};return D.finish=D,T||!1===O.queue?this.each(D):this.queue(O.queue,D)},stop:function(a,p,y){var b=function(T){var O=T.stop;delete T.stop,O(y)};return"string"!=typeof a&&(y=p,p=a,a=void 0),p&&this.queue(a||"fx",[]),this.each(function(){var T=!0,O=null!=a&&a+"queueHooks",D=f.timers,P=$e.get(this);if(O)P[O]&&P[O].stop&&b(P[O]);else for(O in P)P[O]&&P[O].stop&&Ui.test(O)&&b(P[O]);for(O=D.length;O--;)D[O].elem!==this||null!=a&&D[O].queue!==a||(D[O].anim.stop(y),T=!1,D.splice(O,1));!T&&y||f.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var p,y=$e.get(this),b=y[a+"queue"],T=y[a+"queueHooks"],O=f.timers,D=b?b.length:0;for(y.finish=!0,f.queue(this,a,[]),T&&T.stop&&T.stop.call(this,!0),p=O.length;p--;)O[p].elem===this&&O[p].queue===a&&(O[p].anim.stop(!0),O.splice(p,1));for(p=0;p<D;p++)b[p]&&b[p].finish&&b[p].finish.call(this);delete y.finish})}}),f.each(["toggle","show","hide"],function(a,p){var y=f.fn[p];f.fn[p]=function(b,T,O){return null==b||"boolean"==typeof b?y.apply(this,arguments):this.animate(li(p,!0),b,T,O)}}),f.each({slideDown:li("show"),slideUp:li("hide"),slideToggle:li("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,p){f.fn[a]=function(y,b,T){return this.animate(p,y,b,T)}}),f.timers=[],f.fx.tick=function(){var a,p=0,y=f.timers;for(Nt=Date.now();p<y.length;p++)(a=y[p])()||y[p]!==a||y.splice(p--,1);y.length||f.fx.stop(),Nt=void 0},f.fx.timer=function(a){f.timers.push(a),f.fx.start()},f.fx.interval=13,f.fx.start=function(){gi||(gi=!0,mi())},f.fx.stop=function(){gi=null},f.fx.speeds={slow:600,fast:200,_default:400},f.fn.delay=function(a,p){return a=f.fx&&f.fx.speeds[a]||a,this.queue(p=p||"fx",function(y,b){var T=v.setTimeout(y,a);b.stop=function(){v.clearTimeout(T)}})},Qt=k.createElement("input"),Rt=k.createElement("select").appendChild(k.createElement("option")),Qt.type="checkbox",m.checkOn=""!==Qt.value,m.optSelected=Rt.selected,(Qt=k.createElement("input")).value="t",Qt.type="radio",m.radioValue="t"===Qt.value;var Ki,yt=f.expr.attrHandle;f.fn.extend({attr:function(a,p){return Qe(this,f.attr,a,p,1<arguments.length)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})}}),f.extend({attr:function(a,p,y){var b,T,O=a.nodeType;if(3!==O&&8!==O&&2!==O)return void 0===a.getAttribute?f.prop(a,p,y):(1===O&&f.isXMLDoc(a)||(T=f.attrHooks[p.toLowerCase()]||(f.expr.match.bool.test(p)?Ki:void 0)),void 0!==y?null===y?void f.removeAttr(a,p):T&&"set"in T&&void 0!==(b=T.set(a,y,p))?b:(a.setAttribute(p,y+""),y):T&&"get"in T&&null!==(b=T.get(a,p))?b:null==(b=f.find.attr(a,p))?void 0:b)},attrHooks:{type:{set:function(a,p){if(!m.radioValue&&"radio"===p&&re(a,"input")){var y=a.value;return a.setAttribute("type",p),y&&(a.value=y),p}}}},removeAttr:function(a,p){var y,b=0,T=p&&p.match(He);if(T&&1===a.nodeType)for(;y=T[b++];)a.removeAttribute(y)}}),Ki={set:function(a,p,y){return!1===p?f.removeAttr(a,y):a.setAttribute(y,y),y}},f.each(f.expr.match.bool.source.match(/\w+/g),function(a,p){var y=yt[p]||f.find.attr;yt[p]=function(b,T,O){var D,P,C=T.toLowerCase();return O||(P=yt[C],yt[C]=D,D=null!=y(b,T,O)?C:null,yt[C]=P),D}});var bs=/^(?:input|select|textarea|button)$/i,ws=/^(?:a|area)$/i;function Bt(a){return(a.match(He)||[]).join(" ")}function qt(a){return a.getAttribute&&a.getAttribute("class")||""}function yi(a){return Array.isArray(a)?a:"string"==typeof a&&a.match(He)||[]}f.fn.extend({prop:function(a,p){return Qe(this,f.prop,a,p,1<arguments.length)},removeProp:function(a){return this.each(function(){delete this[f.propFix[a]||a]})}}),f.extend({prop:function(a,p,y){var b,T,O=a.nodeType;if(3!==O&&8!==O&&2!==O)return 1===O&&f.isXMLDoc(a)||(T=f.propHooks[p=f.propFix[p]||p]),void 0!==y?T&&"set"in T&&void 0!==(b=T.set(a,y,p))?b:a[p]=y:T&&"get"in T&&null!==(b=T.get(a,p))?b:a[p]},propHooks:{tabIndex:{get:function(a){var p=f.find.attr(a,"tabindex");return p?parseInt(p,10):bs.test(a.nodeName)||ws.test(a.nodeName)&&a.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(f.propHooks.selected={get:function(a){return null},set:function(a){}}),f.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){f.propFix[this.toLowerCase()]=this}),f.fn.extend({addClass:function(a){var p,y,b,T,O,D;return w(a)?this.each(function(P){f(this).addClass(a.call(this,P,qt(this)))}):(p=yi(a)).length?this.each(function(){if(b=qt(this),y=1===this.nodeType&&" "+Bt(b)+" "){for(O=0;O<p.length;O++)y.indexOf(" "+(T=p[O])+" ")<0&&(y+=T+" ");D=Bt(y),b!==D&&this.setAttribute("class",D)}}):this},removeClass:function(a){var p,y,b,T,O,D;return w(a)?this.each(function(P){f(this).removeClass(a.call(this,P,qt(this)))}):arguments.length?(p=yi(a)).length?this.each(function(){if(b=qt(this),y=1===this.nodeType&&" "+Bt(b)+" "){for(O=0;O<p.length;O++)for(T=p[O];-1<y.indexOf(" "+T+" ");)y=y.replace(" "+T+" "," ");D=Bt(y),b!==D&&this.setAttribute("class",D)}}):this:this.attr("class","")},toggleClass:function(a,p){var y,b,T,O,D=typeof a,P="string"===D||Array.isArray(a);return w(a)?this.each(function(C){f(this).toggleClass(a.call(this,C,qt(this),p),p)}):"boolean"==typeof p&&P?p?this.addClass(a):this.removeClass(a):(y=yi(a),this.each(function(){if(P)for(O=f(this),T=0;T<y.length;T++)O.hasClass(b=y[T])?O.removeClass(b):O.addClass(b);else void 0!==a&&"boolean"!==D||((b=qt(this))&&$e.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||!1===a?"":$e.get(this,"__className__")||""))}))},hasClass:function(a){var p,y,b=0;for(p=" "+a+" ";y=this[b++];)if(1===y.nodeType&&-1<(" "+Bt(qt(y))+" ").indexOf(p))return!0;return!1}});var xs=/\r/g;f.fn.extend({val:function(a){var p,y,b,T=this[0];return arguments.length?(b=w(a),this.each(function(O){var D;1===this.nodeType&&(null==(D=b?a.call(this,O,f(this).val()):a)?D="":"number"==typeof D?D+="":Array.isArray(D)&&(D=f.map(D,function(P){return null==P?"":P+""})),(p=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()])&&"set"in p&&void 0!==p.set(this,D,"value")||(this.value=D))})):T?(p=f.valHooks[T.type]||f.valHooks[T.nodeName.toLowerCase()])&&"get"in p&&void 0!==(y=p.get(T,"value"))?y:"string"==typeof(y=T.value)?y.replace(xs,""):null==y?"":y:void 0}}),f.extend({valHooks:{option:{get:function(a){var p=f.find.attr(a,"value");return null!=p?p:Bt(f.text(a))}},select:{get:function(a){var p,y,b,T=a.options,O=a.selectedIndex,D="select-one"===a.type,P=D?null:[],C=D?O+1:T.length;for(b=O<0?C:D?O:0;b<C;b++)if(((y=T[b]).selected||b===O)&&!y.disabled&&(!y.parentNode.disabled||!re(y.parentNode,"optgroup"))){if(p=f(y).val(),D)return p;P.push(p)}return P},set:function(a,p){for(var y,b,T=a.options,O=f.makeArray(p),D=T.length;D--;)((b=T[D]).selected=-1<f.inArray(f.valHooks.option.get(b),O))&&(y=!0);return y||(a.selectedIndex=-1),O}}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]={set:function(a,p){if(Array.isArray(p))return a.checked=-1<f.inArray(f(a).val(),p)}},m.checkOn||(f.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),m.focusin="onfocusin"in v;var Vi=/^(?:focusinfocus|focusoutblur)$/,Ji=function(a){a.stopPropagation()};f.extend(f.event,{trigger:function(a,p,y,b){var T,O,D,P,C,d,x,z,R=[y||k],F=u.call(a,"type")?a.type:a,Z=u.call(a,"namespace")?a.namespace.split("."):[];if(O=z=D=y=y||k,3!==y.nodeType&&8!==y.nodeType&&!Vi.test(F+f.event.triggered)&&(-1<F.indexOf(".")&&(F=(Z=F.split(".")).shift(),Z.sort()),C=F.indexOf(":")<0&&"on"+F,(a=a[f.expando]?a:new f.Event(F,"object"==typeof a&&a)).isTrigger=b?2:3,a.namespace=Z.join("."),a.rnamespace=a.namespace?new RegExp("(^|\\.)"+Z.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,a.result=void 0,a.target||(a.target=y),p=null==p?[a]:f.makeArray(p,[a]),x=f.event.special[F]||{},b||!x.trigger||!1!==x.trigger.apply(y,p))){if(!b&&!x.noBubble&&!_(y)){for(Vi.test((P=x.delegateType||F)+F)||(O=O.parentNode);O;O=O.parentNode)R.push(O),D=O;D===(y.ownerDocument||k)&&R.push(D.defaultView||D.parentWindow||v)}for(T=0;(O=R[T++])&&!a.isPropagationStopped();)z=O,a.type=1<T?P:x.bindType||F,(d=($e.get(O,"events")||Object.create(null))[a.type]&&$e.get(O,"handle"))&&d.apply(O,p),(d=C&&O[C])&&d.apply&&_t(O)&&(a.result=d.apply(O,p),!1===a.result&&a.preventDefault());return a.type=F,b||a.isDefaultPrevented()||x._default&&!1!==x._default.apply(R.pop(),p)||!_t(y)||C&&w(y[F])&&!_(y)&&((D=y[C])&&(y[C]=null),f.event.triggered=F,a.isPropagationStopped()&&z.addEventListener(F,Ji),y[F](),a.isPropagationStopped()&&z.removeEventListener(F,Ji),f.event.triggered=void 0,D&&(y[C]=D)),a.result}},simulate:function(a,p,y){var b=f.extend(new f.Event,y,{type:a,isSimulated:!0});f.event.trigger(b,null,p)}}),f.fn.extend({trigger:function(a,p){return this.each(function(){f.event.trigger(a,p,this)})},triggerHandler:function(a,p){var y=this[0];if(y)return f.event.trigger(a,p,y,!0)}}),m.focusin||f.each({focus:"focusin",blur:"focusout"},function(a,p){var y=function(b){f.event.simulate(p,b.target,f.event.fix(b))};f.event.special[p]={setup:function(){var b=this.ownerDocument||this.document||this,T=$e.access(b,p);T||b.addEventListener(a,y,!0),$e.access(b,p,(T||0)+1)},teardown:function(){var b=this.ownerDocument||this.document||this,T=$e.access(b,p)-1;T?$e.access(b,p,T):(b.removeEventListener(a,y,!0),$e.remove(b,p))}}});var ri=v.location,Gi={guid:Date.now()},ni=/\?/;f.parseXML=function(a){var p,y;if(!a||"string"!=typeof a)return null;try{p=(new v.DOMParser).parseFromString(a,"text/xml")}catch(b){}return y=p&&p.getElementsByTagName("parsererror")[0],p&&!y||f.error("Invalid XML: "+(y?f.map(y.childNodes,function(b){return b.textContent}).join("\n"):a)),p};var bi=/\[\]$/,Ni=/\r?\n/g,Qi=/^(?:submit|button|image|reset|file)$/i,wi=/^(?:input|select|textarea|keygen)/i;function xi(a,p,y,b){var T;if(Array.isArray(p))f.each(p,function(O,D){y||bi.test(a)?b(a,D):xi(a+"["+("object"==typeof D&&null!=D?O:"")+"]",D,y,b)});else if(y||"object"!==N(p))b(a,p);else for(T in p)xi(a+"["+T+"]",p[T],y,b)}f.param=function(a,p){var y,b=[],T=function(O,D){var P=w(D)?D():D;b[b.length]=encodeURIComponent(O)+"="+encodeURIComponent(null==P?"":P)};if(null==a)return"";if(Array.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){T(this.name,this.value)});else for(y in a)xi(y,a[y],p,T);return b.join("&")},f.fn.extend({serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=f.prop(this,"elements");return a?f.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!f(this).is(":disabled")&&wi.test(this.nodeName)&&!Qi.test(a)&&(this.checked||!Se.test(a))}).map(function(a,p){var y=f(this).val();return null==y?null:Array.isArray(y)?f.map(y,function(b){return{name:p.name,value:b.replace(Ni,"\r\n")}}):{name:p.name,value:y.replace(Ni,"\r\n")}}).get()}});var vs=/%20/g,_s=/#.*$/,$s=/([?&])_=[^&]*/,Wt=/^(.*?):[ \t]*([^\r\n]*)$/gm,ks=/^(?:GET|HEAD)$/,Cs=/^\/\//,ai={},vi={},Zt="*/".concat("*"),_i=k.createElement("a");function Zi(a){return function(p,y){"string"!=typeof p&&(y=p,p="*");var b,T=0,O=p.toLowerCase().match(He)||[];if(w(y))for(;b=O[T++];)"+"===b[0]?(b=b.slice(1)||"*",(a[b]=a[b]||[]).unshift(y)):(a[b]=a[b]||[]).push(y)}}function es(a,p,y,b){var T={},O=a===vi;function D(P){var C;return T[P]=!0,f.each(a[P]||[],function(d,x){var z=x(p,y,b);return"string"!=typeof z||O||T[z]?O?!(C=z):void 0:(p.dataTypes.unshift(z),D(z),!1)}),C}return D(p.dataTypes[0])||!T["*"]&&D("*")}function Yt(a,p){var y,b,T=f.ajaxSettings.flatOptions||{};for(y in p)void 0!==p[y]&&((T[y]?a:b||(b={}))[y]=p[y]);return b&&f.extend(!0,a,b),a}_i.href=ri.href,f.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ri.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ri.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Zt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":f.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,p){return p?Yt(Yt(a,f.ajaxSettings),p):Yt(f.ajaxSettings,a)},ajaxPrefilter:Zi(ai),ajaxTransport:Zi(vi),ajax:function(a,p){"object"==typeof a&&(p=a,a=void 0);var y,b,T,O,D,P,C,d,x,z,R=f.ajaxSetup({},p=p||{}),F=R.context||R,Z=R.context&&(F.nodeType||F.jquery)?f(F):f.event,fe=f.Deferred(),pe=f.Callbacks("once memory"),Me=R.statusCode||{},qe={},Ze={},Fe="canceled",Ee={readyState:0,getResponseHeader:function(ze){var Ke;if(C){if(!O)for(O={};Ke=Wt.exec(T);)O[Ke[1].toLowerCase()+" "]=(O[Ke[1].toLowerCase()+" "]||[]).concat(Ke[2]);Ke=O[ze.toLowerCase()+" "]}return null==Ke?null:Ke.join(", ")},getAllResponseHeaders:function(){return C?T:null},setRequestHeader:function(ze,Ke){return null==C&&(ze=Ze[ze.toLowerCase()]=Ze[ze.toLowerCase()]||ze,qe[ze]=Ke),this},overrideMimeType:function(ze){return null==C&&(R.mimeType=ze),this},statusCode:function(ze){var Ke;if(ze)if(C)Ee.always(ze[Ee.status]);else for(Ke in ze)Me[Ke]=[Me[Ke],ze[Ke]];return this},abort:function(ze){var Ke=ze||Fe;return y&&y.abort(Ke),tt(0,Ke),this}};if(fe.promise(Ee),R.url=((a||R.url||ri.href)+"").replace(Cs,ri.protocol+"//"),R.type=p.method||p.type||R.method||R.type,R.dataTypes=(R.dataType||"*").toLowerCase().match(He)||[""],null==R.crossDomain){P=k.createElement("a");try{P.href=R.url,P.href=P.href,R.crossDomain=_i.protocol+"//"+_i.host!=P.protocol+"//"+P.host}catch(ze){R.crossDomain=!0}}if(R.data&&R.processData&&"string"!=typeof R.data&&(R.data=f.param(R.data,R.traditional)),es(ai,R,p,Ee),C)return Ee;for(x in(d=f.event&&R.global)&&0==f.active++&&f.event.trigger("ajaxStart"),R.type=R.type.toUpperCase(),R.hasContent=!ks.test(R.type),b=R.url.replace(_s,""),R.hasContent?R.data&&R.processData&&0===(R.contentType||"").indexOf("application/x-www-form-urlencoded")&&(R.data=R.data.replace(vs,"+")):(z=R.url.slice(b.length),R.data&&(R.processData||"string"==typeof R.data)&&(b+=(ni.test(b)?"&":"?")+R.data,delete R.data),!1===R.cache&&(b=b.replace($s,"$1"),z=(ni.test(b)?"&":"?")+"_="+Gi.guid+++z),R.url=b+z),R.ifModified&&(f.lastModified[b]&&Ee.setRequestHeader("If-Modified-Since",f.lastModified[b]),f.etag[b]&&Ee.setRequestHeader("If-None-Match",f.etag[b])),(R.data&&R.hasContent&&!1!==R.contentType||p.contentType)&&Ee.setRequestHeader("Content-Type",R.contentType),Ee.setRequestHeader("Accept",R.dataTypes[0]&&R.accepts[R.dataTypes[0]]?R.accepts[R.dataTypes[0]]+("*"!==R.dataTypes[0]?", "+Zt+"; q=0.01":""):R.accepts["*"]),R.headers)Ee.setRequestHeader(x,R.headers[x]);if(R.beforeSend&&(!1===R.beforeSend.call(F,Ee,R)||C))return Ee.abort();if(Fe="abort",pe.add(R.complete),Ee.done(R.success),Ee.fail(R.error),y=es(vi,R,p,Ee)){if(Ee.readyState=1,d&&Z.trigger("ajaxSend",[Ee,R]),C)return Ee;R.async&&0<R.timeout&&(D=v.setTimeout(function(){Ee.abort("timeout")},R.timeout));try{C=!1,y.send(qe,tt)}catch(ze){if(C)throw ze;tt(-1,ze)}}else tt(-1,"No Transport");function tt(ze,Ke,Lt,$i){var st,Xt,ki,xt,Ci,Ot=Ke;C||(C=!0,D&&v.clearTimeout(D),y=void 0,T=$i||"",Ee.readyState=0<ze?4:0,st=200<=ze&&ze<300||304===ze,Lt&&(xt=function(et,Ct,Tt){for(var Mt,je,Ue,ot,St=et.contents,nt=et.dataTypes;"*"===nt[0];)nt.shift(),void 0===Mt&&(Mt=et.mimeType||Ct.getResponseHeader("Content-Type"));if(Mt)for(je in St)if(St[je]&&St[je].test(Mt)){nt.unshift(je);break}if(nt[0]in Tt)Ue=nt[0];else{for(je in Tt){if(!nt[0]||et.converters[je+" "+nt[0]]){Ue=je;break}ot||(ot=je)}Ue=Ue||ot}if(Ue)return Ue!==nt[0]&&nt.unshift(Ue),Tt[Ue]}(R,Ee,Lt)),!st&&-1<f.inArray("script",R.dataTypes)&&f.inArray("json",R.dataTypes)<0&&(R.converters["text script"]=function(){}),xt=function(et,Ct,Tt,Mt){var je,Ue,ot,St,nt,Et={},Ti=et.dataTypes.slice();if(Ti[1])for(ot in et.converters)Et[ot.toLowerCase()]=et.converters[ot];for(Ue=Ti.shift();Ue;)if(et.responseFields[Ue]&&(Tt[et.responseFields[Ue]]=Ct),!nt&&Mt&&et.dataFilter&&(Ct=et.dataFilter(Ct,et.dataType)),nt=Ue,Ue=Ti.shift())if("*"===Ue)Ue=nt;else if("*"!==nt&&nt!==Ue){if(!(ot=Et[nt+" "+Ue]||Et["* "+Ue]))for(je in Et)if((St=je.split(" "))[1]===Ue&&(ot=Et[nt+" "+St[0]]||Et["* "+St[0]])){!0===ot?ot=Et[je]:!0!==Et[je]&&(Ue=St[0],Ti.unshift(St[1]));break}if(!0!==ot)if(ot&&et.throws)Ct=ot(Ct);else try{Ct=ot(Ct)}catch(ls){return{state:"parsererror",error:ot?ls:"No conversion from "+nt+" to "+Ue}}}return{state:"success",data:Ct}}(R,xt,Ee,st),st?(R.ifModified&&((Ci=Ee.getResponseHeader("Last-Modified"))&&(f.lastModified[b]=Ci),(Ci=Ee.getResponseHeader("etag"))&&(f.etag[b]=Ci)),204===ze||"HEAD"===R.type?Ot="nocontent":304===ze?Ot="notmodified":(Ot=xt.state,Xt=xt.data,st=!(ki=xt.error))):(ki=Ot,!ze&&Ot||(Ot="error",ze<0&&(ze=0))),Ee.status=ze,Ee.statusText=(Ke||Ot)+"",st?fe.resolveWith(F,[Xt,Ot,Ee]):fe.rejectWith(F,[Ee,Ot,ki]),Ee.statusCode(Me),Me=void 0,d&&Z.trigger(st?"ajaxSuccess":"ajaxError",[Ee,R,st?Xt:ki]),pe.fireWith(F,[Ee,Ot]),d&&(Z.trigger("ajaxComplete",[Ee,R]),--f.active||f.event.trigger("ajaxStop")))}return Ee},getJSON:function(a,p,y){return f.get(a,p,y,"json")},getScript:function(a,p){return f.get(a,void 0,p,"script")}}),f.each(["get","post"],function(a,p){f[p]=function(y,b,T,O){return w(b)&&(O=O||T,T=b,b=void 0),f.ajax(f.extend({url:y,type:p,dataType:O,data:b,success:T},f.isPlainObject(y)&&y))}}),f.ajaxPrefilter(function(a){var p;for(p in a.headers)"content-type"===p.toLowerCase()&&(a.contentType=a.headers[p]||"")}),f._evalUrl=function(a,p,y){return f.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(b){f.globalEval(b,p,y)}})},f.fn.extend({wrapAll:function(a){var p;return this[0]&&(w(a)&&(a=a.call(this[0])),p=f(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&p.insertBefore(this[0]),p.map(function(){for(var y=this;y.firstElementChild;)y=y.firstElementChild;return y}).append(this)),this},wrapInner:function(a){return w(a)?this.each(function(p){f(this).wrapInner(a.call(this,p))}):this.each(function(){var p=f(this),y=p.contents();y.length?y.wrapAll(a):p.append(a)})},wrap:function(a){var p=w(a);return this.each(function(y){f(this).wrapAll(p?a.call(this,y):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){f(this).replaceWith(this.childNodes)}),this}}),f.expr.pseudos.hidden=function(a){return!f.expr.pseudos.visible(a)},f.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},f.ajaxSettings.xhr=function(){try{return new v.XMLHttpRequest}catch(a){}};var Ts={0:200,1223:204},ei=f.ajaxSettings.xhr();m.cors=!!ei&&"withCredentials"in ei,m.ajax=ei=!!ei,f.ajaxTransport(function(a){var p,y;if(m.cors||ei&&!a.crossDomain)return{send:function(b,T){var O,D=a.xhr();if(D.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(O in a.xhrFields)D[O]=a.xhrFields[O];for(O in a.mimeType&&D.overrideMimeType&&D.overrideMimeType(a.mimeType),a.crossDomain||b["X-Requested-With"]||(b["X-Requested-With"]="XMLHttpRequest"),b)D.setRequestHeader(O,b[O]);p=function(P){return function(){p&&(p=y=D.onload=D.onerror=D.onabort=D.ontimeout=D.onreadystatechange=null,"abort"===P?D.abort():"error"===P?"number"!=typeof D.status?T(0,"error"):T(D.status,D.statusText):T(Ts[D.status]||D.status,D.statusText,"text"!==(D.responseType||"text")||"string"!=typeof D.responseText?{binary:D.response}:{text:D.responseText},D.getAllResponseHeaders()))}},D.onload=p(),y=D.onerror=D.ontimeout=p("error"),void 0!==D.onabort?D.onabort=y:D.onreadystatechange=function(){4===D.readyState&&v.setTimeout(function(){p&&y()})},p=p("abort");try{D.send(a.hasContent&&a.data||null)}catch(P){if(p)throw P}},abort:function(){p&&p()}}}),f.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return f.globalEval(a),a}}}),f.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),f.ajaxTransport("script",function(a){var p,y;if(a.crossDomain||a.scriptAttrs)return{send:function(b,T){p=f("<script>").attr(a.scriptAttrs||{}).prop({charset:a.scriptCharset,src:a.url}).on("load error",y=function(O){p.remove(),y=null,O&&T("error"===O.type?404:200,O.type)}),k.head.appendChild(p[0])},abort:function(){y&&y()}}});var ts,Ri=[],ti=/(=)\?(?=&|$)|\?\?/;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Ri.pop()||f.expando+"_"+Gi.guid++;return this[a]=!0,a}}),f.ajaxPrefilter("json jsonp",function(a,p,y){var b,T,O,D=!1!==a.jsonp&&(ti.test(a.url)?"url":"string"==typeof a.data&&0===(a.contentType||"").indexOf("application/x-www-form-urlencoded")&&ti.test(a.data)&&"data");if(D||"jsonp"===a.dataTypes[0])return b=a.jsonpCallback=w(a.jsonpCallback)?a.jsonpCallback():a.jsonpCallback,D?a[D]=a[D].replace(ti,"$1"+b):!1!==a.jsonp&&(a.url+=(ni.test(a.url)?"&":"?")+a.jsonp+"="+b),a.converters["script json"]=function(){return O||f.error(b+" was not called"),O[0]},a.dataTypes[0]="json",T=v[b],v[b]=function(){O=arguments},y.always(function(){void 0===T?f(v).removeProp(b):v[b]=T,a[b]&&(a.jsonpCallback=p.jsonpCallback,Ri.push(b)),O&&w(T)&&T(O[0]),O=T=void 0}),"script"}),m.createHTMLDocument=((ts=k.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===ts.childNodes.length),f.parseHTML=function(a,p,y){return"string"!=typeof a?[]:("boolean"==typeof p&&(y=p,p=!1),p||(m.createHTMLDocument?((b=(p=k.implementation.createHTMLDocument("")).createElement("base")).href=k.location.href,p.head.appendChild(b)):p=k),O=!y&&[],(T=le.exec(a))?[p.createElement(T[1])]:(T=ue([a],p,O),O&&O.length&&f(O).remove(),f.merge([],T.childNodes)));var b,T,O},f.fn.load=function(a,p,y){var b,T,O,D=this,P=a.indexOf(" ");return-1<P&&(b=Bt(a.slice(P)),a=a.slice(0,P)),w(p)?(y=p,p=void 0):p&&"object"==typeof p&&(T="POST"),0<D.length&&f.ajax({url:a,type:T||"GET",dataType:"html",data:p}).done(function(C){O=arguments,D.html(b?f("<div>").append(f.parseHTML(C)).find(b):C)}).always(y&&function(C,d){D.each(function(){y.apply(this,O||[C.responseText,d,C])})}),this},f.expr.pseudos.animated=function(a){return f.grep(f.timers,function(p){return a===p.elem}).length},f.offset={setOffset:function(a,p,y){var b,T,O,D,P,C,d=f.css(a,"position"),x=f(a),z={};"static"===d&&(a.style.position="relative"),P=x.offset(),O=f.css(a,"top"),C=f.css(a,"left"),("absolute"===d||"fixed"===d)&&-1<(O+C).indexOf("auto")?(D=(b=x.position()).top,T=b.left):(D=parseFloat(O)||0,T=parseFloat(C)||0),w(p)&&(p=p.call(a,y,f.extend({},P))),null!=p.top&&(z.top=p.top-P.top+D),null!=p.left&&(z.left=p.left-P.left+T),"using"in p?p.using.call(a,z):x.css(z)}},f.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(T){f.offset.setOffset(this,a,T)});var p,y,b=this[0];return b?b.getClientRects().length?{top:(p=b.getBoundingClientRect()).top+(y=b.ownerDocument.defaultView).pageYOffset,left:p.left+y.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var a,p,y,b=this[0],T={top:0,left:0};if("fixed"===f.css(b,"position"))p=b.getBoundingClientRect();else{for(p=this.offset(),y=b.ownerDocument,a=b.offsetParent||y.documentElement;a&&(a===y.body||a===y.documentElement)&&"static"===f.css(a,"position");)a=a.parentNode;a&&a!==b&&1===a.nodeType&&((T=f(a).offset()).top+=f.css(a,"borderTopWidth",!0),T.left+=f.css(a,"borderLeftWidth",!0))}return{top:p.top-T.top-f.css(b,"marginTop",!0),left:p.left-T.left-f.css(b,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===f.css(a,"position");)a=a.offsetParent;return a||q})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,p){var y="pageYOffset"===p;f.fn[a]=function(b){return Qe(this,function(T,O,D){var P;if(_(T)?P=T:9===T.nodeType&&(P=T.defaultView),void 0===D)return P?P[p]:T[O];P?P.scrollTo(y?P.pageXOffset:D,y?D:P.pageYOffset):T[O]=D},a,b,arguments.length)}}),f.each(["top","left"],function(a,p){f.cssHooks[p]=Wi(m.pixelPosition,function(y,b){if(b)return b=Gt(y,p),mt.test(b)?f(y).position()[p]+"px":b})}),f.each({Height:"height",Width:"width"},function(a,p){f.each({padding:"inner"+a,content:p,"":"outer"+a},function(y,b){f.fn[b]=function(T,O){var D=arguments.length&&(y||"boolean"!=typeof T),P=y||(!0===T||!0===O?"margin":"border");return Qe(this,function(C,d,x){var z;return _(C)?0===b.indexOf("outer")?C["inner"+a]:C.document.documentElement["client"+a]:9===C.nodeType?(z=C.documentElement,Math.max(C.body["scroll"+a],z["scroll"+a],C.body["offset"+a],z["offset"+a],z["client"+a])):void 0===x?f.css(C,d,P):f.style(C,d,x,P)},p,D?T:void 0,D)}})}),f.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,p){f.fn[p]=function(y){return this.on(p,y)}}),f.fn.extend({bind:function(a,p,y){return this.on(a,null,p,y)},unbind:function(a,p){return this.off(a,null,p)},delegate:function(a,p,y,b){return this.on(p,a,y,b)},undelegate:function(a,p,y){return 1===arguments.length?this.off(a,"**"):this.off(p,a||"**",y)},hover:function(a,p){return this.mouseenter(a).mouseleave(p||a)}}),f.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,p){f.fn[p]=function(y,b){return 0<arguments.length?this.on(p,null,y,b):this.trigger(p)}});var is=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;f.proxy=function(a,p){var y,b,T;if("string"==typeof p&&(y=a[p],p=a,a=y),w(a))return b=s.call(arguments,2),(T=function(){return a.apply(p||this,b.concat(s.call(arguments)))}).guid=a.guid=a.guid||f.guid++,T},f.holdReady=function(a){a?f.readyWait++:f.ready(!0)},f.isArray=Array.isArray,f.parseJSON=JSON.parse,f.nodeName=re,f.isFunction=w,f.isWindow=_,f.camelCase=ct,f.type=N,f.now=Date.now,f.isNumeric=function(a){var p=f.type(a);return("number"===p||"string"===p)&&!isNaN(a-parseFloat(a))},f.trim=function(a){return null==a?"":(a+"").replace(is,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return f});var Li=v.jQuery,ss=v.$;return f.noConflict=function(a){return v.$===f&&(v.$=ss),a&&v.jQuery===f&&(v.jQuery=Li),f},void 0===e&&(v.jQuery=v.$=f),f}),function(v,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@popperjs/core")):"function"==typeof define&&define.amd?define(["@popperjs/core"],e):(v="undefined"!=typeof globalThis?globalThis:v||self).bootstrap=e(v.Popper)}(this,function(v){"use strict";const t=function e(C){if(C&&C.__esModule)return C;const d=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(C)for(const x in C)if("default"!==x){const z=Object.getOwnPropertyDescriptor(C,x);Object.defineProperty(d,x,z.get?z:{enumerable:!0,get:()=>C[x]})}return d.default=C,Object.freeze(d)}(v),i="transitionend",s=C=>{let d=C.getAttribute("data-bs-target");if(!d||"#"===d){let x=C.getAttribute("href");if(!x||!x.includes("#")&&!x.startsWith("."))return null;x.includes("#")&&!x.startsWith("#")&&(x=`#${x.split("#")[1]}`),d=x&&"#"!==x?x.trim():null}return d},l=C=>{const d=s(C);return d&&document.querySelector(d)?d:null},n=C=>{const d=s(C);return d?document.querySelector(d):null},r=C=>{C.dispatchEvent(new Event(i))},o=C=>!(!C||"object"!=typeof C)&&(void 0!==C.jquery&&(C=C[0]),void 0!==C.nodeType),h=C=>o(C)?C.jquery?C[0]:C:"string"==typeof C&&C.length>0?document.querySelector(C):null,u=C=>{if(!o(C)||0===C.getClientRects().length)return!1;const d="visible"===getComputedStyle(C).getPropertyValue("visibility"),x=C.closest("details:not([open])");if(!x)return d;if(x!==C){const z=C.closest("summary");if(z&&z.parentNode!==x||null===z)return!1}return d},g=C=>!C||C.nodeType!==Node.ELEMENT_NODE||!!C.classList.contains("disabled")||(void 0!==C.disabled?C.disabled:C.hasAttribute("disabled")&&"false"!==C.getAttribute("disabled")),c=C=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof C.getRootNode){const d=C.getRootNode();return d instanceof ShadowRoot?d:null}return C instanceof ShadowRoot?C:C.parentNode?c(C.parentNode):null},m=()=>{},_=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,k=[],E=()=>"rtl"===document.documentElement.dir,I=C=>{var d;d=()=>{const x=_();if(x){const z=C.NAME,R=x.fn[z];x.fn[z]=C.jQueryInterface,x.fn[z].Constructor=C,x.fn[z].noConflict=()=>(x.fn[z]=R,C.jQueryInterface)}},"loading"===document.readyState?(k.length||document.addEventListener("DOMContentLoaded",()=>{for(const x of k)x()}),k.push(d)):d()},N=C=>{"function"==typeof C&&C()},L=(C,d,x=!0)=>{if(!x)return void N(C);const z=(Z=>{if(!Z)return 0;let{transitionDuration:fe,transitionDelay:pe}=window.getComputedStyle(Z);const Me=Number.parseFloat(fe),qe=Number.parseFloat(pe);return Me||qe?(fe=fe.split(",")[0],pe=pe.split(",")[0],1e3*(Number.parseFloat(fe)+Number.parseFloat(pe))):0})(d)+5;let R=!1;const F=({target:Z})=>{Z===d&&(R=!0,d.removeEventListener(i,F),N(C))};d.addEventListener(i,F),setTimeout(()=>{R||r(d)},z)},f=(C,d,x,z)=>{const R=C.length;let F=C.indexOf(d);return-1===F?!x&&z?C[R-1]:C[0]:(F+=x?1:-1,z&&(F=(F+R)%R),C[Math.max(0,Math.min(F,R-1))])},H=/[^.]*(?=\..*)\.|.*/,B=/\..*/,Q=/::\d+$/,X={};let ne=1;const re={mouseenter:"mouseover",mouseleave:"mouseout"},le=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function J(C,d){return d&&`${d}::${ne++}`||C.uidEvent||ne++}function ge(C){const d=J(C);return C.uidEvent=d,X[d]=X[d]||{},X[d]}function xe(C,d,x=null){return Object.values(C).find(z=>z.callable===d&&z.delegationSelector===x)}function Ye(C,d,x){const z="string"==typeof d,R=z?x:d||x;let F=Be(C);return le.has(F)||(F=C),[z,R,F]}function Xe(C,d,x,z,R){if("string"!=typeof d||!C)return;let[F,Z,fe]=Ye(d,x,z);var tt;d in re&&(tt=Z,Z=function(ze){if(!ze.relatedTarget||ze.relatedTarget!==ze.delegateTarget&&!ze.delegateTarget.contains(ze.relatedTarget))return tt.call(this,ze)});const pe=ge(C),Me=pe[fe]||(pe[fe]={}),qe=xe(Me,Z,F?x:null);if(qe)return void(qe.oneOff=qe.oneOff&&R);const Ze=J(Z,d.replace(H,"")),Fe=F?function(Ee,tt,ze){return function Ke(Lt){const $i=Ee.querySelectorAll(tt);for(let{target:st}=Lt;st&&st!==this;st=st.parentNode)for(const Xt of $i)if(Xt===st)return Ie(Lt,{delegateTarget:st}),Ke.oneOff&&oe.off(Ee,Lt.type,tt,ze),ze.apply(st,[Lt])}}(C,x,Z):function(Ee,tt){return function ze(Ke){return Ie(Ke,{delegateTarget:Ee}),ze.oneOff&&oe.off(Ee,Ke.type,tt),tt.apply(Ee,[Ke])}}(C,Z);Fe.delegationSelector=F?x:null,Fe.callable=Z,Fe.oneOff=R,Fe.uidEvent=Ze,Me[Ze]=Fe,C.addEventListener(fe,Fe,F)}function Ve(C,d,x,z,R){const F=xe(d[x],z,R);F&&(C.removeEventListener(x,F,Boolean(R)),delete d[x][F.uidEvent])}function He(C,d,x,z){const R=d[x]||{};for(const F of Object.keys(R))if(F.includes(z)){const Z=R[F];Ve(C,d,x,Z.callable,Z.delegationSelector)}}function Be(C){return C=C.replace(B,""),re[C]||C}const oe={on(C,d,x,z){Xe(C,d,x,z,!1)},one(C,d,x,z){Xe(C,d,x,z,!0)},off(C,d,x,z){if("string"!=typeof d||!C)return;const[R,F,Z]=Ye(d,x,z),fe=Z!==d,pe=ge(C),Me=pe[Z]||{},qe=d.startsWith(".");if(void 0===F){if(qe)for(const Ze of Object.keys(pe))He(C,pe,Ze,d.slice(1));for(const Ze of Object.keys(Me)){const Fe=Ze.replace(Q,"");if(!fe||d.includes(Fe)){const Ee=Me[Ze];Ve(C,pe,Z,Ee.callable,Ee.delegationSelector)}}}else{if(!Object.keys(Me).length)return;Ve(C,pe,Z,F,R?x:null)}},trigger(C,d,x){if("string"!=typeof d||!C)return null;const z=_();let R=null,F=!0,Z=!0,fe=!1;d!==Be(d)&&z&&(R=z.Event(d,x),z(C).trigger(R),F=!R.isPropagationStopped(),Z=!R.isImmediatePropagationStopped(),fe=R.isDefaultPrevented());let pe=new Event(d,{bubbles:F,cancelable:!0});return pe=Ie(pe,x),fe&&pe.preventDefault(),Z&&C.dispatchEvent(pe),pe.defaultPrevented&&R&&R.preventDefault(),pe}};function Ie(C,d){for(const[x,z]of Object.entries(d||{}))try{C[x]=z}catch(R){Object.defineProperty(C,x,{configurable:!0,get:()=>z})}return C}const ht=new Map,it={set(C,d,x){ht.has(C)||ht.set(C,new Map);const z=ht.get(C);z.has(d)||0===z.size?z.set(d,x):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(z.keys())[0]}.`)},get:(C,d)=>ht.has(C)&&ht.get(C).get(d)||null,remove(C,d){if(!ht.has(C))return;const x=ht.get(C);x.delete(d),0===x.size&&ht.delete(C)}};function rt(C){if("true"===C)return!0;if("false"===C)return!1;if(C===Number(C).toString())return Number(C);if(""===C||"null"===C)return null;if("string"!=typeof C)return C;try{return JSON.parse(decodeURIComponent(C))}catch(d){return C}}function Qe(C){return C.replace(/[A-Z]/g,d=>`-${d.toLowerCase()}`)}const vt={setDataAttribute(C,d,x){C.setAttribute(`data-bs-${Qe(d)}`,x)},removeDataAttribute(C,d){C.removeAttribute(`data-bs-${Qe(d)}`)},getDataAttributes(C){if(!C)return{};const d={},x=Object.keys(C.dataset).filter(z=>z.startsWith("bs")&&!z.startsWith("bsConfig"));for(const z of x){let R=z.replace(/^bs/,"");R=R.charAt(0).toLowerCase()+R.slice(1,R.length),d[R]=rt(C.dataset[z])}return d},getDataAttribute:(C,d)=>rt(C.getAttribute(`data-bs-${Qe(d)}`))};class Pt{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(d){return d=this._mergeConfigObj(d),d=this._configAfterMerge(d),this._typeCheckConfig(d),d}_configAfterMerge(d){return d}_mergeConfigObj(d,x){const z=o(x)?vt.getDataAttribute(x,"config"):{};return gt(gt(gt(gt({},this.constructor.Default),"object"==typeof z?z:{}),o(x)?vt.getDataAttributes(x):{}),"object"==typeof d?d:{})}_typeCheckConfig(d,x=this.constructor.DefaultType){for(const R of Object.keys(x)){const F=x[R],Z=d[R],fe=o(Z)?"element":null==(z=Z)?`${z}`:Object.prototype.toString.call(z).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(F).test(fe))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${R}" provided type "${fe}" but expected type "${F}".`)}var z}}class ft extends Pt{constructor(d,x){super(),(d=h(d))&&(this._element=d,this._config=this._getConfig(x),it.set(this._element,this.constructor.DATA_KEY,this))}dispose(){it.remove(this._element,this.constructor.DATA_KEY),oe.off(this._element,this.constructor.EVENT_KEY);for(const d of Object.getOwnPropertyNames(this))this[d]=null}_queueCallback(d,x,z=!0){L(d,x,z)}_getConfig(d){return d=this._mergeConfigObj(d,this._element),d=this._configAfterMerge(d),this._typeCheckConfig(d),d}static getInstance(d){return it.get(h(d),this.DATA_KEY)}static getOrCreateInstance(d,x={}){return this.getInstance(d)||new this(d,"object"==typeof x?x:null)}static get VERSION(){return"5.2.2"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(d){return`${d}${this.EVENT_KEY}`}}const ct=(C,d="hide")=>{const z=C.NAME;oe.on(document,`click.dismiss${C.EVENT_KEY}`,`[data-bs-dismiss="${z}"]`,function(R){if(["A","AREA"].includes(this.tagName)&&R.preventDefault(),g(this))return;const F=n(this)||this.closest(`.${z}`);C.getOrCreateInstance(F)[d]()})};class _t extends ft{static get NAME(){return"alert"}close(){if(oe.trigger(this._element,"close.bs.alert").defaultPrevented)return;this._element.classList.remove("show");const d=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,d)}_destroyElement(){this._element.remove(),oe.trigger(this._element,"closed.bs.alert"),this.dispose()}static jQueryInterface(d){return this.each(function(){const x=_t.getOrCreateInstance(this);if("string"==typeof d){if(void 0===x[d]||d.startsWith("_")||"constructor"===d)throw new TypeError(`No method named "${d}"`);x[d](this)}})}}ct(_t,"close"),I(_t);const jt='[data-bs-toggle="button"]';class $e extends ft{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(d){return this.each(function(){const x=$e.getOrCreateInstance(this);"toggle"===d&&x[d]()})}}oe.on(document,"click.bs.button.data-api",jt,C=>{C.preventDefault();const d=C.target.closest(jt);$e.getOrCreateInstance(d).toggle()}),I($e);const Ce={find:(C,d=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(d,C)),findOne:(C,d=document.documentElement)=>Element.prototype.querySelector.call(d,C),children:(C,d)=>[].concat(...C.children).filter(x=>x.matches(d)),parents(C,d){const x=[];let z=C.parentNode.closest(d);for(;z;)x.push(z),z=z.parentNode.closest(d);return x},prev(C,d){let x=C.previousElementSibling;for(;x;){if(x.matches(d))return[x];x=x.previousElementSibling}return[]},next(C,d){let x=C.nextElementSibling;for(;x;){if(x.matches(d))return[x];x=x.nextElementSibling}return[]},focusableChildren(C){const d=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(x=>`${x}:not([tabindex^="-"])`).join(",");return this.find(d,C).filter(x=>!g(x)&&u(x))}},Si={endCallback:null,leftCallback:null,rightCallback:null},ui={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class S extends Pt{constructor(d,x){super(),this._element=d,d&&S.isSupported()&&(this._config=this._getConfig(x),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return Si}static get DefaultType(){return ui}static get NAME(){return"swipe"}dispose(){oe.off(this._element,".bs.swipe")}_start(d){this._supportPointerEvents?this._eventIsPointerPenTouch(d)&&(this._deltaX=d.clientX):this._deltaX=d.touches[0].clientX}_end(d){this._eventIsPointerPenTouch(d)&&(this._deltaX=d.clientX-this._deltaX),this._handleSwipe(),N(this._config.endCallback)}_move(d){this._deltaX=d.touches&&d.touches.length>1?0:d.touches[0].clientX-this._deltaX}_handleSwipe(){const d=Math.abs(this._deltaX);if(d<=40)return;const x=d/this._deltaX;this._deltaX=0,x&&N(x>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(oe.on(this._element,"pointerdown.bs.swipe",d=>this._start(d)),oe.on(this._element,"pointerup.bs.swipe",d=>this._end(d)),this._element.classList.add("pointer-event")):(oe.on(this._element,"touchstart.bs.swipe",d=>this._start(d)),oe.on(this._element,"touchmove.bs.swipe",d=>this._move(d)),oe.on(this._element,"touchend.bs.swipe",d=>this._end(d)))}_eventIsPointerPenTouch(d){return this._supportPointerEvents&&("pen"===d.pointerType||"touch"===d.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const A="next",Y="prev",K="left",q="right",G="slid.bs.carousel",V="carousel",ie="active",ye={ArrowLeft:q,ArrowRight:K},ke={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Te={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class be extends ft{constructor(d,x){super(d,x),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Ce.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===V&&this.cycle()}static get Default(){return ke}static get DefaultType(){return Te}static get NAME(){return"carousel"}next(){this._slide(A)}nextWhenVisible(){!document.hidden&&u(this._element)&&this.next()}prev(){this._slide(Y)}pause(){this._isSliding&&r(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?oe.one(this._element,G,()=>this.cycle()):this.cycle())}to(d){const x=this._getItems();if(d>x.length-1||d<0)return;if(this._isSliding)return void oe.one(this._element,G,()=>this.to(d));const z=this._getItemIndex(this._getActive());z!==d&&this._slide(d>z?A:Y,x[d])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(d){return d.defaultInterval=d.interval,d}_addEventListeners(){this._config.keyboard&&oe.on(this._element,"keydown.bs.carousel",d=>this._keydown(d)),"hover"===this._config.pause&&(oe.on(this._element,"mouseenter.bs.carousel",()=>this.pause()),oe.on(this._element,"mouseleave.bs.carousel",()=>this._maybeEnableCycle())),this._config.touch&&S.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const x of Ce.find(".carousel-item img",this._element))oe.on(x,"dragstart.bs.carousel",z=>z.preventDefault());this._swipeHelper=new S(this._element,{leftCallback:()=>this._slide(this._directionToOrder(K)),rightCallback:()=>this._slide(this._directionToOrder(q)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}})}_keydown(d){if(/input|textarea/i.test(d.target.tagName))return;const x=ye[d.key];x&&(d.preventDefault(),this._slide(this._directionToOrder(x)))}_getItemIndex(d){return this._getItems().indexOf(d)}_setActiveIndicatorElement(d){if(!this._indicatorsElement)return;const x=Ce.findOne(".active",this._indicatorsElement);x.classList.remove(ie),x.removeAttribute("aria-current");const z=Ce.findOne(`[data-bs-slide-to="${d}"]`,this._indicatorsElement);z&&(z.classList.add(ie),z.setAttribute("aria-current","true"))}_updateInterval(){const d=this._activeElement||this._getActive();if(!d)return;const x=Number.parseInt(d.getAttribute("data-bs-interval"),10);this._config.interval=x||this._config.defaultInterval}_slide(d,x=null){if(this._isSliding)return;const z=this._getActive(),R=d===A,F=x||f(this._getItems(),z,R,this._config.wrap);if(F===z)return;const Z=this._getItemIndex(F),fe=Ze=>oe.trigger(this._element,Ze,{relatedTarget:F,direction:this._orderToDirection(d),from:this._getItemIndex(z),to:Z});if(fe("slide.bs.carousel").defaultPrevented||!z||!F)return;const pe=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Z),this._activeElement=F;const Me=R?"carousel-item-start":"carousel-item-end",qe=R?"carousel-item-next":"carousel-item-prev";F.classList.add(qe),z.classList.add(Me),F.classList.add(Me),this._queueCallback(()=>{F.classList.remove(Me,qe),F.classList.add(ie),z.classList.remove(ie,qe,Me),this._isSliding=!1,fe(G)},z,this._isAnimated()),pe&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Ce.findOne(".active.carousel-item",this._element)}_getItems(){return Ce.find(".carousel-item",this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(d){return E()?d===K?Y:A:d===K?A:Y}_orderToDirection(d){return E()?d===Y?K:q:d===Y?q:K}static jQueryInterface(d){return this.each(function(){const x=be.getOrCreateInstance(this,d);if("number"!=typeof d){if("string"==typeof d){if(void 0===x[d]||d.startsWith("_")||"constructor"===d)throw new TypeError(`No method named "${d}"`);x[d]()}}else x.to(d)})}}oe.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",function(C){const d=n(this);if(!d||!d.classList.contains(V))return;C.preventDefault();const x=be.getOrCreateInstance(d),z=this.getAttribute("data-bs-slide-to");return z?(x.to(z),void x._maybeEnableCycle()):"next"===vt.getDataAttribute(this,"slide")?(x.next(),void x._maybeEnableCycle()):(x.prev(),void x._maybeEnableCycle())}),oe.on(window,"load.bs.carousel.data-api",()=>{const C=Ce.find('[data-bs-ride="carousel"]');for(const d of C)be.getOrCreateInstance(d)}),I(be);const Re="show",Se="collapse",We="collapsing",Le='[data-bs-toggle="collapse"]',te={parent:null,toggle:!0},_e={parent:"(null|element)",toggle:"boolean"};class ee extends ft{constructor(d,x){super(d,x),this._isTransitioning=!1,this._triggerArray=[];const z=Ce.find(Le);for(const R of z){const F=l(R),Z=Ce.find(F).filter(fe=>fe===this._element);null!==F&&Z.length&&this._triggerArray.push(R)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return te}static get DefaultType(){return _e}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let d=[];if(this._config.parent&&(d=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(R=>R!==this._element).map(R=>ee.getOrCreateInstance(R,{toggle:!1}))),d.length&&d[0]._isTransitioning||oe.trigger(this._element,"show.bs.collapse").defaultPrevented)return;for(const R of d)R.hide();const x=this._getDimension();this._element.classList.remove(Se),this._element.classList.add(We),this._element.style[x]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const z=`scroll${x[0].toUpperCase()+x.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(We),this._element.classList.add(Se,Re),this._element.style[x]="",oe.trigger(this._element,"shown.bs.collapse")},this._element,!0),this._element.style[x]=`${this._element[z]}px`}hide(){if(this._isTransitioning||!this._isShown()||oe.trigger(this._element,"hide.bs.collapse").defaultPrevented)return;const d=this._getDimension();this._element.style[d]=`${this._element.getBoundingClientRect()[d]}px`,this._element.classList.add(We),this._element.classList.remove(Se,Re);for(const x of this._triggerArray){const z=n(x);z&&!this._isShown(z)&&this._addAriaAndCollapsedClass([x],!1)}this._isTransitioning=!0,this._element.style[d]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(We),this._element.classList.add(Se),oe.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}_isShown(d=this._element){return d.classList.contains(Re)}_configAfterMerge(d){return d.toggle=Boolean(d.toggle),d.parent=h(d.parent),d}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const d=this._getFirstLevelChildren(Le);for(const x of d){const z=n(x);z&&this._addAriaAndCollapsedClass([x],this._isShown(z))}}_getFirstLevelChildren(d){const x=Ce.find(":scope .collapse .collapse",this._config.parent);return Ce.find(d,this._config.parent).filter(z=>!x.includes(z))}_addAriaAndCollapsedClass(d,x){if(d.length)for(const z of d)z.classList.toggle("collapsed",!x),z.setAttribute("aria-expanded",x)}static jQueryInterface(d){const x={};return"string"==typeof d&&/show|hide/.test(d)&&(x.toggle=!1),this.each(function(){const z=ee.getOrCreateInstance(this,x);if("string"==typeof d){if(void 0===z[d])throw new TypeError(`No method named "${d}"`);z[d]()}})}}oe.on(document,"click.bs.collapse.data-api",Le,function(C){("A"===C.target.tagName||C.delegateTarget&&"A"===C.delegateTarget.tagName)&&C.preventDefault();const d=l(this),x=Ce.find(d);for(const z of x)ee.getOrCreateInstance(z,{toggle:!1}).toggle()}),I(ee);const se="dropdown",ue="ArrowUp",ce="ArrowDown",me="click.bs.dropdown.data-api",Dt="keydown.bs.dropdown.data-api",Ht="show",$t='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Vt=`${$t}.show`,di=".dropdown-menu",hs=E()?"top-end":"top-start",fs=E()?"top-start":"top-end",Fi=E()?"bottom-end":"bottom-start",ps=E()?"bottom-start":"bottom-end",gs=E()?"left-start":"right-start",Pi=E()?"right-start":"left-start",Jt={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Hi={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class mt extends ft{constructor(d,x){super(d,x),this._popper=null,this._parent=this._element.parentNode,this._menu=Ce.next(this._element,di)[0]||Ce.prev(this._element,di)[0]||Ce.findOne(di,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Jt}static get DefaultType(){return Hi}static get NAME(){return se}toggle(){return this._isShown()?this.hide():this.show()}show(){if(g(this._element)||this._isShown())return;const d={relatedTarget:this._element};if(!oe.trigger(this._element,"show.bs.dropdown",d).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const x of[].concat(...document.body.children))oe.on(x,"mouseover",m);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ht),this._element.classList.add(Ht),oe.trigger(this._element,"shown.bs.dropdown",d)}}hide(){!g(this._element)&&this._isShown()&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(d){if(!oe.trigger(this._element,"hide.bs.dropdown",d).defaultPrevented){if("ontouchstart"in document.documentElement)for(const x of[].concat(...document.body.children))oe.off(x,"mouseover",m);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ht),this._element.classList.remove(Ht),this._element.setAttribute("aria-expanded","false"),vt.removeDataAttribute(this._menu,"popper"),oe.trigger(this._element,"hidden.bs.dropdown",d)}}_getConfig(d){if("object"==typeof(d=super._getConfig(d)).reference&&!o(d.reference)&&"function"!=typeof d.reference.getBoundingClientRect)throw new TypeError(`${se.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return d}_createPopper(){if(void 0===t)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let d=this._element;"parent"===this._config.reference?d=this._parent:o(this._config.reference)?d=h(this._config.reference):"object"==typeof this._config.reference&&(d=this._config.reference);const x=this._getPopperConfig();this._popper=t.createPopper(d,this._menu,x)}_isShown(){return this._menu.classList.contains(Ht)}_getPlacement(){const d=this._parent;if(d.classList.contains("dropend"))return gs;if(d.classList.contains("dropstart"))return Pi;if(d.classList.contains("dropup-center"))return"top";if(d.classList.contains("dropdown-center"))return"bottom";const x="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return d.classList.contains("dropup")?x?fs:hs:x?ps:Fi}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:d}=this._config;return"string"==typeof d?d.split(",").map(x=>Number.parseInt(x,10)):"function"==typeof d?x=>d(x,this._element):d}_getPopperConfig(){const d={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(vt.setDataAttribute(this._menu,"popper","static"),d.modifiers=[{name:"applyStyles",enabled:!1}]),gt(gt({},d),"function"==typeof this._config.popperConfig?this._config.popperConfig(d):this._config.popperConfig)}_selectMenuItem({key:d,target:x}){const z=Ce.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(R=>u(R));z.length&&f(z,x,d===ce,!z.includes(x)).focus()}static jQueryInterface(d){return this.each(function(){const x=mt.getOrCreateInstance(this,d);if("string"==typeof d){if(void 0===x[d])throw new TypeError(`No method named "${d}"`);x[d]()}})}static clearMenus(d){if(2===d.button||"keyup"===d.type&&"Tab"!==d.key)return;const x=Ce.find(Vt);for(const z of x){const R=mt.getInstance(z);if(!R||!1===R._config.autoClose)continue;const F=d.composedPath(),Z=F.includes(R._menu);if(F.includes(R._element)||"inside"===R._config.autoClose&&!Z||"outside"===R._config.autoClose&&Z||R._menu.contains(d.target)&&("keyup"===d.type&&"Tab"===d.key||/input|select|option|textarea|form/i.test(d.target.tagName)))continue;const fe={relatedTarget:R._element};"click"===d.type&&(fe.clickEvent=d),R._completeHide(fe)}}static dataApiKeydownHandler(d){const x=/input|textarea/i.test(d.target.tagName),z="Escape"===d.key,R=[ue,ce].includes(d.key);if(!R&&!z||x&&!z)return;d.preventDefault();const F=this.matches($t)?this:Ce.prev(this,$t)[0]||Ce.next(this,$t)[0]||Ce.findOne($t,d.delegateTarget.parentNode),Z=mt.getOrCreateInstance(F);if(R)return d.stopPropagation(),Z.show(),void Z._selectMenuItem(d);Z._isShown()&&(d.stopPropagation(),Z.hide(),F.focus())}}oe.on(document,Dt,$t,mt.dataApiKeydownHandler),oe.on(document,Dt,di,mt.dataApiKeydownHandler),oe.on(document,me,mt.clearMenus),oe.on(document,"keyup.bs.dropdown.data-api",mt.clearMenus),oe.on(document,me,$t,function(C){C.preventDefault(),mt.getOrCreateInstance(this).toggle()}),I(mt);const ci=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",ii=".sticky-top",si="padding-right",Bi="margin-right";class hi{constructor(){this._element=document.body}getWidth(){const d=document.documentElement.clientWidth;return Math.abs(window.innerWidth-d)}hide(){const d=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,si,x=>x+d),this._setElementAttributes(ci,si,x=>x+d),this._setElementAttributes(ii,Bi,x=>x-d)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,si),this._resetElementAttributes(ci,si),this._resetElementAttributes(ii,Bi)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(d,x,z){const R=this.getWidth();this._applyManipulationCallback(d,F=>{if(F!==this._element&&window.innerWidth>F.clientWidth+R)return;this._saveInitialAttribute(F,x);const Z=window.getComputedStyle(F).getPropertyValue(x);F.style.setProperty(x,`${z(Number.parseFloat(Z))}px`)})}_saveInitialAttribute(d,x){const z=d.style.getPropertyValue(x);z&&vt.setDataAttribute(d,x,z)}_resetElementAttributes(d,x){this._applyManipulationCallback(d,z=>{const R=vt.getDataAttribute(z,x);null!==R?(vt.removeDataAttribute(z,x),z.style.setProperty(x,R)):z.style.removeProperty(x)})}_applyManipulationCallback(d,x){if(o(d))x(d);else for(const z of Ce.find(d,this._element))x(z)}}const Gt="mousedown.bs.backdrop",Wi={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Yi={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Ei extends Pt{constructor(d){super(),this._config=this._getConfig(d),this._isAppended=!1,this._element=null}static get Default(){return Wi}static get DefaultType(){return Yi}static get NAME(){return"backdrop"}show(d){if(!this._config.isVisible)return void N(d);this._append();this._getElement().classList.add("show"),this._emulateAnimation(()=>{N(d)})}hide(d){this._config.isVisible?(this._getElement().classList.remove("show"),this._emulateAnimation(()=>{this.dispose(),N(d)})):N(d)}dispose(){this._isAppended&&(oe.off(this._element,Gt),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const d=document.createElement("div");d.className=this._config.className,this._config.isAnimated&&d.classList.add("fade"),this._element=d}return this._element}_configAfterMerge(d){return d.rootElement=h(d.rootElement),d}_append(){if(this._isAppended)return;const d=this._getElement();this._config.rootElement.append(d),oe.on(d,Gt,()=>{N(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(d){L(d,this._getElement(),this._config.isAnimated)}}const Oi=".bs.focustrap",fi="backward",ms={autofocus:!0,trapElement:null},ys={autofocus:"boolean",trapElement:"element"};class Di extends Pt{constructor(d){super(),this._config=this._getConfig(d),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return ms}static get DefaultType(){return ys}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),oe.off(document,Oi),oe.on(document,"focusin.bs.focustrap",d=>this._handleFocusin(d)),oe.on(document,"keydown.tab.bs.focustrap",d=>this._handleKeydown(d)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,oe.off(document,Oi))}_handleFocusin(d){const{trapElement:x}=this._config;if(d.target===document||d.target===x||x.contains(d.target))return;const z=Ce.focusableChildren(x);0===z.length?x.focus():this._lastTabNavDirection===fi?z[z.length-1].focus():z[0].focus()}_handleKeydown(d){"Tab"===d.key&&(this._lastTabNavDirection=d.shiftKey?fi:"forward")}}const Ai="hidden.bs.modal",pi="show.bs.modal",Ii="modal-open",Nt="modal-static",gi={backdrop:!0,focus:!0,keyboard:!0},Qt={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Rt extends ft{constructor(d,x){super(d,x),this._dialog=Ce.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new hi,this._addEventListeners()}static get Default(){return gi}static get DefaultType(){return Qt}static get NAME(){return"modal"}toggle(d){return this._isShown?this.hide():this.show(d)}show(d){this._isShown||this._isTransitioning||oe.trigger(this._element,pi,{relatedTarget:d}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Ii),this._adjustDialog(),this._backdrop.show(()=>this._showElement(d)))}hide(){this._isShown&&!this._isTransitioning&&(oe.trigger(this._element,"hide.bs.modal").defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove("show"),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){for(const d of[window,this._dialog])oe.off(d,".bs.modal");this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Ei({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Di({trapElement:this._element})}_showElement(d){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const x=Ce.findOne(".modal-body",this._dialog);x&&(x.scrollTop=0),this._element.classList.add("show"),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,oe.trigger(this._element,"shown.bs.modal",{relatedTarget:d})},this._dialog,this._isAnimated())}_addEventListeners(){oe.on(this._element,"keydown.dismiss.bs.modal",d=>{if("Escape"===d.key)return this._config.keyboard?(d.preventDefault(),void this.hide()):void this._triggerBackdropTransition()}),oe.on(window,"resize.bs.modal",()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),oe.on(this._element,"mousedown.dismiss.bs.modal",d=>{oe.one(this._element,"click.dismiss.bs.modal",x=>{this._element===d.target&&this._element===x.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Ii),this._resetAdjustments(),this._scrollBar.reset(),oe.trigger(this._element,Ai)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(oe.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented)return;const d=this._element.scrollHeight>document.documentElement.clientHeight,x=this._element.style.overflowY;"hidden"===x||this._element.classList.contains(Nt)||(d||(this._element.style.overflowY="hidden"),this._element.classList.add(Nt),this._queueCallback(()=>{this._element.classList.remove(Nt),this._queueCallback(()=>{this._element.style.overflowY=x},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const d=this._element.scrollHeight>document.documentElement.clientHeight,x=this._scrollBar.getWidth(),z=x>0;if(z&&!d){const R=E()?"paddingLeft":"paddingRight";this._element.style[R]=`${x}px`}if(!z&&d){const R=E()?"paddingRight":"paddingLeft";this._element.style[R]=`${x}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(d,x){return this.each(function(){const z=Rt.getOrCreateInstance(this,d);if("string"==typeof d){if(void 0===z[d])throw new TypeError(`No method named "${d}"`);z[d](x)}})}}oe.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(C){const d=n(this);["A","AREA"].includes(this.tagName)&&C.preventDefault(),oe.one(d,pi,z=>{z.defaultPrevented||oe.one(d,Ai,()=>{u(this)&&this.focus()})});const x=Ce.findOne(".modal.show");x&&Rt.getInstance(x).hide(),Rt.getOrCreateInstance(d).toggle(this)}),ct(Rt),I(Rt);const Ui="showing",zi=".offcanvas.show",li="hidePrevented.bs.offcanvas",ji="hidden.bs.offcanvas",kt={backdrop:!0,keyboard:!0,scroll:!1},Ki={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class yt extends ft{constructor(d,x){super(d,x),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return kt}static get DefaultType(){return Ki}static get NAME(){return"offcanvas"}toggle(d){return this._isShown?this.hide():this.show(d)}show(d){this._isShown||oe.trigger(this._element,"show.bs.offcanvas",{relatedTarget:d}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new hi).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Ui),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add("show"),this._element.classList.remove(Ui),oe.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:d})},this._element,!0))}hide(){this._isShown&&(oe.trigger(this._element,"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add("hiding"),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove("show","hiding"),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new hi).reset(),oe.trigger(this._element,ji)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const d=Boolean(this._config.backdrop);return new Ei({className:"offcanvas-backdrop",isVisible:d,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:d?()=>{"static"!==this._config.backdrop?this.hide():oe.trigger(this._element,li)}:null})}_initializeFocusTrap(){return new Di({trapElement:this._element})}_addEventListeners(){oe.on(this._element,"keydown.dismiss.bs.offcanvas",d=>{"Escape"===d.key&&(this._config.keyboard?this.hide():oe.trigger(this._element,li))})}static jQueryInterface(d){return this.each(function(){const x=yt.getOrCreateInstance(this,d);if("string"==typeof d){if(void 0===x[d]||d.startsWith("_")||"constructor"===d)throw new TypeError(`No method named "${d}"`);x[d](this)}})}}oe.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(C){const d=n(this);if(["A","AREA"].includes(this.tagName)&&C.preventDefault(),g(this))return;oe.one(d,ji,()=>{u(this)&&this.focus()});const x=Ce.findOne(zi);x&&x!==d&&yt.getInstance(x).hide(),yt.getOrCreateInstance(d).toggle(this)}),oe.on(window,"load.bs.offcanvas.data-api",()=>{for(const C of Ce.find(zi))yt.getOrCreateInstance(C).show()}),oe.on(window,"resize.bs.offcanvas",()=>{for(const C of Ce.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(C).position&&yt.getOrCreateInstance(C).hide()}),ct(yt),I(yt);const bs=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),ws=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,Bt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,qt=(C,d)=>{const x=C.nodeName.toLowerCase();return d.includes(x)?!bs.has(x)||Boolean(ws.test(C.nodeValue)||Bt.test(C.nodeValue)):d.filter(z=>z instanceof RegExp).some(z=>z.test(x))},yi={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},xs={allowList:yi,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Vi={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Ji={entry:"(string|element|function|null)",selector:"(string|element)"};class ri extends Pt{constructor(d){super(),this._config=this._getConfig(d)}static get Default(){return xs}static get DefaultType(){return Vi}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(d=>this._resolvePossibleFunction(d)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(d){return this._checkContent(d),this._config.content=gt(gt({},this._config.content),d),this}toHtml(){const d=document.createElement("div");d.innerHTML=this._maybeSanitize(this._config.template);for(const[R,F]of Object.entries(this._config.content))this._setContent(d,F,R);const x=d.children[0],z=this._resolvePossibleFunction(this._config.extraClass);return z&&x.classList.add(...z.split(" ")),x}_typeCheckConfig(d){super._typeCheckConfig(d),this._checkContent(d.content)}_checkContent(d){for(const[x,z]of Object.entries(d))super._typeCheckConfig({selector:x,entry:z},Ji)}_setContent(d,x,z){const R=Ce.findOne(z,d);R&&((x=this._resolvePossibleFunction(x))?o(x)?this._putElementInTemplate(h(x),R):this._config.html?R.innerHTML=this._maybeSanitize(x):R.textContent=x:R.remove())}_maybeSanitize(d){return this._config.sanitize?function(x,z,R){if(!x.length)return x;if(R&&"function"==typeof R)return R(x);const F=(new window.DOMParser).parseFromString(x,"text/html"),Z=[].concat(...F.body.querySelectorAll("*"));for(const fe of Z){const pe=fe.nodeName.toLowerCase();if(!Object.keys(z).includes(pe)){fe.remove();continue}const Me=[].concat(...fe.attributes),qe=[].concat(z["*"]||[],z[pe]||[]);for(const Ze of Me)qt(Ze,qe)||fe.removeAttribute(Ze.nodeName)}return F.body.innerHTML}(d,this._config.allowList,this._config.sanitizeFn):d}_resolvePossibleFunction(d){return"function"==typeof d?d(this):d}_putElementInTemplate(d,x){if(this._config.html)return x.innerHTML="",void x.append(d);x.textContent=d.textContent}}const Gi=new Set(["sanitize","allowList","sanitizeFn"]),ni="fade",bi="show",Qi="hide.bs.modal",wi="hover",vs={AUTO:"auto",TOP:"top",RIGHT:E()?"left":"right",BOTTOM:"bottom",LEFT:E()?"right":"left"},_s={allowList:yi,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,0],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},$s={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Wt extends ft{constructor(d,x){if(void 0===t)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(d,x),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return _s}static get DefaultType(){return $s}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),oe.off(this._element.closest(".modal"),Qi,this._hideModalHandler),this.tip&&this.tip.remove(),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const d=oe.trigger(this._element,this.constructor.eventName("show")),x=(c(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(d.defaultPrevented||!x)return;this.tip&&(this.tip.remove(),this.tip=null);const z=this._getTipElement();this._element.setAttribute("aria-describedby",z.getAttribute("id"));const{container:R}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(R.append(z),oe.trigger(this._element,this.constructor.eventName("inserted"))),this._popper?this._popper.update():this._popper=this._createPopper(z),z.classList.add(bi),"ontouchstart"in document.documentElement)for(const F of[].concat(...document.body.children))oe.on(F,"mouseover",m);this._queueCallback(()=>{oe.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(!this._isShown()||oe.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented)return;const d=this._getTipElement();if(d.classList.remove(bi),"ontouchstart"in document.documentElement)for(const x of[].concat(...document.body.children))oe.off(x,"mouseover",m);this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||d.remove(),this._element.removeAttribute("aria-describedby"),oe.trigger(this._element,this.constructor.eventName("hidden")),this._disposePopper())},this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(d){const x=this._getTemplateFactory(d).toHtml();if(!x)return null;x.classList.remove(ni,bi),x.classList.add(`bs-${this.constructor.NAME}-auto`);const z=(R=>{do{R+=Math.floor(1e6*Math.random())}while(document.getElementById(R));return R})(this.constructor.NAME).toString();return x.setAttribute("id",z),this._isAnimated()&&x.classList.add(ni),x}setContent(d){this._newContent=d,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(d){return this._templateFactory?this._templateFactory.changeContent(d):this._templateFactory=new ri(cs(gt({},this._config),{content:d,extraClass:this._resolvePossibleFunction(this._config.customClass)})),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(d){return this.constructor.getOrCreateInstance(d.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(ni)}_isShown(){return this.tip&&this.tip.classList.contains(bi)}_createPopper(d){const x="function"==typeof this._config.placement?this._config.placement.call(this,d,this._element):this._config.placement,z=vs[x.toUpperCase()];return t.createPopper(this._element,d,this._getPopperConfig(z))}_getOffset(){const{offset:d}=this._config;return"string"==typeof d?d.split(",").map(x=>Number.parseInt(x,10)):"function"==typeof d?x=>d(x,this._element):d}_resolvePossibleFunction(d){return"function"==typeof d?d.call(this._element):d}_getPopperConfig(d){const x={placement:d,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:z=>{this._getTipElement().setAttribute("data-popper-placement",z.state.placement)}}]};return gt(gt({},x),"function"==typeof this._config.popperConfig?this._config.popperConfig(x):this._config.popperConfig)}_setListeners(){const d=this._config.trigger.split(" ");for(const x of d)if("click"===x)oe.on(this._element,this.constructor.eventName("click"),this._config.selector,z=>{this._initializeOnDelegatedTarget(z).toggle()});else if("manual"!==x){const z=this.constructor.eventName(x===wi?"mouseenter":"focusin"),R=this.constructor.eventName(x===wi?"mouseleave":"focusout");oe.on(this._element,z,this._config.selector,F=>{const Z=this._initializeOnDelegatedTarget(F);Z._activeTrigger["focusin"===F.type?"focus":wi]=!0,Z._enter()}),oe.on(this._element,R,this._config.selector,F=>{const Z=this._initializeOnDelegatedTarget(F);Z._activeTrigger["focusout"===F.type?"focus":wi]=Z._element.contains(F.relatedTarget),Z._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},oe.on(this._element.closest(".modal"),Qi,this._hideModalHandler)}_fixTitle(){const d=this._element.getAttribute("title");d&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",d),this._element.setAttribute("data-bs-original-title",d),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(d,x){clearTimeout(this._timeout),this._timeout=setTimeout(d,x)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(d){const x=vt.getDataAttributes(this._element);for(const z of Object.keys(x))Gi.has(z)&&delete x[z];return d=gt(gt({},x),"object"==typeof d&&d?d:{}),d=this._mergeConfigObj(d),d=this._configAfterMerge(d),this._typeCheckConfig(d),d}_configAfterMerge(d){return d.container=!1===d.container?document.body:h(d.container),"number"==typeof d.delay&&(d.delay={show:d.delay,hide:d.delay}),"number"==typeof d.title&&(d.title=d.title.toString()),"number"==typeof d.content&&(d.content=d.content.toString()),d}_getDelegateConfig(){const d={};for(const x in this._config)this.constructor.Default[x]!==this._config[x]&&(d[x]=this._config[x]);return d.selector=!1,d.trigger="manual",d}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null)}static jQueryInterface(d){return this.each(function(){const x=Wt.getOrCreateInstance(this,d);if("string"==typeof d){if(void 0===x[d])throw new TypeError(`No method named "${d}"`);x[d]()}})}}I(Wt);const ks=cs(gt({},Wt.Default),{content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"}),Cs=cs(gt({},Wt.DefaultType),{content:"(null|string|element|function)"});class ai extends Wt{static get Default(){return ks}static get DefaultType(){return Cs}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(d){return this.each(function(){const x=ai.getOrCreateInstance(this,d);if("string"==typeof d){if(void 0===x[d])throw new TypeError(`No method named "${d}"`);x[d]()}})}}I(ai);const vi="click.bs.scrollspy",Zt="active",Zi={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},es={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Yt extends ft{constructor(d,x){super(d,x),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Zi}static get DefaultType(){return es}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const d of this._observableSections.values())this._observer.observe(d)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(d){return d.target=h(d.target)||document.body,d.rootMargin=d.offset?`${d.offset}px 0px -30%`:d.rootMargin,"string"==typeof d.threshold&&(d.threshold=d.threshold.split(",").map(x=>Number.parseFloat(x))),d}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(oe.off(this._config.target,vi),oe.on(this._config.target,vi,"[href]",d=>{const x=this._observableSections.get(d.target.hash);if(x){d.preventDefault();const z=this._rootElement||window,R=x.offsetTop-this._element.offsetTop;if(z.scrollTo)return void z.scrollTo({top:R,behavior:"smooth"});z.scrollTop=R}}))}_getNewObserver(){return new IntersectionObserver(x=>this._observerCallback(x),{root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin})}_observerCallback(d){const x=Z=>this._targetLinks.get(`#${Z.target.id}`),z=Z=>{this._previousScrollData.visibleEntryTop=Z.target.offsetTop,this._process(x(Z))},R=(this._rootElement||document.documentElement).scrollTop,F=R>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=R;for(const Z of d){if(!Z.isIntersecting){this._activeTarget=null,this._clearActiveClass(x(Z));continue}const fe=Z.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(F&&fe){if(z(Z),!R)return}else F||fe||z(Z)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const d=Ce.find("[href]",this._config.target);for(const x of d){if(!x.hash||g(x))continue;const z=Ce.findOne(x.hash,this._element);u(z)&&(this._targetLinks.set(x.hash,x),this._observableSections.set(x.hash,z))}}_process(d){this._activeTarget!==d&&(this._clearActiveClass(this._config.target),this._activeTarget=d,d.classList.add(Zt),this._activateParents(d),oe.trigger(this._element,"activate.bs.scrollspy",{relatedTarget:d}))}_activateParents(d){if(d.classList.contains("dropdown-item"))Ce.findOne(".dropdown-toggle",d.closest(".dropdown")).classList.add(Zt);else for(const x of Ce.parents(d,".nav, .list-group"))for(const z of Ce.prev(x,".nav-link, .nav-item > .nav-link, .list-group-item"))z.classList.add(Zt)}_clearActiveClass(d){d.classList.remove(Zt);const x=Ce.find("[href].active",d);for(const z of x)z.classList.remove(Zt)}static jQueryInterface(d){return this.each(function(){const x=Yt.getOrCreateInstance(this,d);if("string"==typeof d){if(void 0===x[d]||d.startsWith("_")||"constructor"===d)throw new TypeError(`No method named "${d}"`);x[d]()}})}}oe.on(window,"load.bs.scrollspy.data-api",()=>{for(const C of Ce.find('[data-bs-spy="scroll"]'))Yt.getOrCreateInstance(C)}),I(Yt);const Ts="ArrowLeft",ei="ArrowRight",ts="ArrowUp",Ri="ArrowDown",ti="active",Li="show",ss='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',a=`.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), ${ss}`;class p extends ft{constructor(d){super(d),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),oe.on(this._element,"keydown.bs.tab",x=>this._keydown(x)))}static get NAME(){return"tab"}show(){const d=this._element;if(this._elemIsActive(d))return;const x=this._getActiveElem(),z=x?oe.trigger(x,"hide.bs.tab",{relatedTarget:d}):null;oe.trigger(d,"show.bs.tab",{relatedTarget:x}).defaultPrevented||z&&z.defaultPrevented||(this._deactivate(x,d),this._activate(d,x))}_activate(d,x){d&&(d.classList.add(ti),this._activate(n(d)),this._queueCallback(()=>{"tab"===d.getAttribute("role")?(d.removeAttribute("tabindex"),d.setAttribute("aria-selected",!0),this._toggleDropDown(d,!0),oe.trigger(d,"shown.bs.tab",{relatedTarget:x})):d.classList.add(Li)},d,d.classList.contains("fade")))}_deactivate(d,x){d&&(d.classList.remove(ti),d.blur(),this._deactivate(n(d)),this._queueCallback(()=>{"tab"===d.getAttribute("role")?(d.setAttribute("aria-selected",!1),d.setAttribute("tabindex","-1"),this._toggleDropDown(d,!1),oe.trigger(d,"hidden.bs.tab",{relatedTarget:x})):d.classList.remove(Li)},d,d.classList.contains("fade")))}_keydown(d){if(![Ts,ei,ts,Ri].includes(d.key))return;d.stopPropagation(),d.preventDefault();const x=[ei,Ri].includes(d.key),z=f(this._getChildren().filter(R=>!g(R)),d.target,x,!0);z&&(z.focus({preventScroll:!0}),p.getOrCreateInstance(z).show())}_getChildren(){return Ce.find(a,this._parent)}_getActiveElem(){return this._getChildren().find(d=>this._elemIsActive(d))||null}_setInitialAttributes(d,x){this._setAttributeIfNotExists(d,"role","tablist");for(const z of x)this._setInitialAttributesOnChild(z)}_setInitialAttributesOnChild(d){d=this._getInnerElement(d);const x=this._elemIsActive(d),z=this._getOuterElement(d);d.setAttribute("aria-selected",x),z!==d&&this._setAttributeIfNotExists(z,"role","presentation"),x||d.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(d,"role","tab"),this._setInitialAttributesOnTargetPanel(d)}_setInitialAttributesOnTargetPanel(d){const x=n(d);x&&(this._setAttributeIfNotExists(x,"role","tabpanel"),d.id&&this._setAttributeIfNotExists(x,"aria-labelledby",`#${d.id}`))}_toggleDropDown(d,x){const z=this._getOuterElement(d);if(!z.classList.contains("dropdown"))return;const R=(F,Z)=>{const fe=Ce.findOne(F,z);fe&&fe.classList.toggle(Z,x)};R(".dropdown-toggle",ti),R(".dropdown-menu",Li),z.setAttribute("aria-expanded",x)}_setAttributeIfNotExists(d,x,z){d.hasAttribute(x)||d.setAttribute(x,z)}_elemIsActive(d){return d.classList.contains(ti)}_getInnerElement(d){return d.matches(a)?d:Ce.findOne(a,d)}_getOuterElement(d){return d.closest(".nav-item, .list-group-item")||d}static jQueryInterface(d){return this.each(function(){const x=p.getOrCreateInstance(this);if("string"==typeof d){if(void 0===x[d]||d.startsWith("_")||"constructor"===d)throw new TypeError(`No method named "${d}"`);x[d]()}})}}oe.on(document,"click.bs.tab",ss,function(C){["A","AREA"].includes(this.tagName)&&C.preventDefault(),g(this)||p.getOrCreateInstance(this).show()}),oe.on(window,"load.bs.tab",()=>{for(const C of Ce.find('.active[data-bs-toggle="tab"], .active[data-bs-toggle="pill"], .active[data-bs-toggle="list"]'))p.getOrCreateInstance(C)}),I(p);const y="hide",b="show",T="showing",O={animation:"boolean",autohide:"boolean",delay:"number"},D={animation:!0,autohide:!0,delay:5e3};class P extends ft{constructor(d,x){super(d,x),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return D}static get DefaultType(){return O}static get NAME(){return"toast"}show(){oe.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(y),this._element.classList.add(b,T),this._queueCallback(()=>{this._element.classList.remove(T),oe.trigger(this._element,"shown.bs.toast"),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(oe.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add(T),this._queueCallback(()=>{this._element.classList.add(y),this._element.classList.remove(T,b),oe.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(b),super.dispose()}isShown(){return this._element.classList.contains(b)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(d,x){switch(d.type){case"mouseover":case"mouseout":this._hasMouseInteraction=x;break;case"focusin":case"focusout":this._hasKeyboardInteraction=x}if(x)return void this._clearTimeout();const z=d.relatedTarget;this._element===z||this._element.contains(z)||this._maybeScheduleHide()}_setListeners(){oe.on(this._element,"mouseover.bs.toast",d=>this._onInteraction(d,!0)),oe.on(this._element,"mouseout.bs.toast",d=>this._onInteraction(d,!1)),oe.on(this._element,"focusin.bs.toast",d=>this._onInteraction(d,!0)),oe.on(this._element,"focusout.bs.toast",d=>this._onInteraction(d,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(d){return this.each(function(){const x=P.getOrCreateInstance(this,d);if("string"==typeof d){if(void 0===x[d])throw new TypeError(`No method named "${d}"`);x[d](this)}})}}return ct(P),I(P),{Alert:_t,Button:$e,Carousel:be,Collapse:ee,Dropdown:mt,Modal:Rt,Offcanvas:yt,Popover:ai,ScrollSpy:Yt,Tab:p,Toast:P,Tooltip:Wt}});class w2event{constructor(e){if(this.handlers=[],void 0!==e){if(!w2utils.checkName(e))return;w2ui[e]=this}}on(e,t){let i;if("string"==typeof e&&-1!==e.indexOf(".")){let s=e.split(".");e=s[0],i=s[1]}if("string"==typeof e&&-1!==e.indexOf(":")){let s=e.split(":");-1!==["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:s[0],execute:s[1]},i&&(e.scope=i)}if($.isPlainObject(e)||(e={type:e,scope:i}),(e=$.extend({type:null,execute:"before",target:null,onComplete:null},e)).type){if(t)return Array.isArray(this.handlers)||(this.handlers=[]),this.handlers.push({edata:e,handler:t}),this;console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name)}else console.log("ERROR: You must specify event type when calling .on() method of "+this.name)}off(e,t){let i;if("string"==typeof e&&-1!==e.indexOf(".")){let l=e.split(".");i=l[1],""===(e=l[0])&&(e="*")}if("string"==typeof e&&-1!==e.indexOf(":")){let l=e.split(":");-1!==["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:l[0],execute:l[1]}}if($.isPlainObject(e)||(e={type:e}),!(e=$.extend({},{type:null,execute:null,target:null,onComplete:null},e)).type&&!i)return void console.log("ERROR: You must specify event type when calling .off() method of "+this.name);t||(t=null);let s=[];for(let l=0,n=this.handlers.length;l<n;l++){let r=this.handlers[l];(r.edata.type===e.type||"*"===e.type||null!=r.edata.scope&&""==e.type)&&(r.edata.target===e.target||null==e.target)&&(r.edata.execute===e.execute||null==e.execute)&&(r.handler===t&&null!=t||null!=i&&r.edata.scope==i)||s.push(r)}return this.handlers=s,this}trigger(e){let t,i,s;"before"===(e=$.extend({type:null,phase:"before",target:null,doneHandlers:[]},e,{isStopped:!1,isCancelled:!1,done(n){this.doneHandlers.push(n)},preventDefault(){this.isCancelled=!0},stopPropagation(){this.isStopped=!0}})).phase&&(e.onComplete=null),null==e.target&&(e.target=null),Array.isArray(this.handlers)||(this.handlers=[]);for(let n=this.handlers.length-1;n>=0;n--){let r=this.handlers[n];if(!(null==r||r.edata.type!==e.type&&"*"!==r.edata.type||r.edata.target!==e.target&&null!=r.edata.target||r.edata.execute!==e.phase&&"*"!==r.edata.execute&&"*"!==r.edata.phase||(e=$.extend({},r.edata,e),t=[],s=new RegExp(/\((.*?)\)/).exec(r.handler),s&&(t=s[1].split(/\s*,\s*/)),2===t.length?r.handler.call(this,e.target,e):r.handler.call(this,e),!0!==e.isStopped&&!0!==e.stop)))return e}let l="on"+e.type.substr(0,1).toUpperCase()+e.type.substr(1);if("before"===e.phase&&"function"==typeof this[l]&&(i=this[l],t=[],s=new RegExp(/\((.*?)\)/).exec(i),s&&(t=s[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),!0===e.isStopped||!0===e.stop)||null!=e.object&&"before"===e.phase&&"function"==typeof e.object[l]&&(i=e.object[l],t=[],s=new RegExp(/\((.*?)\)/).exec(i),s&&(t=s[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),!0===e.isStopped||!0===e.stop))return e;if("after"===e.phase){"function"==typeof e.onComplete&&e.onComplete.call(this,e);for(let n=0;n<e.doneHandlers.length;n++)"function"==typeof e.doneHandlers[n]&&e.doneHandlers[n].call(this,e)}return e}}const w2locale={locale:"tr-TR",dateFormat:"dd.mm.yyyy",timeFormat:"h24",datetimeFormat:"yyyy.mm.dd|h24",currencyPrefix:"",currencySuffix:"&#x20BA;",currencyPrecision:2,groupSymbol:" ",decimalSymbol:",",shortmonths:["Oca","\u015eub","Mar","May","Nis","Haz","Tem","A\u011fu","Eyl","Ekm","Kas","Ara"],fullmonths:["Ocak","\u015eubat","Mart","Nisan","May\u0131s","Haziran","Temmuz","A\u011fustos","Eyl\xfcl","Ekim","Kas\u0131m","Aral\u0131k"],shortdays:["Pts","Sa","\xc7a","Pe","Cu","Ct","Pz"],fulldays:["Pazartesi","Sal\u0131","\xc7ar\u015famba","Per\u015fembe","Cuma","Cumartesi","Pazar"],weekStarts:"M",phrases:{"${count} letters or more...":"${count} harf veya daha fazla...","Add new record":"Yeni kay\u0131t ekle","Add New":"Yeni Ekle","Advanced Search":"Geli\u015fmi\u015f Arama",after:"Sonra","AJAX error. See console for more details.":"AJAX hatas\u0131. Daha fazla bilgi i\xe7in konsolu kontrol edin.","All Fields":"T\xfcm Alanlar",All:"B\xfct\xfcn",Any:"Herhangi","Are you sure you want to delete ${count} ${records}?":"Emin misiniz ${count} ${records} silmek istiyor musunuz?","Attach files by dragging and dropping or Click to Select":"S\xfcr\xfckle b\u0131rak ile dosya ekle ve se\xe7mek i\xe7in t\u0131kla",before:"\xf6nce","begins with":"\u015fununla ba\u015flayan",begins:"ba\u015flayan",between:"aras\u0131nda",buffered:"\xf6nbelle\u011fe al\u0131nm\u0131\u015f",Cancel:"\u0130ptal",Close:"Kapat",Column:"S\xfctun",Confirmation:"Onay",contains:"i\xe7eren",Copied:"Kopyalanm\u0131\u015f","Copy to clipboard":"Kopyala","Current Date & Time":"Tarih & Saat","Delete selected records":"Se\xe7ili kay\u0131tlar\u0131 sil",Delete:"Sil","Do you want to delete search item '${item}'?":"'${item}' arama \xf6\u011fesini silmek istiyor musunuz?","Edit selected record":"Se\xe7ileni d\xfczenle",Edit:"D\xfczenle","Empty list":"Bo\u015f Liste","ends with":"\u015fununla biten",ends:"biten","Field should be at least ${count} characters.":"Alan en az ${count} karakter olmal\u0131.",Hide:"Gizle",in:"i\xe7eren","not in":"i\xe7ermeyen",is:"e\u015fit","is not":"e\u015fit de\u011fil","less than":"daha k\xfc\xe7\xfck","more than":"daha b\xfcy\xfck","Line #":"Sat\u0131r #","Load ${count} more...":"Y\xfckle ${count} adet daha...","Loading...":"Y\xfckleniyor...","Maximum number of files is ${count}":"Maksimum dosya say\u0131s\u0131 ${count}","Maximum total size is ${count}":"Maksimum dosya boyutu ${count}",UndefinedError:"Bilinmeyen Hata",Modified:"De\u011fi\u015ftirilmi\u015f","Multiple Fields":"\xc7oklu Alanlar",Name:"Ad\u0131","No items found":"Hi\xe7bir madde bulunamad\u0131","No matches":"E\u015fle\u015fme yok",No:"Hay\u0131r",none:"hi\xe7biri","Not a float":"Ondal\u0131kl\u0131 say\u0131 de\u011fil","Not a hex number":"HEX format\u0131 uygun de\u011fil","Not a valid date":"Ge\xe7erli bir tarih de\u011fil","Not a valid email":"E-posta uygun de\u011fil","Not alpha-numeric":"Alfasay\u0131sal de\u011fil","Not an integer":"Tam say\u0131 de\u011fil","Not in money format":"Para format\u0131 uygun de\u011fil",Notification:"Bildirim",of:"/",Ok:"Tamam",Opacity:"Opakl\u0131k","Record ID":"Kay\u0131t ID",record:"kay\u0131t",records:"kay\u0131tlar","Refreshing...":"Yenileniyor...","Reload data in the list":"Listeyi yeniden y\xfckle",Remove:"Kald\u0131r","Request aborted.":"\u0130stek iptal edildi.","Required field":"Gerekli alan",Reset:"S\u0131f\u0131rla","Restore Default State":"Varsay\u0131lanlar\u0131 d\xf6n","Returned data is not in valid JSON format.":"D\xf6nen veri ge\xe7erli JSON format\u0131nda de\u011fil.","Save changed records":"De\u011fi\u015fiklikleri kaydet","Save Grid State":"Gridin durumunu ekle",Save:"Kaydet","Saved Searches":"Aramalar\u0131 Kaydet","Saving...":"Kaydediliyor...","Search took ${count} seconds":"Arama ${count} saniye s\xfcrd\xfc",Search:"Ara","Select Hour":"Select Hour","Select Minute":"Select Minute",selected:"Se\xe7ilmi\u015f","Server Response ${count} seconds":"Sunucu yan\u0131t\u0131 ${count} saniye","Show/hide columns":"S\xfctunlar\u0131 g\xf6ster/gizle",Show:"G\xf6ster",Size:"Boyut",Skip:"Atlamak","Sorting took ${count} seconds":"S\u0131ralama s\xfcresi ${count} saniye","Type to search...":"Tipe g\xf6re ara...",Type:"Tip",Yes:"Evet",Yesterday:"D\xfcn","Your remote data source record count has changed, reloading from the first record.":"Kullan\u0131c\u0131n\u0131n uzaktan kaynak kay\u0131t say\u0131s\u0131 de\u011fi\u015fti, ilk \xf6nce yeniden y\xfckle."}};let w2ui={};const date=new Date,addedDate=new Date(date.getTime());addedDate.setFullYear(date.getFullYear()+20);let w2utils=(v=>{let e={};return{version:"2.0.x",settings:v.extend(!0,{},w2locale,{dataType:"HTTPJSON",dateStartYear:1900,dateEndYear:addedDate.getFullYear(),macButtonOrder:!1,warn_missing_translation:!0}),isBin:function t(S){return/^[0-1]+$/.test(S)},isInt:i,isFloat:s,isMoney:function l(S){if("object"==typeof S||""===S)return!1;if(s(S))return!0;let A=w2utils.settings,Y=new RegExp("^"+(A.currencyPrefix?"\\"+A.currencyPrefix+"?":"")+"[-+]?"+(A.currencyPrefix?"\\"+A.currencyPrefix+"?":"")+"[0-9]*[\\"+A.decimalSymbol+"]?[0-9]+"+(A.currencySuffix?"\\"+A.currencySuffix+"?":"")+"$","i");return"string"==typeof S&&(S=S.replace(new RegExp(A.groupSymbol,"g"),"")),Y.test(S)},isHex:function n(S){return/^(0x)?[0-9a-fA-F]+$/.test(S)},isAlphaNumeric:function r(S){return/^[a-zA-Z0-9_-]+$/.test(S)},isEmail:function o(S){return/^[a-zA-Z0-9._%\-+]+@[\u0430-\u044f\u0410-\u042fa-zA-Z0-9.-]+\.[\u0430-\u044f\u0410-\u042fa-zA-Z]+$/.test(S)},isIpAddress:function h(S){return new RegExp("^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$").test(S)},isDate:function u(S,A,Y){if(!S)return!1;let q,G,V,K="Invalid Date";if(null==A&&(A=w2utils.settings.dateFormat),"function"==typeof S.getFullYear)V=S.getFullYear(),q=S.getMonth()+1,G=S.getDate();else if(parseInt(S)==S&&parseInt(S)>0)V=(S=new Date(parseInt(S))).getFullYear(),q=S.getMonth()+1,G=S.getDate();else{if(S=String(S),new RegExp("mon","ig").test(A)){A=A.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),S=S.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(let ke=0,Te=w2utils.settings.fullmonths.length;ke<Te;ke++){let be=w2utils.settings.fullmonths[ke];S=S.replace(new RegExp(be,"ig"),parseInt(ke)+1).replace(new RegExp(be.substr(0,3),"ig"),parseInt(ke)+1)}}let ie=S.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),ye=A.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===ye&&(q=ie[0],G=ie[1],V=ie[2]),"m/d/yyyy"===ye&&(q=ie[0],G=ie[1],V=ie[2]),"dd/mm/yyyy"===ye&&(q=ie[1],G=ie[0],V=ie[2]),"d/m/yyyy"===ye&&(q=ie[1],G=ie[0],V=ie[2]),"yyyy/dd/mm"===ye&&(q=ie[2],G=ie[1],V=ie[0]),"yyyy/d/m"===ye&&(q=ie[2],G=ie[1],V=ie[0]),"yyyy/mm/dd"===ye&&(q=ie[1],G=ie[2],V=ie[0]),"yyyy/m/d"===ye&&(q=ie[1],G=ie[2],V=ie[0]),"mm/dd/yy"===ye&&(q=ie[0],G=ie[1],V=ie[2]),"m/d/yy"===ye&&(q=ie[0],G=ie[1],V=parseInt(ie[2])+1900),"dd/mm/yy"===ye&&(q=ie[1],G=ie[0],V=parseInt(ie[2])+1900),"d/m/yy"===ye&&(q=ie[1],G=ie[0],V=parseInt(ie[2])+1900),"yy/dd/mm"===ye&&(q=ie[2],G=ie[1],V=parseInt(ie[0])+1900),"yy/d/m"===ye&&(q=ie[2],G=ie[1],V=parseInt(ie[0])+1900),"yy/mm/dd"===ye&&(q=ie[1],G=ie[2],V=parseInt(ie[0])+1900),"yy/m/d"===ye&&(q=ie[1],G=ie[2],V=parseInt(ie[0])+1900)}return!!(i(V)&&i(q)&&i(G)&&(V=+V,q=+q,G=+G,K=new Date(V,q-1,G),K.setFullYear(V),null!=q)&&"Invalid Date"!==String(K)&&K.getMonth()+1===q&&K.getDate()===G&&K.getFullYear()===V)&&(!0!==Y||K)},isTime:function g(S,A){if(null==S)return!1;let Y,K,q;K=(S=(S=String(S)).toUpperCase()).indexOf("AM")>=0,q=S.indexOf("PM")>=0;let G=q||K;Y=G?12:24;let V=(S=S.replace("AM","").replace("PM","").trim()).split(":"),ie=parseInt(V[0]||0),ye=parseInt(V[1]||0),ke=parseInt(V[2]||0);return!((!G||1!==V.length)&&2!==V.length&&3!==V.length||""===V[0]||ie<0||ie>Y||!this.isInt(V[0])||V[0].length>2||V.length>1&&(""===V[1]||ye<0||ye>59||!this.isInt(V[1])||2!==V[1].length)||V.length>2&&(""===V[2]||ke<0||ke>59||!this.isInt(V[2])||2!==V[2].length)||!G&&Y===ie&&(0!==ye||0!==ke)||G&&1===V.length&&0===ie)&&(!0!==A||(q&&12!==ie&&(ie+=12),K&&12===ie&&(ie+=12),{hours:ie,minutes:ye,seconds:ke}))},isDateTime:function c(S,A,Y){if("function"==typeof S.getFullYear)return!0!==Y||S;let K=parseInt(S);if(K===S)return!(K<0)&&(!0!==Y||new Date(K));let q=String(S).indexOf(" ");if(q<0)return!(String(S).indexOf("T")<0||"Invalid Date"==String(new Date(S)))&&(!0!==Y||new Date(S));{null==A&&(A=w2utils.settings.datetimeFormat);let G=A.split("|"),V=[S.substr(0,q),S.substr(q).trim()];G[0]=G[0].trim(),G[1]&&(G[1]=G[1].trim());let ie=w2utils.isDate(V[0],G[0],!0),ye=w2utils.isTime(V[1],!0);return!1!==ie&&!1!==ye&&(!0!==Y||(ie.setHours(ye.hours),ie.setMinutes(ye.minutes),ie.setSeconds(ye.seconds),ie))}},age:function m(S){let A;if(""===S||null==S||(A="function"==typeof S.getFullYear?S:parseInt(S)==S&&parseInt(S)>0?new Date(parseInt(S)):new Date(S),"Invalid Date"===String(A)))return"";let K=((new Date).getTime()-A.getTime())/1e3,q="",G="";return K<0?(q=0,G="sec"):K<60?(q=Math.floor(K),G="sec",K<0&&(q=0,G="sec")):K<3600?(q=Math.floor(K/60),G="min"):K<86400?(q=Math.floor(K/60/60),G="hour"):K<2592e3?(q=Math.floor(K/24/60/60),G="day"):K<31536e3?(q=Math.floor(K/30/24/60/60*10)/10,G="month"):K<126144e3?(q=Math.floor(K/365/24/60/60*10)/10,G="year"):K>=126144e3&&(q=Math.floor(K/365.25/24/60/60*10)/10,G="year"),q+" "+G+(q>1?"s":"")},interval:function w(S){let A="";return A=S<1e3?"< 1 sec":S<6e4?Math.floor(S/1e3)+" secs":S<36e5?Math.floor(S/6e4)+" mins":S<864e5?Math.floor(S/36e5*10)/10+" hours":S<2628e6?Math.floor(S/864e5*10)/10+" days":S<31536e6?Math.floor(S/2628e6*10)/10+" months":Math.floor(S/31536e5)/10+" years",A},date:function _(S){if(""===S||null==S||"object"==typeof S&&!S.getMonth)return"";let A=new Date(S);if(w2utils.isInt(S)&&(A=new Date(Number(S))),"Invalid Date"===String(A))return"";let Y=w2utils.settings.shortmonths,K=new Date,q=new Date;q.setTime(q.getTime()-864e5);let G=Y[A.getMonth()]+" "+A.getDate()+", "+A.getFullYear(),V=Y[K.getMonth()]+" "+K.getDate()+", "+K.getFullYear(),ie=Y[q.getMonth()]+" "+q.getDate()+", "+q.getFullYear(),ye=A.getHours()-(A.getHours()>12?12:0)+":"+(A.getMinutes()<10?"0":"")+A.getMinutes()+" "+(A.getHours()>=12?"pm":"am"),ke=A.getHours()-(A.getHours()>12?12:0)+":"+(A.getMinutes()<10?"0":"")+A.getMinutes()+":"+(A.getSeconds()<10?"0":"")+A.getSeconds()+" "+(A.getHours()>=12?"pm":"am"),Te=G;return G===V&&(Te=ye),G===ie&&(Te=w2utils.lang("Yesterday")),'<span title="'+G+" "+ke+'">'+Te+"</span>"},formatSize:function k(S){if(!w2utils.isFloat(S)||""===S)return"";if(0===(S=parseFloat(S)))return 0;let Y=parseInt(Math.floor(Math.log(S)/Math.log(1024)));return(Math.floor(S/Math.pow(1024,Y)*10)/10).toFixed(0===Y?0:1)+" "+(["Bt","KB","MB","GB","TB","PB","EB","ZB"][Y]||"??")},formatNumber:function E(S,A,Y){if(null==S||""===S||"object"==typeof S)return"";let K={minimumFractionDigits:A,maximumFractionDigits:A,useGrouping:Y};return(null==A||A<0)&&(K.minimumFractionDigits=0,K.maximumFractionDigits=20),S},formatDate:function I(S,A){if(A||(A=this.settings.dateFormat),""===S||null==S||"object"==typeof S&&!S.getMonth)return"";let Y=new Date(S);if(w2utils.isInt(S)&&(Y=new Date(Number(S))),"Invalid Date"===String(Y))return"";let K=Y.getFullYear(),q=Y.getMonth(),G=Y.getDate();return A.toLowerCase().replace("month",w2utils.settings.fullmonths[q]).replace("mon",w2utils.settings.shortmonths[q]).replace(/yyyy/g,("000"+K).slice(-4)).replace(/yyy/g,("000"+K).slice(-4)).replace(/yy/g,("0"+K).slice(-2)).replace(/(^|[^a-z$])y/g,"$1"+K).replace(/mm/g,("0"+(q+1)).slice(-2)).replace(/dd/g,("0"+G).slice(-2)).replace(/th/g,1==G?"st":"th").replace(/th/g,2==G?"nd":"th").replace(/th/g,3==G?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(q+1)).replace(/(^|[^a-z$])d/g,"$1"+G)},formatTime:function N(S,A){if(A||(A=this.settings.timeFormat),""===S||null==S||"object"==typeof S&&!S.getMonth)return"";let Y=new Date(S);if(w2utils.isInt(S)&&(Y=new Date(Number(S))),w2utils.isTime(S)){let ye=w2utils.isTime(S,!0);Y=new Date,Y.setHours(ye.hours),Y.setMinutes(ye.minutes)}if("Invalid Date"===String(Y))return"";let K="am",q=Y.getHours(),G=Y.getHours(),V=Y.getMinutes(),ie=Y.getSeconds();return V<10&&(V="0"+V),ie<10&&(ie="0"+ie),(-1!==A.indexOf("am")||-1!==A.indexOf("pm"))&&(q>=12&&(K="pm"),q>12&&(q-=12),0===q&&(q=12)),A.toLowerCase().replace("am",K).replace("pm",K).replace("hhh",q<10?"0"+q:q).replace("hh24",G<10?"0"+G:G).replace("h24",G).replace("hh",q).replace("mm",V).replace("mi",V).replace("ss",ie).replace(/(^|[^a-z$])h/g,"$1"+q).replace(/(^|[^a-z$])m/g,"$1"+V).replace(/(^|[^a-z$])s/g,"$1"+ie)},formatDateTime:function L(S,A){let Y;return""===S||null==S||"object"==typeof S&&!S.getMonth?"":("string"!=typeof A?Y=[this.settings.dateFormat,this.settings.timeFormat]:(Y=A.split("|"),Y[0]=Y[0].trim(),Y[1]=Y.length>1?Y[1].trim():this.settings.timeFormat),"h12"===Y[1]&&(Y[1]="h:m pm"),"h24"===Y[1]&&(Y[1]="h24:m"),this.formatDate(S,Y[0])+" "+this.formatTime(S,Y[1]))},stripTags:function f(S){if(null==S)return S;switch(typeof S){case"number":break;case"string":S=String(S).replace(/<(?:[^>=]|='[^']*'|="[^"]*"|=[^'"][^\s>]*)*>/gi,"");break;case"object":if(Array.isArray(S)){S=v.extend(!0,[],S);for(let A=0;A<S.length;A++)S[A]=this.stripTags(S[A])}else{S=v.extend(!0,{},S);for(let A in S)S[A]=this.stripTags(S[A])}}return S},encodeTags:H,decodeTags:function B(S){if(null==S)return S;switch(typeof S){case"number":break;case"string":S=String(S).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":if(Array.isArray(S)){S=v.extend(!0,[],S);for(let A=0;A<S.length;A++)S[A]=this.decodeTags(S[A])}else{S=v.extend(!0,{},S);for(let A in S)S[A]=this.decodeTags(S[A])}}return S},escapeId:function Q(S){return""===S||null==S?"":v.escapeSelector(S)},unescapeId:function X(S){return""===S||null==S?"":v.find.selectors.preFilter.ATTR([null,S])[1]},normMenu:function Si(S,A){return Array.isArray(S)?(S.forEach((Y,K)=>{"string"==typeof Y||"number"==typeof Y?S[K]={id:Y,text:Y}:null!=Y?(null!=Y.caption&&null==Y.text&&(Y.text=Y.caption),null!=Y.text&&null==Y.id&&(Y.id=Y.text),null==Y.text&&null!=Y.id&&(Y.text=Y.id)):S[K]={id:null,text:"null"}}),S):"function"==typeof S?w2utils.normMenu.call(this,S.call(this,A)):"object"==typeof S?Object.keys(S).map(Y=>({id:Y,text:S[Y]})):void 0},bindEvents:ui,base64encode:function ne(S){let Y,K,q,G,V,ie,ye,A="",ke=0,Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(S=function be(Re){Re=String(Re).replace(/\r\n/g,"\n");let Se="";for(let We=0;We<Re.length;We++){let Le=Re.charCodeAt(We);Le<128?Se+=String.fromCharCode(Le):Le>127&&Le<2048?(Se+=String.fromCharCode(Le>>6|192),Se+=String.fromCharCode(63&Le|128)):(Se+=String.fromCharCode(Le>>12|224),Se+=String.fromCharCode(Le>>6&63|128),Se+=String.fromCharCode(63&Le|128))}return Se}(S);ke<S.length;)Y=S.charCodeAt(ke++),K=S.charCodeAt(ke++),q=S.charCodeAt(ke++),G=Y>>2,V=(3&Y)<<4|K>>4,ie=(15&K)<<2|q>>6,ye=63&q,isNaN(K)?ie=ye=64:isNaN(q)&&(ye=64),A=A+Te.charAt(G)+Te.charAt(V)+Te.charAt(ie)+Te.charAt(ye);return A},base64decode:function re(S){let Y,K,q,G,V,ie,ye,A="",ke=0,Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(S=S.replace(/[^A-Za-z0-9\+\/\=]/g,"");ke<S.length;)G=Te.indexOf(S.charAt(ke++)),V=Te.indexOf(S.charAt(ke++)),ie=Te.indexOf(S.charAt(ke++)),ye=Te.indexOf(S.charAt(ke++)),Y=G<<2|V>>4,K=(15&V)<<4|ie>>2,q=(3&ie)<<6|ye,A+=String.fromCharCode(Y),64!==ie&&(A+=String.fromCharCode(K)),64!==ye&&(A+=String.fromCharCode(q));return A=function be(Re){let te,_e,Se="",We=0,Le=0;for(;We<Re.length;)Le=Re.charCodeAt(We),Le<128?(Se+=String.fromCharCode(Le),We++):Le>191&&Le<224?(te=Re.charCodeAt(We+1),Se+=String.fromCharCode((31&Le)<<6|63&te),We+=2):(te=Re.charCodeAt(We+1),_e=Re.charCodeAt(We+2),Se+=String.fromCharCode((15&Le)<<12|(63&te)<<6|63&_e),We+=3);return Se}(A),A},md5:function le(S){function ke(te,_e,ee,se,ue,ce){return We(function Le(te,_e){return te<<_e|te>>>32-_e}(We(We(_e,te),We(se,ce)),ue),ee)}function Te(te,_e,ee,se,ue,ce,me){return ke(_e&ee|~_e&se,te,_e,ue,ce,me)}function be(te,_e,ee,se,ue,ce,me){return ke(_e&se|ee&~se,te,_e,ue,ce,me)}function Re(te,_e,ee,se,ue,ce,me){return ke(_e^ee^se,te,_e,ue,ce,me)}function Se(te,_e,ee,se,ue,ce,me){return ke(ee^(_e|~se),te,_e,ue,ce,me)}function We(te,_e){let ee=(65535&te)+(65535&_e);return(te>>16)+(_e>>16)+(ee>>16)<<16|65535&ee}return function Y(te){return function q(te){let se,_e="0123456789abcdef",ee="";for(let ue=0;ue<te.length;ue++)se=te.charCodeAt(ue),ee+=_e.charAt(se>>>4&15)+_e.charAt(15&se);return ee}(function K(te){return function ie(te){let _e="";for(let ee=0;ee<32*te.length;ee+=8)_e+=String.fromCharCode(te[ee>>5]>>>ee%32&255);return _e}(function ye(te,_e){te[_e>>5]|=128<<_e%32,te[14+(_e+64>>>9<<4)]=_e;let ee=1732584193,se=-271733879,ue=-1732584194,ce=271733878;for(let me=0;me<te.length;me+=16){let Dt=ee,Ht=se,$t=ue,Vt=ce;ee=Te(ee,se,ue,ce,te[me+0],7,-680876936),ce=Te(ce,ee,se,ue,te[me+1],12,-389564586),ue=Te(ue,ce,ee,se,te[me+2],17,606105819),se=Te(se,ue,ce,ee,te[me+3],22,-1044525330),ee=Te(ee,se,ue,ce,te[me+4],7,-176418897),ce=Te(ce,ee,se,ue,te[me+5],12,1200080426),ue=Te(ue,ce,ee,se,te[me+6],17,-1473231341),se=Te(se,ue,ce,ee,te[me+7],22,-45705983),ee=Te(ee,se,ue,ce,te[me+8],7,1770035416),ce=Te(ce,ee,se,ue,te[me+9],12,-1958414417),ue=Te(ue,ce,ee,se,te[me+10],17,-42063),se=Te(se,ue,ce,ee,te[me+11],22,-1990404162),ee=Te(ee,se,ue,ce,te[me+12],7,1804603682),ce=Te(ce,ee,se,ue,te[me+13],12,-40341101),ue=Te(ue,ce,ee,se,te[me+14],17,-1502002290),se=Te(se,ue,ce,ee,te[me+15],22,1236535329),ee=be(ee,se,ue,ce,te[me+1],5,-165796510),ce=be(ce,ee,se,ue,te[me+6],9,-1069501632),ue=be(ue,ce,ee,se,te[me+11],14,643717713),se=be(se,ue,ce,ee,te[me+0],20,-373897302),ee=be(ee,se,ue,ce,te[me+5],5,-701558691),ce=be(ce,ee,se,ue,te[me+10],9,38016083),ue=be(ue,ce,ee,se,te[me+15],14,-660478335),se=be(se,ue,ce,ee,te[me+4],20,-405537848),ee=be(ee,se,ue,ce,te[me+9],5,568446438),ce=be(ce,ee,se,ue,te[me+14],9,-1019803690),ue=be(ue,ce,ee,se,te[me+3],14,-187363961),se=be(se,ue,ce,ee,te[me+8],20,1163531501),ee=be(ee,se,ue,ce,te[me+13],5,-1444681467),ce=be(ce,ee,se,ue,te[me+2],9,-51403784),ue=be(ue,ce,ee,se,te[me+7],14,1735328473),se=be(se,ue,ce,ee,te[me+12],20,-1926607734),ee=Re(ee,se,ue,ce,te[me+5],4,-378558),ce=Re(ce,ee,se,ue,te[me+8],11,-2022574463),ue=Re(ue,ce,ee,se,te[me+11],16,1839030562),se=Re(se,ue,ce,ee,te[me+14],23,-35309556),ee=Re(ee,se,ue,ce,te[me+1],4,-1530992060),ce=Re(ce,ee,se,ue,te[me+4],11,1272893353),ue=Re(ue,ce,ee,se,te[me+7],16,-155497632),se=Re(se,ue,ce,ee,te[me+10],23,-1094730640),ee=Re(ee,se,ue,ce,te[me+13],4,681279174),ce=Re(ce,ee,se,ue,te[me+0],11,-358537222),ue=Re(ue,ce,ee,se,te[me+3],16,-722521979),se=Re(se,ue,ce,ee,te[me+6],23,76029189),ee=Re(ee,se,ue,ce,te[me+9],4,-640364487),ce=Re(ce,ee,se,ue,te[me+12],11,-421815835),ue=Re(ue,ce,ee,se,te[me+15],16,530742520),se=Re(se,ue,ce,ee,te[me+2],23,-995338651),ee=Se(ee,se,ue,ce,te[me+0],6,-198630844),ce=Se(ce,ee,se,ue,te[me+7],10,1126891415),ue=Se(ue,ce,ee,se,te[me+14],15,-1416354905),se=Se(se,ue,ce,ee,te[me+5],21,-57434055),ee=Se(ee,se,ue,ce,te[me+12],6,1700485571),ce=Se(ce,ee,se,ue,te[me+3],10,-1894986606),ue=Se(ue,ce,ee,se,te[me+10],15,-1051523),se=Se(se,ue,ce,ee,te[me+1],21,-2054922799),ee=Se(ee,se,ue,ce,te[me+8],6,1873313359),ce=Se(ce,ee,se,ue,te[me+15],10,-30611744),ue=Se(ue,ce,ee,se,te[me+6],15,-1560198380),se=Se(se,ue,ce,ee,te[me+13],21,1309151649),ee=Se(ee,se,ue,ce,te[me+4],6,-145523070),ce=Se(ce,ee,se,ue,te[me+11],10,-1120210379),ue=Se(ue,ce,ee,se,te[me+2],15,718787259),se=Se(se,ue,ce,ee,te[me+9],21,-343485551),ee=We(ee,Dt),se=We(se,Ht),ue=We(ue,$t),ce=We(ce,Vt)}return Array(ee,se,ue,ce)}(function V(te){let _e=Array(te.length>>2);for(let ee=0;ee<_e.length;ee++)_e[ee]=0;for(let ee=0;ee<8*te.length;ee+=8)_e[ee>>5]|=(255&te.charCodeAt(ee/8))<<ee%32;return _e}(te),8*te.length))}(function G(te){let se,ue,_e="",ee=-1;for(;++ee<te.length;)se=te.charCodeAt(ee),ue=ee+1<te.length?te.charCodeAt(ee+1):0,55296<=se&&se<=56319&&56320<=ue&&ue<=57343&&(se=65536+((1023&se)<<10)+(1023&ue),ee++),se<=127?_e+=String.fromCharCode(se):se<=2047?_e+=String.fromCharCode(192|se>>>6&31,128|63&se):se<=65535?_e+=String.fromCharCode(224|se>>>12&15,128|se>>>6&63,128|63&se):se<=2097151&&(_e+=String.fromCharCode(240|se>>>18&7,128|se>>>12&63,128|se>>>6&63,128|63&se));return _e}(te)))}(S)},transition:function J(S,A,Y,K){let q=v(S).width(),G=v(S).height();if(S&&A){switch(S.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",S.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",A.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",Y){case"slide-left":S.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",A.style.cssText+="overflow: hidden; transform: translate3d("+q+"px, 0, 0)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",S.style.cssText+="transition: 0.5s; transform: translate3d(-"+q+"px, 0, 0)"},1);break;case"slide-right":S.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",A.style.cssText+="overflow: hidden; transform: translate3d(-"+q+"px, 0, 0)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)",S.style.cssText+="transition: 0.5s; transform: translate3d("+q+"px, 0, 0)"},1);break;case"slide-down":S.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",A.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",S.style.cssText+="transition: 0.5s; transform: translate3d(0, "+G+"px, 0)"},1);break;case"slide-up":S.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",A.style.cssText+="overflow: hidden; transform: translate3d(0, "+G+"px, 0)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",S.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"},1);break;case"flip-left":S.style.cssText+="overflow: hidden; transform: rotateY(0deg)",A.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",S.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"},1);break;case"flip-right":S.style.cssText+="overflow: hidden; transform: rotateY(0deg)",A.style.cssText+="overflow: hidden; transform: rotateY(180deg)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",S.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"},1);break;case"flip-down":S.style.cssText+="overflow: hidden; transform: rotateX(0deg)",A.style.cssText+="overflow: hidden; transform: rotateX(180deg)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",S.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"},1);break;case"flip-up":S.style.cssText+="overflow: hidden; transform: rotateX(0deg)",A.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",S.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"},1);break;case"pop-in":S.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",A.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;",S.style.cssText+="transition: 0.5s;"},1);break;case"pop-out":S.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",A.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; opacity: 1;",S.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"},1);break;default:S.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",A.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",v(A).show(),setTimeout(()=>{A.style.cssText+="transition: 0.5s; opacity: 1;",S.style.cssText+="transition: 0.5s"},1)}setTimeout(()=>{"slide-down"===Y&&(v(S).css("z-index","1019"),v(A).css("z-index","1020")),A&&v(A).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),S&&v(S).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),"function"==typeof K&&K()},500)}else console.log("ERROR: Cannot do transition when one of the divs is null")},lock:function ge(S,A,Y){let K={};"object"==typeof A?K=A:(K.msg=A,K.spinner=Y),!K.msg&&0!==K.msg&&(K.msg=""),w2utils.unlock(S),v(S).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');let q=v(S).find(".w2ui-lock"),G=v(S).find(".w2ui-lock-msg");K.msg||G.css({"background-color":"transparent",border:"0px"}),!0===K.spinner&&(K.msg='<div class="w2ui-spinner" '+(K.msg?"":'style="width: 35px; height: 35px"')+"></div>"+K.msg),null!=K.opacity&&q.css("opacity",K.opacity),"function"==typeof q.fadeIn?(q.fadeIn(200),G.html(K.msg).fadeIn(200)):(q.show(),G.html(K.msg).show(0))},unlock:function xe(S,A){i(A)?(v(S).find(".w2ui-lock").fadeOut(A),setTimeout(()=>{v(S).find(".w2ui-lock").remove(),v(S).find(".w2ui-lock-msg").remove()},A)):(v(S).find(".w2ui-lock").remove(),v(S).find(".w2ui-lock-msg").remove())},message:function Ye(S,A){return new Promise((Y,K)=>{let G,V,q=this;if(v().w2tag(),A||(A={width:200,height:100}),null==A.on){let Le=A;A=new w2event,v.extend(A,Le)}null==A.width&&(A.width=200),null==A.height&&(A.height=100);let ie=parseInt(v(S.box).width()),ye=parseInt(v(S.box).height()),ke=parseInt(v(S.box).find(S.title).css("height")||0);A.width>ie&&(A.width=ie-10),A.height>ye-ke&&(A.height=ye-10-ke),A.originalWidth=A.width,A.originalHeight=A.height,parseInt(A.width)<0&&(A.width=ie+A.width),parseInt(A.width)<10&&(A.width=10),parseInt(A.height)<0&&(A.height=ye+A.height-ke),parseInt(A.height)<10&&(A.height=10),null==A.hideOnClick&&(A.hideOnClick=!1);let Te=v(S.box).data("options")||{};(null==A.width||A.width>Te.width-10)&&(A.width=Te.width-10),(null==A.height||A.height>Te.height-ke-5)&&(A.height=Te.height-ke-5),A.originalHeight<0&&(A.height=ye+A.originalHeight-ke),A.originalWidth<0&&(A.width=ie+2*A.originalWidth);let be=v(S.box).find(S.title),Re=v(S.box).find(".w2ui-message.w2ui-closing");v(S.box).find(".w2ui-message.w2ui-closing").length>0&&(clearTimeout(G),We(Re,Re.data("options")||{}));let Se=v(S.box).find(".w2ui-message").length;if(""===(A.html||"").trim()&&""===(A.body||"").trim()&&""===(A.buttons||"").trim()){if(0===Se)return;let Le=v(S.box).find("#w2ui-message"+(Se-1));if((A=Le.data("options")||{}).trigger&&(V=A.trigger({phase:"before",type:"close",target:"self",box:A.box[0]}),!0===V.isCancelled))return;Le.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+A.height+"px)"})).addClass("w2ui-closing"),1===Se?this.unlock&&(S.param?this.unlock(S.param,150):this.unlock(150)):v(S.box).find("#w2ui-message"+(Se-2)).css("z-index",1500),G=setTimeout(()=>{We(Le,A)},150)}else{(""!==(A.body||"").trim()||""!==(A.buttons||"").trim())&&(A.html='<div class="w2ui-message-body">'+(A.body||"")+'</div><div class="w2ui-message-buttons">'+(A.buttons||"")+"</div>"),v(S.box).find(".w2ui-message").css("z-index",1390),be.data("old-z-index",be.css("z-index")),be.css("z-index",1501),v(S.box).find(S.body).before('<div id="w2ui-message'+Se+'" data-mousedown="stop"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===be.length?"top: 0px;":"top: "+w2utils.getSize(be,"height")+"px;")+(null!=A.width?"width: "+A.width+"px; left: "+(ie-A.width)/2+"px;":"left: 10px; right: 10px;")+(null!=A.height?"height: "+A.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===A.hideOnClick?S.param?`data-click='["message", "${S.param}"]`:'data-click="message"':"")+"></div>"),ui("#w2ui-message"+Se,this),v(S.box).find("#w2ui-message"+Se).data("options",A).data("prev_focus",v(":focus"));let Le=v(S.box).find("#w2ui-message"+Se).css("display");if(v(S.box).find("#w2ui-message"+Se).css(w2utils.cssPrefix({transform:"none"===Le?"translateY(-"+A.height+"px)":"translateY(0px)"})),"none"===Le){if(v(S.box).find("#w2ui-message"+Se).show().html(A.html),A.box=v(S.box).find("#w2ui-message"+Se),A.trigger&&(V=A.trigger({phase:"before",type:"open",target:"self",box:A.box[0]}),!0===V.isCancelled))return be.css("z-index",be.data("old-z-index")),void v(S.box).find("#w2ui-message"+Se).remove();setTimeout(()=>{v(S.box).find("#w2ui-message"+Se).css(w2utils.cssPrefix({transform:"none"===Le?"translateY(0px)":"translateY(-"+A.height+"px)"}))},1),0===Se&&this.lock&&(S.param?this.lock(S.param):this.lock()),setTimeout(()=>{v(S.box).find("#w2ui-message"+Se).css(w2utils.cssPrefix({transition:"0s"})),A.trigger&&(A.trigger(v.extend(V,{phase:"after"})),Y())},350)}}function We(Le,te){if(null==V&&te.trigger&&(V=te.trigger({phase:"before",type:"open",target:"self"}),!0===V.isCancelled))return be.css("z-index",be.data("old-z-index")),void v(S.box).find("#w2ui-message"+Se).remove();let _e=Le.data("prev_focus");Le.remove(),_e&&_e.length>0?_e.focus():q&&"function"==typeof q.focus&&q.focus(),be.css("z-index",be.data("old-z-index")),te.trigger&&te.trigger(v.extend(V,{phase:"after"}))}})},naturalCompare:function Ce(S,A){let Y,K,q=1,G=0,V=0,ie=String.alphabet;function ye(ke,Te,be){if(be){for(Y=Te;(be=ye(ke,Y))<76&&be>65;)++Y;return+ke.slice(Te-1,Y)}return(be=ie&&ie.indexOf(ke.charAt(Te)))>-1?be+76:(be=ke.charCodeAt(Te)||0)<45||be>127?be:be<46?65:be<48?be-1:be<58?be+18:be<65?be-11:be<91?be+11:be<97?be-37:be<123?be+5:be-63}if((S+="")!=(A+=""))for(;q;)if(K=ye(S,G++),q=ye(A,V++),K<76&&q<76&&K>66&&q>66&&(K=ye(S,G,G),q=ye(A,V,G=Y),V=Y),K!=q)return K<q?-1:1;return 0},i18nCompare:Intl.Collator().compare,fillTemplate:He,lang:function Be(S,A,Y){if(!S||"string"!=typeof S||"<=>=".includes(S))return S;!0===A&&(A=void 0,Y=!0);let K=this.settings.phrases[S];return null==K&&(K=S,this.settings.warn_missing_translation&&!Y&&(this.settings.phrases[S]=K)),He(K,A)},locale:function oe(S,A){},getSize:function Xe(S,A){let Y=v(S),K_left=parseInt(Y.css("border-left-width"))||0,K_right=parseInt(Y.css("border-right-width"))||0,K_top=parseInt(Y.css("border-top-width"))||0,K_bottom=parseInt(Y.css("border-bottom-width"))||0,q_left=parseInt(Y.css("margin-left"))||0,q_right=parseInt(Y.css("margin-right"))||0,q_top=parseInt(Y.css("margin-top"))||0,q_bottom=parseInt(Y.css("margin-bottom"))||0,G_left=parseInt(Y.css("padding-left"))||0,G_right=parseInt(Y.css("padding-right"))||0,G_top=parseInt(Y.css("padding-top"))||0,G_bottom=parseInt(Y.css("padding-bottom"))||0;switch(A){case"top":return K_top+q_top+G_top;case"bottom":return K_bottom+q_bottom+G_bottom;case"left":return K_left+q_left+G_left;case"right":return K_right+q_right+G_right;case"width":return K_left+K_right+q_left+q_right+G_left+G_right+parseInt(Y.width());case"height":return K_top+K_bottom+q_top+q_bottom+G_top+G_bottom+parseInt(Y.height());case"+width":return K_left+K_right+q_left+q_right+G_left+G_right;case"+height":return K_top+K_bottom+q_top+q_bottom+G_top+G_bottom}return 0},getStrWidth:function Ve(S,A){let Y,K='<div id="_tmp_width" style="position: absolute; top: -900px;'+(A||"")+'">'+H(S)+"</div>";return v("body").append(K),Y=v("#_tmp_width").width(),v("#_tmp_width").remove(),Y},scrollBarSize:function Ie(){return e.scrollBarSize||(v("body").append('<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>'),e.scrollBarSize=100-v("#_scrollbar_width > div").width(),v("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(e.scrollBarSize=e.scrollBarSize/2)),e.scrollBarSize},checkName:function ht(S){return null==S?(console.log('ERROR: Property "name" is required but not supplied.'),!1):null!=w2ui[S]?(console.log(`ERROR: Object named "${S}" is already registered as w2ui.${S}.`),!1):!!w2utils.isAlphaNumeric(S)||(console.log('ERROR: Property "name" has to be alpha-numeric (a-z, 0-9, dash and underscore).'),!1)},checkUniqueId:function it(S,A,Y,K){Array.isArray(A)||(A=[A]);for(let q=0;q<A.length;q++)if(A[q].id===S)return console.log(`ERROR: The item "id=${S}" is not unique within the ${Y} "${K}".`,A),!1;return!0},parseRoute:function rt(S){let A=[],Y=S.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(K,q,G,V,ie,ye)=>(A.push({name:V,optional:!!ye}),q=q||"",(ye?"":q)+"(?:"+(ye?q:"")+(G||"")+(ie||G&&"([^/.]+?)"||"([^/]+?)")+")"+(ye||""))).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+Y+"$","i"),keys:A}},cssPrefix:function Qe(S,A,Y){let K={},q={},G="";v.isPlainObject(S)?(K=S,!0===A&&(Y=!0)):K[S]=A;for(let V in K)q[V]=K[V],q["-webkit-"+V]=K[V],q["-moz-"+V]=K[V].replace("-webkit-","-moz-"),q["-ms-"+V]=K[V].replace("-webkit-","-ms-"),q["-o-"+V]=K[V].replace("-webkit-","-o-");if(!0===Y)for(let V in q)G+=V+": "+q[V]+"; ";else G=q;return G},parseColor:function ct(S){if("string"!=typeof S)return null;"#"===(S=S.trim().toUpperCase())[0]&&(S=S.substr(1));let A={};if(3===S.length)A={r:parseInt(S[0]+S[0],16),g:parseInt(S[1]+S[1],16),b:parseInt(S[2]+S[2],16),a:1};else if(6===S.length)A={r:parseInt(S.substr(0,2),16),g:parseInt(S.substr(2,2),16),b:parseInt(S.substr(4,2),16),a:1};else if(8===S.length)A={r:parseInt(S.substr(0,2),16),g:parseInt(S.substr(2,2),16),b:parseInt(S.substr(4,2),16),a:Math.round(parseInt(S.substr(6,2),16)/255*100)/100};else if(S.length>4&&"RGB("===S.substr(0,4)){let Y=S.replace("RGB","").replace(/\(/g,"").replace(/\)/g,"").split(",");A={r:parseInt(Y[0],10),g:parseInt(Y[1],10),b:parseInt(Y[2],10),a:1}}else{if(!(S.length>5&&"RGBA("===S.substr(0,5)))return null;{let Y=S.replace("RGBA","").replace(/\(/g,"").replace(/\)/g,"").split(",");A={r:parseInt(Y[0],10),g:parseInt(Y[1],10),b:parseInt(Y[2],10),a:parseFloat(Y[3])}}}return A},hsv2rgb:function _t(S,A,Y,K){let q,G,V,ie,ye,ke,Te,be;switch(1===arguments.length&&(A=S.s,Y=S.v,K=S.a,S=S.h),S/=360,A/=100,Y/=100,ie=Math.floor(6*S),ye=6*S-ie,ke=Y*(1-A),Te=Y*(1-ye*A),be=Y*(1-(1-ye)*A),ie%6){case 0:q=Y,G=be,V=ke;break;case 1:q=Te,G=Y,V=ke;break;case 2:q=ke,G=Y,V=be;break;case 3:q=ke,G=Te,V=Y;break;case 4:q=be,G=ke,V=Y;break;case 5:q=Y,G=ke,V=Te}return{r:Math.round(255*q),g:Math.round(255*G),b:Math.round(255*V),a:null!=K?K:1}},rgb2hsv:function jt(S,A,Y,K){1===arguments.length&&(A=S.g,Y=S.b,K=S.a,S=S.r);let ie,q=Math.max(S,A,Y),G=Math.min(S,A,Y),V=q-G,ye=0===q?0:V/q,ke=q/255;switch(q){case G:ie=0;break;case S:ie=A-Y+V*(A<Y?6:0),ie/=6*V;break;case A:ie=Y-S+2*V,ie/=6*V;break;case Y:ie=S-A+4*V,ie/=6*V}return{h:Math.round(360*ie),s:Math.round(100*ye),v:Math.round(100*ke),a:null!=K?K:1}},tooltip:function $e(S,A){let Y,K="mouseenter",q="mouseleave";return(A=A||{}).showOn&&(K=A.showOn,delete A.showOn),A.hideOn&&(q=A.hideOn,delete A.hideOn),Y="on"+K+"=\"$(this).w2tag(w2utils.base64decode('"+w2utils.base64encode(S)+"'),JSON.parse(w2utils.base64decode('"+w2utils.base64encode(JSON.stringify(A))+"')))\"on"+q+'="$(this).w2tag()"',Y},getCursorPosition:function vt(S){if(null==S)return null;let q,A=0,Y=S.ownerDocument||S.document,K=Y.defaultView||Y.parentWindow;if(S.tagName&&"INPUT"===S.tagName.toUpperCase()&&S.selectionStart)A=S.selectionStart;else if(K.getSelection){if(q=K.getSelection(),q.rangeCount>0){let G=q.getRangeAt(0),V=G.cloneRange();V.selectNodeContents(S),V.setEnd(G.endContainer,G.endOffset),A=V.toString().length}}else if((q=Y.selection)&&"Control"!==q.type){let G=q.createRange(),V=Y.body.createTextRange();V.moveToElementText(S),V.setEndPoint("EndToEnd",G),A=V.text.length}return A},setCursorPosition:function Pt(S,A,Y){let q,K=document.createRange(),G=window.getSelection();if(null!=S){for(let V=0;V<S.childNodes.length;V++){let ie=v(S.childNodes[V]).text();if(S.childNodes[V].tagName&&(ie=v(S.childNodes[V]).html(),ie=ie.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," ")),A<=ie.length){q=S.childNodes[V],q.childNodes&&q.childNodes.length>0&&(q=q.childNodes[0]),q.childNodes&&q.childNodes.length>0&&(q=q.childNodes[0]);break}A-=ie.length}null!=q&&(A>q.length&&(A=q.length),K.setStart(q,A),Y?K.setEnd(q,Y):K.collapse(!0),G.removeAllRanges(),G.addRange(K))}},testLocalStorage:ft,hasLocalStorage:ft(),isIOS:-1!==navigator.userAgent.toLowerCase().indexOf("iphone")||-1!==navigator.userAgent.toLowerCase().indexOf("ipod")||-1!==navigator.userAgent.toLowerCase().indexOf("ipad")||-1!==navigator.userAgent.toLowerCase().indexOf("mobile")||-1!==navigator.userAgent.toLowerCase().indexOf("android"),isIE:-1!==navigator.userAgent.toLowerCase().indexOf("msie")||-1!==navigator.userAgent.toLowerCase().indexOf("trident"),isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)};function i(S){return/^[-+]?[0-9]+$/.test(S)}function s(S){return"string"==typeof S&&(S=S.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),("number"==typeof S||"string"==typeof S&&""!==S)&&!isNaN(Number(S))}function H(S){if(null==S)return S;switch(typeof S){case"number":break;case"string":S=String(S).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":if(Array.isArray(S)){S=v.extend(!0,[],S);for(let A=0;A<S.length;A++)S[A]=this.encodeTags(S[A])}else{S=v.extend(!0,{},S);for(let A in S)S[A]=this.encodeTags(S[A])}}return S}function He(S,A){return"string"==typeof S&&A&&"object"==typeof A?S.replace(/\${([^}]+)?}/g,function(Y,K){return A[K]||K}):S}function ft(){let S="w2ui_test";try{return localStorage.setItem(S,S),localStorage.removeItem(S),!0}catch(A){return!1}}function ui(S,A){v(S).each((Y,K)=>{let q=v(K).data();Object.keys(q).forEach(G=>{if(-1==["click","dblclick","mouseenter","mouseleave","mouseover","mouseout","mousedown","mousemove","mouseup","focus","blur","input","change","keydown","keyup","keypress"].indexOf(String(G).toLowerCase()))return;let V=v(K).data(G);"string"==typeof V&&(V=V.split("|").map(ye=>("true"===ye&&(ye=!0),"false"===ye&&(ye=!1),ye)));let ie=V[0];V=V.slice(1),v(K).off(G+".w2utils-bind").on(G+".w2utils-bind",function(ye){switch(ie){case"alert":alert(V[0]);break;case"stop":ye.stopPropagation();break;case"prevent":ye.preventDefault();break;case"stopPrevent":return ye.stopPropagation(),ye.preventDefault(),!1;default:A[ie].apply(A,V.map((ke,Te)=>{switch(String(ke).toLowerCase()){case"event":return ye;case"this":return this;default:return ke}}))}})})})}})(jQuery);w2utils.formatters={number:(v,e)=>(parseInt(e)>20&&(e=20),parseInt(e)<0&&(e=0),null==v||""===v?"":w2utils.formatNumber(parseFloat(v),e,!0)),float:(v,e)=>w2utils.formatters.number(v,e),int:(v,e)=>w2utils.formatters.number(v,0),money(v,e){if(null==v||""===v)return"";let t=w2utils.formatNumber(Number(v),w2utils.settings.currencyPrecision);return(w2utils.settings.currencyPrefix||"")+t+(w2utils.settings.currencySuffix||"")},currency:(v,e)=>w2utils.formatters.money(v,e),percent:(v,e)=>null==v||""===v?"":w2utils.formatNumber(v,e||1)+"%",size:(v,e)=>null==v||""===v?"":w2utils.formatSize(parseInt(v)),date(v,e){if(""===e&&(e=w2utils.settings.dateFormat),null==v||0===v||""===v)return"";let t=w2utils.isDateTime(v,e,!0);return!1===t&&(t=w2utils.isDate(v,e,!0)),'<span title="'+t+'">'+w2utils.formatDate(t,e)+"</span>"},datetime(v,e){if(""===e&&(e=w2utils.settings.datetimeFormat),null==v||0===v||""===v)return"";let t=w2utils.isDateTime(v,e,!0);return!1===t&&(t=w2utils.isDate(v,e,!0)),'<span title="'+t+'">'+w2utils.formatDateTime(t,e)+"</span>"},time(v,e){if(""===e&&(e=w2utils.settings.timeFormat),"h12"===e&&(e="hh:mi pm"),"h24"===e&&(e="h24:mi"),null==v||0===v||""===v)return"";let t=w2utils.isDateTime(v,e,!0);return!1===t&&(t=w2utils.isDate(v,e,!0)),'<span title="'+t+'">'+w2utils.formatTime(v,e)+"</span>"},timestamp(v,e){if(""===e&&(e=w2utils.settings.datetimeFormat),null==v||0===v||""===v)return"";let t=w2utils.isDateTime(v,e,!0);return!1===t&&(t=w2utils.isDate(v,e,!0)),t.toString?t.toString():""},gmt(v,e){if(""===e&&(e=w2utils.settings.datetimeFormat),null==v||0===v||""===v)return"";let t=w2utils.isDateTime(v,e,!0);return!1===t&&(t=w2utils.isDate(v,e,!0)),t.toUTCString?t.toUTCString():""},age(v,e){if(null==v||0===v||""===v)return"";let t=w2utils.isDateTime(v,null,!0);return!1===t&&(t=w2utils.isDate(v,null,!0)),'<span title="'+t+'">'+w2utils.age(v)+(e?" "+e:"")+"</span>"},interval:(v,e)=>null==v||0===v||""===v?"":w2utils.interval(v)+(e?" "+e:""),toggle:(v,e)=>v?"Yes":"",password(v,e){let t="";for(let i=0;i<v.length;i++)t+="*";return t}};class w2grid extends w2event{constructor(e){if(super(e.name),this.name=null,this.box=null,this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.toolbar={},this.ranges=[],this.menu=[],this.searchMap={},this.searchData=[],this.sortMap={},this.sortData=[],this.savedSearches=[],this.total=0,this.recid=null,this.last={field:"",label:"",logic:"AND",search:"",searchIds:[],selection:{indexes:[],columns:{}},_selection:null,multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,xhr:null,xhr_cmd:"",xhr_offset:null,xhr_start:0,xhr_response:0,xhr_hasMore:!1,pull_more:!1,pull_refresh:!0,loaded:!1,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,sel_recid:null,idCache:{},move:null,cancelClick:null,inEditMode:!1,_edit:null,kbd_timer:null,marker_timer:null,click_time:null,click_recid:null,bubbleEl:null,colResizing:!1,tmp:null,copy_event:null,userSelect:"",columnDrag:!1,state:null,show_extra:0,_toolbar_height:0},this.header="",this.url="",this.limit=100,this.offset=0,this.postData={},this.routeData={},this.httpHeaders={},this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,orderColumn:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!1,toolbarSearch:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,searchLogic:!0,searchHiddenMsg:!1,searchSave:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},this.stateId=null,this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=32,this.lineNumberWidth=34,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.showExtraOnSearch=0,this.markSearch=!0,this.columnTooltip="top|bottom",this.disableCVS=!1,this.nestedFields=!0,this.vs_start=150,this.vs_extra=15,this.style="",this.tabIndex=null,this.method=null,this.dataType=null,this.parser=null,this.advanceOnEdit=!1,this.useLocalStorage=!0,this.colDefaults={text:"",field:"",size:null,min:20,max:null,gridMinWidth:null,sizeCorrected:null,sizeCalculated:null,sizeOriginal:null,sizeType:null,hidden:!1,sortable:!1,sortMode:null,searchable:!1,resizable:!0,hideable:!0,autoResize:null,attr:"",style:"",render:null,title:null,tooltip:null,editable:{},frozen:!1,info:null,clipboardCopy:!1},this.stateColProps={text:!1,field:!0,size:!0,min:!1,max:!1,gridMinWidth:!1,sizeCorrected:!1,sizeCalculated:!0,sizeOriginal:!0,sizeType:!0,hidden:!0,sortable:!1,sortMode:!0,searchable:!1,resizable:!1,hideable:!1,autoResize:!1,attr:!1,style:!1,render:!1,title:!1,tooltip:!1,editable:!1,frozen:!0,info:!1,clipboardCopy:!1},this.msgDelete="Are you sure you want to delete ${count} ${records}?",this.msgNotJSON="Returned data is not in valid JSON format.",this.msgAJAXerror="AJAX error. See console for more details.",this.msgRefresh="Refreshing...",this.msgNeedReload="Your remote data source record count has changed, reloading from the first record.",this.msgEmpty="",this.buttons={reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon w2ui-icon-search w2ui-search-down\" onclick=\"let grid = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; grid.searchShowFields()\"></div>"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},this.operators={text:["is","begins","contains","ends"],number:["=","between",">","<",">=","<="],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},this.defaultOperator={text:"contains",number:"=",date:"is",list:"is",enum:"in",hex:"begins",color:"begins"},this.operatorsMap={text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},this.onAdd=null,this.onEdit=null,this.onRequest=null,this.onLoad=null,this.onDelete=null,this.onSave=null,this.onSelect=null,this.onUnselect=null,this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onMenuClick=null,this.onColumnClick=null,this.onColumnDblClick=null,this.onColumnResize=null,this.onColumnAutoResize=null,this.onSort=null,this.onSearch=null,this.onSearchOpen=null,this.onChange=null,this.onRestore=null,this.onExpand=null,this.onCollapse=null,this.onError=null,this.onKeydown=null,this.onToolbar=null,this.onColumnOnOff=null,this.onCopy=null,this.onPaste=null,this.onSelectionExtend=null,this.onEditField=null,this.onRender=null,this.onRefresh=null,this.onReload=null,this.onResize=null,this.onDestroy=null,this.onStateSave=null,this.onStateRestore=null,this.onFocus=null,this.onBlur=null,this.onReorderRow=null,this.onSearchSave=null,this.onSearchRemove=null,this.onSearchSelect=null,this.onColumnSelect=null,this.onColumnDragStart=null,this.onColumnDragEnd=null,this.onResizerDblClick=null,$.extend(!0,this,e),Array.isArray(this.records)){let t=[];this.records.forEach((i,s)=>{null!=i[this.recid]&&(i.recid=i[this.recid]),null==i.recid&&console.log("ERROR: Cannot add records without recid. (obj: "+this.name+")"),i.w2ui&&!0===i.w2ui.summary&&(this.summary.push(i),t.push(s))}),t.sort();for(let i=t.length-1;i>=0;i--)this.records.splice(t[i],1)}if(Array.isArray(this.columns)&&this.columns.forEach((t,i)=>{t=$.extend({},this.colDefaults,t),this.columns[i]=t;let s=t.searchable;if(null!=s&&!1!==s&&null==this.getSearch(t.field))if($.isPlainObject(s))this.addSearch($.extend({field:t.field,label:t.text,type:"text"},s));else{let l=t.searchable,n="";!0===t.searchable&&(l="text",n='size="20"'),this.addSearch({field:t.field,label:t.text,type:l,attr:n,options:t.options})}}),w2utils.hasLocalStorage&&this.useLocalStorage)try{let t=JSON.parse(localStorage.w2ui||"{}");if(t&&t.searches){let i=t.searches[this.stateId||this.name];Array.isArray(i)&&i.forEach(s=>{this.savedSearches.push({id:s.name,text:s.name,icon:"w2ui-icon-search",remove:!0,logic:s.logic,data:s.data})})}}catch(t){}}add(e,t){Array.isArray(e)||(e=[e]);let i=0;for(let l=0;l<e.length;l++){let n=e[l];null!=n[this.recid]&&(n.recid=n[this.recid]),null!=n.recid?(n.w2ui&&!0===n.w2ui.summary?t?this.summary.unshift(n):this.summary.push(n):t?this.records.unshift(n):this.records.push(n),i++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")")}return("object"!=typeof this.url?this.url:this.url.get)||(this.total=this.records.length,this.localSort(!1,!0),this.localSearch()),this.refresh(),i}find(e,t,i){null==e&&(e={});let s=[],l=!1;for(let o in e)-1!=String(o).indexOf(".")&&(l=!0);let r=i?this.last.range_end+1:this.records.length;r>this.records.length&&(r=this.records.length);for(let o=i?this.last.range_start:0;o<r;o++){let h=!0;for(let u in e){let g=this.records[o][u];l&&-1!=String(u).indexOf(".")&&(g=this.parseField(this.records[o],u)),"not-null"==e[u]?(null==g||""===g)&&(h=!1):e[u]!=g&&(h=!1)}h&&!0!==t&&s.push(this.records[o].recid),h&&!0===t&&s.push(o)}return s}set(e,t,i){if("object"==typeof e&&null!==e&&(i=t,t=e,e=null),null==e){for(let s=0;s<this.records.length;s++)$.extend(!0,this.records[s],t);!0!==i&&this.refresh()}else{let s=this.get(e,!0);if(null==s)return!1;this.records[s]&&this.records[s].recid==e?$.extend(!0,this.records[s],t):$.extend(!0,this.summary[s],t),!0!==i&&this.refreshRow(e,s)}return!0}get(e,t){if(Array.isArray(e)){let i=[];for(let s=0;s<e.length;s++){let l=this.get(e[s],t);null!==l&&i.push(l)}return i}{let i=this.last.idCache;i||(this.last.idCache=i={});let s=i[e];if("number"==typeof s){if(s>=0&&s<this.records.length&&this.records[s].recid==e)return!0===t?s:this.records[s];if(s=~s,s>=0&&s<this.summary.length&&this.summary[s].recid==e)return!0===t?s:this.summary[s];this.last.idCache=i={}}for(let l=0;l<this.records.length;l++)if(this.records[l].recid==e)return i[e]=l,!0===t?l:this.records[l];for(let l=0;l<this.summary.length;l++)if(this.summary[l].recid==e)return i[e]=~l,!0===t?l:this.summary[l];return null}}getSelectedRecords(){var e=[],t=this;return this.last.selection.indexes.forEach(i=>{e[e.length]=t.records[i]}),e}removeSelectedRecords(){var e=this;this.last.selection.indexes.forEach((t,i)=>{e.records[t]=null}),e.records=e.records.filter(function(t){return null!=t}),this.refresh(),this.selectNone()}transferSelectedRecords(e,t=!0,i=!0,s=!0){var l=[];if(this.getSelectedRecords().forEach(n=>{l.push(Object.assign({},n))}),i)l=l.filter(n=>null==w2ui[e].get(n.recid));else{let n=w2ui[e].records.map(r=>r.Id);l.forEach((r,o)=>{let h=1;for(;n.includes(h);)h++;r.recid=h,r.OldId=r.Id,r.Id=h,console.log(r)}),this.selectNone(),this.refresh()}s&&w2ui[e].add(l),t&&this.removeSelectedRecords()}transferSave(){this.postData.list=this.records.map(e=>e.OldId?e.OldId:e.recid),this.method="POST",this.save(),this.method="GET"}getFirst(e){if(0==this.records.length)return null;let t=this.records[0].recid,i=this.last.searchIds;return this.searchData.length>0&&(t=Array.isArray(i)&&i.length>0?this.records[i[e||0]]:null),t}remove(){let e=0;for(let i=0;i<arguments.length;i++){for(let s=this.records.length-1;s>=0;s--)this.records[s].recid==arguments[i]&&(this.records.splice(s,1),e++);for(let s=this.summary.length-1;s>=0;s--)this.summary[s].recid==arguments[i]&&(this.summary.splice(s,1),e++)}return("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!1,!0),this.localSearch()),this.refresh(),e}addColumn(e,t){let i=0;1==arguments.length?(t=e,e=this.columns.length):("string"==typeof e&&(e=this.getColumn(e,!0)),null==e&&(e=this.columns.length)),Array.isArray(t)||(t=[t]);for(let s=0;s<t.length;s++){let l=$.extend({},this.colDefaults,t[s]);if(this.columns.splice(e,0,l),t[s].searchable){let n=t[s].searchable,r="";!0===t[s].searchable&&(n="text",r='size="20"'),this.addSearch({field:t[s].field,label:t[s].label,type:n,attr:r})}e++,i++}return this.refresh(),i}removeColumn(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.columns.length-1;i>=0;i--)this.columns[i].field==arguments[t]&&(this.columns[i].searchable&&this.removeSearch(arguments[t]),this.columns.splice(i,1),e++);return this.refresh(),e}getColumn(e,t){if(0===arguments.length){let i=[];for(let s=0;s<this.columns.length;s++)i.push(this.columns[s].field);return i}for(let i=0;i<this.columns.length;i++)if(this.columns[i].field==e)return!0===t?i:this.columns[i];return null}updateColumn(e,t){let i=0;return(e=Array.isArray(e)?e:[e]).forEach(s=>{this.columns.forEach(l=>{if(l.field==s){let n=$.extend(!0,{},t);Object.keys(n).forEach(r=>{"function"==typeof n[r]&&(n[r]=n[r](l)),l[r]!=n[r]&&i++}),$.extend(!0,l,n)}})}),i>0&&this.refresh(),i}toggleColumn(){return this.updateColumn(Array.from(arguments),{hidden:e=>!e.hidden})}showColumn(){return this.updateColumn(Array.from(arguments),{hidden:!1})}hideColumn(){return this.updateColumn(Array.from(arguments),{hidden:!0})}addSearch(e,t){let i=0;1==arguments.length?(t=e,e=this.searches.length):("string"==typeof e&&(e=this.getSearch(e,!0)),null==e&&(e=this.searches.length)),Array.isArray(t)||(t=[t]);for(let s=0;s<t.length;s++)this.searches.splice(e,0,t[s]),e++,i++;return this.searchClose(),i}removeSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches.splice(i,1),e++);return this.searchClose(),e}getSearch(e,t){if(0===arguments.length){let i=[];for(let s=0;s<this.searches.length;s++)i.push(this.searches[s].field);return i}for(let i=0;i<this.searches.length;i++)if(this.searches[i].field==e)return!0===t?i:this.searches[i];return null}toggleSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches[i].hidden=!this.searches[i].hidden,e++);return this.searchClose(),e}showSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&!1!==this.searches[i].hidden&&(this.searches[i].hidden=!1,e++);return this.searchClose(),e}hideSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&!0!==this.searches[i].hidden&&(this.searches[i].hidden=!0,e++);return this.searchClose(),e}getSearchData(e){for(let t=0;t<this.searchData.length;t++)if(this.searchData[t].field==e)return this.searchData[t];return null}localSort(e,t){let i=this;if("object"!=typeof this.url?this.url:this.url.get)return void console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");if($.isEmptyObject(this.sortData))return;let l=(new Date).getTime();this.selectionSave(),this.prepareData(),t||this.reset();for(let c=0;c<this.sortData.length;c++){let m=this.getColumn(this.sortData[c].field);if(!m)return;"string"==typeof m.render&&(-1!=["date","age"].indexOf(m.render.split(":")[0])&&(this.sortData[c].field_=m.field+"_"),-1!=["time"].indexOf(m.render.split(":")[0])&&(this.sortData[c].field_=m.field+"_"))}return function n(){for(let c=0;c<i.records.length;c++){let m=i.records[c];m.w2ui&&null!=m.w2ui.parent_recid&&(m.w2ui._path=h(m))}}(),this.records.sort((c,m)=>function o(c,m){if(!(c.w2ui&&null!=c.w2ui.parent_recid||m.w2ui&&null!=m.w2ui.parent_recid))return u(c,m);let w=h(c),_=h(m);for(let k=0;k<Math.min(w.length,_.length);k++){let E=u(w[k],_[k]);if(0!==E)return E}return w.length>_.length?1:w.length<_.length?-1:(console.log("ERROR: two paths should not be equal."),0)}(c,m)),function r(){for(let c=0;c<i.records.length;c++){let m=i.records[c];m.w2ui&&null!=m.w2ui.parent_recid&&(m.w2ui._path=null)}}(),this.selectionRestore(t),l=(new Date).getTime()-l,!0!==e&&this.show.statusSort&&setTimeout(()=>{this.status(w2utils.lang("Sorting took ${count} seconds",{count:l/1e3}))},10),l;function h(c){if(!c.w2ui||null==c.w2ui.parent_recid)return[c];if(c.w2ui._path)return c.w2ui._path;let m=i.get(c.w2ui.parent_recid);return m?h(m).concat(c):(console.log("ERROR: no parent record: "+c.w2ui.parent_recid),[c])}function u(c,m){if(c===m)return 0;for(let _=0;_<i.sortData.length;_++){let k=i.sortData[_].field,E=i.sortData[_].field_?i.sortData[_].field_:k,I=c[E],N=m[E];-1!=String(k).indexOf(".")&&(I=i.parseField(c,E),N=i.parseField(m,E));let L=i.getColumn(k);L&&null!=L.editable&&($.isPlainObject(I)&&I.text&&(I=I.text),$.isPlainObject(N)&&N.text&&(N=N.text));let f=g(I,N,0,i.sortData[_].direction,L.sortMode||"default");if(0!==f)return f}return g(c.recid,m.recid,0,"asc")}function g(c,m,w,_,k){if(c===m)return 0;if((null==c||""===c)&&null!=m&&""!==m)return 1;if(null!=c&&""!==c&&(null==m||""===m))return-1;let E="asc"===_.toLowerCase()?1:-1;if(typeof c!=typeof m)return typeof c>typeof m?E:-E;if(c.constructor.name!=m.constructor.name)return c.constructor.name>m.constructor.name?E:-E;c&&"object"==typeof c&&(c=c.valueOf()),m&&"object"==typeof m&&(m=m.valueOf());let I={}.toString;switch(c&&"object"==typeof c&&c.toString!=I&&(c=String(c)),m&&"object"==typeof m&&m.toString!=I&&(m=String(m)),"string"==typeof c&&(c=c.toLowerCase().trim()),"string"==typeof m&&(m=m.toLowerCase().trim()),k){case"natural":k=w2utils.naturalCompare;break;case"i18n":k=w2utils.i18nCompare}return"function"==typeof k?k(c,m)*E:c>m?E:c<m?-E:0}}localSearch(e){let t=this,i="object"!=typeof this.url?this.url:this.url.get;if(i)return void console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");let s=(new Date).getTime(),l={}.toString,n={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),this.searchData.length>0&&!i){this.total=0;for(let h=0;h<this.records.length;h++){let u=this.records[h];if(r(u))if(u&&u.w2ui&&o(u.w2ui.parent_recid),this.showExtraOnSearch>0){let c=this.showExtraOnSearch,m=this.showExtraOnSearch;if(h<c&&(c=h),h+m>this.records.length&&(m=this.records.length-h),c>0)for(let w=h-c;w<h;w++)this.last.searchIds.indexOf(w)<0&&this.last.searchIds.push(w);if(this.last.searchIds.indexOf(h)<0&&this.last.searchIds.push(h),m>0)for(let w=h+1;w<=h+m;w++)this.last.searchIds.indexOf(w)<0&&this.last.searchIds.push(w)}else this.last.searchIds.push(h)}this.total=this.last.searchIds.length}return s=(new Date).getTime()-s,!0!==e&&this.show.statusSearch&&setTimeout(()=>{this.status(w2utils.lang("Search took ${count} seconds",{count:s/1e3}))},10),s;function r(h){let g,c,m,w,u=0,_=!1;for(let k=0;k<t.searchData.length;k++){let E=t.searchData[k],I=t.getSearch(E.field);if(null==E)continue;null==I&&(I={field:E.field,type:E.type});let N=t.parseField(h,I.field);switch(g=null==N||"object"==typeof N&&N.toString==l?"":String(N).toLowerCase(),null!=E.value&&(Array.isArray(E.value)?(c=E.value[0],m=E.value[1]):c=String(E.value).toLowerCase()),E.operator){case"=":case"is":t.parseField(h,I.field)==E.value?u++:"date"==I.type?(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.formatDate(w,"yyyy-mm-dd"),c=w2utils.formatDate(w2utils.isDate(c,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"),g==c&&u++):"time"==I.type?(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.formatTime(w,"hh24:mi"),c=w2utils.formatTime(c,"hh24:mi"),g==c&&u++):"datetime"==I.type&&(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.formatDateTime(w,"yyyy-mm-dd|hh24:mm:ss"),c=w2utils.formatDateTime(w2utils.isDateTime(c,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),g==c&&u++);break;case"between":-1!=["int","float","money","currency","percent"].indexOf(I.type)?parseFloat(t.parseField(h,I.field))>=parseFloat(c)&&parseFloat(t.parseField(h,I.field))<=parseFloat(m)&&u++:"date"==I.type?(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.isDate(w,w2utils.settings.dateFormat,!0),c=w2utils.isDate(c,w2utils.settings.dateFormat,!0),m=w2utils.isDate(m,w2utils.settings.dateFormat,!0),null!=m&&(m=new Date(m.getTime()+864e5)),g>=c&&g<m&&u++):"time"==I.type?(g=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),c=w2utils.isTime(c,!0),m=w2utils.isTime(m,!0),c=(new Date).setHours(c.hours,c.minutes,c.seconds?c.seconds:0,0),m=(new Date).setHours(m.hours,m.minutes,m.seconds?m.seconds:0,0),g>=c&&g<m&&u++):"datetime"==I.type&&(g=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),c=w2utils.isDateTime(c,w2utils.settings.datetimeFormat,!0),m=w2utils.isDateTime(m,w2utils.settings.datetimeFormat,!0),m&&(m=new Date(m.getTime()+864e5)),g>=c&&g<m&&u++);break;case"<=":_=!0;case"<":case"less":-1!=["int","float","money","currency","percent"].indexOf(I.type)?(g=parseFloat(t.parseField(h,I.field)),c=parseFloat(E.value),(g<c||_&&g===c)&&u++):"date"==I.type?(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.isDate(w,w2utils.settings.dateFormat,!0),c=w2utils.isDate(c,w2utils.settings.dateFormat,!0),(g<c||_&&g===c)&&u++):"time"==I.type?(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.formatTime(w,"hh24:mi"),c=w2utils.formatTime(c,"hh24:mi"),(g<c||_&&g===c)&&u++):"datetime"==I.type&&(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.formatDateTime(w,"yyyy-mm-dd|hh24:mm:ss"),c=w2utils.formatDateTime(w2utils.isDateTime(c,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),g.length==c.length&&(g<c||_&&g===c)&&u++);break;case">=":_=!0;case">":case"more":-1!=["int","float","money","currency","percent"].indexOf(I.type)?(g=parseFloat(t.parseField(h,I.field)),c=parseFloat(E.value),(g>c||_&&g===c)&&u++):"date"==I.type?(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.isDate(w,w2utils.settings.dateFormat,!0),c=w2utils.isDate(c,w2utils.settings.dateFormat,!0),(g>c||_&&g===c)&&u++):"time"==I.type?(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.formatTime(w,"hh24:mi"),c=w2utils.formatTime(c,"hh24:mi"),(g>c||_&&g===c)&&u++):"datetime"==I.type&&(w=t.parseField(h,I.field+"_")instanceof Date?t.parseField(h,I.field+"_"):t.parseField(h,I.field),g=w2utils.formatDateTime(w,"yyyy-mm-dd|hh24:mm:ss"),c=w2utils.formatDateTime(w2utils.isDateTime(c,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),g.length==c.length&&(g>c||_&&g===c)&&u++);break;case"in":w=E.value,E.svalue&&(w=E.svalue),(-1!==w.indexOf(w2utils.isFloat(N)?parseFloat(N):N)||-1!==w.indexOf(g))&&u++;break;case"not in":w=E.value,E.svalue&&(w=E.svalue),-1!==w.indexOf(w2utils.isFloat(N)?parseFloat(N):N)||-1!==w.indexOf(g)||u++;break;case"begins":case"begins with":0===g.indexOf(c)&&u++;break;case"contains":g.indexOf(c)>=0&&u++;break;case"null":null==t.parseField(h,I.field)&&u++;break;case"not null":null!=t.parseField(h,I.field)&&u++;break;case"ends":case"ends with":let L=g.lastIndexOf(c);-1!==L&&L==g.length-c.length&&u++}}if("OR"==t.last.logic&&0!==u||"AND"==t.last.logic&&u==t.searchData.length)return!0;if(h.w2ui&&h.w2ui.children&&!0!==h.w2ui.expanded)for(let k=0;k<h.w2ui.children.length;k++)if(r(h.w2ui.children[k]))return!0;return!1}function o(h){if(void 0===h||n[h])return;n[h]=!0;let u=t.get(h,!0);if(null==u||-1!=$.inArray(u,t.last.searchIds))return;let g=t.records[u];g&&g.w2ui&&o(g.w2ui.parent_recid),t.last.searchIds.push(u)}}getRangeData(e,t){let i=this.get(e[0].recid,!0),s=this.get(e[1].recid,!0),l=e[0].column,n=e[1].column,r=[];if(l==n)for(let o=i;o<=s;o++){let h=this.records[o],u=h[this.columns[l].field]||null;r.push(!0!==t?u:{data:u,column:l,index:o,record:h})}else if(i==s){let o=this.records[i];for(let h=l;h<=n;h++){let u=o[this.columns[h].field]||null;r.push(!0!==t?u:{data:u,column:h,index:i,record:o})}}else for(let o=i;o<=s;o++){let h=this.records[o];r.push([]);for(let u=l;u<=n;u++){let g=h[this.columns[u].field];r[r.length-1].push(!0!==t?g:{data:g,column:u,index:o,record:h})}}return r}addRange(e){let i,s,t=0;if("row"==this.selectType)return t;Array.isArray(e)||(e=[e]);for(let l=0;l<e.length;l++){if("object"!=typeof e[l]&&(e[l]={name:"selection"}),"selection"==e[l].name){if(!1===this.show.selectionBorder)continue;let n=this.getSelection();if(0===n.length){this.removeRange("selection");continue}i=n[0],s=n[n.length-1]}else i=e[l].range[0],s=e[l].range[1];if(i){let n={name:e[l].name,range:[{recid:i.recid,column:i.column},{recid:s.recid,column:s.column}],style:e[l].style||""},r=!1;for(let o=0;o<this.ranges.length;o++)if(this.ranges[o].name==e[l].name){r=o;break}!1!==r?this.ranges[r]=n:this.ranges.push(n),t++}}return this.refreshRanges(),t}removeRange(){let e=0;for(let t=0;t<arguments.length;t++){let i=arguments[t];$("#grid_"+this.name+"_"+i).remove(),$("#grid_"+this.name+"_f"+i).remove();for(let s=this.ranges.length-1;s>=0;s--)this.ranges[s].name==i&&(this.ranges.splice(s,1),e++)}return e}refreshRanges(){if(0===this.ranges.length)return;let t,i,s,l,n,e=this,r=(new Date).getTime(),o=$("#grid_"+this.name+"_frecords"),h=$("#grid_"+this.name+"_records");for(let w=0;w<this.ranges.length;w++){let _=this.ranges[w],k=_.range[0],E=_.range[1];null==k.index&&(k.index=this.get(k.recid,!0)),null==E.index&&(E.index=this.get(E.recid,!0));let I=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(k.recid)+' td[col="'+k.column+'"]'),N=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(E.recid)+' td[col="'+E.column+'"]'),L=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(k.recid)+' td[col="'+k.column+'"]'),f=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(E.recid)+' td[col="'+E.column+'"]'),H=E.column;k.column<this.last.colStart&&E.column>this.last.colStart&&(I=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(k.recid)+' td[col="start"]')),k.column<this.last.colEnd&&E.column>this.last.colEnd&&(H='"end"',N=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(E.recid)+' td[col="end"]'));let B=parseInt($("#grid_"+this.name+"_rec_top").next().attr("index")),Q=parseInt($("#grid_"+this.name+"_rec_bottom").prev().attr("index")),X=parseInt($("#grid_"+this.name+"_frec_top").next().attr("index")),ne=parseInt($("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===I.length&&k.index<B&&E.index>B&&(I=$("#grid_"+this.name+"_rec_top").next().find("td[col="+k.column+"]")),0===N.length&&E.index>Q&&k.index<Q&&(N=$("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+H+"]")),0===L.length&&k.index<X&&E.index>X&&(L=$("#grid_"+this.name+"_frec_top").next().find("td[col="+k.column+"]")),0===f.length&&E.index>ne&&k.index<ne&&(f=$("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+E.column+"]"));let le=$(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input"),J=le.attr("recid"),ge=le.attr("column");"selection"==_.name&&_.range[0].recid==J&&_.range[0].column==ge||(t=$("#grid_"+this.name+"_f"+_.name),L.length>0||f.length>0?(0===t.length?(o.append('<div id="grid_'+this.name+"_f"+_.name+'" class="w2ui-selection" style="'+_.style+'">'+("selection"==_.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),t=$("#grid_"+this.name+"_f"+_.name)):(t.attr("style",_.style),t.find(".w2ui-selection-resizer").show()),0===f.length&&(f=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(E.recid)+" td:last-child"),0===f.length&&(f=$("#grid_"+this.name+"_frec_bottom td:first-child")),t.css("border-right","0px"),t.find(".w2ui-selection-resizer").hide()),null!=k.recid&&null!=E.recid&&L.length>0&&f.length>0?(i=0,s=h.scrollTop(),L.find(">div").position().top<8&&(i=0,s=0),l=L.position().left-0+i,n=L.position().top-0+s,t.show().css({left:(l>0?l:0)+"px",top:(n>0?n:0)+"px",width:f.position().left-L.position().left+f.width()+2+"px",height:f.position().top-L.position().top+f.height()+1+"px"})):t.hide()):t.hide(),t=$("#grid_"+this.name+"_"+_.name),I.length>0||N.length>0?(0===t.length?(h.append('<div id="grid_'+this.name+"_"+_.name+'" class="w2ui-selection" style="'+_.style+'">'+("selection"==_.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),t=$("#grid_"+this.name+"_"+_.name)):t.attr("style",_.style),0===I.length&&(I=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(k.recid)+" td:first-child"),0===I.length&&(I=$("#grid_"+this.name+"_rec_top td:first-child"))),0!==f.length&&t.css("border-left","0px"),null!=k.recid&&null!=E.recid&&I.length>0&&N.length>0?(i=h.scrollLeft(),s=h.scrollTop(),N.find(">div").position().top<8&&(i=0,s=0),l=I.position().left-0+i,n=I.position().top-0+s,t.show().css({left:(l>0?l:0)+"px",top:(n>0?n:0)+"px",width:N.position().left-I.position().left+N.width()+2+"px",height:N.position().top-I.position().top+N.height()+1+"px"})):t.hide()):t.hide())}$(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",function g(w){let _=e.getSelection();e.last.move={type:"expand",x:w.screenX,y:w.screenY,divX:0,divY:0,recid:_[0].recid,column:_[0].column,originalRange:[{recid:_[0].recid,column:_[0].column},{recid:_[_.length-1].recid,column:_[_.length-1].column}],newRange:[{recid:_[0].recid,column:_[0].column},{recid:_[_.length-1].recid,column:_[_.length-1].column}]},$(document).off(".w2ui-"+e.name).on("mousemove.w2ui-"+e.name,c).on("mouseup.w2ui-"+e.name,m),w.preventDefault()}).off("dblclick").on("dblclick",function(w){let _=e.trigger({phase:"before",type:"resizerDblClick",target:e.name,originalEvent:w});!0!==_.isCancelled&&e.trigger($.extend(_,{phase:"after"}))});let u={phase:"before",type:"selectionExtend",target:e.name,originalRange:null,newRange:null};return(new Date).getTime()-r;function c(w){let _=e.last.move;if(!_||"expand"!=_.type)return;_.divX=w.screenX-_.x,_.divY=w.screenY-_.y;let k,E,I=w.originalEvent.target;if("TD"!=I.tagName.toUpperCase()&&(I=$(I).parents("td")[0]),null!=$(I).attr("col")&&(E=parseInt($(I).attr("col"))),I=$(I).parents("tr")[0],k=$(I).attr("recid"),_.newRange[1].recid==k&&_.newRange[1].column==E)return;let N=$.extend({},_.newRange);if(_.newRange=[{recid:_.recid,column:_.column},{recid:k,column:E}],u=e.trigger($.extend(u,{originalRange:_.originalRange,newRange:_.newRange})),!0===u.isCancelled)return _.newRange=N,void(u.newRange=N);e.removeRange("grid-selection-expand"),e.addRange({name:"grid-selection-expand",range:u.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"})}function m(w){e.removeRange("grid-selection-expand"),delete e.last.move,$(document).off(".w2ui-"+e.name),e.trigger($.extend(u,{phase:"after"}))}}select(){if(0===arguments.length)return 0;let e=0,t=this.last.selection;this.multiSelect||this.selectNone();let i=Array.prototype.slice.call(arguments);Array.isArray(i[0])&&(i=i[0]);let s={phase:"before",type:"select",target:this.name};1==i.length?(s.multiple=!1,$.isPlainObject(i[0])?(s.recid=i[0].recid,s.column=i[0].column):s.recid=i[0]):(s.multiple=!0,s.recids=i);let l=this.trigger(s);if(!0===l.isCancelled)return 0;if("row"==this.selectType)for(let o=0;o<i.length;o++){let h="object"==typeof i[o]?i[o].recid:i[o],u=this.get(h,!0);if(null==u)continue;let g=null,c=null;if((0!==this.searchData.length||u+1>=this.last.range_start&&u+1<=this.last.range_end)&&(g=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(h)),c=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(h))),"row"==this.selectType){if(-1!=t.indexes.indexOf(u))continue;t.indexes.push(u),g&&c&&(g.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),c.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),g.find(".w2ui-grid-select-check").prop("checked",!0)),e++}}else{let o={};for(let u=0;u<i.length;u++){let g="object"==typeof i[u]?i[u].recid:i[u],c="object"==typeof i[u]?i[u].column:null;if(o[g]=o[g]||[],Array.isArray(c))o[g]=c;else if(w2utils.isInt(c))o[g].push(c);else for(let m=0;m<this.columns.length;m++)this.columns[m].hidden||o[g].push(parseInt(m))}let h=[];for(let u in o){let g=this.get(u,!0);if(null==g)continue;let c=null,m=null;g+1>=this.last.range_start&&g+1<=this.last.range_end&&(c=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(u)),m=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(u)));let w=t.columns[g]||[];-1==t.indexes.indexOf(g)&&t.indexes.push(g);for(let _=0;_<o[u].length;_++)-1==w.indexOf(o[u][_])&&w.push(o[u][_]);w.sort((_,k)=>_-k);for(let _=0;_<o[u].length;_++){let k=o[u][_];-1==h.indexOf(k)&&h.push(k),c&&(c.find("#grid_"+this.name+"_data_"+g+"_"+k).addClass("w2ui-selected"),c.find(".w2ui-col-number").addClass("w2ui-row-selected"),c.data("selected","yes"),c.find(".w2ui-grid-select-check").prop("checked",!0)),m&&(m.find("#grid_"+this.name+"_data_"+g+"_"+k).addClass("w2ui-selected"),m.find(".w2ui-col-number").addClass("w2ui-row-selected"),m.data("selected","yes"),m.find(".w2ui-grid-select-check").prop("checked",!0)),e++}t.columns[g]=w}for(let u=0;u<h.length;u++)$(this.box).find("#grid_"+this.name+"_column_"+h[u]+" .w2ui-col-header").addClass("w2ui-col-selected")}t.indexes.sort((o,h)=>o-h);let n=this.records.length>0&&t.indexes.length==this.records.length;return n||t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,n),this.trigger($.extend(l,{phase:"after"})),e}unselect(){let e=0,t=this.last.selection,i=Array.prototype.slice.call(arguments);Array.isArray(i[0])&&(i=i[0]);let s={phase:"before",type:"unselect",target:this.name};1==i.length?(s.multiple=!1,$.isPlainObject(i[0])?(s.recid=i[0].recid,s.column=i[0].column):s.recid=i[0]):(s.multiple=!0,s.recids=i);let l=this.trigger(s);if(!0===l.isCancelled)return 0;for(let o=0;o<i.length;o++){let h="object"==typeof i[o]?i[o].recid:i[o],u=this.get(h);if(null==u)continue;let g=this.get(u.recid,!0),c=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(h)),m=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(h));if("row"==this.selectType){if(-1==t.indexes.indexOf(g))continue;t.indexes.splice(t.indexes.indexOf(g),1),c.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),m.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=c.length&&(c[0].style.cssText="height: "+this.recordHeight+"px; "+c.attr("custom_style"),m[0].style.cssText="height: "+this.recordHeight+"px; "+m.attr("custom_style")),c.find(".w2ui-grid-select-check").prop("checked",!1),e++}else{let w=i[o].column;if(!w2utils.isInt(w)){let N=[];for(let L=0;L<this.columns.length;L++)this.columns[L].hidden||N.push({recid:h,column:L});return this.unselect(N)}let _=t.columns[g];if(!Array.isArray(_)||-1==_.indexOf(w))continue;_.splice(_.indexOf(w),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(h)).find(" > td[col="+w+"]").removeClass("w2ui-selected w2ui-inactive"),$("#grid_"+this.name+"_frec_"+w2utils.escapeId(h)).find(" > td[col="+w+"]").removeClass("w2ui-selected w2ui-inactive");let k=!1,E=!1,I=this.getSelection();for(let N=0;N<I.length;N++)I[N].column==w&&(k=!0),I[N].recid==h&&(E=!0);k||$(this.box).find(".w2ui-grid-columns td[col="+w+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+w+"] .w2ui-col-header").removeClass("w2ui-col-selected"),E||$("#grid_"+this.name+"_frec_"+w2utils.escapeId(h)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),e++,0===_.length&&(delete t.columns[g],t.indexes.splice(t.indexes.indexOf(g),1),c.removeData("selected"),c.find(".w2ui-grid-select-check").prop("checked",!1),m.removeData("selected"))}}let n=this.records.length>0&&t.indexes.length==this.records.length;return n||t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,n),this.trigger($.extend(l,{phase:"after"})),e}selectAll(){let e=(new Date).getTime();if(!1===this.multiSelect)return;let t=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(!0===t.isCancelled)return;let i="object"!=typeof this.url?this.url:this.url.get,s=this.last.selection,l=[];for(let n=0;n<this.columns.length;n++)l.push(n);if(s.indexes=[],i||0===this.searchData.length){let n=this.records.length;0!=this.searchData.length&&!i&&(n=this.last.searchIds.length);for(let r=0;r<n;r++)s.indexes.push(r),"row"!=this.selectType&&(s.columns[r]=l.slice())}else for(let n=0;n<this.last.searchIds.length;n++)s.indexes.push(this.last.searchIds[n]),"row"!=this.selectType&&(s.columns[this.last.searchIds[n]]=l.slice());return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)),s=this.getSelection(!0),1==s.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),s.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete"),this.addRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!0),this.status(),this.updateToolbar({indexes:s},!0),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}selectNone(){let e=(new Date).getTime(),t=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0===t.isCancelled)return;let i=this.last.selection;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)),i.indexes=[],i.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.updateToolbar(i,!1),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}updateToolbar(e){let t=this,i=e&&e.indexes?e.indexes.length:0;function s(l,n){!0===l.batch&&(i>0?t.toolbar.enable(n+l.id):t.toolbar.disable(n+l.id)),null!=l.batch&&!isNaN(l.batch)&&l.batch>0&&(i==l.batch?t.toolbar.enable(n+l.id):t.toolbar.disable(n+l.id)),"function"==typeof l.batch&&l.batch("cell"==t.selectType?e:e?e.indexes:null)}this.toolbar.items.forEach(l=>{s(l,""),Array.isArray(l.items)&&l.items.forEach(n=>{s(n,l.id+":")})})}getSelection(e){let t=[],i=this.last.selection;if("row"==this.selectType){for(let s=0;s<i.indexes.length;s++)!this.records[i.indexes[s]]||t.push(!0===e?i.indexes[s]:this.records[i.indexes[s]].recid);return t}for(let s=0;s<i.indexes.length;s++){let l=i.columns[i.indexes[s]];if(this.records[i.indexes[s]])for(let n=0;n<l.length;n++)t.push({recid:this.records[i.indexes[s]].recid,index:parseInt(i.indexes[s]),column:l[n]})}return t}getSelectionIndexes(e){return this.last.selection.indexes}search(e,t){let i="object"!=typeof this.url?this.url:this.url.get,s=[],l=this.last.multi,n=this.last.logic,r=this.last.field,o=this.last.search,h=!1;for(let g=0;g<this.searches.length;g++)!this.searches[g].hidden||null==this.searches[g].value||(s.push({field:this.searches[g].field,operator:this.searches[g].operator||"is",type:this.searches[g].type,value:this.searches[g].value||""}),h=!0);if(0===arguments.length){this.focus(),n=$(`#grid_${this.name}_logic`).val(),this.limit=parseInt($(`#grid_${this.name}_limit`).val()),o="";for(let g=0;g<this.searches.length;g++){let c=this.searches[g],m=$("#grid_"+this.name+"_operator_"+g).val(),w=$("#grid_"+this.name+"_field_"+g),_=$("#grid_"+this.name+"_field2_"+g),k=w.val(),E=_.val(),I=null,N=null;if(-1!=["int","float","money","currency","percent"].indexOf(c.type)){let L=w.data("w2field"),f=_.data("w2field");L&&(k=L.clean(k)),f&&(E=f.clean(E))}if(-1!=["list","enum"].indexOf(c.type)||-1!=["in","not in"].indexOf(m))if(k=w.data("selected")||{},Array.isArray(k)){I=[];for(let L=0;L<k.length;L++)I.push(w2utils.isFloat(k[L].id)?parseFloat(k[L].id):String(k[L].id)),delete k[L].hidden;$.isEmptyObject(k)&&(k="")}else N=k.text||"",k=k.id||"";if(""!==k&&null!=k||null!=E&&""!==E){let L={field:c.field,type:c.type,operator:m};"between"==m?$.extend(L,{value:[k,E]}):"in"==m&&"string"==typeof k||"not in"==m&&"string"==typeof k?$.extend(L,{value:k.split(",")}):$.extend(L,{value:k}),I&&$.extend(L,{svalue:I}),N&&$.extend(L,{text:N});try{"date"==c.type&&"between"==m&&(L.value[0]=k,L.value[1]=E),"date"==c.type&&"is"==m&&(L.value=k)}catch(f){}s.push(L),l=!0}}}if("string"==typeof e&&(1==arguments.length&&(t=e,e="all"),r=e,o=t,l=!1,n=h?"AND":"OR",null!=t))if("all"==e.toLowerCase())if(this.searches.length>0)for(let g=0;g<this.searches.length;g++){let c=this.searches[g];if("text"==c.type||"alphanumeric"==c.type&&w2utils.isAlphaNumeric(t)||"int"==c.type&&w2utils.isInt(t)||"float"==c.type&&w2utils.isFloat(t)||"percent"==c.type&&w2utils.isFloat(t)||("hex"==c.type||"color"==c.type)&&w2utils.isHex(t)||"currency"==c.type&&w2utils.isMoney(t)||"money"==c.type&&w2utils.isMoney(t)||"date"==c.type&&w2utils.isDate(t)||"time"==c.type&&w2utils.isTime(t)||"datetime"==c.type&&w2utils.isDateTime(t)||"datetime"==c.type&&w2utils.isDate(t)||"enum"==c.type&&w2utils.isAlphaNumeric(t)||"list"==c.type&&w2utils.isAlphaNumeric(t)){let m=this.defaultOperator[this.operatorsMap[c.type]],w={field:c.field,type:c.type,operator:null!=c.operator?c.operator:m,value:t};""!=String(t).trim()&&s.push(w)}if(-1!=["int","float","money","currency","percent"].indexOf(c.type)&&2==String(t).trim().split("-").length){let m=String(t).trim().split("-");s.push({field:c.field,type:c.type,operator:null!=c.operator?c.operator:"between",value:[m[0],m[1]]})}if(-1!=["list","enum"].indexOf(c.type)){let m=[];null==c.options&&(c.options={}),Array.isArray(c.options.items)||(c.options.items=[]);for(let w=0;w<c.options.items;w++){let _=c.options.items[w];try{let k=new RegExp(t,"i");k.test(_)&&m.push(w),_.text&&k.test(_.text)&&m.push(_.id)}catch(k){}}m.length>0&&s.push({field:c.field,type:c.type,operator:null!=c.operator?c.operator:"in",value:m})}}else for(let g=0;g<this.columns.length;g++)s.push({field:this.columns[g].field,type:"text",operator:this.defaultOperator.text,value:t});else{let g=$("#grid_"+this.name+"_search_all"),c=this.getSearch(e);if(null==c&&(c={field:e,type:"text"}),c.field==e&&(this.last.label=c.label),""!==t){let m=this.defaultOperator[this.operatorsMap[c.type]],w=t;if(-1!=["date","time","datetime"].indexOf(c.type)&&(m="is"),-1!=["list","enum"].indexOf(c.type)){m="is";let k=g.data("selected");w=k&&!$.isEmptyObject(k)?k.id:""}if("int"==c.type&&""!==t){if(m="is",-1!=String(t).indexOf("-")){let k=t.split("-");2==k.length&&(m="between",w=[parseInt(k[0]),parseInt(k[1])])}if(-1!=String(t).indexOf(",")){let k=t.split(",");m="in",w=[];for(let E=0;E<k.length;E++)w.push(k[E])}}null!=c.operator&&(m=c.operator),s.push({field:c.field,type:c.type,operator:m,value:w})}}if(Array.isArray(e)){let g="AND";"string"==typeof t&&(g=t.toUpperCase(),"OR"!=g&&"AND"!=g&&(g="AND")),o="",l=!0,n=g;for(let c=0;c<e.length;c++){let m=e[c];"number"==typeof m.value&&(m.operator=this.defaultOperator.number),"string"==typeof m.value&&(m.operator=this.defaultOperator.text),Array.isArray(m.value)&&(m.operator=this.defaultOperator.enum),w2utils.isDate(m.value)&&(m.operator=this.defaultOperator.date),s.push(m)}}let u=this.trigger({phase:"before",type:"search",target:this.name,multi:0===arguments.length,searchField:e||"multi",searchValue:e?t:"multi",searchData:s,searchLogic:n});!0!==u.isCancelled&&(this.searchData=u.searchData,this.last.field=r,this.last.search=o,this.last.multi=l,this.last.logic=u.searchLogic,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),i?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(u,{phase:"after"})))}searchOpen(){if(!this.box||0===this.searches.length)return;let e=this,i=(e.toolbar.get("w2ui-search"),this.trigger({phase:"before",type:"searchOpen",target:this.name}));if(!0===i.isCancelled)return;let s=$(e.box).find(".w2ui-grid-search-input .w2ui-search-drop");s.addClass("checked"),$("#grid_"+e.name+"_search_all").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",align:"left",class:"w2ui-grid-search-advanced",onShow(){e.initSearches(),e.last.search_opened=!0,$(`#w2ui-overlay-${e.name}-searchOverlay .w2ui-grid-search-advanced`).data("grid-name",e.name),w2utils.bindEvents($(`#w2ui-overlay-${e.name}-searchOverlay`).find("select, input, button"),e);let l=$(`#w2ui-overlay-${e.name}-searchOverlay *[rel=search]`);l.length>0&&l[0].focus(),e.trigger($.extend(i,{phase:"after"}))},onHide(){s.removeClass("checked"),e.last.search_opened=!1}})}searchClose(){!this.box||0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced","w2ui-column-on-off"),$().w2overlay({name:this.name+"-searchOverlay"}))}searchSuggest(e,t,i){let s=this;if(clearTimeout(this.last.kbd_timer),clearTimeout(this.last.overlay_timer),this.searchShowFields(!0),this.searchClose(),!0===t)return void $(i).w2overlay({name:this.name+"-suggestOverlay"});if($(`#w2ui-overlay-${this.name}-suggestOverlay`).length>0)return;if(!e)return void(this.last.overlay_timer=setTimeout(()=>{this.searchSuggest(!0)},100));let l=$(`#grid_${this.name}_search_all`)[0];Array.isArray(this.savedSearches)&&this.savedSearches.length>0&&$(l).w2menu({align:"both",name:this.name+"-suggestOverlay",items:this.savedSearches,menuStyle:"top: 34px",topHTML:`<div class="w2ui-grid-search-suggest">${w2utils.lang("Saved Searches")}</div>`,render(n){let r=n.text;return n.isDefault&&(r=`<b>${r}</b>`),r},onSelect(n){let r=s.trigger({phase:"before",type:"searchSelect",target:s.name,index:n.index,item:n.item});!0!==r.isCancelled?(s.last.logic=n.item.logic||"AND",s.last.search="",s.last.label="[Multiple Fields]",s.searchData=$.extend(!0,[],n.item.data),s.searchSelected={name:n.item.id,logic:n.item.logic,data:$.extend(!0,[],n.item.data)},s.reload(),s.trigger($.extend(r,{phase:"after"}))):n.preventDefault()},onRemove(n){let r=s.trigger({phase:"before",type:"searchRemove",target:s.name,index:n.index,item:n.item});!0!==r.isCancelled?s.confirm(w2utils.lang('Do you want to delete search item "${item}"?',{item:n.item.text})).yes(()=>{if(w2utils.hasLocalStorage&&this.useLocalStorage)try{let h=JSON.parse(localStorage.w2ui||"{}");if(h&&h.searches){let u=h.searches[s.stateId||s.name];if(Array.isArray(u)){let g=u.findIndex((c,m)=>c.name==n.item.id);null!==g&&u.splice(g,1),localStorage.w2ui=JSON.stringify(h)}}}catch(h){}let o=s.savedSearches.findIndex((h,u)=>h.name==n.item.id);null!==o&&s.savedSearches.splice(o,1),s.trigger($.extend(r,{phase:"after"}))}):n.preventDefault()}})}searchFieldDrop(e,t,i){let s=this,l=this.searches[e],n=this.searchData[t],o=(this.getOperators(l.type,l.operators),"");switch(l.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":{let g="width: 250px;";-1!=["hex","color"].indexOf(l.type)&&(g="width: 90px;"),o+='<input rel="search" type="text" id="grid_'+this.name+"_field_"+e+'" name="'+l.field+'"    class="w2ui-input" style="'+g+l.style+'" '+l.inTag+"/>";break}case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":let u="width: 80px";"datetime"==l.type&&(u="width: 140px;"),o+='<input rel="search" type="text" class="w2ui-input" style="'+u+l.style+'" id="grid_'+this.name+"_field_"+e+'" name="'+l.field+'" '+l.inTag+'/><span id="grid_'+this.name+"_extra1_"+e+'" style="padding-left: 5px; color: #6f6f6f; font-size: 10px"></span><span id="grid_'+this.name+"_range_"+e+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+u+l.style+'" id="grid_'+this.name+"_field2_"+e+'" name="'+l.field+'" '+l.inTag+'/></span><span id="grid_'+this.name+"_extra2_"+e+'" style="padding-left: 5px; color: #6f6f6f; font-size: 10px"></span>';break;case"select":o+='<select rel="search" class="w2ui-input" style="'+l.style+'" id="grid_'+this.name+"_field_"+e+'"  name="'+l.field+'" '+l.inTag+'  onclick="event.stopPropagation();"></select>'}let h=n.operator;if("more"==h&&"date"==n.type&&(h="since"),"less"==h&&"date"==n.type&&(h="before"),Array.isArray(n.value)){let u="";n.value.forEach(g=>{u+=`<li>${g.text||g}</li>`}),"date"==n.type&&(u="",n.value.forEach(g=>{u+=`<li>${w2utils.formatDate(g)}</li>`})),$(i).w2overlay({name:this.name+"-fieldOverlay",html:`\n                  <div class="w2ui-grid-search-single">\n                      <span class="operator">${h}</span>\n                      <div class="options">\n                          <ul>${u}</ul>\n                      </div>\n                      <div class="buttons">\n                          <button id="remove" class="w2ui-btn">Remove This Field</button>\n                      </div>\n                  </div>`,onShow(g){$("#w2ui-overlay").find("#remove").on("click",()=>{s.searchData.splice(`${t}`,1),s.reload(),s.localSearch(),$(i).w2overlay({name:s.name+"-fieldOverlay"})})}})}else{let u=n.value;"date"==n.type&&(u=w2utils.formatDateTime(u)),$(i).w2overlay({html:`\n                  <div class="w2ui-grid-search-single">\n                      <div class="options">\n                          <span class="operator">${h}</span>\n                          "<span>${u}</span>"\n                      </div>\n                      <div class="buttons">\n                          <button id="remove" class="w2ui-btn">Remove This Field</button>\n                      </div>\n                  </div>`,onShow(g){$("#w2ui-overlay").find("#remove").on("click",()=>{s.searchData.splice(`${t}`,1),s.reload(),s.localSearch(),$(i).w2overlay({name:s.name+"-fieldOverlay"})})}})}}searchSave(){let e="";this.searchSelected&&(e=this.searchSelected.name);let i=this,s=this.trigger({phase:"before",type:"searchSave",target:this.name,saveLocalStorage:!0});!0!==s.isCancelled&&this.message({width:350,height:150,body:'<div style="padding-top: 29px; text-align: center;">\n              <span style="width: 280px; display: inline-block; text-align: left; padding-bottom: 4px;">Save Search</span>\n              <input class="search-name" placeholder="Search name" style="width: 280px">\n          </div>',buttons:`\n              <button id="grid-search-cancel" class="w2ui-btn">Cancel</button>\n              <button id="grid-search-save" class="w2ui-btn w2ui-btn-blue" ${""==String(e).trim()?"disabled":""}>Save</button>\n          `,onOpen(l){setTimeout(()=>{$(this.box).find("#grid-search-cancel").on("click",()=>{i.message()}),$(this.box).find("#grid-search-save").on("click",()=>{let r=$(i.box).find(".w2ui-message .search-name").val();if(i.searchSelected){let o=i.savedSearches.findIndex(h=>h.id==i.searchSelected.name);Object.assign(i.savedSearches[o],{id:r,text:r,logic:i.last.logic,data:$.extend(!0,[],i.searchData)})}else i.savedSearches.push({id:r,text:r,icon:"w2ui-icon-search",remove:!0,logic:i.last.logic,data:i.searchData});if(w2utils.hasLocalStorage&&i.useLocalStorage)try{let o=JSON.parse(localStorage.w2ui||"{}");o||(o={}),o.searches||(o.searches={}),Array.isArray(o.searches[i.stateId||i.name])||(o.searches[i.stateId||i.name]=[]);let h=o.searches[i.stateId||i.name],u=h.findIndex(g=>g.name==i.searchSelected.name);-1!==u?Object.assign(h[u],{name:r,logic:i.last.logic,data:i.searchData}):h.push({name:r,logic:i.last.logic,data:i.searchData}),localStorage.w2ui=JSON.stringify(o)}catch(o){return delete localStorage.w2ui,null}i.message(),i.searchSelected?(i.searchSelected.name=r,$(i.box).find(`#grid_${i.name}_search_name .name-text`).html(r)):(i.searchSelected={name:r,logic:i.last.logic,data:$.extend(!0,[],i.searchData)},$(i.box).find(`#grid_${i.name}_search_all`).val(" ").prop("readOnly",!0),$(i.box).find(`#grid_${i.name}_search_name`).show().find(".name-text").html(r)),this.trigger($.extend(s,{phase:"after",name:r}))});let n=$(this.box).find("input, button");n.off(".message").on("blur.message",function(r){n.index(r.target)+1===n.length&&(n.get(0).focus(),r.preventDefault())}).on("keydown.message",function(r){let o=String($(i.box).find(".w2ui-message-body input").val()).trim();13==r.keyCode&&""!=o&&$(i.box).find("#grid-search-save").click(),27==r.keyCode&&i.message()}),$(this.box).find(".w2ui-message-body input").on("input",function(r){let o=$(this).closest(".w2ui-message").find("#grid-search-save");""===String($(this).val()).trim()?o.prop("disabled",!0):o.prop("disabled",!1)}).val(e).focus()},25)}})}searchReset(e){let t=[],i=!1;for(let l=0;l<this.searches.length;l++)!this.searches[l].hidden||null==this.searches[l].value||(t.push({field:this.searches[l].field,operator:this.searches[l].operator||"is",type:this.searches[l].type,value:this.searches[l].value||""}),i=!0);let s=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:t});if(!0!==s.isCancelled){if(this.searchData=s.searchData,this.searchSelected=null,this.last.search="",this.last.logic=i?"AND":"OR",this.searches.length>0)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label=w2utils.lang("All Fields");else{let l=0;for(;l<this.searches.length&&(this.searches[l].hidden||!1===this.searches[l].simple);)l++;l>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[l].field,this.last.label=this.searches[l].label)}this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val("").removeData("selected"),e||this.reload(),this.trigger($.extend(s,{phase:"after"}))}}searchShowFields(e){let t=$("#grid_"+this.name+"_search_all");if(!0===e)return void $(t).w2overlay({name:this.name+"-searchFields"});let i='<div class="w2ui-grid-search-fields"><table><tbody>';for(let l=-1;l<this.searches.length;l++){let n=this.searches[l],o=this.getColumn(n?n.field:null),h=!1,u="This column is hidden";if(1==this.show.searchHiddenMsg&&-1!=l&&(null==o||!0===o.hidden&&!1!==o.hideable)&&(h=!0,null==o&&(u="This column does not exist")),-1==l){if(!this.multiSearch||!this.show.searchAll)continue;n={field:"all",label:w2utils.lang("All Fields")}}else if(null!=o&&!1===o.hideable||!0===this.searches[l].hidden||!1===this.searches[l].simple)continue;null==n.label&&null!=n.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",n),n.label=n.caption),i+='<tr style="'+(h?"color: silver":"")+'" '+(h?"onmouseenter=\"jQuery(this).w2tag({ top: 4, html: '"+u+'\' })" onmouseleave="jQuery(this).w2tag()"':"")+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"event.stopPropagation();            w2ui['"+this.name+"'].searchInitInput('"+n.field+"');           jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+"-searchFields' });\"           jQuery(this).addClass('w2ui-selected');      onmousedown=\"jQuery(this).parent().find('tr').removeClass('w2ui-selected'); jQuery(this).addClass('w2ui-selected')\"       onmouseup=\"jQuery(this).removeClass('w2ui-selected')\"    >   <td>       <span class=\"w2ui-column-check w2ui-icon-"+(n.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+n.label+"</td></tr>"}i+="</tbody></table></div>";let s=this.name+"-searchFields";1==$("#w2ui-overlay-"+s).length&&(i=""),setTimeout(()=>{$(t).w2overlay({html:i,name:s,left:-10})},1)}searchInitInput(e,t){let i,s=$("#grid_"+this.name+"_search_all");if("all"==e)i={field:"all",label:w2utils.lang("All Fields")};else if(i=this.getSearch(e),null==i)return;""!=this.last.search?(this.last.label=i.label,this.search(i.field,this.last.search)):(this.last.field=i.field,this.last.label=i.label),s.attr("placeholder",w2utils.lang("Search")+" "+w2utils.lang(i.label||i.caption||i.field,!0)),$().w2overlay({name:this.name+"-searchFields"})}clear(e){this.total=0,this.records=[],this.summary=[],this.last.xhr_offset=0,this.last.idCache={},this.reset(!0),e||this.refresh()}reset(e){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection={indexes:[],columns:{}},this.last.range_start=null,this.last.range_end=null,$("#grid_"+this.name+"_records").prop("scrollTop",0),e||this.refresh()}skip(e,t){console.log(e),("object"!=typeof this.url?this.url:this.url.get)?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(t)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")}load(e,t){null!=e?(this.clear(!0),this.request("get",{},e,t)):console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.')}reload(e){let t=this,i="object"!=typeof this.url?this.url:this.url.get;t.selectionSave(),i?this.load(i,()=>{t.selectionRestore(),"function"==typeof e&&e()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof e&&e({status:"success"}))}request(e,t,i,s){if(null==t&&(t={}),(""==i||null==i)&&(i=this.url),""==i||null==i)return;w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0);let l,n={limit:this.limit,offset:parseInt(this.offset)+parseInt(this.last.xhr_offset),searchLogic:this.last.logic,search:this.searchData.map(h=>{let u=$.extend({},h);return this.searchMap&&this.searchMap[u.field]&&(u.field=this.searchMap[u.field]),u}),sort:this.sortData.map(h=>{let u=$.extend({},h);return this.sortMap&&this.sortMap[u.field]&&(u.field=this.sortMap[u.field]),u})};if(0===this.searchData.length&&(delete n.search,delete n.searchLogic),0===this.sortData.length&&delete n.sort,$.extend(n,this.postData),$.extend(n,t),("delete"==e||"save"==e)&&(delete n.limit,delete n.offset,n.action=e,"delete"==e&&(n[this.recid||"recid"]=this.getSelection())),"get"==e){if(l=this.trigger({phase:"before",type:"request",target:this.name,url:i,postData:n,httpHeaders:this.httpHeaders}),!0===l.isCancelled)return void("function"==typeof s&&s({status:"error",message:w2utils.lang("Request aborted.")}))}else l={url:i,postData:n,httpHeaders:this.httpHeaders};if(0===this.last.xhr_offset&&this.lock(w2utils.lang(this.msgRefresh),!0),this.last.xhr)try{this.last.xhr.abort()}catch(h){}if(i="object"!=typeof l.url?l.url:l.url.get,"save"==e&&"object"==typeof l.url&&(i=l.url.save),"delete"==e&&"object"==typeof l.url&&(i=l.url.remove),!$.isEmptyObject(this.routeData)){let h=w2utils.parseRoute(i);if(h.keys.length>0)for(let u=0;u<h.keys.length;u++)null!=this.routeData[h.keys[u].name]&&(i=i.replace(new RegExp(":"+h.keys[u].name,"g"),this.routeData[h.keys[u].name]))}let r={type:"GET",url:i,data:l.postData,headers:l.httpHeaders,dataType:"HTTPJSON"};switch(null!=localStorage.getItem("token")&&(r.headers.Authorization="Bearer "+localStorage.getItem("token")),null!=localStorage.getItem("lang")&&(r.headers["Accept-Language"]=localStorage.getItem("lang")),this.dataType||w2utils.settings.dataType){case"HTTP":r.data="object"==typeof r.data?String($.param(r.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):r.data;break;case"HTTPJSON":r.data={request:JSON.stringify(r.data)};break;case"RESTFULL":r.type="GET","save"==e&&(r.type="PUT"),"delete"==e&&(r.type="DELETE"),r.data="object"==typeof r.data?String($.param(r.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):r.data;break;case"RESTFULLJSON":r.type="GET","save"==e&&(r.type="PUT"),"delete"==e&&(r.type="DELETE"),r.data=JSON.stringify(r.data),r.contentType="application/json";break;case"JSON":r.type="POST",r.data=JSON.stringify(r.data),r.contentType="application/json"}r.dataType="json",this.method&&(r.type=this.method),this.last.xhr_cmd=e,this.last.xhr_start=(new Date).getTime(),this.last.loaded=!1,this.last.xhr=$.ajax(r).done((h,u,g)=>{this.requestComplete(u,g,e,s)}).fail((h,u,g)=>{let m=this.trigger({phase:"before",type:"error",error:{status:u,error:g,rawResponseText:h.responseText},xhr:h});if(!0!==m.isCancelled){if("abort"!=u){let w;try{w="object"==typeof h.responseJSON?h.responseJSON:JSON.parse(h.responseText)}catch(_){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof w?w:h.responseText),this.requestComplete("error",h,e,s)}this.trigger($.extend(m,{phase:"after"}))}}),"get"==e&&this.trigger($.extend(l,{phase:"after"}))}requestComplete(e,t,i,s){this.unlock(),this.last.xhr_response=((new Date).getTime()-this.last.xhr_start)/1e3,setTimeout(()=>{this.show.statusResponse&&this.status(w2utils.lang("Server Response ${count} seconds",{count:this.last.xhr_response}))},10),this.last.pull_more=!1,this.last.pull_refresh=!0;let l="load";"save"==this.last.xhr_cmd&&(l="save"),"delete"==this.last.xhr_cmd&&(l="delete");let r,n=this.trigger({phase:"before",target:this.name,type:l,xhr:t,status:e});if(!0!==n.isCancelled){if("error"!=e){if("function"==typeof this.parser?(r=this.parser(t.responseJSON),"object"!=typeof r&&console.log("ERROR: Your parser did not return proper object")):(r=t.responseJSON,null==r?r={status:"error",message:w2utils.lang(this.msgNotJSON),responseText:t.responseText}:Array.isArray(r)&&(r={status:"success",records:r,total:r.length})),"error"==r.status)this.error(r.message);else if("get"==i){if(null==r.total&&(r.total=-1),null==r.records&&(r.records=[]),r.records.length==this.limit?this.last.xhr_hasMore=this.records.length+r.records.length!=this.total:(this.last.xhr_hasMore=!1,this.total=this.offset+this.last.xhr_offset+r.records.length),this.last.xhr_hasMore||$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide(),0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(r.total)&&(this.total=parseInt(r.total));else if(-1!=r.total&&parseInt(r.total)!=parseInt(this.total)){let h=this;return void this.message({body:`<div class="w2ui-centered">${w2utils.lang(h.msgNeedReload)}</div>`,onClose(u){delete h.last.xhr_offset,h.reload()}})}r.records&&r.records.forEach(h=>{this.recid&&(h.recid=this.parseField(h,this.recid)),null==h.recid&&(h.recid="recid-"+this.records.length),h.w2ui&&!0===h.w2ui.summary?this.summary.push(h):this.records.push(h)}),r.summary&&(this.summary=[],r.summary.forEach(h=>{this.recid&&(h.recid=this.parseField(h,this.recid)),null==h.recid&&(h.recid="recid-"+this.summary.length),this.summary.push(h)}))}else if("delete"==i)return this.reset(),void this.reload()}else console.log("cccc",t),r={status:"error",message:w2utils.lang(t.responseJSON?t.responseJSON.message:this.msgAJAXerror),responseText:t.responseText},this.error(w2utils.lang(t.responseJSON?t.responseJSON.message:this.msgAJAXerror));("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize()),"function"==typeof s&&s(r),this.trigger($.extend(n,{phase:"after"})),this.last.loaded=!0}else"function"==typeof s&&s({status:"error",message:w2utils.lang("Request aborted.")})}error(e){let t=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});!0!==t.isCancelled&&(this.message(e),this.trigger($.extend(t,{phase:"after"})))}getChanges(e){let t=[];void 0===e&&(e=this.records);for(let i=0;i<e.length;i++){let s=e[i];if(s.w2ui){if(null!=s.w2ui.changes){let l={};l[this.recid||"recid"]=s.recid,t.push($.extend(!0,l,s.w2ui.changes))}!0!==s.w2ui.expanded&&s.w2ui.children&&s.w2ui.children.length&&$.merge(t,this.getChanges(s.w2ui.children))}}return t}mergeChanges(){let e=this.getChanges();for(let i=0;i<e.length;i++){let s=this.get(e[i][this.recid||"recid"]);for(let l in e[i])if(!("recid"==l||this.recid&&l==this.recid)){"object"==typeof e[i][l]&&(e[i][l]=e[i][l].text);try{t(s,l,e[i][l])}catch(n){console.log("ERROR: Cannot merge. ",n.message||"",n)}s.w2ui&&delete s.w2ui.changes}}function t(i,s,l){let n=s.split(".");1==n.length?i[s]=l:(i=i[n[0]],n.shift(),t(i,n.join("."),l))}this.refresh()}save(e){let t=this.getChanges(),i="object"!=typeof this.url?this.url:this.url.save,s=this.trigger({phase:"before",target:this.name,type:"save",changes:t});!0!==s.isCancelled?i?this.request("save",{changes:s.changes},null,l=>{"error"!==l.status&&this.mergeChanges(),this.trigger($.extend(s,{phase:"after"})),"function"==typeof e&&e(l)}):(this.mergeChanges(),this.trigger($.extend(s,{phase:"after"}))):i&&"function"==typeof e&&e({status:"error",message:w2utils.lang("Request aborted.")})}editField(e,t,i,s){let n,r,l=this;if(!0===this.last.inEditMode){if(s&&13==s.keyCode){if(n=this.last._edit.index,t=this.last._edit.column,this.editChange({type:"custom",value:this.last._edit.value},this.get(e=this.last._edit.recid,!0),t,s),1==this.advanceOnEdit){let N=s.shiftKey?this.prevRow(n,t,1):this.nextRow(n,t,1);null!=N&&N!=n&&setTimeout(()=>{"row"!=this.selectType?(this.selectNone(),this.select({recid:this.records[N].recid,column:t})):this.editField(this.records[N].recid,t,null,s)},1)}this.last.inEditMode=!1}else{let N=$(this.box).find("div.w2ui-edit-box .w2ui-input");N.length>0&&"DIV"==N[0].tagName&&(N.text(N.text()+i),w2utils.setCursorPosition(N[0],N.text().length))}return}n=this.get(e,!0);let o=this.getCellEditable(n,t);if(!o)return;let h=this.records[n],u=this.columns[t],g=!0===u.frozen?"_f":"_";if(-1!=["enum","file"].indexOf(o.type))return void console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');let c=this.trigger({phase:"before",type:"editField",target:this.name,recid:e,column:t,value:i,index:n,originalEvent:s});if(!0===c.isCancelled||(i=c.value,this.last.inEditMode=!0,this.last._edit={value:i,index:n,column:t,recid:e},this.selectNone(),this.select({recid:e,column:t}),-1!=["checkbox","check"].indexOf(o.type)))return;let m=$("#grid_"+this.name+g+"rec_"+w2utils.escapeId(e)),w=m.find("[col="+t+"] > div");$(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&($("#grid_"+this.name+g+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),w=$("#grid_"+this.name+"_editable >div:first-child")),null==o.inTag&&(o.inTag=""),null==o.outTag&&(o.outTag=""),null==o.style&&(o.style=""),null==o.items&&(o.items=[]);let _=w2utils.stripTags(h.w2ui&&h.w2ui.changes&&null!=h.w2ui.changes[u.field]?h.w2ui.changes[u.field]:h[u.field]);null==_&&(_="");let k="object"!=typeof _?_:"";null!=c.old_value&&(k=c.old_value),null!=i&&(_=i);let E=null!=u.style?u.style+";":"";switch("string"==typeof u.render&&-1!=["number","int","float","money","percent","size"].indexOf(u.render.split(":")[0])&&(E+="text-align: right;"),o.items.length>0&&!$.isPlainObject(o.items[0])&&(o.items=w2utils.normMenu(o.items)),o.type){case"select":{let N="";for(let L=0;L<o.items.length;L++)N+='<option value="'+o.items[L].id+'"'+(o.items[L].id==_?' selected="selected"':"")+">"+o.items[L].text+"</option>";w.addClass("w2ui-editable").html('<select id="grid_'+this.name+"_edit_"+e+"_"+t+'" column="'+t+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+E+o.style+'"     field="'+u.field+'" recid="'+e+'"     '+o.inTag+">"+N+"</select>"+o.outTag),setTimeout(()=>{w.find("select").on("change",function(L){delete l.last.move}).on("blur",function(L){1!=$(this).data("keep-open")&&l.editChange.call(l,this,n,t,L)})},10);break}case"div":{let N=m.find("[col="+t+"] > div"),L="font-family: "+N.css("font-family")+"; font-size: "+N.css("font-size")+";";w.addClass("w2ui-editable").html('<div id="grid_'+this.name+"_edit_"+e+"_"+t+'" class="w2ui-input"    contenteditable style="'+L+E+o.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+u.field+'" recid="'+e+'" column="'+t+'" '+o.inTag+"></div>"+o.outTag),null==i&&w.find("div.w2ui-input").text("object"!=typeof _?_:""),r=w.find("div.w2ui-input").get(0),setTimeout(()=>{let f=r;$(f).on("blur",function(H){1!=$(this).data("keep-open")&&l.editChange.call(l,f,n,t,H)})},10),null!=i&&$(r).text("object"!=typeof _?_:"");break}default:{let N=m.find("[col="+t+"] > div"),L="font-family: "+N.css("font-family")+"; font-size: "+N.css("font-size");w.addClass("w2ui-editable").html('<input id="grid_'+this.name+"_edit_"+e+"_"+t+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+L+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+E+o.style+'"     field="'+u.field+'" recid="'+e+'" column="'+t+'" class="w2ui-input"'+o.inTag+"/>"+o.outTag),"number"==o.type&&(_=w2utils.formatNumber(_)),"date"==o.type&&(_=w2utils.formatDate(w2utils.isDate(_,o.format,!0)||new Date,o.format)),null==i&&w.find("input").val("object"!=typeof _?_:""),r=w.find("input").get(0),$(r).w2field(o.type,$.extend(o,{selected:_})),setTimeout(()=>{let f=r;"list"==o.type&&(f=$($(r).data("w2field").helpers.focus).find("input"),"object"!=typeof _&&""!=_&&f.val(_).css({opacity:1}).prev().css({opacity:1}),w.find("input").on("change",function(H){l.editChange.call(l,r,n,t,H)})),$(f).on("blur",function(H){1!=$(this).data("keep-open")&&l.editChange.call(l,r,n,t,H)})},10),null!=i&&$(r).val("object"!=typeof _?_:"")}}return void setTimeout(()=>{r||(r=w.find("input").get(0)),this.last.inEditMode&&(w.find("input, select, div.w2ui-input").data("old_value",k).on("mousedown",function(N){N.stopPropagation()}).on("click",function(N){I.call("div"==o.type?w.find("div.w2ui-input")[0]:w.find("input, select")[0],null)}).on("paste",function(N){let L=N.originalEvent;N.preventDefault();let f=L.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,f)}).on("keydown",function(N){let L=this,f="DIV"==L.tagName.toUpperCase()?$(L).text():$(L).val();switch(N.keyCode){case 8:"list"==o.type&&!$(r).data("w2field")&&N.preventDefault();break;case 9:case 13:N.preventDefault();break;case 37:0===w2utils.getCursorPosition(L)&&N.preventDefault();break;case 39:w2utils.getCursorPosition(L)==f.length&&(w2utils.setCursorPosition(L,f.length),N.preventDefault())}setTimeout(()=>{switch(N.keyCode){case 9:{let H=e,B=N.shiftKey?l.prevCell(n,t,!0):l.nextCell(n,t,!0);if(null==B){let Q=N.shiftKey?l.prevRow(n,t,1):l.nextRow(n,t,1);if(null!=Q&&Q!=n){H=l.records[Q].recid;for(let X=0;X<l.columns.length;X++){let ne=l.getCellEditable(n,X);if(null!=ne&&-1==["checkbox","check"].indexOf(ne.type)&&(B=parseInt(X),!N.shiftKey))break}}}!1===H&&(H=e),null==B&&(B=t),L.blur(),setTimeout(()=>{"row"!=l.selectType?(l.selectNone(),l.select({recid:H,column:B})):l.editField(H,B,null,N)},1),N.preventDefault&&N.preventDefault();break}case 13:if(L.blur(),1==l.advanceOnEdit){let H=N.shiftKey?l.prevRow(n,t,1):l.nextRow(n,t,1);null!=H&&H!=n&&setTimeout(()=>{"row"!=l.selectType?(l.selectNone(),l.select({recid:l.records[H].recid,column:t})):l.editField(l.records[H].recid,t,null,N)},1)}"DIV"==L.tagName.toUpperCase()&&N.preventDefault();break;case 27:{let H=l.parseField(h,u.field);h.w2ui&&h.w2ui.changes&&null!=h.w2ui.changes[u.field]&&(H=h.w2ui.changes[u.field]),null!=$(L).data("old_value")&&(H=$(L).data("old_value")),"DIV"==L.tagName.toUpperCase()?$(L).text(null!=H?H:""):L.value=null!=H?H:"",L.blur(),setTimeout(()=>{l.select({recid:e,column:t})},1);break}}I.call(L,N)},1)}).on("keyup",function(N){I.call(this,N)}),setTimeout(()=>{if(!l.last.inEditMode)return;let N=w.find(".w2ui-input"),L=null!=$(N).val()?$(N).val().length:0;"div"==o.type&&(L=$(N).text().length),N.length>0&&(N.focus(),clearTimeout(l.last.kbd_timer),"SELECT"!=N[0].tagName.toUpperCase()&&w2utils.setCursorPosition(N[0],L),N[0].resize=I,I.call(N[0],null))},50),this.trigger($.extend(c,{phase:"after",input:w.find("input, select, div.w2ui-input")})))},5);function I(N){try{let L="DIV"==this.tagName.toUpperCase()?$(this).text():this.value,f=$("#grid_"+l.name+"_editable"),H="font-family: "+$(this).css("font-family")+"; font-size: "+$(this).css("font-size")+"; white-space: pre;",B=w2utils.getStrWidth(L,H);B+20>f.width()&&f.width(B+20)}catch(L){}}}editChange(e,t,i,s){setTimeout(()=>{let _=$(this.box).find("#grid_"+this.name+"_focus");_.is(":focus")||_.focus()},10);let l=t<0,r=(l?this.summary:this.records)[t=t<0?-t-1:t],o=this.columns[i],h=$("#grid_"+this.name+(!0===o.frozen?"_frec_":"_rec_")+w2utils.escapeId(r.recid)),u=e.tagName&&"DIV"==e.tagName.toUpperCase()?$(e).text():e.value,g=this.parseField(r,o.field),c=$(e).data("w2field");c&&("list"==c.type&&(u=$(e).data("selected")),($.isEmptyObject(u)||null==u)&&(u=""),$.isPlainObject(u)||(u=c.clean(u))),"checkbox"==e.type&&(r.w2ui&&!1===r.w2ui.editable&&(e.checked=!e.checked),u=e.checked);let m={phase:"before",type:"change",target:this.name,input_id:e.id,recid:r.recid,index:t,column:i,originalEvent:s.originalEvent?s.originalEvent:s,value_new:u,value_previous:r.w2ui&&r.w2ui.changes&&r.w2ui.changes.hasOwnProperty(o.field)?r.w2ui.changes[o.field]:g,value_original:g};for(null!=$(s.target).data("old_value")&&(m.value_previous=$(s.target).data("old_value"));;){if(u=m.value_new,"object"!=typeof u&&String(g)!=String(u)||"object"==typeof u&&u&&u.id!=g&&("object"!=typeof g||null==g||u.id!=g.id)){if(m=this.trigger($.extend(m,{type:"change",phase:"before"})),!0!==m.isCancelled){if(u!==m.value_new)continue;r.w2ui=r.w2ui||{},r.w2ui.changes=r.w2ui.changes||{},r.w2ui.changes[o.field]=m.value_new,this.trigger($.extend(m,{phase:"after"}))}}else if(m=this.trigger($.extend(m,{type:"restore",phase:"before"})),!0!==m.isCancelled){if(u!==m.value_new)continue;r.w2ui&&r.w2ui.changes&&delete r.w2ui.changes[o.field],r.w2ui&&$.isEmptyObject(r.w2ui.changes)&&delete r.w2ui.changes,this.trigger($.extend(m,{phase:"after"}))}break}let w=$(h).find("[col="+i+"]");l||(r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[o.field]?w.addClass("w2ui-changed"):w.removeClass("w2ui-changed"),w.replaceWith(this.getCellHTML(t,i,l))),$(this.box).find("div.w2ui-edit-box").remove(),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.last.inEditMode=!1}delete(e){let t=this.trigger({phase:"before",target:this.name,type:"delete",force:e});if(e&&this.message(),!0===t.isCancelled)return;e=t.force,setTimeout(()=>{$().w2tag()},20);let i=this.getSelection();if(0!==i.length)if(""==this.msgDelete||e){if("object"!=typeof this.url?this.url:this.url.remove)this.request("delete");else if("object"!=typeof i[0])this.selectNone(),this.remove.apply(this,i);else{for(let l=0;l<i.length;l++){let n=this.columns[i[l].column].field,r=this.get(i[l].recid,!0),o=this.records[r];null!=r&&"recid"!=n&&(this.records[r][n]="",o.w2ui&&o.w2ui.changes&&delete o.w2ui.changes[n])}this.update()}this.trigger($.extend(t,{phase:"after"}))}else{let l=w2utils.lang(this.msgDelete,{count:i.length,records:w2utils.lang(1==i.length?"record":"records")});this.confirm({width:380,height:170,yes_text:"Delete",yes_class:"w2ui-btn-red",no_text:"Cancel",body:'<div class="w2ui-centered">'+l+"</div>"}).yes(()=>{this.delete(!0)})}}click(e,t){let i=(new Date).getTime(),s=null;if(1==this.last.cancelClick||t&&t.altKey)return;if("object"==typeof e&&null!==e&&(s=e.column,e=e.recid),null==t&&(t={}),i-parseInt(this.last.click_time)<350&&this.last.click_recid==e&&"click"==t.type)return void this.dblClick(e,t);this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null),this.last.click_time=i;let l=this.last.click_recid;if(this.last.click_recid=e,null==s&&t.target){let w=t.target;"TD"!=w.tagName.toUpperCase()&&(w=$(w).parents("td")[0]),null!=$(w).attr("col")&&(s=parseInt($(w).attr("col")))}let n=this.trigger({phase:"before",target:this.name,type:"click",recid:e,column:s,originalEvent:t});if(!0===n.isCancelled)return;let r=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);let u,g,c,m,o=this.get(e,!0),h=[];if(this.last.sel_ind=o,this.last.sel_col=s,this.last.sel_recid=e,this.last.sel_type="click",t.shiftKey&&r.length>0&&this.multiSelect){if(r[0].recid){u=this.get(r[0].recid,!0),g=this.get(e,!0),s>r[0].column?(c=r[0].column,m=s):(c=s,m=r[0].column);for(let k=c;k<=m;k++)h.push(k)}else u=this.get(l,!0),g=this.get(e,!0);let w=[];if(u>g){let k=u;u=g,g=k}let _="object"!=typeof this.url?this.url:this.url.get;for(let k=u;k<=g;k++)if(!(this.searchData.length>0)||_||-1!=$.inArray(k,this.last.searchIds))if("row"==this.selectType)w.push(this.records[k].recid);else for(let E=0;E<h.length;E++)w.push({recid:this.records[k].recid,column:h[E]});this.select(w)}else{let w=this.last.selection,_=-1!=w.indexes.indexOf(o),k=!1;if($(t.target).parents("td").hasClass("w2ui-col-select")&&(k=!0),(t.ctrlKey||t.shiftKey||t.metaKey||k)&&this.multiSelect||this.showSelectColumn){let E=$(t.target).parents("tr").find(".w2ui-grid-select-check").is(":checked");"row"!=this.selectType&&-1==$.inArray(s,w.columns[o])&&!E&&(_=!1),!0===_?this.unselect({recid:e,column:s}):this.select({recid:e,column:s})}else"row"!=this.selectType&&-1==$.inArray(s,w.columns[o])&&(_=!1),r.length>300?this.selectNone():this.unselect(r),!0===_&&1==r.length?this.unselect({recid:e,column:s}):this.select({recid:e,column:s})}this.status(),this.initResize(),this.trigger($.extend(n,{phase:"after"}))}columnClick(e,t){if(!0===this.last.colResizing)return;let i=this.trigger({phase:"before",type:"columnClick",target:this.name,field:e,originalEvent:t});if(!0!==i.isCancelled){if("row"==this.selectType){let s=this.getColumn(e);s&&s.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),"line-number"==i.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll())}else{if(t.altKey){let s=this.getColumn(e);s&&s.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey))}if("line-number"==i.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{!t.shiftKey&&!t.metaKey&&!t.ctrlKey&&this.selectNone();let s=this.getSelection(),l=this.getColumn(i.field,!0),n=[],r=[];if(0!=s.length&&t.shiftKey){let o=l,h=s[0].column;o>h&&(o=s[0].column,h=l);for(let u=o;u<=h;u++)r.push(u)}else r.push(l);if(i=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:r}),!0!==i.isCancelled){for(let o=0;o<this.records.length;o++)n.push({recid:this.records[o].recid,column:r});this.select(n)}this.trigger($.extend(i,{phase:"after"}))}}this.trigger($.extend(i,{phase:"after"}))}}columnDblClick(e,t){let i=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:e,originalEvent:t});!0!==i.isCancelled&&this.trigger($.extend(i,{phase:"after"}))}focus(e){let t=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:e});if(!0===t.isCancelled)return!1;this.hasFocus=!0,$(this.box).removeClass("w2ui-inactive").find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout(()=>{let i=$(this.box).find("#grid_"+this.name+"_focus");i.is(":focus")||i.focus()},10),this.trigger($.extend(t,{phase:"after"}))}blur(e){let t=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:e});if(!0===t.isCancelled)return!1;this.hasFocus=!1,$(this.box).addClass("w2ui-inactive").find(".w2ui-selected").addClass("w2ui-inactive"),$(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),this.trigger($.extend(t,{phase:"after"}))}keydown(e){let t=this,i="object"!=typeof this.url?this.url:this.url.get;if(!0!==t.keyboard)return;let s=t.trigger({phase:"before",type:"keydown",target:t.name,originalEvent:e});if(!0===s.isCancelled)return;if($(this.box).find(">.w2ui-message").length>0)return void(27==e.keyCode&&this.message());let l=!1,n=$("#grid_"+t.name+"_records"),r=t.getSelection();0===r.length&&(l=!0);let o=r[0]||null,h=[],u=r[r.length-1];if("object"==typeof o&&null!=o){o=r[0].recid,h=[];let X=0;for(;r[X]&&r[X].recid==o;)h.push(r[X].column),X++;u=r[r.length-1].recid}let g=t.get(o,!0),c=t.get(u,!0),m=$(`#grid_${t.name}_rec_${null!=g?w2utils.escapeId(t.records[g].recid):"none"}`),w=Math.floor($(`#grid_${t.name}_records`).height()/t.recordHeight),_=!1,k=e.keyCode,E=e.shiftKey;switch(k){case 8:case 46:t.delete(),_=!0,e.stopPropagation();break;case 27:t.selectNone(),_=!0;break;case 65:if(!e.metaKey&&!e.ctrlKey)break;t.selectAll(),_=!0;break;case 13:if("row"==this.selectType&&!0===t.show.expandColumn){if(m.length<=0)break;t.toggle(o,e),_=!0}else{for(let X=0;X<this.columns.length;X++)if(this.getCellEditable(g,X)){h.push(parseInt(X));break}"row"==this.selectType&&this.last._edit&&this.last._edit.column&&(h=[this.last._edit.column]),h.length>0&&(t.editField(o,h[0],null,e),_=!0)}break;case 37:!function N(){if(l)B();else{if("row"==t.selectType){if(m.length<=0)return;let X=t.records[g].w2ui||{};!X||null==X.parent_recid||Array.isArray(X.children)&&0!==X.children.length&&X.expanded?t.collapse(o,e):(t.unselect(o),t.collapse(X.parent_recid,e),t.select(X.parent_recid))}else{let X=t.prevCell(g,h[0]);if(!E&&null==X&&(t.selectNone(),X=0),null!=X)if(E&&t.multiSelect){if(Q())return;let ne=[],re=[],le=[];if(0===h.indexOf(t.last.sel_col)&&h.length>1){for(let J=0;J<r.length;J++)-1==ne.indexOf(r[J].recid)&&ne.push(r[J].recid),le.push({recid:r[J].recid,column:h[h.length-1]});t.unselect(le),t.scrollIntoView(g,h[h.length-1],!0)}else{for(let J=0;J<r.length;J++)-1==ne.indexOf(r[J].recid)&&ne.push(r[J].recid),re.push({recid:r[J].recid,column:X});t.select(re),t.scrollIntoView(g,X,!0)}}else e.metaKey=!1,t.click({recid:o,column:X},e),t.scrollIntoView(g,X,!0);else if(!E)if(r.length>1)t.selectNone();else for(let ne=1;ne<r.length;ne++)t.unselect(r[ne])}_=!0}}();break;case 39:!function L(){if(l)B();else{if("row"==t.selectType){if(m.length<=0)return;t.expand(o,e)}else{let X=t.nextCell(g,h[h.length-1]);if(!E&&null==X&&(t.selectNone(),X=t.columns.length-1),null!=X)if(E&&39==k&&t.multiSelect){if(Q())return;let ne=[],re=[],le=[];if(h.indexOf(t.last.sel_col)==h.length-1&&h.length>1){for(let J=0;J<r.length;J++)-1==ne.indexOf(r[J].recid)&&ne.push(r[J].recid),le.push({recid:r[J].recid,column:h[0]});t.unselect(le),t.scrollIntoView(g,h[0],!0)}else{for(let J=0;J<r.length;J++)-1==ne.indexOf(r[J].recid)&&ne.push(r[J].recid),re.push({recid:r[J].recid,column:X});t.select(re),t.scrollIntoView(g,X,!0)}}else e.metaKey=!1,t.click({recid:o,column:X},e),t.scrollIntoView(g,X,!0);else if(!E)if(r.length>1)t.selectNone();else for(let ne=0;ne<r.length-1;ne++)t.unselect(r[ne])}_=!0}}();break;case 33:f(w);break;case 34:H(w);break;case 35:H(-1);break;case 36:f(-1);break;case 38:f(e.metaKey||e.ctrlKey?-1:1);break;case 40:H(e.metaKey||e.ctrlKey?-1:1);break;case 17:case 91:if(l)break;w2utils.isSafari&&(t.last.copy_event=t.copy(!1,e),$("#grid_"+t.name+"_focus").val(t.last.copy_event.text).select());break;case 67:(e.metaKey||e.ctrlKey)&&(w2utils.isSafari||(t.last.copy_event=t.copy(!1,e),$("#grid_"+t.name+"_focus").val(t.last.copy_event.text).select()),t.copy(t.last.copy_event,e));break;case 88:if(l)break;(e.ctrlKey||e.metaKey)&&(w2utils.isSafari||(t.last.copy_event=t.copy(!1,e),$("#grid_"+t.name+"_focus").val(t.last.copy_event.text).select()),t.copy(t.last.copy_event,e))}let I=[32,187,189,192,219,220,221,186,222,188,190,191];for(let X=48;X<=111;X++)I.push(X);function f(X){if(l&&B(),m.length<=0)return;let ne=t.prevRow(g,0,X);if(!E&&null==ne&&(ne=0==t.searchData.length||i?0:t.last.searchIds[0]),null!=ne){if(E&&t.multiSelect){if(Q())return;if("row"==t.selectType)t.last.sel_ind>ne&&t.last.sel_ind!=c?t.unselect(t.records[c].recid):t.select(t.records[ne].recid);else if(t.last.sel_ind>ne&&t.last.sel_ind!=c){ne=c;let re=[];for(let le=0;le<h.length;le++)re.push({recid:t.records[ne].recid,column:h[le]});t.unselect(re)}else{let re=[];for(let le=0;le<h.length;le++)re.push({recid:t.records[ne].recid,column:h[le]});t.select(re)}}else r.length>300?t.selectNone():t.unselect(r),t.click({recid:t.records[ne].recid,column:h[0]},e);t.scrollIntoView(ne,null,!1,1!=X),e.preventDefault&&e.preventDefault()}else if(!E)if(r.length>1)t.selectNone();else for(let re=1;re<r.length;re++)t.unselect(r[re])}function H(X){if(l&&B(),m.length<=0)return;let ne=t.nextRow(c,0,X);if(!E&&null==ne&&(ne=0==t.searchData.length||i?t.records.length-1:t.last.searchIds[t.last.searchIds.length-1]),null!=ne){if(E&&t.multiSelect){if(Q())return;if("row"==t.selectType)t.last.sel_ind<ne&&t.last.sel_ind!=g?t.unselect(t.records[g].recid):t.select(t.records[ne].recid);else if(t.last.sel_ind<ne&&t.last.sel_ind!=g){ne=g;let re=[];for(let le=0;le<h.length;le++)re.push({recid:t.records[ne].recid,column:h[le]});t.unselect(re)}else{let re=[];for(let le=0;le<h.length;le++)re.push({recid:t.records[ne].recid,column:h[le]});t.select(re)}}else r.length>300?t.selectNone():t.unselect(r),t.click({recid:t.records[ne].recid,column:h[0]},e);t.scrollIntoView(ne,null,!1,1!=X),_=!0}else if(!E)if(r.length>1)t.selectNone();else for(let re=0;re<r.length-1;re++)t.unselect(r[re])}function B(){if(!t.records||0===t.records.length)return;let X=Math.floor(n[0].scrollTop/t.recordHeight)+1;(!t.records[X]||X<2)&&(X=0),void 0!==t.records[X]&&t.select({recid:t.records[X].recid,column:0})}function Q(){if("click"!=t.last.sel_type)return!1;if("row"!=t.selectType){if(t.last.sel_type="key",r.length>1){for(let X=0;X<r.length;X++)if(r[X].recid==t.last.sel_recid&&r[X].column==t.last.sel_col){r.splice(X,1);break}return t.unselect(r),!0}return!1}return t.last.sel_type="key",r.length>1&&(r.splice(r.indexOf(t.records[t.last.sel_ind].recid),1),t.unselect(r),!0)}-1!=I.indexOf(k)&&!e.ctrlKey&&!e.metaKey&&!_&&(0===h.length&&h.push(0),_=!1,setTimeout(()=>{let X=$("#grid_"+t.name+"_focus"),ne=X.val();X.val(""),t.editField(o,h[0],ne,e)},1)),_&&e.preventDefault&&e.preventDefault(),t.trigger($.extend(s,{phase:"after"}))}scrollIntoView(e,t,i,s){let l=this.records.length;if(0!=this.searchData.length&&!this.url&&(l=this.last.searchIds.length),0===l)return;if(null==e){let o=this.getSelection();if(0===o.length)return;$.isPlainObject(o[0])?(e=o[0].index,t=o[0].column):e=this.get(o[0],!0)}let n=$("#grid_"+this.name+"_records"),r=this.last.searchIds.length;if(r>0&&(e=this.last.searchIds.indexOf(e)),n.height()<this.recordHeight*(r>0?r:l)&&n.length>0){let o=Math.floor(n[0].scrollTop/this.recordHeight),h=o+Math.floor(n.height()/this.recordHeight);e==o&&(!0===i?n.prop({scrollTop:n.scrollTop()-n.height()/1.3}):(n.stop(),n.animate({scrollTop:n.scrollTop()-n.height()/1.3},250,"linear"))),e==h&&(!0===i?n.prop({scrollTop:n.scrollTop()+n.height()/1.3}):(n.stop(),n.animate({scrollTop:n.scrollTop()+n.height()/1.3},250,"linear"))),(e<o||e>h)&&(!0===i?n.prop({scrollTop:(e-1)*this.recordHeight}):(n.stop(),n.animate({scrollTop:(e-1)*this.recordHeight},250,"linear"))),!0===s&&(!0===i?n.prop({scrollTop:e*this.recordHeight}):(n.stop(),n.animate({scrollTop:e*this.recordHeight},250,"linear")))}if(null!=t){let o=0,h=0,u=w2utils.scrollBarSize();for(let g=0;g<=t;g++){let c=this.columns[g];c.frozen||c.hidden||(o=h,h+=parseInt(c.sizeCalculated))}n.width()<h-n.scrollLeft()?!0===i?n.prop({scrollLeft:o-u}):n.animate({scrollLeft:o-u},250,"linear"):o<n.scrollLeft()&&(!0===i?n.prop({scrollLeft:h-n.width()+2*u}):n.animate({scrollLeft:h-n.width()+2*u},250,"linear"))}}scrollToColumn(e){if(null==e)return;let t=0,i=!1;for(let s=0;s<this.columns.length;s++){let l=this.columns[s];if(l.field==e){i=!0;break}l.frozen||l.hidden||(t+=parseInt(l.sizeCalculated?l.sizeCalculated:l.size))}!i||(this.last.scrollLeft=t+1,this.scroll())}dblClick(e,t){let i=null;if("object"==typeof e&&null!==e&&(i=e.column,e=e.recid),null==t&&(t={}),null==i&&t.target){let o=t.target;"TD"!=o.tagName.toUpperCase()&&(o=$(o).parents("td")[0]),i=parseInt($(o).attr("col"))}let s=this.get(e,!0),l=this.records[s],n=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:e,column:i,originalEvent:t});!0!==n.isCancelled&&(this.selectNone(),this.getCellEditable(s,i)?this.editField(e,i,null,t):(this.select({recid:e,column:i}),(this.show.expandColumn||l&&l.w2ui&&Array.isArray(l.w2ui.children))&&this.toggle(e)),this.trigger($.extend(n,{phase:"after"})))}contextMenu(e,t,i){const s=this;if("text"==this.last.userSelect)return;null==i&&(i={offsetX:0,offsetY:0,target:$("#grid_"+this.name+"_rec_"+e)[0]}),null==i.offsetX&&(i.offsetX=i.layerX-i.target.offsetLeft,i.offsetY=i.layerY-i.target.offsetTop),w2utils.isFloat(e)&&(e=parseFloat(e));let l=this.getSelection();if("row"==this.selectType)-1==l.indexOf(e)&&this.click(e);else{let r=$(i.target);"TD"!=r[0].tagName.toUpperCase()&&(r=$(i.target).parents("td"));let o=!1;t=r.attr("col");for(let h=0;h<l.length;h++)(l[h].recid==e||l[h].column==t)&&(o=!0);!o&&null!=e&&this.click({recid:e,column:t}),!o&&null!=t&&this.columnClick(this.columns[t].field,i)}let n=this.trigger({phase:"before",type:"contextMenu",target:this.name,originalEvent:i,recid:e,column:t});!0!==n.isCancelled&&(s.menu.length>0&&$(s.box).find(i.target).w2menu(s.menu,{originalEvent:i,contextMenu:!0,onSelect(r){s.menuClick(e,r)}}),i.preventDefault&&i.preventDefault(),this.trigger($.extend(n,{phase:"after"})))}menuClick(e,t){let i=this.trigger({phase:"before",type:"menuClick",target:this.name,originalEvent:t.originalEvent,menuEvent:t,recid:e,menuIndex:t.index,menuItem:t.item});!0!==i.isCancelled&&this.trigger($.extend(i,{phase:"after"}))}toggle(e){let t=this.get(e);if(null!=t)return t.w2ui=t.w2ui||{},!0===t.w2ui.expanded?this.collapse(e):this.expand(e)}expand(e){let t=this.get(e,!0),i=this.records[t];i.w2ui=i.w2ui||{};let n,s=w2utils.escapeId(e),l=i.w2ui.children;if(Array.isArray(l)){if(!0===i.w2ui.expanded||0===l.length||(n=this.trigger({phase:"before",type:"expand",target:this.name,recid:e}),!0===n.isCancelled))return!1;i.w2ui.expanded=!0,l.forEach(o=>{o.w2ui=o.w2ui||{},o.w2ui.parent_recid=i.recid,null==o.w2ui.children&&(o.w2ui.children=[])}),this.records.splice.apply(this.records,[t+1,0].concat(l)),this.total+=l.length,("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0)),this.refresh(),this.trigger($.extend(n,{phase:"after"}))}else{if($("#grid_"+this.name+"_rec_"+s+"_expanded_row").length>0||!0!==this.show.expandColumn||"none"==i.w2ui.expanded)return!1;if($("#grid_"+this.name+"_rec_"+s).after('<tr id="grid_'+this.name+"_rec_"+e+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+e+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>'),$("#grid_"+this.name+"_frec_"+s).after('<tr id="grid_'+this.name+"_frec_"+e+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+e+'_expanded"></div>   </td></tr>'),n=this.trigger({phase:"before",type:"expand",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+s+"_expanded"}),!0===n.isCancelled)return $("#grid_"+this.name+"_rec_"+s+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+s+"_expanded_row").remove(),!1;let r=$(this.box).find("#grid_"+this.name+"_rec_"+e+"_expanded"),o=$(this.box).find("#grid_"+this.name+"_frec_"+e+"_expanded"),h=r.find("> div:first-child").height();r.height()<h&&r.css({height:h+"px"}),o.height()<h&&o.css({height:h+"px"}),$("#grid_"+this.name+"_rec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("-"),i.w2ui.expanded=!0,this.trigger($.extend(n,{phase:"after"})),this.resizeRecords()}return!0}collapse(e){let t=this.get(e,!0),i=this.records[t];i.w2ui=i.w2ui||{};let n,s=w2utils.escapeId(e);if(Array.isArray(i.w2ui.children)){if(!0!==i.w2ui.expanded||(n=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e}),!0===n.isCancelled))return!1;!function r(o){o.w2ui.expanded=!1;for(let h=0;h<o.w2ui.children.length;h++){let u=o.w2ui.children[h];u.w2ui.expanded&&r(u)}}(i);let o=[];for(let c=i;null!=c;c=this.get(c.w2ui.parent_recid))o.push(c.w2ui.parent_recid);let h=t+1,u=h;for(;!(this.records.length<=u+1||null==this.records[u+1].w2ui||o.indexOf(this.records[u+1].w2ui.parent_recid)>=0);)u++;this.records.splice(h,u-h+1),this.total-=u-h+1,("object"!=typeof this.url?this.url:this.url.get)||this.searchData.length>0&&this.localSearch(!0),this.refresh(),this.trigger($.extend(n,{phase:"after"}))}else{if(0===$("#grid_"+this.name+"_rec_"+s+"_expanded_row").length||!0!==this.show.expandColumn||(n=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+s+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+s+"_expanded"}),!0===n.isCancelled))return!1;$("#grid_"+this.name+"_rec_"+s).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+s).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),$("#grid_"+this.name+"_rec_"+s+"_expanded").css("height","0px"),$("#grid_"+this.name+"_frec_"+s+"_expanded").css("height","0px"),setTimeout(()=>{$("#grid_"+this.name+"_rec_"+s+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+s+"_expanded_row").remove(),i.w2ui.expanded=!1,this.trigger($.extend(n,{phase:"after"})),this.resizeRecords()},300)}return!0}sort(e,t,i){let s=this.trigger({phase:"before",type:"sort",target:this.name,field:e,direction:t,multiField:i});if(!0!==s.isCancelled){if(null!=e){let n=this.sortData.length;for(let r=0;r<this.sortData.length;r++)if(this.sortData[r].field==e){n=r;break}null==t&&(t=null==this.sortData[n]?"asc":"asc"===(null==this.sortData[n].direction&&(this.sortData[n].direction=""),this.sortData[n].direction.toLowerCase())?"desc":"asc"),!1===this.multiSort&&(this.sortData=[],n=0),1!=i&&(this.sortData=[],n=0),null==this.sortData[n]&&(this.sortData[n]={}),this.sortData[n].field=e,this.sortData[n].direction=t}else this.sortData=[];("object"!=typeof this.url?this.url:this.url.get)?(this.trigger($.extend(s,{phase:"after",direction:t})),this.last.xhr_offset=0,this.reload()):(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0),this.last.scrollTop=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger($.extend(s,{phase:"after",direction:t})),this.refresh())}}copy(e,t){if($.isPlainObject(e))return this.trigger($.extend(e,{phase:"after"})),e.text;let i=this.getSelection();if(0===i.length)return"";let l,s="";if("object"==typeof i[0]){let n=i[0].column,r=i[0].column,o=[];for(let h=0;h<i.length;h++)i[h].column<n&&(n=i[h].column),i[h].column>r&&(r=i[h].column),-1==o.indexOf(i[h].index)&&o.push(i[h].index);o.sort((h,u)=>h-u);for(let h=0;h<o.length;h++){let u=o[h];for(let g=n;g<=r;g++)!0!==this.columns[g].hidden&&(s+=this.getCellCopy(u,g)+"\t");s=s.substr(0,s.length-1),s+="\n"}}else{for(let n=0;n<this.columns.length;n++){let r=this.columns[n];if(!0===r.hidden)continue;let o=r.text?r.text:r.field;r.text&&r.text.length<3&&r.tooltip&&(o=r.tooltip),s+='"'+w2utils.stripTags(o)+'"\t'}s=s.substr(0,s.length-1),s+="\n";for(let n=0;n<i.length;n++){let r=this.get(i[n],!0);for(let o=0;o<this.columns.length;o++)!0!==this.columns[o].hidden&&(s+='"'+this.getCellCopy(r,o)+'"\t');s=s.substr(0,s.length-1),s+="\n"}}return s=s.substr(0,s.length-1),null==e?(l=this.trigger({phase:"before",type:"copy",target:this.name,text:s,cut:88==t.keyCode,originalEvent:t}),!0===l.isCancelled?"":(s=l.text,this.trigger($.extend(l,{phase:"after"})),s)):!1===e?(l=this.trigger({phase:"before",type:"copy",target:this.name,text:s,cut:88==t.keyCode,originalEvent:t}),!0===l.isCancelled?"":(s=l.text,l)):void 0}getCellCopy(e,t){return w2utils.stripTags(this.getCellHTML(e,t))}paste(e){let t=this.getSelection(),i=this.get(t[0].recid,!0),s=t[0].column,l=this.trigger({phase:"before",type:"paste",target:this.name,text:e,index:i,column:s});if(!0===l.isCancelled)return;if(e=l.text,"row"==this.selectType||0===t.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(l,{phase:"after"}));let n=[];e=e.split("\n");for(let o=0;o<e.length;o++){let h=e[o].split("\t"),u=0,g=this.records[i],c=[];if(null!=g){for(let m=0;m<h.length;m++)!this.columns[s+u]||(r(g,this.columns[s+u].field,h[m]),c.push(s+u),u++);for(let m=0;m<c.length;m++)n.push({recid:g.recid,column:c[m]});i++}}function r(o,h,u){o.w2ui=o.w2ui||{},o.w2ui.changes=o.w2ui.changes||{},o.w2ui.changes[h]=u}this.selectNone(),this.select(n),this.refresh(),this.trigger($.extend(l,{phase:"after"}))}resize(){let e=(new Date).getTime();if(!this.box||$(this.box).attr("name")!=this.name)return;$(this.box).find("> div.w2ui-grid-box").css("width",$(this.box).width()).css("height",$(this.box).height());let t=this.trigger({phase:"before",type:"resize",target:this.name});return!0!==t.isCancelled?(this.resizeBoxes(),this.resizeRecords(),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e):void 0}update(e){let t=(new Date).getTime();if(null==this.box)return 0;if(null==e)for(let i=this.last.range_start-1;i<=this.last.range_end-1;i++){if(i<0)continue;let s=this.records[i]||{};s.w2ui||(s.w2ui={});for(let l=0;l<this.columns.length;l++){let n=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(s.recid)),r=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+l);r.replaceWith(this.getCellHTML(i,l,!1)),r=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+l),null==s.w2ui.style||$.isEmptyObject(s.w2ui.style)?r.attr("style",""):("string"==typeof s.w2ui.style&&n.attr("style",s.w2ui.style),$.isPlainObject(s.w2ui.style)&&"string"==typeof s.w2ui.style[l]&&r.attr("style",s.w2ui.style[l])),null!=s.w2ui.class&&!$.isEmptyObject(s.w2ui.class)&&("string"==typeof s.w2ui.class&&n.addClass(s.w2ui.class),$.isPlainObject(s.w2ui.class)&&"string"==typeof s.w2ui.class[l]&&r.addClass(s.w2ui.class[l]))}}else for(let i=0;i<e.length;i++){let s=e[i].index,l=e[i].column;if(s<0)continue;if(null==s||null==l){console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]");continue}let n=this.records[s]||{},r=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)),o=$(this.box).find("#grid_"+this.name+"_data_"+s+"_"+l);n.w2ui||(n.w2ui={}),o.replaceWith(this.getCellHTML(s,l,!1)),o=$(this.box).find("#grid_"+this.name+"_data_"+s+"_"+l),null==n.w2ui.style||$.isEmptyObject(n.w2ui.style)?o.attr("style",""):("string"==typeof n.w2ui.style&&r.attr("style",n.w2ui.style),$.isPlainObject(n.w2ui.style)&&"string"==typeof n.w2ui.style[l]&&o.attr("style",n.w2ui.style[l])),null!=n.w2ui.class&&!$.isEmptyObject(n.w2ui.class)&&("string"==typeof n.w2ui.class&&r.addClass(n.w2ui.class),$.isPlainObject(n.w2ui.class)&&"string"==typeof n.w2ui.class[l]&&o.addClass(n.w2ui.class[l]))}return(new Date).getTime()-t}refreshCell(e,t){let i=this.get(e,!0),s=this.getColumn(t,!0),l=!(this.records[i]&&this.records[i].recid==e),n=$(this.box).find((l?".w2ui-grid-summary ":"")+"#grid_"+this.name+"_data_"+i+"_"+s);if(0==n.length)return!1;n.replaceWith(this.getCellHTML(i,s,l))}refreshRow(e,t){let i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),s=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if(i.length>0){null==t&&(t=this.get(e,!0));let l=i.attr("line"),n=!(this.records[t]&&this.records[t].recid==e),r="object"!=typeof this.url?this.url:this.url.get;if(this.searchData.length>0&&!r)for(let u=0;u<this.last.searchIds.length;u++)this.last.searchIds[u]==t&&(t=u);let o=this.getRecordHTML(t,l,n);$(i).replaceWith(o[0]),$(s).replaceWith(o[1]);let h=this.records[t].w2ui?this.records[t].w2ui.style:"";"string"==typeof h&&(i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),s=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e)),i.attr("custom_style",h),s.attr("custom_style",h),i.hasClass("w2ui-selected")&&(h=h.replace("background-color","none")),i[0].style.cssText="height: "+this.recordHeight+"px;"+h,s[0].style.cssText="height: "+this.recordHeight+"px;"+h),n&&this.resize()}}refresh(){let e=(new Date).getTime();if(this.total<=0&&!("object"!=typeof this.url?this.url:this.url.get)&&0===this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete"),!this.box)return;let i=this.trigger({phase:"before",target:this.name,type:"refresh"});if(!0===i.isCancelled)return;if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&nbsp;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(!(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked)&&($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)){let h=this.toolbar.items;for(let u=0;u<h.length;u++)"w2ui-search"==h[u].id||"break"==h[u].type||this.toolbar.refresh(h[u].id)}}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();let s=$("#grid_"+this.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.label=this.searches[0].label);for(let h=0;h<this.searches.length;h++)this.searches[h].field==this.last.field&&(this.last.label=this.searches[h].label);if(this.last.multi?(s.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),s.w2field("clear")):s.attr("placeholder",w2utils.lang("Search")+" "+w2utils.lang(this.last.label,!0)),s.val()!=this.last.search){let h=this.last.search,u=s.data("w2field");u&&(h=u.format(h)),s.val(h)}this.refreshSearch(),this.refreshBody(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();let l=this.last.selection;this.records.length>0&&l.indexes.length==this.records.length||l.indexes.length>0&&0!==this.searchData.length&&l.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();let o=this.find({"w2ui.expanded":!0},!0,!0);for(let h=0;h<o.length;h++){let u=this.records[o[h]].w2ui;u&&!Array.isArray(u.children)&&(u.expanded=!1)}return this.markSearch&&setTimeout(()=>{let h=[];for(let u=0;u<this.searchData.length;u++){let g=this.searchData[u],c=this.getSearch(g.field);if(!c||c.hidden)continue;let m=this.getColumn(g.field,!0);h.push({field:g.field,search:g.value,col:m})}h.length>0&&h.forEach(u=>{$(this.box).find('td[col="'+u.col+'"]').not(".w2ui-head").w2marker(u.search)})},50),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.trigger($.extend(i,{phase:"after"})),this.resize(),this.addRange("selection"),setTimeout(()=>{this.resize(),this.scroll()},1),this.reorderColumns&&!this.last.columnDrag?this.last.columnDrag=this.initColumnDrag():!this.reorderColumns&&this.last.columnDrag&&this.last.columnDrag.remove(),(new Date).getTime()-e}refreshSearch(){if(this.multiSearch&&this.searchData.length>0){0==$(this.box).find(".w2ui-grid-searches").length&&$(this.box).find(".w2ui-grid-toolbar").css("height",this.last._toolbar_height+35+"px").append(`<div id="grid_${this.name}_searches" class="w2ui-grid-searches"></div>`);let e=`\n              <span id="grid_${this.name}_search_logic" class="w2ui-grid-search-logic"></span>\n              <div class="grid-search-line"></div>`;this.searchData.forEach((t,i)=>{let n,s=this.getSearch(t.field,!0),l=this.searches[s];if(n=Array.isArray(t.value)?`<span class="grid-search-count">${t.value.length}</span>`:`: ${t.text?t.text:t.value}`,l&&"date"==l.type)if("between"==t.operator){let r=t.value[0],o=t.value[1];Number(r)===r&&(r=w2utils.formatDate(r)),Number(o)===o&&(o=w2utils.formatDate(o)),n=`: ${r} - ${o}`}else{let r=t.value;Number(r)==r&&(r=w2utils.formatDate(r));let o=t.operator;"more"==o&&(o="since"),"less"==o&&(o="before"),"more:"==o.substr(0,5)&&(o="since"),n=`: ${o} ${r}`}console.log(l),e+=`<span class="w2ui-action" data-click="searchFieldDrop|${s}|${i}|this">\n                  ${l?l.label:""}\n                  ${n}\n                  <span class="icon-chevron-down"></span>\n              </span>`}),e+=`\n              ${this.show.searchSave?'<div class="grid-search-line"></div>\n                     <button class="w2ui-btn grid-search-btn" data-click="searchSave">Save</button>\n                    ':""}\n              <button class="w2ui-btn grid-search-btn btn-remove"\n                  data-click="searchReset">X</button>\n          `,$(this.box).find(`#grid_${this.name}_searches`).html(e),$(`#grid_${this.name}_search_logic`).html(w2utils.lang("AND"==this.last.logic?"All":"Any"))}else $(this.box).find(".w2ui-grid-toolbar").css("height",this.last._toolbar_height).find(".w2ui-grid-searches").remove();this.searchSelected?($(this.box).find(`#grid_${this.name}_search_all`).val(" ").prop("readOnly",!0),$(this.box).find(`#grid_${this.name}_search_name`).show().find(".name-text").html(this.searchSelected.name)):($(this.box).find(`#grid_${this.name}_search_all`).prop("readOnly",!1),$(this.box).find(`#grid_${this.name}_search_name`).hide().find(".name-text").html("")),w2utils.bindEvents(`#grid_${this.name}_searches .w2ui-action, #grid_${this.name}_searches button`,this)}refreshBody(){this.scroll();let e=this.getRecordsHTML(),t=this.getColumnsHTML(),i='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+e[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+e[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+t[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+t[1]+"</tbody></table></div>",s=$("#grid_"+this.name+"_body",this.box).html(i),l=$("#grid_"+this.name+"_records",this.box),n=$("#grid_"+this.name+"_frecords",this.box),r=this;if("row"==this.selectType&&(l.on("mouseover mouseout","tr",function(o){$("#grid_"+r.name+"_frec_"+w2utils.escapeId($(this).attr("recid"))).toggleClass("w2ui-record-hover","mouseover"==o.type)}),n.on("mouseover mouseout","tr",function(o){$("#grid_"+r.name+"_rec_"+w2utils.escapeId($(this).attr("recid"))).toggleClass("w2ui-record-hover","mouseover"==o.type)})),w2utils.isIOS?l.add(n).on("click","tr",function(o){r.dblClick($(this).attr("recid"),o)}):l.add(n).on("click","tr",function(o){r.click($(this).attr("recid"),o)}).on("contextmenu","tr",function(o){r.contextMenu($(this).attr("recid"),null,o)}),s.data("scrolldata",{lastTime:0,lastDelta:0,time:0}).find(".w2ui-grid-frecords").on("mousewheel DOMMouseScroll ",function(o){o.preventDefault();let h=o.originalEvent,u=s.data("scrolldata"),g=$(this).siblings(".w2ui-grid-records").addBack().filter(".w2ui-grid-records"),c=null!=typeof h.wheelDelta?-1*h.wheelDelta/120:(h.detail||h.deltaY)/3,m=g.scrollTop();u.time=+new Date,u.lastTime<u.time-150&&(u.lastDelta=0),u.lastTime=u.time,u.lastDelta+=c,c=Math.abs(u.lastDelta)<1?0:Math.round(u.lastDelta),s.data("scrolldata",u),c*=(Math.round(l.height()/r.recordHeight)-1)*r.recordHeight/4,g.stop().animate({scrollTop:m+c},250,"linear")}),0===this.records.length&&this.msgEmpty?$("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):$("#grid_"+this.name+"_empty_msg").length>0&&$("#grid_"+this.name+"_empty_msg").remove(),this.summary.length>0){let o=this.getSummaryHTML();$("#grid_"+this.name+"_fsummary").html(o[0]).show(),$("#grid_"+this.name+"_summary").html(o[1]).show()}else $("#grid_"+this.name+"_fsummary").hide(),$("#grid_"+this.name+"_summary").hide()}render(e){let t=this,i=(new Date).getTime();if(null!=e&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),this.box=e),!this.box)return;let s="object"!=typeof this.url?this.url:this.url.get,l=this.trigger({phase:"before",target:this.name,type:"render",box:e});if(!0===l.isCancelled)return;if(this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label=w2utils.lang("All Fields");else{let c=0;for(;c<this.searches.length&&(this.searches[c].hidden||!1===this.searches[c].simple);)c++;c>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[c].field,this.last.label=this.searches[c].label)}if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid w2ui-inactive").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input" '+(this.tabIndex?'tabindex="'+this.tabIndex+'"':"")+(w2utils.isIOS?"readonly":"")+"></textarea></div>"),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last._toolbar_height=$(`#grid_${this.name}_toolbar`).prop("offsetHeight"),this.last.field&&"all"!=this.last.field){let c=this.searchData;setTimeout(()=>{this.searchInitInput(this.last.field,1==c.length?c[0].value:null)},1)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),s&&(this.clear(),this.refresh());let r,n=!1;for(let c=0;c<this.searches.length;c++)if(this.searches[c].hidden){n=!0;break}return n?(this.searchReset(!1),s||setTimeout(()=>{this.searchReset()},1)):this.reload(),$(this.box).find("#grid_"+this.name+"_focus").on("focus",function(c){clearTimeout(t.last.kbd_timer),t.hasFocus||t.focus()}).on("blur",function(c){clearTimeout(t.last.kbd_timer),t.last.kbd_timer=setTimeout(()=>{t.hasFocus&&t.blur()},100)}).on("paste",function(c){let m=c.originalEvent.clipboardData?c.originalEvent.clipboardData:null;if(m&&m.types&&-1!=m.types.indexOf("text/plain")){c.preventDefault();let w=m.getData("text/plain");-1!=w.indexOf("\r")&&-1==w.indexOf("\n")&&(w=w.replace(/\r/g,"\n")),w2ui[t.name].paste(w)}else{let w=this;setTimeout(()=>{w2ui[t.name].paste(w.value),w.value=""},1)}}).on("keydown",function(c){w2ui[t.name].keydown.call(w2ui[t.name],c)}),$(this.box).off("mousedown.mouseStart").on("mousedown.mouseStart",function o(c){if(1==c.which&&("text"==t.last.userSelect&&(t.last.userSelect="",$(t.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),!("row"==t.selectType&&($(c.target).parents().hasClass("w2ui-head")||$(c.target).hasClass("w2ui-head"))||t.last.move&&"expand"==t.last.move.type))){if(c.altKey)$(t.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),t.selectNone(),t.last.move={type:"text-select"},t.last.userSelect="text";else{let m=c.target,w={x:c.offsetX-10,y:c.offsetY-10},_=!1;for(;m&&(!m.classList||!m.classList.contains("w2ui-grid"));)m.tagName&&"TD"==m.tagName.toUpperCase()&&(_=!0),m.tagName&&"TR"!=m.tagName.toUpperCase()&&1==_&&(w.x+=m.offsetLeft,w.y+=m.offsetTop),m=m.parentNode;t.last.move={x:c.screenX,y:c.screenY,divX:0,divY:0,focusX:w.x,focusY:w.y,recid:$(c.target).parents("tr").attr("recid"),column:parseInt("TD"==c.target.tagName.toUpperCase()?$(c.target).attr("col"):$(c.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0},null==t.last.move.recid&&(t.last.move.type="select-column");let k=c.target,E=$(t.box).find("#grid_"+t.name+"_focus");if(t.last.move){let I=t.last.move.focusX,N=t.last.move.focusY,L=$(k).parents("table").parent();(L.hasClass("w2ui-grid-records")||L.hasClass("w2ui-grid-frecords")||L.hasClass("w2ui-grid-columns")||L.hasClass("w2ui-grid-fcolumns")||L.hasClass("w2ui-grid-summary"))&&(I=t.last.move.focusX-$(t.box).find("#grid_"+t.name+"_records").scrollLeft(),N=t.last.move.focusY-$(t.box).find("#grid_"+t.name+"_records").scrollTop()),($(k).hasClass("w2ui-grid-footer")||$(k).parents("div.w2ui-grid-footer").length>0)&&(N=$(t.box).find("#grid_"+t.name+"_footer").position().top),L.hasClass("w2ui-scroll-wrapper")&&L.parent().hasClass("w2ui-toolbar")&&(I=t.last.move.focusX-L.scrollLeft()),E.css({left:I-10,top:N})}setTimeout(()=>{-1!=["INPUT","TEXTAREA","SELECT"].indexOf(k.tagName.toUpperCase())?$(k).focus():E.is(":focus")||E.focus()},50),!t.multiSelect&&!t.reorderRows&&"drag"==t.last.move.type&&delete t.last.move}if(1==t.reorderRows){let m=c.target;if("TD"!=m.tagName.toUpperCase()&&(m=$(m).parents("td")[0]),$(m).hasClass("w2ui-col-number")||$(m).hasClass("w2ui-col-order")){t.selectNone(),t.last.move.reorder=!0;let w=$(t.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),_=$(t.box).find(".w2ui-odd.w2ui-empty-record").css("background-color");$(t.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",w),$(t.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",_);let k=t.last.move,E=$(t.box).find(".w2ui-grid-records");if(!k.ghost){let N=$("#grid_"+t.name+"_rec_"+k.recid),L=N.parents("table").find("tr:first-child").clone();k.offsetY=c.offsetY,k.from=k.recid,k.pos=N.position(),k.ghost=$(N).clone(!0),k.ghost.removeAttr("id"),N.find("td").remove(),N.append('<td colspan="1000"><div style="height: '+t.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></div></td>'),E.append('<div id="grid_'+t.name+'_ghost_line" style="position: absolute; z-index: 999999; pointer-events: none; width: 100%;"></div>'),E.append('<table id="grid_'+t.name+'_ghost" style="position: absolute; z-index: 999998; opacity: 0.9; pointer-events: none;"></table>'),$("#grid_"+t.name+"_ghost").append(L).append(k.ghost)}$("#grid_"+t.name+"_ghost").css({top:k.pos.top,left:k.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})}else t.last.move.reorder=!1}$(document).on("mousemove.w2ui-"+t.name,h).on("mouseup.w2ui-"+t.name,u),c.stopPropagation()}}),this.updateToolbar(),this.trigger($.extend(l,{phase:"after"})),0===$(".w2ui-layout").length&&$(window).off("resize.w2ui-"+t.name).on("resize.w2ui-"+t.name,function(c){null==w2ui[t.name]?$(window).off("resize.w2ui-"+t.name):w2ui[t.name].resize()}),(new Date).getTime()-i;function h(c){let m=t.last.move;if(!m||-1==["select","select-column"].indexOf(m.type)||(m.divX=c.screenX-m.x,m.divY=c.screenY-m.y,Math.abs(m.divX)<=1&&Math.abs(m.divY)<=1))return;if(t.last.cancelClick=!0,1==t.reorderRows&&t.last.move.reorder){let E=$(c.target).parents("tr").attr("recid");if("-none-"==E&&(E="bottom"),E!=m.from){let N=$("#grid_"+t.name+"_rec_"+E);$(t.box).find(".insert-before"),N.addClass("insert-before"),m.lastY=c.screenY,m.to=E;let L=N.position();$("#grid_"+t.name+"_ghost_line").css(L?{top:L.top,left:m.pos.left,"border-top":"2px solid #769EFC"}:{"border-top":"2px solid transparent"})}return void $("#grid_"+t.name+"_ghost").css({top:m.pos.top+m.divY,left:m.pos.left})}m.start&&m.recid&&(t.selectNone(),m.start=!1);let w=[],_="TR"==c.target.tagName.toUpperCase()?$(c.target).attr("recid"):$(c.target).parents("tr").attr("recid");if(null==_){if("row"==t.selectType||t.last.move&&"select"==t.last.move.type)return;let k=parseInt($(c.target).parents("td").attr("col"));if(isNaN(k))t.removeRange("column-selection"),$(t.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),$(t.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete m.colRange;else{let E=k+"-"+k;m.column<k&&(E=m.column+"-"+k),m.column>k&&(E=k+"-"+m.column);let I=[],N=E.split("-");for(let L=parseInt(N[0]);L<=parseInt(N[1]);L++)I.push(L);if(m.colRange!=E&&(r=t.trigger({phase:"before",type:"columnSelect",target:t.name,columns:I,isCancelled:!1}),!0!==r.isCancelled)){null==m.colRange&&t.selectNone();let L=E.split("-");$(t.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(let f=parseInt(L[0]);f<=parseInt(L[1]);f++)$(t.box).find("#grid_"+t.name+"_column_"+f+" .w2ui-col-header").addClass("w2ui-col-selected");$(t.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),m.colRange=E,t.removeRange("column-selection"),t.addRange({name:"column-selection",range:[{recid:t.records[0].recid,column:L[0]},{recid:t.records[t.records.length-1].recid,column:L[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{let k=t.get(m.recid,!0);if(null==k||t.records[k]&&t.records[k].recid!=m.recid)return;let E=t.get(_,!0);if(null==E)return;let I=parseInt(m.column),N=parseInt("TD"==c.target.tagName.toUpperCase()?$(c.target).attr("col"):$(c.target).parents("td").attr("col"));if(isNaN(I)&&isNaN(N)&&(I=0,N=t.columns.length-1),k>E){let f=k;k=E,E=f}let L="ind1:"+k+",ind2;"+E+",col1:"+I+",col2:"+N;if(m.range==L)return;m.range=L;for(let f=k;f<=E;f++)if(!(t.last.searchIds.length>0&&-1==t.last.searchIds.indexOf(f)))if("row"!=t.selectType){if(I>N){let H=I;I=N,N=H}for(let H=I;H<=N;H++)t.columns[H].hidden||w.push({recid:t.records[f].recid,column:parseInt(H)})}else w.push(t.records[f].recid);if("row"!=t.selectType){let f=t.getSelection(),H=[];for(let B=0;B<w.length;B++){let Q=!1;for(let X=0;X<f.length;X++)w[B].recid==f[X].recid&&w[B].column==f[X].column&&(Q=!0);Q||H.push({recid:w[B].recid,column:w[B].column})}t.select(H),H=[];for(let B=0;B<f.length;B++){let Q=!1;for(let X=0;X<w.length;X++)w[X].recid==f[B].recid&&w[X].column==f[B].column&&(Q=!0);Q||H.push({recid:f[B].recid,column:f[B].column})}t.unselect(H)}else if(t.multiSelect){let f=t.getSelection();for(let H=0;H<w.length;H++)-1==f.indexOf(w[H])&&t.select(w[H]);for(let H=0;H<f.length;H++)-1==w.indexOf(f[H])&&t.unselect(f[H])}}}function u(c){let m=t.last.move;if(setTimeout(()=>{delete t.last.cancelClick},1),!$(c.target).parents().hasClass(".w2ui-head")&&!$(c.target).hasClass(".w2ui-head")){if(m&&-1!=["select","select-column"].indexOf(m.type)){if(null!=m.colRange&&!0!==r.isCancelled){let w=m.colRange.split("-"),_=[];for(let k=0;k<t.records.length;k++){let E=[];for(let I=parseInt(w[0]);I<=parseInt(w[1]);I++)E.push(I);_.push({recid:t.records[k].recid,column:E})}t.removeRange("column-selection"),t.trigger($.extend(r,{phase:"after"})),t.select(_)}if(1==t.reorderRows&&t.last.move.reorder)if(null!=m.to){let w=t.trigger({phase:"before",target:t.name,type:"reorderRow",recid:m.from,moveBefore:m.to});if(!0===w.isCancelled)return g(),void delete t.last.move;let _=t.get(m.from,!0),k=t.get(m.to,!0);"bottom"==m.to&&(k=t.records.length);let E=t.records[_];null!=_&&null!=k&&(t.records.splice(_,1),t.records.splice(_>k?k:k-1,0,E)),g(),t.trigger($.extend(w,{phase:"after"}))}else g()}delete t.last.move,$(document).off(".w2ui-"+t.name)}}function g(){$("#grid_"+t.name+"_ghost").remove(),$("#grid_"+t.name+"_ghost_line").remove(),t.refresh(),delete t.last.move}}destroy(){let e=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==e.isCancelled&&($(this.box).off(),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))}initColumnOnOff(){if(!this.show.toolbarColumns)return;let e='<div class="w2ui-grid-col-onoff"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+this.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(this.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td>      <label>'+w2utils.lang("Line #")+"</label>   </td></tr>";for(let i=0;i<this.columns.length;i++){let s=this.columns[i],l=this.columns[i].text;!1!==s.hideable&&(!l&&this.columns[i].tooltip&&(l=this.columns[i].tooltip),l||(l="- column "+(parseInt(i)+1)+" -"),e+='<tr id="grid_'+this.name+"_column_"+i+'_check"        onclick="w2ui[\''+this.name+"'].columnOnOff(event, '"+s.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(s.hidden?"empty":"check")+'"></span>   </td>   <td>       <label>'+w2utils.stripTags(l)+"</label>   </td></tr>")}let t="object"!=typeof this.url?this.url:this.url.get;(t&&this.show.skipRecords||this.show.saveRestoreState)&&(e+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>'),t&&this.show.skipRecords&&(e+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+this.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("records")+"    </div></td></tr>"),this.show.saveRestoreState&&(e+='<tr><td colspan="2" onclick="let grid = w2ui[\''+this.name+"']; grid.toolbar.uncheck('w2ui-column-on-off'); grid.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="let grid = w2ui[\''+this.name+"']; grid.toolbar.uncheck('w2ui-column-on-off'); grid.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>"),e+="</tbody></table></div>",this.toolbar.get("w2ui-column-on-off").html=e}initColumnDrag(e){if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";let t=this,i={};function s(){i.pressed=!1,clearTimeout(i.timeout)}function l(g){i.timeout&&clearTimeout(i.timeout);let c=this;i.pressed=!0,i.timeout=setTimeout(()=>{if(!i.pressed||0===i.numberPreColumnsPresent)return;let m,w,_,k,E,L=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]);if($(g.originalEvent.target).parents().hasClass("w2ui-head")){for(let B=0,Q=L.length;B<Q;B++)if($(g.originalEvent.target).parents().hasClass(L[B]))return;if(i.numberPreColumnsPresent=$(t.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length,i.columnHead=k=$(g.originalEvent.target).parents(".w2ui-head"),i.originalPos=E=parseInt(k.attr("col"),10),m=t.trigger({type:"columnDragStart",phase:"before",originalEvent:g,origColumnNumber:E,target:k[0]}),!0===m.isCancelled)return!1;w=i.columns=$(t.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",r),$(document).on("mousemove",n),i.ghost=$(c).clone(!0),$(i.ghost).find('[col]:not([col="'+i.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(i.ghost).find(".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select").remove(),$(i.ghost).find(".w2ui-grid-body").css({top:0}),_=$(i.ghost).find('[col="'+i.originalPos+'"]'),$(document.body).append(i.ghost),$(i.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:_.width(),height:$(t.box).find(".w2ui-grid-body").first().height(),left:g.pageX,top:g.pageY,opacity:.8},0),i.offsets=[];for(let B=0,Q=w.length;B<Q;B++)i.offsets.push($(w[B]).offset().left);t.trigger($.extend(m,{phase:"after"}))}},150)}function n(g){if(!i.pressed)return;let c=g.originalEvent.pageX,m=g.originalEvent.pageY,w=i.offsets,_=$(".w2ui-head:not(.w2ui-head-last)").width();i.targetInt=Math.max(i.numberPreColumnsPresent,function h(g,c,m){if(g<=c[0])return 0;if(g>=c[c.length-1]+m)return c.length;for(let w=0,_=c.length;w<_;w++){let E=c[w+1]||c[w]+m,I=(E-c[w])/2+c[w];if(g>c[w]&&g<=I)return w;if(g>I&&g<=E)return w+1}return 0}(c,w,_)),function o(g){!i.marker&&!i.markerLeft&&(i.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),i.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),(!i.lastInt||i.lastInt!==g)&&(i.lastInt=g,i.marker.remove(),i.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),g>=i.columns.length?($(i.columns[i.columns.length-1]).children("div:last").append(i.marker.addClass("right").removeClass("left")),$(i.columns[i.columns.length-1]).addClass("w2ui-col-intersection")):g<=i.numberPreColumnsPresent?($(i.columns[i.numberPreColumnsPresent]).prepend(i.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(i.columns[i.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(i.columns[g]).children("div:last").prepend(i.marker.addClass("left").removeClass("right")),$(i.columns[g]).prev().children("div:last").append(i.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),$(i.columns[g-1]).addClass("w2ui-col-intersection")))}(i.targetInt),function u(g,c){$(i.ghost).css({left:g-10,top:c-10})}(c,m)}function r(g){i.pressed=!1;let c,m,w,_,k,E=$(".w2ui-grid-ghost");if(c=t.trigger({type:"columnDragEnd",phase:"before",originalEvent:g,target:i.columnHead[0]}),!0===c.isCancelled)return!1;w=t.columns[i.originalPos],_=t.columns,k=$(i.columns[Math.min(i.lastInt,i.columns.length-1)]),m=i.lastInt<i.columns.length?parseInt(k.attr("col")):_.length,m!==i.originalPos+1&&m!==i.originalPos&&k&&k.length?($(i.ghost).animate({top:$(t.box).offset().top,left:k.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove(),E.remove()}),_.splice(m,0,$.extend({},w)),_.splice(_.indexOf(w),1)):($(i.ghost).remove(),E.remove()),$(document).off("mouseup",r),$(document).off("mousemove",n),i.marker&&i.marker.remove(),i={},t.refresh(),t.trigger($.extend(c,{phase:"after",targetColumnNumber:m-1}))}return i.lastInt=void 0,i.pressed=!1,i.timeout=null,i.columnHead=null,$(t.box).off("mousedown.colDrag").on("mousedown.colDrag",l),$(t.box).off("mouseup.colDrag").on("mouseup.colDrag",s),{remove(){$(t.box).off("mousedown.colDrag",l),$(t.box).off("mouseup.colDrag",s),$(t.box).find(".w2ui-head").removeAttr("draggable"),t.last.columnDrag=!1}}}columnOnOff(e,t){let i=$(e.target).parents("tr").find(".w2ui-column-check"),s=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:t,originalEvent:e});if(!0===s.isCancelled)return;let l=this,n=!(e.shiftKey||e.metaKey||e.ctrlKey||$(e.target).hasClass("w2ui-column-check")),r=l.find({"w2ui.expanded":!0},!0);for(let o=0;o<r.length;o++){let h=this.records[o].w2ui;h&&!Array.isArray(h.children)&&(this.records[o].w2ui.expanded=!1)}if("line-numbers"==t)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{let o=this.getColumn(t);o.hidden?(i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),setTimeout(()=>{l.showColumn(o.field)},n?0:50)):(i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),setTimeout(()=>{l.hideColumn(o.field)},n?0:50))}n&&setTimeout(()=>{$().w2overlay({name:l.name+"_toolbar"})},40),this.trigger($.extend(s,{phase:"after"}))}initToolbar(){let e=this;if(null==this.toolbar.render){let t=this.toolbar.items||[];if(this.toolbar.items=[],this.toolbar=new w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),this.show.toolbarSearch){let i=`\n                  <div class="w2ui-grid-search-input">\n                      ${this.buttons.search.html}\n                      <div id="grid_${this.name}_search_name" class="w2ui-grid-search-name">\n                          <span class="name-icon w2ui-icon-search"></span>\n                          <span class="name-text"></span>\n                          <span class="name-cross w2ui-action" data-click="searchReset">x</span>\n                      </div>\n                      <input type="text" id="grid_${this.name}_search_all" class="w2ui-search-all" tabindex="-1"\n                          autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"\n                          placeholder="${w2utils.lang(this.last.label,!0)}" value="${this.last.search}"\n                          data-focus="searchSuggest" data-blur="searchSuggest|true|true|this" data-click="stop"\n                      >\n                      <div class="w2ui-search-drop w2ui-action" data-click="searchOpen"\n                              style="${this.multiSearch?"":"display: none"}">\n                          <span class="w2ui-icon-drop"></span>\n                      </div>\n                  </div>`;this.toolbar.items.push({id:"w2ui-search",type:"html",html:i,onRefresh(s){s.done(()=>{let l=$(this.box).find(`#grid_${e.name}_search_all`);w2utils.bindEvents($(this.box).find(`#grid_${e.name}_search_all, .w2ui-action`),e),l.on("change",function(n){let r=this.value,o=jQuery(this).data("selected"),h=jQuery(this).data("w2field");h&&(r=h.clean(r)),h&&"list"==h.type&&o&&void 0===o.id?e.searchReset():e.search(e.last.field,r),e.searchSuggest(!0,!0,this)}).on("keydown",function(n){13==n.keyCode&&w2utils.isIE&&$(this).trigger("change"),40==n.keyCode&&e.searchSuggest(!0)})})}})}if(this.show.toolbarAdd&&Array.isArray(t)&&-1==t.map(i=>i.id).indexOf(this.buttons.add.id)&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&Array.isArray(t)&&-1==t.map(i=>i.id).indexOf(this.buttons.edit.id)&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&Array.isArray(t)&&-1==t.map(i=>i.id).indexOf(this.buttons.delete.id)&&this.toolbar.items.push($.extend(!0,{},this.buttons.delete)),this.show.toolbarSave&&Array.isArray(t)&&-1==t.map(i=>i.id).indexOf(this.buttons.save.id)&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save))),t)for(let i=0;i<t.length;i++)this.toolbar.items.push(t[i]);this.toolbar.on("click",i=>{let s=this.trigger({phase:"before",type:"toolbar",target:i.target,originalEvent:i});if(!0===s.isCancelled)return;let n,l=i.target;switch(l){case"w2ui-reload":if(n=this.trigger({phase:"before",type:"reload",target:this.name}),!0===n.isCancelled)return!1;this.reload(),this.trigger($.extend(n,{phase:"after"}));break;case"w2ui-column-on-off":this.initColumnOnOff(),this.initResize(),this.resize();break;case"w2ui-search-advanced":this.toolbar.get(l).checked?this.searchClose():this.searchOpen(),this.toolbar.tooltipHide("w2ui-search-advanced"),i.preventDefault();break;case"w2ui-add":if(n=this.trigger({phase:"before",target:this.name,type:"add",recid:null}),!0===n.isCancelled)return!1;this.trigger($.extend(n,{phase:"after"})),setTimeout(()=>{$().w2tag()},20);break;case"w2ui-edit":{let o=this.getSelection(),h=null;if(1==o.length&&(h=o[0]),n=this.trigger({phase:"before",target:this.name,type:"edit",recid:h}),!0===n.isCancelled)return!1;this.trigger($.extend(n,{phase:"after"})),setTimeout(()=>{$().w2tag()},20);break}case"w2ui-delete":this.delete();break;case"w2ui-save":this.save()}this.trigger($.extend(s,{phase:"after"}))}),this.toolbar.on("refresh",i=>{if("w2ui-search"==i.target){let s=this.searchData;setTimeout(()=>{this.searchInitInput(this.last.field,1==s.length?s[0].value:null)},1)}})}}initResize(){let e=this;$(this.box).find(".w2ui-resizer").off(".grid-col-resize").on("click.grid-col-resize",function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault()}).on("mousedown.grid-col-resize",function(t){t||(t=window.event),e.last.colResizing=!0,e.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt($(this).attr("name"))},e.last.tmp.tds=$("#grid_"+e.name+"_body table tr:first-child td[col="+e.last.tmp.col+"]"),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();for(let r=0;r<e.columns.length;r++)e.columns[r].hidden||(null==e.columns[r].sizeOriginal&&(e.columns[r].sizeOriginal=e.columns[r].size),e.columns[r].size=e.columns[r].sizeCalculated);let s,i={phase:"before",type:"columnResize",target:e.name,column:e.last.tmp.col,field:e.columns[e.last.tmp.col].field};i=e.trigger($.extend(i,{resizeBy:0,originalEvent:t})),$(document).off(".grid-col-resize").on("mousemove.grid-col-resize",function(r){if(1!=e.last.colResizing)return;if(r||(r=window.event),i=e.trigger($.extend(i,{resizeBy:r.screenX-e.last.tmp.gx,originalEvent:r})),!0===i.isCancelled)return void(i.isCancelled=!1);e.last.tmp.x=r.screenX-e.last.tmp.x,e.last.tmp.y=r.screenY-e.last.tmp.y;let o=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px";e.columns[e.last.tmp.col].size=o,s&&clearTimeout(s),s=setTimeout(()=>{e.resizeRecords(),e.scroll()},100),e.last.tmp.tds.css({width:o}),e.last.tmp.x=r.screenX,e.last.tmp.y=r.screenY}).on("mouseup.grid-col-resize",function(r){$(document).off(".grid-col-resize"),e.resizeRecords(),e.scroll(),e.trigger($.extend(i,{phase:"after",originalEvent:r})),setTimeout(()=>{e.last.colResizing=!1},1)})}).on("dblclick.grid-col-resize",function(t){let i=parseInt($(this).attr("name")),s=e.columns[i],l=0;if(!1===s.autoResize)return!0;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault(),$('.w2ui-grid-records td[col="'+i+'"] > div',e.box).each(()=>{let r=this.offsetWidth-this.scrollWidth;r<l&&(l=r-3)});let n={phase:"before",type:"columnAutoResize",target:e.name,column:s,field:s.field};n=e.trigger($.extend(n,{resizeBy:Math.abs(l),originalEvent:t})),!0!==n.isCancelled?(l<0&&(s.size=Math.min(parseInt(s.size)+Math.abs(l),s.max||1/0)+"px",e.resizeRecords(),e.resizeRecords(),e.scroll()),e.trigger($.extend(n,{phase:"after",originalEvent:t}))):n.isCancelled=!1}).each((t,i)=>{let s=$(i).parent();$(i).css({height:s.height(),"margin-left":s.width()-3+"px"})})}resizeBoxes(){let e=$("#grid_"+this.name+"_header"),t=$("#grid_"+this.name+"_toolbar"),i=$("#grid_"+this.name+"_fsummary"),s=$("#grid_"+this.name+"_summary"),l=$("#grid_"+this.name+"_footer"),n=$("#grid_"+this.name+"_body");this.show.header&&e.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&t.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+"px",left:"0px",right:"0px"}),this.summary.length>0&&(i.css({bottom:0+(this.show.footer?w2utils.getSize(l,"height"):0)+"px"}),s.css({bottom:0+(this.show.footer?w2utils.getSize(l,"height"):0)+"px",right:"0px"})),this.show.footer&&l.css({bottom:"0px",left:"0px",right:"0px"}),n.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+(this.show.toolbar?w2utils.getSize(t,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(l,"height"):0)+(this.summary.length>0?w2utils.getSize(s,"height"):0)+"px",left:"0px",right:"0px"})}resizeRecords(){let e=this;$(this.box).find(".w2ui-empty-record").remove();let t=$(this.box),i=$(this.box).find("> div.w2ui-grid-box"),s=$("#grid_"+this.name+"_header"),l=$("#grid_"+this.name+"_toolbar"),n=$("#grid_"+this.name+"_summary"),r=$("#grid_"+this.name+"_fsummary"),o=$("#grid_"+this.name+"_footer"),h=$("#grid_"+this.name+"_body"),u=$("#grid_"+this.name+"_columns"),g=$("#grid_"+this.name+"_fcolumns"),c=$("#grid_"+this.name+"_records"),m=$("#grid_"+this.name+"_frecords"),w=$("#grid_"+this.name+"_scroll1"),_=8*String(this.total).length+10;_<34&&(_=34),null!=this.lineNumberWidth&&(_=this.lineNumberWidth);let k=!1,E=!1,I=0;for(let re=0;re<this.columns.length;re++)this.columns[re].frozen||this.columns[re].hidden||(I+=parseInt(this.columns[re].sizeCalculated?this.columns[re].sizeCalculated:this.columns[re].size));if(c.width()<I&&(k=!0),h.height()-u.height()<$(c).find(">table").height()+(k?w2utils.scrollBarSize():0)&&(E=!0),this.fixedBody){let re=i.height()-(this.show.header?w2utils.getSize(s,"height"):0)-(this.show.toolbar?w2utils.getSize(l,"height"):0)-("none"!=n.css("display")?w2utils.getSize(n,"height"):0)-(this.show.footer?w2utils.getSize(o,"height"):0);h.css("height",re)}else{let re=w2utils.getSize(u,"height")+w2utils.getSize($("#grid_"+this.name+"_records table"),"height")+(k?w2utils.scrollBarSize():0);this.height=re+w2utils.getSize(i,"+height")+(this.show.header?w2utils.getSize(s,"height"):0)+(this.show.toolbar?w2utils.getSize(l,"height"):0)+("none"!=n.css("display")?w2utils.getSize(n,"height"):0)+(this.show.footer?w2utils.getSize(o,"height"):0),i.css("height",this.height),h.css("height",re),t.css("height",w2utils.getSize(i,"height")+w2utils.getSize(t,"+height"))}let H,B,N=this.records.length;if(0!=this.searchData.length&&!("object"!=typeof this.url?this.url:this.url.get)&&(N=this.last.searchIds.length),this.fixedBody||(E=!1),k||E?(u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),c.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":k?"auto":"hidden","overflow-y":E?"auto":"hidden"})):(u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),c.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px",overflow:"hidden"}),c.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),k?(m.css("margin-bottom",w2utils.scrollBarSize()),w.show()):(m.css("margin-bottom",0),w.hide()),m.css({overflow:"hidden",top:c.css("top")}),this.show.emptyRecords&&!E){let re=Math.floor(c.height()/this.recordHeight)-1,le=0;if(c[0]&&(le=c[0].scrollHeight-re*this.recordHeight),le>=this.recordHeight&&(le-=this.recordHeight,re++),this.fixedBody){for(let J=N;J<re;J++)f(J,this.recordHeight,this);f(re,le,this)}}function f(re,le,J){let ge="",xe="",Ye="";ge+='<tr class="'+(re%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+le+'px">',xe+='<tr class="'+(re%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+le+'px">',J.show.lineNumbers&&(ge+='<td class="w2ui-col-number"></td>'),J.show.selectColumn&&(ge+='<td class="w2ui-grid-data w2ui-col-select"></td>'),J.show.expandColumn&&(ge+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),xe+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',J.show.orderColumn&&(xe+='<td class="w2ui-grid-data w2ui-col-order" col="order"></td>');for(let Xe=0;Xe<J.columns.length;Xe++){let Ve=J.columns[Xe];(Ve.hidden||Xe<J.last.colStart||Xe>J.last.colEnd)&&!Ve.frozen||(Ye='<td class="w2ui-grid-data" '+(null!=Ve.attr?Ve.attr:"")+' col="'+Xe+'"></td>',Ve.frozen?ge+=Ye:xe+=Ye)}ge+='<td class="w2ui-grid-data-last"></td> </tr>',xe+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',$("#grid_"+J.name+"_frecords > table").append(ge),$("#grid_"+J.name+"_records > table").append(xe)}if(h.length>0){let re=parseInt(h.width())-(E?w2utils.scrollBarSize():0)-(this.show.lineNumbers?_:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1;H=re,B=0;let le=!1;for(let J=0;J<this.columns.length;J++){let ge=this.columns[J];ge.gridMinWidth>0&&(ge.gridMinWidth>H&&!0!==ge.hidden&&(ge.hidden=!0,le=!0),ge.gridMinWidth<H&&!0===ge.hidden&&(ge.hidden=!1,le=!0))}if(!0===le)return void this.refresh();for(let J=0;J<this.columns.length;J++){let ge=this.columns[J];ge.hidden||("px"==String(ge.size).substr(String(ge.size).length-2).toLowerCase()?(re-=parseFloat(ge.size),this.columns[J].sizeCalculated=ge.size,this.columns[J].sizeType="px"):(B+=parseFloat(ge.size),this.columns[J].sizeType="%",delete ge.sizeCorrected))}if(100!=B&&B>0)for(let J=0;J<this.columns.length;J++){let ge=this.columns[J];ge.hidden||"%"==ge.sizeType&&(ge.sizeCorrected=Math.round(100*parseFloat(ge.size)*100/B)/100+"%")}for(let J=0;J<this.columns.length;J++){let ge=this.columns[J];ge.hidden||"%"==ge.sizeType&&(this.columns[J].sizeCalculated=null!=this.columns[J].sizeCorrected?Math.floor(re*parseFloat(ge.sizeCorrected)/100)-1+"px":Math.floor(re*parseFloat(ge.size)/100)-1+"px")}}let Q=0;for(let re=0;re<this.columns.length;re++){let le=this.columns[re];le.hidden||(null==le.min&&(le.min=20),parseInt(le.sizeCalculated)<parseInt(le.min)&&(le.sizeCalculated=le.min+"px"),parseInt(le.sizeCalculated)>parseInt(le.max)&&(le.sizeCalculated=le.max+"px"),Q+=parseInt(le.sizeCalculated))}let X=parseInt(H)-parseInt(Q);if(X>0&&B>0){let re=0;for(;;){let le=this.columns[re];if(null!=le)if(le.hidden||"px"==le.sizeType)re++;else{if(le.sizeCalculated=parseInt(le.sizeCalculated)+1+"px",X--,0===X)break;re++}else re=0}}else X>0&&u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();let ne=1;this.show.lineNumbers&&(ne+=_),this.show.selectColumn&&(ne+=26),this.show.expandColumn&&(ne+=26);for(let re=0;re<this.columns.length;re++)this.columns[re].hidden||this.columns[re].frozen&&(ne+=parseInt(this.columns[re].sizeCalculated));g.css("width",ne),m.css("width",ne),r.css("width",ne),w.css("width",ne),u.css("left",ne),c.css("left",ne),n.css("left",ne),u.find("> table > tbody > tr:nth-child(1) td").add(g.find("> table > tbody > tr:nth-child(1) td")).each((re,le)=>{$(le).hasClass("w2ui-col-number")&&$(le).css("width",_);let J=$(le).attr("col");if(null!=J){if("start"==J){let ge=0;for(let xe=0;xe<e.last.colStart;xe++)!e.columns[xe]||e.columns[xe].frozen||e.columns[xe].hidden||(ge+=parseInt(e.columns[xe].sizeCalculated));$(le).css("width",ge+"px")}e.columns[J]&&$(le).css("width",e.columns[J].sizeCalculated)}if($(le).hasClass("w2ui-head-last"))if(e.last.colEnd+1<e.columns.length){let ge=0;for(let xe=e.last.colEnd+1;xe<e.columns.length;xe++)!e.columns[xe]||e.columns[xe].frozen||e.columns[xe].hidden||(ge+=parseInt(e.columns[xe].sizeCalculated));$(le).css("width",ge+"px")}else $(le).css("width",w2utils.scrollBarSize()+(X>0&&0===B?X:0)+"px")}),3==u.find("> table > tbody > tr").length&&u.find("> table > tbody > tr:nth-child(1) td").add(g.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),c.find("> table > tbody > tr:nth-child(1) td").add(m.find("> table > tbody > tr:nth-child(1) td")).each((re,le)=>{$(le).hasClass("w2ui-col-number")&&$(le).css("width",_);let J=$(le).attr("col");if(null!=J){if("start"==J){let ge=0;for(let xe=0;xe<e.last.colStart;xe++)!e.columns[xe]||e.columns[xe].frozen||e.columns[xe].hidden||(ge+=parseInt(e.columns[xe].sizeCalculated));$(le).css("width",ge+"px")}e.columns[J]&&$(le).css("width",e.columns[J].sizeCalculated)}if($(le).hasClass("w2ui-grid-data-last")&&0===$(le).parents(".w2ui-grid-frecords").length)if(e.last.colEnd+1<e.columns.length){let ge=0;for(let xe=e.last.colEnd+1;xe<e.columns.length;xe++)!e.columns[xe]||e.columns[xe].frozen||e.columns[xe].hidden||(ge+=parseInt(e.columns[xe].sizeCalculated));$(le).css("width",ge+"px")}else $(le).css("width",(X>0&&0===B?X:0)+"px")}),n.find("> table > tbody > tr:nth-child(1) td").add(r.find("> table > tbody > tr:nth-child(1) td")).each((re,le)=>{$(le).hasClass("w2ui-col-number")&&$(le).css("width",_);let J=$(le).attr("col");if(null!=J){if("start"==J){let ge=0;for(let xe=0;xe<e.last.colStart;xe++)!e.columns[xe]||e.columns[xe].frozen||e.columns[xe].hidden||(ge+=parseInt(e.columns[xe].sizeCalculated));$(le).css("width",ge+"px")}e.columns[J]&&$(le).css("width",e.columns[J].sizeCalculated)}$(le).hasClass("w2ui-grid-data-last")&&0===$(le).parents(".w2ui-grid-frecords").length&&$(le).css("width",w2utils.scrollBarSize()+(X>0&&0===B?X:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&c.length>0&&(u.prop("scrollLeft",this.last.scrollLeft),c.prop("scrollTop",this.last.scrollTop),c.prop("scrollLeft",this.last.scrollLeft))}getSearchesHTML(){console.log("last",this);let e=`\n          <div class="search-title">\n              ${w2utils.lang("Advanced Search")}\n              <span class="search-limit" style="${this.show.searchLogic?"":"display: none"}">\n                  <select id="grid_${this.name}_limit">\n                      <option value="1000" ${1e3==this.limit?"selected":""}>1000</option>\n                      <option value="500" ${500==this.limit?"selected":""}>500</option>\n                      <option value="100" ${100==this.limit?"selected":""}>100</option>\n                      <option value="50" ${50==this.limit?"selected":""}>50</option>\n                      <option value="25" ${25==this.limit?"selected":""}>25</option>\n                      <option value="10" ${10==this.limit?"selected":""}>10</option>\n                      <option value="0" ${0==this.limit?"selected":""}>${w2utils.lang("All")}</option>\n                  </select>\n              </span>\n              <span class="search-logic" style="${this.show.searchLogic?"":"display: none"}">\n                  <select id="grid_${this.name}_logic">\n                      <option value="AND" ${"AND"==this.last.logic?"selected":""}>${w2utils.lang("All")}</option>\n                      <option value="OR" ${"OR"==this.last.logic?"selected":""}>${w2utils.lang("Any")}</option>\n                  </select>\n              </span>\n          </div>\n          <table cellspacing="0"><tbody>\n      `;for(let t=0;t<this.searches.length;t++){let i=this.searches[t];if(i.type=String(i.type).toLowerCase(),i.hidden)continue;null==i.inTag&&(i.inTag=""),null==i.outTag&&(i.outTag=""),null==i.style&&(i.style=""),null==i.type&&(i.type="text"),null==i.label&&null!=i.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",i),i.label=i.caption);let l,s=`<select id="grid_${this.name}_operator_${t}" class="w2ui-input" data-change="initOperator|${t}">\n                  ${this.getOperators(i.type,i.operators)}\n              </select>`;switch(e+=`<tr>\n                      <td class="caption">${i.label||""}</td>\n                      <td class="operator">${s}</td>\n                      <td class="value">`,i.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":l="width: 250px;",-1!=["hex","color"].indexOf(i.type)&&(l="width: 90px;"),e+=`<input rel="search" type="text" id="grid_${this.name}_field_${t}" name="${i.field}"\n                             class="w2ui-input" style="${l+i.style}" ${i.inTag}>`;break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":l="width: 90px;","datetime"==i.type&&(l="width: 140px;"),e+=`<input id="grid_${this.name}_field_${t}" name="${i.field}" ${i.inTag} rel="search" type="text"\n                              class="w2ui-input" style="${l+i.style}">\n                          <span id="grid_${this.name}_range_${t}" style="display: none">&#160;-&#160;&#160;\n                              <input rel="search" type="text" class="w2ui-input" style="${l+i.style}" id="grid_${this.name}_field2_${t}" name="${i.field}" ${i.inTag}>\n                          </span>`;break;case"select":e+=`<select rel="search" class="w2ui-input" style="${i.style}" id="grid_${this.name}_field_${t}"\n                              name="${i.field}" ${i.inTag}></select>`}e+=i.outTag+"    </td></tr>"}return e+=`<tr>\n          <td colspan="2" class="actions">\n              <button type="button" class="w2ui-btn close-btn" data-click="searchClose">${w2utils.lang("Close")}</button>\n          </td>\n          <td class="actions">\n              <button type="button" class="w2ui-btn" data-click="searchReset">${w2utils.lang("Reset")}</button>\n              <button type="button" class="w2ui-btn w2ui-btn-blue" data-click="search">${w2utils.lang("Search")}</button>\n          </td>\n      </tr></tbody></table>`,e}getOperators(e,t){let i=this.operators[this.operatorsMap[e]]||[];null!=t&&Array.isArray(t)&&(i=t);let s="";return i.forEach(l=>{let n=l;Array.isArray(l)?(n=l[1],l=l[0],null==n&&(n=l)):$.isPlainObject(l)&&(n=l.text,l=l.oper),s+=`<option value="${l}">${w2utils.lang(n)}</option>\n`}),s}initOperator(e){let t,i=this.searches[e],s=this.getSearchData(i.field),l=$(`#grid_${this.name}_range_${e}`),n=$(`#grid_${this.name}_field_${e}`),r=$(`#grid_${this.name}_field2_${e}`),h=$(`#grid_${this.name}_operator_${e}`).val();switch(n.show(),l.hide(),h){case"between":l.show(),r.w2field(i.type,i.options);break;case"null":case"not null":n.hide(),n.val(h),n.trigger("change")}switch(i.type){case"text":case"alphanumeric":if("in"==h||"not in"==h){let u=n.data("w2field");(!u||"clear"==u.type)&&(n.w2field("enum",i.options),s&&Array.isArray(s.value)&&n.data("selected",s.value))}else{let u=n.data("selected");n.w2field("clear"),n.removeData("w2field"),Array.isArray(u)&&u.length>0&&u[0].text&&n.val(u[0].text)}break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":n.w2field(i.type,i.options),r.w2field(i.type,i.options),setTimeout(()=>{n.keydown(),r.keydown()},1);break;case"list":case"combo":case"enum":t=i.options,"list"==i.type&&(t.selected={}),"enum"==i.type&&(t.selected=[]),s&&(t.selected=s.value),n.w2field(i.type,$.extend({openOnFocus:!0},t)),s&&null!=s.text&&n.data("selected",{id:s.value,text:s.text});break;case"select":t='<option value="">--</option>';for(let u=0;u<i.options.items.length;u++){let g=i.options.items[u];if($.isPlainObject(i.options.items[u])){let c=g.id,m=g.text;null==c&&null!=g.value&&(c=g.value),null==m&&null!=g.text&&(m=g.text),null==c&&(c=""),t+='<option value="'+c+'">'+m+"</option>"}else t+='<option value="'+g+'">'+g+"</option>"}n.html(t)}}initSearches(){let e=this;for(let t=0;t<this.searches.length;t++){let i=this.searches[t],s=this.getSearchData(i.field);i.type=String(i.type).toLowerCase(),"object"!=typeof i.options&&(i.options={});let l=i.operator,n=this.operators[this.operatorsMap[i.type]]||[];i.operators&&(n=i.operators),$.isPlainObject(l)&&(l=l.oper),n.forEach((u,g)=>{$.isPlainObject(u)&&(n[g]=u.oper)}),s&&s.operator&&(l=s.operator);let r=this.defaultOperator[this.operatorsMap[i.type]];-1==n.indexOf(l)&&(l=r),$(`#grid_${this.name}_operator_${t}`).val(l),this.initOperator(t);let o=$(`#grid_${this.name}_field_${t}`),h=$(`#grid_${this.name}_field2_${t}`);null!=s&&("int"==s.type&&-1!=["in","not in"].indexOf(s.operator)&&o.w2field("clear").val(s.value),Array.isArray(s.value)?-1!=["in","not in"].indexOf(s.operator)?o.val(s.value).trigger("change"):(o.val(s.value[0]).trigger("change"),h.val(s.value[1]).trigger("change")):null!=s.value&&o.val(s.value).trigger("change"))}$(`#w2ui-overlay-${this.name}-searchOverlay .w2ui-grid-search-advanced *[rel=search]`).on("keypress",function(t){13==t.keyCode&&(e.search(),$().w2overlay({name:e.name+"-searchOverlay"}))})}getColumnsHTML(){let e=this,t="",i="";if(this.show.columnHeaders)if(this.columnGroups.length>0){let n=l(!0),r=function s(){let n="<tr>",r="<tr>",o="",h=e.columnGroups.length-1;null==e.columnGroups[h].text&&null!=e.columnGroups[h].caption&&(console.log("NOTICE: grid columnGroup.caption property is deprecated, please use columnGroup.text. Group -> ",e.columnGroups[h]),e.columnGroups[h].text=e.columnGroups[h].caption),""!=e.columnGroups[e.columnGroups.length-1].text&&e.columnGroups.push({text:""}),e.show.lineNumbers&&(n+='<td class="w2ui-head w2ui-col-number">    <div>&#160;</div></td>'),e.show.selectColumn&&(n+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>'),e.show.expandColumn&&(n+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');let u=0;r+='<td id="grid_'+e.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>',e.show.orderColumn&&(r+='<td class="w2ui-head w2ui-col-order" col="order">    <div style="height: 25px">&#160;</div></td>');for(let g=0;g<e.columnGroups.length;g++){let c=e.columnGroups[g],m=e.columns[u]||{};null!=c.colspan&&(c.span=c.colspan),(null==c.span||c.span!=parseInt(c.span))&&(c.span=1),null==m.text&&null!=m.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column ->",m),m.text=m.caption);let w=0;for(let _=u;_<u+c.span;_++)e.columns[_]&&!e.columns[_].hidden&&w++;if(g==e.columnGroups.length-1&&(w=100),!(w<=0))if(!0===c.main){let _="";for(let I=0;I<e.sortData.length;I++)e.sortData[I].field==m.field&&("asc"===(e.sortData[I].direction||"").toLowerCase()&&(_="w2ui-sort-up"),"desc"===(e.sortData[I].direction||"").toLowerCase()&&(_="w2ui-sort-down"));let k="";!1!==m.resizable&&(k='<div class="w2ui-resizer" name="'+u+'"></div>');let E="function"==typeof m.text?m.text(m):m.text;o='<td id="grid_'+e.name+"_column_"+u+'" class="w2ui-head '+_+'" col="'+u+'"     rowspan="2" colspan="'+w+'"     oncontextmenu = "w2ui[\''+e.name+"'].contextMenu(null, "+u+', event);"    onclick="w2ui[\''+e.name+"'].columnClick('"+m.field+"', event);\"    ondblclick=\"w2ui['"+e.name+"'].columnDblClick('"+m.field+"', event);\">"+k+'    <div class="w2ui-col-group w2ui-col-header '+(_?"w2ui-col-sorted":"")+'">        <div class="'+_+'"></div>'+(E||"&#160;")+"    </div></td>",m&&m.frozen?n+=o:r+=o}else{let _="function"==typeof c.text?c.text(c):c.text;o='<td id="grid_'+e.name+"_column_"+u+'" class="w2ui-head" col="'+u+'"         colspan="'+w+'">    <div class="w2ui-col-group">'+(_||"&#160;")+"    </div></td>",m&&m.frozen?n+=o:r+=o}u+=c.span}return n+="<td></td></tr>",r+='<td id="grid_'+e.name+'_column_end" class="w2ui-head" col="end"></td></tr>',[n,r]}(),o=l(!1);t=n[0]+r[0]+o[0],i=n[1]+r[1]+o[1]}else{let n=l(!0);t=n[0],i=n[1]}return[t,i];function l(n){let r="<tr>",o="<tr>";e.show.lineNumbers&&(r+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+e.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+e.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>"),e.show.selectColumn&&(r+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+e.name+'_check_all" tabindex="-1"            style="'+(0==e.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="let grid = w2ui[\''+e.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>"),e.show.expandColumn&&(r+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');let g,h=0,u=0;o+='<td id="grid_'+e.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>',e.show.orderColumn&&(o+='<td class="w2ui-head w2ui-col-order" col="order">    <div>&#160;</div></td>');for(let c=0;c<e.columns.length;c++){let m=e.columns[c];if(null==m.text&&null!=m.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column -> ",m),m.text=m.caption),null==m.size&&(m.size="100%"),c==u&&(g=e.columnGroups[h++]||{},u+=g.span),(!(c<e.last.colStart||c>e.last.colEnd)||m.frozen)&&!m.hidden&&(!0!==g.main||n)){let w=e.getColumnCellHTML(c);m&&m.frozen?r+=w:o+=w}}return r+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',o+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',r+="</tr>",o+="</tr>",[r,o]}}getColumnCellHTML(e){let t=this.columns[e];if(null==t)return"";let i=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",s="";for(let h=0;h<this.sortData.length;h++)this.sortData[h].field==t.field&&("asc"===(this.sortData[h].direction||"").toLowerCase()&&(s="w2ui-sort-up"),"desc"===(this.sortData[h].direction||"").toLowerCase()&&(s="w2ui-sort-down"));let l=this.last.selection.columns,n=!1;for(let h in l)for(let u=0;u<l[h].length;u++)l[h][u]==e&&(n=!0);let r="function"==typeof t.text?t.text(t):t.text;return'<td id="grid_'+this.name+"_column_"+e+'" col="'+e+'" class="w2ui-head '+s+i+'" '+("normal"==this.columnTooltip&&t.tooltip?'title="'+t.tooltip+'" ':"")+"    onmouseEnter = \"w2ui['"+this.name+"'].columnTooltipShow('"+e+"', event);\"    onmouseLeave  = \"w2ui['"+this.name+"'].columnTooltipHide('"+e+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+e+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+t.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+t.field+"', event);\">"+(!1!==t.resizable?'<div class="w2ui-resizer" name="'+e+'"></div>':"")+'    <div class="w2ui-col-header '+(s?"w2ui-col-sorted":"")+" "+(n?"w2ui-col-selected":"")+'">        <div class="'+s+'"></div>'+(r||"&#160;")+"    </div></td>"}columnTooltipShow(e,t){if("normal"==this.columnTooltip)return;let i=$(this.box).find("#grid_"+this.name+"_column_"+e),s=this.columns[e],l=this.columnTooltip;i.prop("_mouse_over",!0),setTimeout(()=>{!0===i.prop("_mouse_over")&&!0!==i.prop("_mouse_tooltip")&&(i.prop("_mouse_tooltip",!0),i.w2tag(s.tooltip,{position:l,top:5}))},1)}columnTooltipHide(e,t){if("normal"==this.columnTooltip)return;let i=$(this.box).find("#grid_"+this.name+"_column_"+e);i.removeProp("_mouse_over"),setTimeout(()=>{!0!==i.prop("_mouse_over")&&!0===i.prop("_mouse_tooltip")&&(i.removeProp("_mouse_tooltip"),i.w2tag())},1)}getRecordsHTML(){let e=this.records.length;0!=this.searchData.length&&!("object"!=typeof this.url?this.url:this.url.get)&&(e=this.last.searchIds.length),this.last.show_extra=e>this.vs_start?this.vs_extra:this.vs_start;let i=$("#grid_"+this.name+"_records"),s=Math.floor((i.height()||0)/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||s>e)&&(s=e);let l=this.getRecordHTML(-1,0),n="<table><tbody>"+l[0],r="<table><tbody>"+l[1];n+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',r+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(let h=0;h<s;h++)l=this.getRecordHTML(h,h+1),n+=l[0],r+=l[1];let o=(e-s)*this.recordHeight;return n+='<tr id="grid_'+this.name+'_frec_bottom" rec="bottom" line="bottom" style="height: '+o+'px; vertical-align: top">    <td colspan="2000" style="border-right: 1px solid #D6D5D7;"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; ">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',r+='<tr id="grid_'+this.name+'_rec_bottom" rec="bottom" line="bottom" style="height: '+o+'px; vertical-align: top">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=s,[n,r]}getSummaryHTML(){if(0===this.summary.length)return;let e=this.getRecordHTML(-1,0),t="<table><tbody>"+e[0],i="<table><tbody>"+e[1];for(let s=0;s<this.summary.length;s++)e=this.getRecordHTML(s,s+1,!0),t+=e[0],i+=e[1];return t+="</tbody></table>",i+="</tbody></table>",[t,i]}scroll(e){let t=this,i="object"!=typeof this.url?this.url:this.url.get,s=$("#grid_"+this.name+"_records"),l=$("#grid_"+this.name+"_frecords");if(e){let J=e.target.scrollTop,ge=e.target.scrollLeft;this.last.scrollTop=J,this.last.scrollLeft=ge,$("#grid_"+this.name+"_columns")[0].scrollLeft=ge,$("#grid_"+this.name+"_summary")[0].scrollLeft=ge,l[0].scrollTop=J}this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);let n=null,r=null;if(this.disableCVS||this.columnGroups.length>0)n=0,r=this.columns.length-1;else{let J=s.width(),ge=0;for(let xe=0;xe<this.columns.length;xe++){if(this.columns[xe].frozen||this.columns[xe].hidden)continue;let Ye=parseInt(this.columns[xe].sizeCalculated?this.columns[xe].sizeCalculated:this.columns[xe].size);ge+Ye+30>this.last.scrollLeft&&null==n&&(n=xe),ge+Ye-30>this.last.scrollLeft+J&&null==r&&(r=xe),ge+=Ye}null==r&&(r=this.columns.length-1)}if(null!=n&&(n<0&&(n=0),r<0&&(r=0),n==r&&(n>0?n--:r++),n!=this.last.colStart||r!=this.last.colEnd)){let J=$(this.box),ge=Math.abs(n-this.last.colStart),xe=Math.abs(r-this.last.colEnd);if(ge<5&&xe<5){let Ye=J.find(".w2ui-grid-columns #grid_"+this.name+"_column_start"),Xe=J.find(".w2ui-grid-columns .w2ui-head-last"),Ve=J.find("#grid_"+this.name+"_records .w2ui-grid-data-spacer"),He=J.find("#grid_"+this.name+"_records .w2ui-grid-data-last"),Be=J.find("#grid_"+this.name+"_summary .w2ui-grid-data-spacer"),oe=J.find("#grid_"+this.name+"_summary .w2ui-grid-data-last");if(n>this.last.colStart)for(let Ie=this.last.colStart;Ie<n;Ie++)J.find("#grid_"+this.name+"_columns #grid_"+this.name+"_column_"+Ie).remove(),J.find("#grid_"+this.name+'_records td[col="'+Ie+'"]').remove(),J.find("#grid_"+this.name+'_summary td[col="'+Ie+'"]').remove();if(r<this.last.colEnd)for(let Ie=this.last.colEnd;Ie>r;Ie--)J.find("#grid_"+this.name+"_columns #grid_"+this.name+"_column_"+Ie).remove(),J.find("#grid_"+this.name+'_records td[col="'+Ie+'"]').remove(),J.find("#grid_"+this.name+'_summary td[col="'+Ie+'"]').remove();if(n<this.last.colStart)for(let Ie=this.last.colStart-1;Ie>=n;Ie--)this.columns[Ie]&&(this.columns[Ie].frozen||this.columns[Ie].hidden)||(Ye.after(this.getColumnCellHTML(Ie)),Ve.each((ht,it)=>{let rt=$(it).parent().attr("index"),Qe='<td class="w2ui-grid-data" col="'+Ie+'" style="height: 0px"></td>';null!=rt&&(Qe=this.getCellHTML(parseInt(rt),Ie,!1)),$(it).after(Qe)}),Be.each((ht,it)=>{let rt=$(it).parent().attr("index"),Qe='<td class="w2ui-grid-data" col="'+Ie+'" style="height: 0px"></td>';null!=rt&&(Qe=this.getCellHTML(parseInt(rt),Ie,!0)),$(it).after(Qe)}));if(r>this.last.colEnd)for(let Ie=this.last.colEnd+1;Ie<=r;Ie++)this.columns[Ie]&&(this.columns[Ie].frozen||this.columns[Ie].hidden)||(Xe.before(this.getColumnCellHTML(Ie)),He.each((ht,it)=>{let rt=$(it).parent().attr("index"),Qe='<td class="w2ui-grid-data" col="'+Ie+'" style="height: 0px"></td>';null!=rt&&(Qe=this.getCellHTML(parseInt(rt),Ie,!1)),$(it).before(Qe)}),oe.each((ht,it)=>{let rt=$(it).parent().attr("index")||-1,Qe=this.getCellHTML(parseInt(rt),Ie,!0);$(it).before(Qe)}));this.last.colStart=n,this.last.colEnd=r,this.resizeRecords()}else{this.last.colStart=n,this.last.colEnd=r;let Ye=this.getColumnsHTML(),Xe=this.getRecordsHTML(),Ve=this.getSummaryHTML(),He=J.find("#grid_"+this.name+"_columns"),Be=J.find("#grid_"+this.name+"_records"),oe=J.find("#grid_"+this.name+"_frecords"),Ie=J.find("#grid_"+this.name+"_summary");He.find("tbody").html(Ye[1]),oe.html(Xe[0]),Be.prepend(Xe[1]),null!=Ve&&Ie.html(Ve[1]),setTimeout(()=>{Be.find("> table").not("table:first-child").remove(),Ie[0]&&(Ie[0].scrollLeft=this.last.scrollLeft)},1),this.resizeRecords()}}let o=this.records.length;if(o>this.total&&-1!==this.total&&(o=this.total),0!=this.searchData.length&&!i&&(o=this.last.searchIds.length),0===o||0===s.length||0===s.height())return;this.last.show_extra=o>this.vs_start?this.vs_extra:this.vs_start;let h=Math.round(s[0].scrollTop/this.recordHeight+1),u=h+(Math.round(s.height()/this.recordHeight)-1);if(h>o&&(h=o),u>=o-1&&(u=o),$("#grid_"+this.name+"_footer .w2ui-footer-right").html((this.show.statusRange?w2utils.formatNumber(this.offset+h)+"-"+w2utils.formatNumber(this.offset+u)+(-1!=this.total?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(i&&this.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(o)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),!i&&(!this.fixedBody||-1!=this.total&&this.total<=this.vs_start))return;let g=Math.floor(s[0].scrollTop/this.recordHeight)-this.last.show_extra,c=g+Math.floor(s.height()/this.recordHeight)+2*this.last.show_extra+1;g<1&&(g=1),c>this.total&&-1!=this.total&&(c=this.total);let m=s.find("#grid_"+this.name+"_rec_top"),w=s.find("#grid_"+this.name+"_rec_bottom"),_=l.find("#grid_"+this.name+"_frec_top"),k=l.find("#grid_"+this.name+"_frec_bottom");-1!=String(m.next().prop("id")).indexOf("_expanded_row")&&(m.next().remove(),_.next().remove()),this.total>c&&-1!=String(w.prev().prop("id")).indexOf("_expanded_row")&&(w.prev().remove(),k.prev().remove());let N,L,f,H,B,E=parseInt(m.next().attr("line")),I=parseInt(w.prev().attr("line"));if(E<g||1==E||this.last.pull_refresh){if(c<=I+this.last.show_extra-2&&c!=this.total)return;for(this.last.pull_refresh=!1;L=l.find("#grid_"+this.name+"_frec_top").next(),f=s.find("#grid_"+this.name+"_rec_top").next(),"bottom"!=f.attr("line")&&parseInt(f.attr("line"))<g;)L.remove(),f.remove();N=s.find("#grid_"+this.name+"_rec_bottom").prev(),H=N.attr("line"),"top"==H&&(H=g);for(let J=parseInt(H)+1;J<=c;J++)!this.records[J-1]||(f=this.records[J-1].w2ui,f&&!Array.isArray(f.children)&&(f.expanded=!1),B=this.getRecordHTML(J-1,J),w.before(B[1]),k.before(B[0]));le(),setTimeout(()=>{this.refreshRanges()},0)}else{if(g>=E-this.last.show_extra+2&&g>1)return;for(;L=l.find("#grid_"+this.name+"_frec_bottom").prev(),f=s.find("#grid_"+this.name+"_rec_bottom").prev(),"top"!=f.attr("line")&&parseInt(f.attr("line"))>c;)L.remove(),f.remove();N=s.find("#grid_"+this.name+"_rec_top").next(),H=N.attr("line"),"bottom"==H&&(H=c);for(let J=parseInt(H)-1;J>=g;J--)!this.records[J-1]||(f=this.records[J-1].w2ui,f&&!Array.isArray(f.children)&&(f.expanded=!1),B=this.getRecordHTML(J-1,J),m.after(B[1]),_.after(B[0]));le(),setTimeout(()=>{this.refreshRanges()},0)}let Q=(g-1)*this.recordHeight,X=(o-c)*this.recordHeight;function le(){!t.markSearch||(clearTimeout(t.last.marker_timer),t.last.marker_timer=setTimeout(()=>{let J=[];for(let ge=0;ge<t.searchData.length;ge++){let xe=t.searchData[ge],Ye=t.getSearch(xe.field);if(!Ye||Ye.hidden)continue;let Xe=t.getColumn(xe.field,!0);J.push({field:xe.field,search:xe.value,col:Xe})}J.length>0&&J.forEach(ge=>{$(t.box).find('td[col="'+ge.col+'"]').not(".w2ui-head").w2marker(ge.search)})},50))}X<0&&(X=0),m.css("height",Q+"px"),_.css("height",Q+"px"),w.css("height",X+"px"),k.css("height",X+"px"),this.last.range_start=g,this.last.range_end=c,Math.floor(s[0].scrollTop/this.recordHeight)+Math.floor(s.height()/this.recordHeight)+10>o&&!0!==this.last.pull_more&&(o<this.total-this.offset||-1==this.total&&this.last.xhr_hasMore)&&(!0===this.autoLoad&&(this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get")),$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").show().eq(1).off(".load-more").on("click.load-more",function(){$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'),t.last.pull_more=!0,t.last.xhr_offset+=t.limit,t.request("get")}).find("td").html(t.autoLoad?'<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>':'<div style="padding-top: 15px">'+w2utils.lang("Load ${count} more...",{count:t.limit})+"</div>"))}getRecordHTML(e,t,i){let o,s="",l="",n="",r=this.last.selection;if(-1==e){l+='<tr line="0">',n+='<tr line="0">',this.show.lineNumbers&&(l+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(l+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(l+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),n+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>',this.show.orderColumn&&(n+='<td class="w2ui-col-order" style="height: 0px;" col="order"></td>');for(let _=0;_<this.columns.length;_++){let k=this.columns[_];if(s='<td class="w2ui-grid-data" col="'+_+'" style="height: 0px;"></td>',k.frozen&&!k.hidden)l+=s;else{if(k.hidden||_<this.last.colStart||_>this.last.colEnd)continue;n+=s}}return l+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',n+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',l+="</tr>",n+="</tr>",[l,n]}if(!0!==i)if(this.searchData.length>0&&!("object"!=typeof this.url?this.url:this.url.get)){if(e>=this.last.searchIds.length)return"";o=this.records[e=this.last.searchIds[e]]}else{if(e>=this.records.length)return"";o=this.records[e]}else{if(e>=this.summary.length)return"";o=this.summary[e]}if(!o)return"";if(null==o.recid&&null!=this.recid){let _=this.parseField(o,this.recid);null!=_&&(o.recid=_)}let u=!1;-1!=r.indexes.indexOf(e)&&(u=!0);let g=o.w2ui?o.w2ui.style:"";(null==g||"string"!=typeof g)&&(g="");let c=o.w2ui?o.w2ui.class:"";if((null==c||"string"!=typeof c)&&(c=""),l+='<tr id="grid_'+this.name+"_frec_"+o.recid+'" recid="'+o.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+c+(u&&"row"==this.selectType?" w2ui-selected":"")+(o.w2ui&&!1===o.w2ui.editable?" w2ui-no-edit":"")+(o.w2ui&&!0===o.w2ui.expanded?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(u||""==g?g.replace("background-color","none"):g)+'" '+(""!=g?'custom_style="'+g+'"':"")+">",n+='<tr id="grid_'+this.name+"_rec_"+o.recid+'" recid="'+o.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+c+(u&&"row"==this.selectType?" w2ui-selected":"")+(o.w2ui&&!1===o.w2ui.editable?" w2ui-no-edit":"")+(o.w2ui&&!0===o.w2ui.expanded?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(u||""==g?g.replace("background-color","none"):g)+'" '+(""!=g?'custom_style="'+g+'"':"")+">",this.show.lineNumbers&&(l+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'"    class="w2ui-col-number '+(u?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(!0!==i?this.getLineHTML(t,o):"")+"</td>"),this.show.selectColumn&&(l+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(!0===i||o.w2ui&&!0===o.w2ui.hideCheckBox?"":'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(u?'checked="checked"':"")+' style="pointer-events: none"/>    </div>')+"</td>"),this.show.expandColumn){let _="";_=o.w2ui&&!0===o.w2ui.expanded?"-":"+",o.w2ui&&("none"==o.w2ui.expanded||!Array.isArray(o.w2ui.children)||!o.w2ui.children.length)&&(_=""),o.w2ui&&"spinner"==o.w2ui.expanded&&(_='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),l+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==i?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+_+" </div>":"")+"</td>"}n+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',this.show.orderColumn&&(n+='<td id="grid_'+this.name+"_cell_"+e+"_order"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-order" col="order">'+(!0!==i?'<div title="Drag to reorder">&nbsp;</div>':"")+"</td>");let m=0,w=0;for(;;){let _=1,k=this.columns[m];if(null==k)break;if(k.hidden){m++,w>0&&w--;continue}if(w>0){if(m++,null==this.columns[m])break;o.w2ui.colspan[this.columns[m-1].field]=0,w--;continue}if(o.w2ui){let I=o.w2ui.colspan,N=this.columns[m].field;I&&0===I[N]&&delete I[N]}if((m<this.last.colStart||m>this.last.colEnd)&&!k.frozen){m++;continue}if(o.w2ui&&"object"==typeof o.w2ui.colspan){let I=parseInt(o.w2ui.colspan[k.field])||null;if(I>1){let N=0;for(let L=m;L<m+I&&!(L>=this.columns.length);L++)this.columns[L].hidden&&N++;_=I-N,w=I-1}}let E=this.getCellHTML(e,m,i,_);k.frozen?l+=E:n+=E,m++}return l+='<td class="w2ui-grid-data-last"></td>',n+='<td class="w2ui-grid-data-last" col="end"></td>',l+="</tr>",n+="</tr>",[l,n]}getLineHTML(e){return"<div>"+e+"</div>"}getCellHTML(e,t,i,s){let l=this,n=this.columns[t];if(null==n)return"";let r=!0!==i?this.records[e]:this.summary[e],o=-1!==e?this.getCellValue(e,t,i):"",h=-1!==e?this.getCellEditable(e,t):"",u="max-height: "+parseInt(this.recordHeight)+"px;"+(n.clipboardCopy?"margin-right: 20px":""),g=!i&&r&&r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[n.field],c="",m="",w=this.last.selection,_=!1,k="";if(-1!=w.indexes.indexOf(e)&&(_=!0),null==s&&(s=r&&r.w2ui&&r.w2ui.colspan&&r.w2ui.colspan[n.field]?r.w2ui.colspan[n.field]:1),"object"==typeof o&&o.length>0&&(o[0].id&&(o=o.map(f=>f.text).join(", ")),n.viewMask)){let f=n.viewMask;o.forEach((H,B)=>{f=f.replace(`{${B}}`,H)}),o=f}if(0===t&&r&&r.w2ui&&Array.isArray(r.w2ui.children)){let f=0,H=this.get(r.w2ui.parent_recid,!0);for(;null!=H;){f++;let B=this.records[H].w2ui;if(null==B||null==B.parent_recid)break;H=this.get(B.parent_recid,!0)}if(r.w2ui.parent_recid)for(let B=0;B<f;B++)k+='<span class="w2ui-show-children w2ui-icon-empty"></span>';k+='<span class="w2ui-show-children '+(r.w2ui.children.length>0?r.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}if(!0===n.info&&(n.info={}),null!=n.info){let f="w2ui-icon-info";"function"==typeof n.info.icon?f=n.info.icon(r):"object"==typeof n.info.icon?f=n.info.icon[this.parseField(r,n.field)]||"":"string"==typeof n.info.icon&&(f=n.info.icon);let H=n.info.style||"";"function"==typeof n.info.style?H=n.info.style(r):"object"==typeof n.info.style?H=n.info.style[this.parseField(r,n.field)]||"":"string"==typeof n.info.style&&(H=n.info.style),k+='<span class="w2ui-info '+f+'" style="'+H+'" '+(null!=n.info.showOn?"on"+n.info.showOn:"onclick")+"=\"event.stopPropagation(); w2ui['"+this.name+"'].showBubble("+e+", "+t+')"'+(null!=n.info.hideOn?"on"+n.info.hideOn:"")+"=\"let grid = w2ui['"+this.name+"']; if (grid.last.bubbleEl) { $(grid.last.bubbleEl).w2tag() } grid.last.bubbleEl = null;\"></span>"}if(null!=n.render&&-1!==e){if("function"==typeof n.render){let f=n.render.call(this,r,e,t,o);null!=f&&"object"==typeof f?("string"==typeof f.html?o=(f.html||"").trim():(o="",console.log("ERROR: if render function returns an object, its html property should be a string.",{html:"...",class:"...",style:"..."})),m=f.class||"",c=f.style||""):"string"==typeof f?o=(f||"").trim():(o="",console.log("ERROR: render function should return a string or an object.",{html:"...",class:"...",style:"..."})),(o.length<4||"<div"!=o.substr(0,4).toLowerCase())&&(o='<div style="'+u+'" title="'+L(o)+'">'+k+String(o)+"</div>")}if("object"==typeof n.render){let f=n.render[o];(null==f||""===f)&&(f=o),o='<div style="'+u+'" title="'+L(f)+'">'+k+String(f)+"</div>"}if("string"==typeof n.render){let f=n.render.toLowerCase().indexOf(":"),H=[];-1==f?(H[0]=n.render.toLowerCase(),H[1]=""):(H[0]=n.render.toLowerCase().substr(0,f),H[1]=n.render.toLowerCase().substr(f+1));let B=w2utils.formatters[H[0]];n.options&&!1===n.options.autoFormat&&(B=null),o="function"==typeof B?B(o,H[1],r):"",o='<div style="'+u+'" title="'+L(o)+'">'+k+String(o)+"</div>"}}else h&&-1!=["checkbox","check"].indexOf(h.type)&&(u+="text-align: center;",o='<input tabindex="-1" type="checkbox" '+(o?'checked="checked"':"")+" onclick=\"    let obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+(i?-(e+1):e)+", "+t+', event); "/>',k=""),o='<div style="'+u+'" title="'+L(o)+'">'+k+String(o)+"</div>";if(null==o&&(o=""),"string"==typeof n.render){let f=n.render.toLowerCase().split(":");-1!=["number","int","float","money","currency","percent","size"].indexOf(f[0])&&(c+="text-align: right;")}r&&r.w2ui&&("object"==typeof r.w2ui.style&&("string"==typeof r.w2ui.style[t]&&(c+=r.w2ui.style[t]+";"),"string"==typeof r.w2ui.style[n.field]&&(c+=r.w2ui.style[n.field]+";")),"object"==typeof r.w2ui.class&&("string"==typeof r.w2ui.class[t]&&(m+=r.w2ui.class[t]+" "),"string"==typeof r.w2ui.class[n.field]&&(m+=r.w2ui.class[n.field]+" ")));let I,N,E=!1;return _&&-1!=$.inArray(t,w.columns[e])&&(E=!0),n.clipboardCopy&&(I="string"==typeof n.clipboardCopy?n.clipboardCopy:w2utils.lang("Copy to clipboard"),N="<span onmouseEnter=\"jQuery(this).w2tag('"+I+"', { position: 'top|bottom' })\"onclick=\"w2ui['"+this.name+"'].clipboardCopy("+e+", "+t+'); jQuery(this).w2tag(w2utils.lang(\'Copied\'), { position: \'top|bottom\' }); event.stopPropagation();" onmouseLeave="jQuery(this).w2tag()" class="w2ui-clipboard-copy w2ui-icon-paste"></span>'),o='<td class="w2ui-grid-data'+(E?" w2ui-selected":"")+" "+m+(g?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+e+"_"+t+'" col="'+t+'"    style="'+c+(null!=n.style?n.style:"")+'" '+(null!=n.attr?n.attr:"")+(s>1?'colspan="'+s+'"':"")+">"+o+(N&&w2utils.stripTags(o)?N:"")+"</td>",-1===e&&!0===i&&(o='<td class="w2ui-grid-data" col="'+t+'" style="height: 0px; '+c+'" '+(s>1?'colspan="'+s+'"':"")+"></td>"),o;function L(f){let H="";return l.show.recordTitles&&(null!=n.title?("function"==typeof n.title&&(H=n.title.call(l,r,e,t)),"string"==typeof n.title&&(H=n.title)):H=w2utils.stripTags(String(f).replace(/"/g,"''"))),null!=H?String(H):""}}clipboardCopy(e,t){let i=this.records[e],s=this.columns[t],l=s?this.parseField(i,s.field):"";"function"==typeof s.clipboardCopy&&(l=s.clipboardCopy(i)),$("#grid_"+this.name+"_focus").text(l).select(),document.execCommand("copy")}showBubble(e,t){let i=this.columns[t].info;if(!i)return;let s="",l=this.records[e],n=$(this.box).find("#grid_"+this.name+"_data_"+e+"_"+t+" .w2ui-info");if(this.last.bubbleEl&&$(this.last.bubbleEl).w2tag(),this.last.bubbleEl=n,null==i.fields){i.fields=[];for(let o=0;o<this.columns.length;o++){let h=this.columns[o];i.fields.push(h.field+("string"==typeof h.render?":"+h.render:""))}}let r=i.fields;if("function"==typeof r&&(r=r(l,e,t)),"function"==typeof i.render)s=i.render(l,e,t);else if(Array.isArray(r)){s='<table cellpadding="0" cellspacing="0">';for(let o=0;o<r.length;o++){let h=String(r[o]).split(":");if(""==h[0]||"-"==h[0]||"--"==h[0]||"---"==h[0]){s+='<tr><td colspan=2><div style="border-top: '+(""==h[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';continue}let u=this.getColumn(h[0]);null==u&&(u={field:h[0],caption:h[0]});let g=u?this.parseField(l,u.field):"";h.length>1&&(w2utils.formatters[h[1]]?g=w2utils.formatters[h[1]](g,h[2]||null,l):console.log('ERROR: w2utils.formatters["'+h[1]+'"] does not exists.')),(!0===i.showEmpty||null!=g&&""!=g)&&(null!=i.maxLength&&"string"==typeof g&&g.length>i.maxLength&&(g=g.substr(0,i.maxLength)+"..."),s+="<tr><td>"+u.text+"</td><td>"+((0===g?"0":g)||"")+"</td></tr>")}s+="</table>"}else if($.isPlainObject(r)){s='<table cellpadding="0" cellspacing="0">';for(let o in r){let h=r[o];if(""==h||"-"==h||"--"==h||"---"==h){s+='<tr><td colspan=2><div style="border-top: '+(""==h?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';continue}let u=String(h).split(":"),g=this.getColumn(u[0]);null==g&&(g={field:u[0],caption:u[0]});let c=g?this.parseField(l,g.field):"";u.length>1&&(w2utils.formatters[u[1]]?c=w2utils.formatters[u[1]](c,u[2]||null,l):console.log('ERROR: w2utils.formatters["'+u[1]+'"] does not exists.')),"function"==typeof h&&(c=h(l,e,t)),(!0===i.showEmpty||null!=c&&""!=c)&&(null!=i.maxLength&&"string"==typeof c&&c.length>i.maxLength&&(c=c.substr(0,i.maxLength)+"..."),s+="<tr><td>"+o+"</td><td>"+((0===c?"0":c)||"")+"</td></tr>")}s+="</table>"}$(n).w2tag($.extend({html:s,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},i.options||{}))}getCellEditable(e,t){return null}getCellValue(e,t,i){let s=this.columns[t],l=!0!==i?this.records[e]:this.summary[e],n=this.parseField(l,s.field);if(l&&l.w2ui&&l.w2ui.changes&&null!=l.w2ui.changes[s.field]&&(n=l.w2ui.changes[s.field]),$.isPlainObject(n))if(s.options&&s.options.items){let r=s.options.items.find(o=>o.id==n.id);n=r?r.text:n.id}else null!=n.text&&(n=n.text),null!=n.id&&(n=n.id);return null==n&&(n=""),n}getFooterHTML(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'}status(e){if(null!=e)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(e);else{let t="",i=this.getSelection();if(i.length>0&&(this.show.statusSelection&&i.length>1&&(t=String(i.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+w2utils.settings.groupSymbol)+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==i.length)){let s=i[0];"object"==typeof s&&(s=s.recid+", "+w2utils.lang("Column")+": "+s.column),t=w2utils.lang("Record ID")+": "+s+" "}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(t),1==i.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),i.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}}lock(e,t){let i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),setTimeout(()=>{$(this.box).find("#grid_"+this.name+"_empty_msg").remove(),w2utils.lock.apply(window,i)},10)}unlock(e){setTimeout(()=>{$(this.box).find(".w2ui-message").not(".w2ui-closing").length>0||w2utils.unlock(this.box,e)},25)}stateSave(e){if(!w2utils.hasLocalStorage)return null;let i,t={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,label:this.last.label,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]};for(let l=0;l<this.columns.length;l++){let n=this.columns[l],r={};Object.keys(this.stateColProps).forEach((o,h)=>{this.stateColProps[o]&&(i=void 0!==n[o]?n[o]:this.colDefaults[o]||null,r[o]=i)}),t.columns.push(r)}for(let l=0;l<this.sortData.length;l++)t.sortData.push($.extend({},this.sortData[l]));for(let l=0;l<this.searchData.length;l++)t.searchData.push($.extend({},this.searchData[l]));let s=this.trigger({phase:"before",type:"stateSave",target:this.name,state:t});if(!0!==s.isCancelled){if(!0!==e&&this.useLocalStorage)try{let l=JSON.parse(localStorage.w2ui||"{}");l||(l={}),l.states||(l.states={}),l.states[this.stateId||this.name]=t,localStorage.w2ui=JSON.stringify(l)}catch(l){return delete localStorage.w2ui,null}return this.trigger($.extend(s,{phase:"after"})),t}}stateRestore(e){let t="object"!=typeof this.url?this.url:this.url.get;if(!e){if(!w2utils.hasLocalStorage&&this.useLocalStorage)return!1;try{let s=JSON.parse(localStorage.w2ui||"{}");s||(s={}),s.states||(s.states={}),e=s.states[this.stateId||this.name]}catch(s){return delete localStorage.w2ui,null}}let i=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:e});if(!0!==i.isCancelled){if($.isPlainObject(e)){$.extend(this.show,e.show),$.extend(this.last,e.last);let s=this.last.scrollTop,l=this.last.scrollLeft;for(let n=0;n<e.columns.length;n++){let r=e.columns[n],o=this.getColumn(r.field,!0);null!==o&&($.extend(this.columns[o],r),n!==o&&this.columns.splice(n,0,this.columns.splice(o,1)[0]))}this.sortData.splice(0,this.sortData.length);for(let n=0;n<e.sortData.length;n++)this.sortData.push(e.sortData[n]);this.searchData.splice(0,this.searchData.length);for(let n=0;n<e.searchData.length;n++)this.searchData.push(e.searchData[n]);setTimeout(()=>{t||(this.sortData.length>0&&this.localSort(),this.searchData.length>0&&this.localSearch()),this.last.scrollTop=s,this.last.scrollLeft=l,this.refresh()},1)}return this.trigger($.extend(i,{phase:"after"})),!0}}stateReset(){if(this.stateRestore(this.last.state),w2utils.hasLocalStorage&&this.useLocalStorage)try{let e=JSON.parse(localStorage.w2ui||"{}");e.states&&e.states[this.stateId||this.name]&&delete e.states[this.stateId||this.name],localStorage.w2ui=JSON.stringify(e)}catch(e){return delete localStorage.w2ui,null}}parseField(e,t){if(this.nestedFields){let i="";try{i=e;let s=String(t).split(".");for(let l=0;l<s.length;l++)i=i[s[l]]}catch(s){i=""}return i}return e?e[t]:""}prepareData(){let e=this;for(let i=0;i<this.records.length;i++)t(this.records[i]);function t(i){for(let s=0;s<e.columns.length;s++){let l=e.columns[s];if(null!=i[l.field]&&"string"==typeof l.render){if(-1!=["number","int","float","money","currency","percent"].indexOf(l.render.split(":")[0])&&"number"!=typeof i[l.field]&&(i[l.field]=parseFloat(i[l.field])),-1!=["date","age"].indexOf(l.render.split(":")[0])&&!i[l.field+"_"]){let n=i[l.field];w2utils.isInt(n)&&(n=parseInt(n)),i[l.field+"_"]=new Date(n)}if(-1!=["time"].indexOf(l.render))if(w2utils.isTime(i[l.field])){let n=w2utils.isTime(i[l.field],!0),r=new Date;r.setHours(n.hours,n.minutes,n.seconds?n.seconds:0,0),i[l.field+"_"]||(i[l.field+"_"]=r)}else{let n=i[l.field];w2utils.isInt(n)&&(n=parseInt(n)),n=null!=n?new Date(n):new Date;let r=new Date;r.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),0),i[l.field+"_"]||(i[l.field+"_"]=r)}}}if(i.w2ui&&i.w2ui.children&&!0!==i.w2ui.expanded)for(let s=0;s<i.w2ui.children.length;s++)t(i.w2ui.children[s])}}nextCell(e,t,i){let s=t+1;if(s>=this.columns.length)return null;let l=this.records[e].w2ui,n=this.columns[s],r=l&&l.colspan&&!isNaN(l.colspan[n.field])?parseInt(l.colspan[n.field]):1;if(null==n)return null;if(n&&n.hidden||0===r)return this.nextCell(e,s,i);if(i){let o=this.getCellEditable(e,t);if(null==o||-1!=["checkbox","check"].indexOf(o.type))return this.nextCell(e,s,i)}return s}prevCell(e,t,i){let s=t-1;if(s<0)return null;let l=this.records[e].w2ui,n=this.columns[s],r=l&&l.colspan&&!isNaN(l.colspan[n.field])?parseInt(l.colspan[n.field]):1;if(null==n)return null;if(n&&n.hidden||0===r)return this.prevCell(e,s,i);if(i){let o=this.getCellEditable(e,t);if(null==o||-1!=["checkbox","check"].indexOf(o.type))return this.prevCell(e,s,i)}return s}nextRow(e,t,i){let s=this.last.searchIds,l=null;if(-1==i)return this.records.length-1;if(e+i<this.records.length&&0===s.length||s.length>0&&e<s[s.length-i]){if(e+=i,s.length>0)for(;!(-1!=$.inArray(e,s)||e>this.records.length);)e+=i;let n=this.records[e].w2ui,r=this.columns[t];l=0===(n&&n.colspan&&null!=r&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1)?this.nextRow(e,t,i):e}return l}prevRow(e,t,i){let s=this.last.searchIds,l=null;if(-1==i)return 0;if(e-i>0&&0===s.length||s.length>0&&e>s[0]){if(e-=i,s.length>0)for(;!(-1!=$.inArray(e,s)||e<0);)e-=i;let n=this.records[e].w2ui,r=this.columns[t];l=0===(n&&n.colspan&&null!=r&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1)?this.prevRow(e,t,i):e}return l}selectionSave(){return this.last._selection=this.getSelection(),this.last._selection}selectionRestore(e){let t=(new Date).getTime();this.last.selection={indexes:[],columns:{}};let i=this.last.selection,s=this.last._selection;if(s)for(let l=0;l<s.length;l++)if($.isPlainObject(s[l])){let n=this.get(s[l].recid,!0);null!=n&&(-1==i.indexes.indexOf(n)&&i.indexes.push(n),i.columns[n]||(i.columns[n]=[]),i.columns[n].push(s[l].column))}else{let n=this.get(s[l],!0);null!=n&&i.indexes.push(n)}return delete this.last._selection,!0!==e&&this.refresh(),(new Date).getTime()-t}message(e){return"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:`<div class="w2ui-centered">${e}</div>`,onOpen(t){setTimeout(()=>{$(t.box).find(".w2ui-btn").focus()},25)}}),e&&null==e.buttons&&(e.buttons=`<button type="button" class="w2ui-btn" onclick="w2ui['${this.name}'].message()">\n              ${w2utils.lang("Ok")}\n          </button>`),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},e)}confirm(e){let t=this;"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>"});let i=()=>{"function"==typeof e.yes_click&&e.yes_click("yes"),"function"==typeof e.callBack&&e.callBack("yes"),t.message()},s=()=>{"function"==typeof e.no_click&&e.no_click("no"),"function"==typeof e.callBack&&e.callBack("no"),t.message()},l=`<button type="button" class="w2ui-btn btn-yes ${e.yes_class||""}">${w2utils.lang(e.yes_text||"Yes")}</button>`,n=`<button type="button" class="w2ui-btn btn-no ${e.no_class||""}">${w2utils.lang(e.no_text||"No")}</button>`;Object.assign(e,{buttons:w2utils.settings.macButtonOrder?n+l:l+n,onOpen(o){setTimeout(()=>{let h=$(this.box).find(".w2ui-btn");h.off(".message").on("blur.message",function(u){h.index(u.target)+1===h.length&&(h.get(0).focus(),u.preventDefault())}).on("keydown.message",function(u){27==u.keyCode&&s()}).focus(),$(this.box).find(".w2ui-btn.btn-yes").off("click").on("click",i),$(this.box).find(".w2ui-btn.btn-no").off("click").on("click",s)},25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},e);let r={yes:o=>(e.yes_click=o,r),no:o=>(e.no_click=o,r),then:o=>(e.callBack=o,r)};return r}}let w2panels=["top","left","main","preview","right","bottom"];class w2layout extends w2event{constructor(e){super(e.name),this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",this.onShow=null,this.onHide=null,this.onResizing=null,this.onResizerClick=null,this.onRender=null,this.onRefresh=null,this.onChange=null,this.onResize=null,this.onDestroy=null,this.panel_template={type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",html:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},removed:null,onRefresh:null,onShow:null,onHide:null},$.extend(!0,this,e),Array.isArray(this.panels)||(this.panels=[]),this.panels.forEach((s,l)=>{this.panels[l]=$.extend(!0,{},this.panel_template,s),($.isPlainObject(s.tabs)||Array.isArray(s.tabs))&&function t(s,l,n){let r=s.get(l);null!=r&&null==n&&(n=r.tabs),null!=r&&null!=n&&(Array.isArray(n)&&(n={tabs:n}),$().w2destroy(s.name+"_"+l+"_tabs"),r.tabs=new w2tabs($.extend({},n,{owner:s,name:s.name+"_"+l+"_tabs"})),r.show.tabs=!0)}(this,s.type),($.isPlainObject(s.toolbar)||Array.isArray(s.toolbar))&&function i(s,l,n){let r=s.get(l);null!=r&&null==n&&(n=r.toolbar),null!=r&&null!=n&&(Array.isArray(n)&&(n={items:n}),$().w2destroy(s.name+"_"+l+"_toolbar"),r.toolbar=new w2toolbar($.extend({},n,{owner:s,name:s.name+"_"+l+"_toolbar"})),r.show.toolbar=!0)}(this,s.type)}),w2panels.forEach(s=>{null==this.get(s)&&this.panels.push($.extend(!0,{},this.panel_template,{type:s,hidden:"main"!==s,size:50}))})}html(e,t,i){let s=this,l=this.get(e),n={panel:e,html:l.html,error:!1,cancelled:!1,removed(g){"function"==typeof g&&(l.removed=g)}};if("function"==typeof l.removed&&(l.removed({panel:e,html:l.html,html_new:t,transition:i||"none"}),l.removed=null),"css"==e)return $("#layout_"+s.name+"_panel_css").html("<style>"+t+"</style>"),n.status=!0,n;if(null==l)return console.log("ERROR: incorrect panel name. Panel name can be main, left, right, top, bottom, preview or css"),n.error=!0,n;if(null==t)return n;let r=this.trigger({phase:"before",type:"change",target:e,panel:l,html_new:t,transition:i});if(!0===r.isCancelled)return n.cancelled=!0,n;if(t instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.html() method"),n;let o="#layout_"+this.name+"_panel_"+l.type,h=$(o+"> .w2ui-panel-content"),u=0;if(h.length>0&&($(o).scrollTop(0),u=$(h).position().top),""===l.html)l.html=t,this.refresh(e);else{if(l.html=t,!l.hidden&&null!=i&&""!==i){let g=$(o+"> .w2ui-panel-content");g.after('<div class="w2ui-panel-content new-panel" style="'+g[0].style.cssText+'"></div>');let c=$(o+"> .w2ui-panel-content.new-panel");g.css("top",u),c.css("top",u),"object"==typeof t?(t.box=c[0],t.render()):c.html(t),w2utils.transition(g[0],c[0],i,()=>{g.remove(),c.removeClass("new-panel"),c.css("overflow",l.overflow),$(o+"> .w2ui-panel-content").slice(1).remove(),s.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(()=>{s.resize()},100)})}this.refresh(e)}return s.trigger($.extend(r,{phase:"after"})),s.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(()=>{s.resize()},100),n}message(e,t){let i=this;"string"==typeof t&&(t={width:t.length<300?350:550,height:t.length<300?170:250,body:'<div class="w2ui-centered">'+t+"</div>",buttons:`<button class="w2ui-btn" data-click='["message", "${e}"]'>Ok</button>`,onOpen(o){setTimeout(()=>{w2utils.bindEvents($(i.box).find(".w2ui-btn"),i),$(i.box).find(".w2ui-btn").focus()},25)}});let r,s=this.get(e),n=$("#layout_"+this.name+"_panel_"+s.type).css("overflow");return t&&(t.onClose&&(r=t.onClose),t.onClose=o=>{"function"==typeof r&&r(o),o.done(()=>{$("#layout_"+i.name+"_panel_"+s.type).css("overflow",n)})}),$("#layout_"+this.name+"_panel_"+s.type).css("overflow","hidden"),w2utils.message.call(this,{box:$("#layout_"+this.name+"_panel_"+s.type),param:e,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},t)}confirm(e,t){let i=this;"string"==typeof t&&(t={width:t.length<300?350:550,height:t.length<300?170:250,body:'<div class="w2ui-centered">'+t+"</div>"});let s=()=>{"function"==typeof t.yes_click&&t.yes_click("yes"),"function"==typeof t.callBack&&t.callBack("yes"),i.message(e)},l=()=>{"function"==typeof t.no_click&&t.no_click("no"),"function"==typeof t.callBack&&t.callBack("no"),i.message(e)},n=`<button type="button" class="w2ui-btn btn-yes ${t.yes_class||""}">${w2utils.lang(t.yes_text||"Yes")}</button>`,r=`<button type="button" class="w2ui-btn btn-no ${t.no_class||""}">${w2utils.lang(t.no_text||"No")}</button>`;Object.assign(t,{buttons:w2utils.settings.macButtonOrder?r+n:n+r,onOpen(m){setTimeout(()=>{let w=$(this.box).find(".w2ui-btn");w.off(".message").on("blur.message",function(_){w.index(_.target)+1===w.length&&(w.get(0).focus(),_.preventDefault())}).on("keydown.message",function(_){27==_.keyCode&&l()}).focus(),$(this.box).find(".w2ui-btn.btn-yes").off("click").on("click",s),$(this.box).find(".w2ui-btn.btn-no").off("click").on("click",l)},25)}});let g,o=this.get(e),u=$("#layout_"+this.name+"_panel_"+o.type).css("overflow");t&&(t.onClose&&(g=t.onClose),t.onClose=m=>{"function"==typeof g&&g(m),m.done(()=>{$("#layout_"+i.name+"_panel_"+o.type).css("overflow",u)})}),$("#layout_"+this.name+"_panel_"+o.type).css("overflow","hidden"),w2utils.message.call(this,{box:$("#layout_"+this.name+"_panel_"+o.type),param:e,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},t);let c={yes:m=>(t.yes_click=m,c),no:m=>(t.no_click=m,c),then:m=>(t.callBack=m,c)};return c}load(e,t,i){return new Promise((s,l)=>{let n=this;"css"==e&&null!=t||null!=this.get(e)&&null!=t?$.get(t,(r,o,h)=>{n.resize(),s(n.html(e,h.responseText,i))}):l()})}sizeTo(e,t,i){let s=this;return null!=s.get(e)&&($(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",!0!==i?".2s":"0s")),setTimeout(()=>{s.set(e,{size:t})},1),setTimeout(()=>{$(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),s.resize()},500),!0)}show(e,t){let i=this,s=this.trigger({phase:"before",type:"show",target:e,object:this.get(e),immediate:t});if(!0===s.isCancelled)return;let l=i.get(e);return null!=l&&(l.hidden=!1,!0===t?($("#layout_"+i.name+"_panel_"+e).css({opacity:"1"}),i.trigger($.extend(s,{phase:"after"})),i.resize()):($("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),$(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),setTimeout(()=>{i.resize()},1),setTimeout(()=>{$("#layout_"+i.name+"_panel_"+e).css({opacity:"1"})},250),setTimeout(()=>{$(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),i.trigger($.extend(s,{phase:"after"})),i.resize()},500)),!0)}hide(e,t){let i=this,s=this.trigger({phase:"before",type:"hide",target:e,object:this.get(e),immediate:t});if(!0===s.isCancelled)return;let l=i.get(e);return null!=l&&(l.hidden=!0,!0===t?($("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),i.trigger($.extend(s,{phase:"after"})),i.resize()):($(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),$("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),setTimeout(()=>{i.resize()},1),setTimeout(()=>{$(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),i.trigger($.extend(s,{phase:"after"})),i.resize()},500)),!0)}toggle(e,t){let i=this.get(e);return null!=i&&(i.hidden?this.show(e,t):this.hide(e,t))}set(e,t){let i=this.get(e,!0);return null!=i&&($.extend(this.panels[i],t),(null!=t.html||null!=t.resizable)&&this.refresh(e),this.resize(),!0)}get(e,t){for(let i=0;i<this.panels.length;i++)if(this.panels[i].type==e)return!0===t?i:this.panels[i];return null}el(e){let t=$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-content");return 1!=t.length?null:t[0]}hideToolbar(e){let t=this.get(e);!t||(t.show.toolbar=!1,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").hide(),this.resize())}showToolbar(e){let t=this.get(e);!t||(t.show.toolbar=!0,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").show(),this.resize())}toggleToolbar(e){let t=this.get(e);!t||(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))}assignToolbar(e,t){"string"==typeof t&&null!=w2ui[t]&&(t=w2ui[t]);let i=this.get(e);i.toolbar=t;let s=$(this.box).find(e+"> .w2ui-panel-toolbar");null!=i.toolbar?(0===s.find("[name="+i.toolbar.name+"]").length?s.w2render(i.toolbar):null!=i.toolbar&&i.toolbar.refresh(),t.owner=this,this.showToolbar(e),this.refresh(e)):(s.html(""),this.hideToolbar(e))}hideTabs(e){let t=this.get(e);!t||(t.show.tabs=!1,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").hide(),this.resize())}showTabs(e){let t=this.get(e);!t||(t.show.tabs=!0,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").show(),this.resize())}toggleTabs(e){let t=this.get(e);!t||(t.show.tabs?this.hideTabs(e):this.showTabs(e))}render(e){let t=this,i=(new Date).getTime(),s=t.trigger({phase:"before",type:"render",target:t.name,box:e});if(!0!==s.isCancelled){if(null!=e&&($(t.box).find("#layout_"+t.name+"_panel_main").length>0&&$(t.box).removeAttr("name").removeClass("w2ui-layout").html(""),t.box=e),!t.box)return!1;$(t.box).attr("name",t.name).addClass("w2ui-layout").html("<div></div>"),$(t.box).length>0&&($(t.box)[0].style.cssText+=t.style);for(let h=0;h<w2panels.length;h++){let u='<div id="layout_'+t.name+"_panel_"+w2panels[h]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+t.name+"_resizer_"+w2panels[h]+'" class="w2ui-resizer"></div>';$(t.box).find(" > div").append(u)}return $(t.box).find(" > div").append('<div id="layout_'+t.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),t.refresh(),t.trigger($.extend(s,{phase:"after"})),setTimeout(()=>{(function l(){t.tmp.events={resize(h){null==w2ui[t.name]?$(window).off("resize.w2ui-"+t.name):w2ui[t.name].resize()},resizeStart:n,mouseMove:o,mouseUp:r},$(window).on("resize.w2ui-"+t.name,t.tmp.events.resize)})(),t.resize()},0),(new Date).getTime()-i}function n(h,u){if(t.box){u||(u=window.event),$(document).off("mousemove",t.tmp.events.mouseMove).on("mousemove",t.tmp.events.mouseMove),$(document).off("mouseup",t.tmp.events.mouseUp).on("mouseup",t.tmp.events.mouseUp),t.tmp.resize={type:h,x:u.screenX,y:u.screenY,diff_x:0,diff_y:0,value:0};for(let g=0;g<w2panels.length;g++){let c=$(t.el(w2panels[g])).parent().find(".w2ui-lock");c.length>0?c.attr("locked","previous"):t.lock(w2panels[g],{opacity:0})}("left"==h||"right"==h)&&(t.tmp.resize.value=parseInt($("#layout_"+t.name+"_resizer_"+h)[0].style.left)),("top"==h||"preview"==h||"bottom"==h)&&(t.tmp.resize.value=parseInt($("#layout_"+t.name+"_resizer_"+h)[0].style.top))}}function r(h){if(t.box&&(h||(h=window.event),$(document).off("mousemove",t.tmp.events.mouseMove),$(document).off("mouseup",t.tmp.events.mouseUp),null!=t.tmp.resize)){for(let u=0;u<w2panels.length;u++){let g=$(t.el(w2panels[u])).parent().find(".w2ui-lock");"previous"==g.attr("locked")?g.removeAttr("locked"):t.unlock(w2panels[u])}if(0!==t.tmp.diff_x||0!==t.tmp.resize.diff_y){let k,E,u=t.get("top"),g=t.get("bottom"),c=t.get(t.tmp.resize.type),m=parseInt($(t.box).height()),w=parseInt($(t.box).width()),_=String(c.size);switch(t.tmp.resize.type){case"top":k=parseInt(c.sizeCalculated)+t.tmp.resize.diff_y,E=0;break;case"bottom":k=parseInt(c.sizeCalculated)-t.tmp.resize.diff_y,E=0;break;case"preview":k=parseInt(c.sizeCalculated)-t.tmp.resize.diff_y,E=(u&&!u.hidden?u.sizeCalculated:0)+(g&&!g.hidden?g.sizeCalculated:0);break;case"left":k=parseInt(c.sizeCalculated)+t.tmp.resize.diff_x,E=0;break;case"right":k=parseInt(c.sizeCalculated)-t.tmp.resize.diff_x,E=0}c.size="%"==_.substr(_.length-1)?Math.floor(100*k/("left"==c.type||"right"==c.type?w:m-E)*100)/100+"%":"-"==String(c.size).substr(0,1)?parseInt(c.size)-c.sizeCalculated+k:k,t.resize()}$("#layout_"+t.name+"_resizer_"+t.tmp.resize.type).removeClass("active"),delete t.tmp.resize}}function o(h){if(!t.box||(h||(h=window.event),null==t.tmp.resize))return;let u=t.get(t.tmp.resize.type),g=t.tmp.resize,c=t.trigger({phase:"before",type:"resizing",target:t.name,object:u,originalEvent:h,panel:g?g.type:"all",diff_x:g?g.diff_x:0,diff_y:g?g.diff_y:0});if(!0===c.isCancelled)return;let m=$("#layout_"+t.name+"_resizer_"+g.type),w=h.screenX-g.x,_=h.screenY-g.y,k=t.get("main");switch(m.hasClass("active")||m.addClass("active"),g.type){case"left":u.minSize-w>u.width&&(w=u.minSize-u.width),u.maxSize&&u.width+w>u.maxSize&&(w=u.maxSize-u.width),k.minSize+w>k.width&&(w=k.width-k.minSize);break;case"right":u.minSize+w>u.width&&(w=u.width-u.minSize),u.maxSize&&u.width-w>u.maxSize&&(w=u.width-u.maxSize),k.minSize-w>k.width&&(w=k.minSize-k.width);break;case"top":u.minSize-_>u.height&&(_=u.minSize-u.height),u.maxSize&&u.height+_>u.maxSize&&(_=u.maxSize-u.height),k.minSize+_>k.height&&(_=k.height-k.minSize);break;case"preview":case"bottom":u.minSize+_>u.height&&(_=u.height-u.minSize),u.maxSize&&u.height-_>u.maxSize&&(_=u.height-u.maxSize),k.minSize-_>k.height&&(_=k.minSize-k.height)}switch(g.diff_x=w,g.diff_y=_,g.type){case"top":case"preview":case"bottom":g.diff_x=0,m.length>0&&(m[0].style.top=g.value+g.diff_y+"px");break;case"left":case"right":g.diff_y=0,m.length>0&&(m[0].style.left=g.value+g.diff_x+"px")}t.trigger($.extend(c,{phase:"after"}))}}refresh(e){let t=this;null==e&&(e=null);let i=(new Date).getTime(),s=t.trigger({phase:"before",type:"refresh",target:null!=e?e:t.name,object:t.get(e)});if(!0!==s.isCancelled){if("string"==typeof e){let l=t.get(e);if(null==l)return;let n="#layout_"+t.name+"_panel_"+l.type,r="#layout_"+t.name+"_resizer_"+l.type;$(n).css({display:l.hidden?"none":"block"}),l.resizable?$(r).show():$(r).hide(),"object"==typeof l.html&&"function"==typeof l.html.render?(l.html.box=$(n+"> .w2ui-panel-content")[0],setTimeout(()=>{$(n+"> .w2ui-panel-content").length>0&&($(n+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",l.overflow)[0].style.cssText+=";"+l.style),l.html&&"function"==typeof l.html.render&&l.html.render()},1)):$(n+"> .w2ui-panel-content").length>0&&($(n+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(l.html).css("overflow",l.overflow)[0].style.cssText+=";"+l.style);let o=$(t.box).find(n+"> .w2ui-panel-tabs");l.show.tabs?0===o.find("[name="+l.tabs.name+"]").length&&null!=l.tabs?o.w2render(l.tabs):l.tabs.refresh():o.html("").removeClass("w2ui-tabs").hide(),o=$(t.box).find(n+"> .w2ui-panel-toolbar"),l.show.toolbar?0===o.find("[name="+l.toolbar.name+"]").length&&null!=l.toolbar?o.w2render(l.toolbar):l.toolbar.refresh():o.html("").removeClass("w2ui-toolbar").hide(),o=$(t.box).find(n+"> .w2ui-panel-title"),l.title?o.html(l.title).show():o.html("").hide()}else{if(0===$("#layout_"+t.name+"_panel_main").length)return void t.render();t.resize();for(let l=0;l<this.panels.length;l++)t.refresh(this.panels[l].type)}return t.trigger($.extend(s,{phase:"after"})),(new Date).getTime()-i}}resize(){if(!this.box)return!1;let e=(new Date).getTime(),t=this.tmp.resize,i=this.trigger({phase:"before",type:"resize",target:this.name,panel:t?t.type:"all",diff_x:t?t.diff_x:0,diff_y:t?t.diff_y:0});if(!0===i.isCancelled)return;this.padding<0&&(this.padding=0);let s=parseInt($(this.box).width()),l=parseInt($(this.box).height());$(this.box).find(" > div").css({width:s+"px",height:l+"px"});let I,N,L,f,H,n=this,r=this.get("main"),o=this.get("preview"),h=this.get("left"),u=this.get("right"),g=this.get("top"),c=this.get("bottom"),m=null!=o&&!0!==o.hidden,w=null!=h&&!0!==h.hidden,_=null!=u&&!0!==u.hidden,k=null!=g&&!0!==g.hidden,E=null!=c&&!0!==c.hidden;for(let B=0;B<w2panels.length;B++){if("main"===w2panels[B]||(t=this.get(w2panels[B]),!t))continue;let Q=String(t.size||0);if("%"==Q.substr(Q.length-1)){let X=l;"preview"==t.type&&(X=X-(g&&!g.hidden?g.sizeCalculated:0)-(c&&!c.hidden?c.sizeCalculated:0)),t.sizeCalculated=parseInt(("left"==t.type||"right"==t.type?s:X)*parseFloat(t.size)/100)}else t.sizeCalculated=parseInt(t.size);t.sizeCalculated=Math.max(t.sizeCalculated,parseInt(t.minSize))}"-"==String(u.size).substr(0,1)&&(w&&"-"==String(h.size).substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):u.sizeCalculated=s-(w?h.sizeCalculated:0)+parseInt(u.size)),"-"==String(h.size).substr(0,1)&&(_&&"-"==String(u.size).substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):h.sizeCalculated=s-(_?u.sizeCalculated:0)+parseInt(h.size)),null!=g&&!0!==g.hidden?(I=0,N=0,L=s,f=g.sizeCalculated,$("#layout_"+this.name+"_panel_top").css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px"}).show(),g.width=L,g.height=f,g.resizable&&(N=g.sizeCalculated-(0===this.padding?this.resizer:0),f=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(B){let Q=n.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:B});if(!0!==Q.isCancelled)return w2ui[n.name].tmp.events.resizeStart("top",B),n.trigger($.extend(Q,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_top").hide(),$("#layout_"+this.name+"_resizer_top").hide()),null!=h&&!0!==h.hidden?(I=0,N=0+(k?g.sizeCalculated+this.padding:0),L=h.sizeCalculated,f=l-(k?g.sizeCalculated+this.padding:0)-(E?c.sizeCalculated+this.padding:0),H=$("#layout_"+this.name+"_panel_left"),-1!=window.navigator.userAgent.indexOf("MSIE")&&H.length>0&&H[0].clientHeight<H[0].scrollHeight&&(L+=17),H.css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px"}).show(),h.width=L,h.height=f,h.resizable&&(I=h.sizeCalculated-(0===this.padding?this.resizer:0),L=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(B){let Q=n.trigger({phase:"before",type:"resizerClick",target:"left",originalEvent:B});if(!0!==Q.isCancelled)return w2ui[n.name].tmp.events.resizeStart("left",B),n.trigger($.extend(Q,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_left").hide(),$("#layout_"+this.name+"_resizer_left").hide()),null!=u&&!0!==u.hidden?(I=s-u.sizeCalculated,N=0+(k?g.sizeCalculated+this.padding:0),L=u.sizeCalculated,f=l-(k?g.sizeCalculated+this.padding:0)-(E?c.sizeCalculated+this.padding:0),$("#layout_"+this.name+"_panel_right").css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px"}).show(),u.width=L,u.height=f,u.resizable&&(I-=this.padding,L=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(B){let Q=n.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:B});if(!0!==Q.isCancelled)return w2ui[n.name].tmp.events.resizeStart("right",B),n.trigger($.extend(Q,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_right").hide(),$("#layout_"+this.name+"_resizer_right").hide()),null!=c&&!0!==c.hidden?(I=0,N=l-c.sizeCalculated,L=s,f=c.sizeCalculated,$("#layout_"+this.name+"_panel_bottom").css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px"}).show(),c.width=L,c.height=f,c.resizable&&(N-=0===this.padding?0:this.padding,f=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(B){let Q=n.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:B});if(!0!==Q.isCancelled)return w2ui[n.name].tmp.events.resizeStart("bottom",B),n.trigger($.extend(Q,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_bottom").hide(),$("#layout_"+this.name+"_resizer_bottom").hide()),I=0+(w?h.sizeCalculated+this.padding:0),N=0+(k?g.sizeCalculated+this.padding:0),L=s-(w?h.sizeCalculated+this.padding:0)-(_?u.sizeCalculated+this.padding:0),f=l-(k?g.sizeCalculated+this.padding:0)-(E?c.sizeCalculated+this.padding:0)-(m?o.sizeCalculated+this.padding:0),H=$("#layout_"+this.name+"_panel_main"),-1!=window.navigator.userAgent.indexOf("MSIE")&&H.length>0&&H[0].clientHeight<H[0].scrollHeight&&(L+=17),H.css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px"}),r.width=L,r.height=f,null!=o&&!0!==o.hidden?(I=0+(w?h.sizeCalculated+this.padding:0),N=l-(E?c.sizeCalculated+this.padding:0)-o.sizeCalculated,L=s-(w?h.sizeCalculated+this.padding:0)-(_?u.sizeCalculated+this.padding:0),f=o.sizeCalculated,H=$("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&H.length>0&&H[0].clientHeight<H[0].scrollHeight&&(L+=17),H.css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px"}).show(),o.width=L,o.height=f,o.resizable&&(N-=0===this.padding?0:this.padding,f=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:I+"px",top:N+"px",width:L+"px",height:f+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(B){let Q=n.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:B});if(!0!==Q.isCancelled)return w2ui[n.name].tmp.events.resizeStart("preview",B),n.trigger($.extend(Q,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_preview").hide(),$("#layout_"+this.name+"_resizer_preview").hide());for(let B=0;B<w2panels.length;B++){let Q=this.get(w2panels[B]),X="#layout_"+this.name+"_panel_"+w2panels[B]+" > .w2ui-panel-",ne=0;Q&&(Q.title&&(ne+=w2utils.getSize($(X+"title").css({top:ne+"px",display:"block"}),"height")),Q.show.tabs&&(null!=Q.tabs&&w2ui[this.name+"_"+w2panels[B]+"_tabs"]&&w2ui[this.name+"_"+w2panels[B]+"_tabs"].resize(),ne+=w2utils.getSize($(X+"tabs").css({top:ne+"px",display:"block"}),"height")),Q.show.toolbar&&(null!=Q.toolbar&&w2ui[this.name+"_"+w2panels[B]+"_toolbar"]&&w2ui[this.name+"_"+w2panels[B]+"_toolbar"].resize(),ne+=w2utils.getSize($(X+"toolbar").css({top:ne+"px",display:"block"}),"height"))),$(X+"content").css({display:"block"}).css({top:ne+"px"})}return clearTimeout(this._resize_timer),this._resize_timer=setTimeout(()=>{for(let B in w2ui)if("function"==typeof w2ui[B].resize){null==w2ui[B].panels&&w2ui[B].resize();let Q=$(w2ui[B].box).parents(".w2ui-layout");Q.length>0&&Q.attr("name")==n.name&&w2ui[B].resize()}},100),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-e}destroy(){let e=this.trigger({phase:"before",type:"destroy",target:this.name});if(!0!==e.isCancelled)return null!=w2ui[this.name]&&($(this.box).find("#layout_"+this.name+"_panel_main").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&$(window).off("resize",this.tmp.events.resize),!0)}lock(e,t,i){if(-1==w2panels.indexOf(e))return void console.log("ERROR: First parameter needs to be the a valid panel name.");let s=Array.from(arguments);s[0]="#layout_"+this.name+"_panel_"+e,w2utils.lock.apply(window,s)}unlock(e,t){-1!=w2panels.indexOf(e)?w2utils.unlock("#layout_"+this.name+"_panel_"+e,t):console.log("ERROR: First parameter needs to be the a valid panel name.")}}class w2dialog extends w2event{constructor(e){super(),this.defaults={title:"",body:"",buttons:"",actions:null,style:"",color:"#000",opacity:.4,speed:.3,innerContent:[],modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showBack:!1,showMax:!1,transition:null,multiple:!1,openMaximized:!1},this.status="closed",this.onOpen=null,this.onClose=null,this.onMax=null,this.onBack=null,this.onMin=null,this.onToggle=null,this.onKeydown=null,this.onAction=null,this.onMove=null,this.onMsgOpen=null,this.onMsgClose=null}open(e){return new Promise((t,i)=>{let s=this,l=$.extend(!0,{},e);if("closing"==w2popup.status)return void setTimeout(()=>{s.open.call(s,e)},100);let r,o,h,u,g,n=$("#w2ui-popup").data("options");e=$.extend({},this.defaults,n,{title:"",body:"",buttons:""},e,{maximized:!1}),0===$("#w2ui-popup").length?(w2popup.onOpen=null,w2popup.onClose=null,w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onKeydown=null,w2popup.onAction=null,w2popup.onMove=null,w2popup.onMsgOpen=null,w2popup.onMsgClose=null):$("#w2ui-popup").data("options",e),e.onOpen&&(w2popup.onOpen=e.onOpen),e.onClose&&(w2popup.onClose=e.onClose),e.onBack&&(w2popup.onBack=e.onBack),e.onMax&&(w2popup.onMax=e.onMax),e.onMin&&(w2popup.onMin=e.onMin),e.onToggle&&(w2popup.onToggle=e.onToggle),e.onKeydown&&(w2popup.onKeydown=e.onKeydown),e.onAction&&(w2popup.onAction=e.onAction),e.onMove&&(w2popup.onMove=e.onMove),e.onMsgOpen&&(w2popup.onMsgOpen=e.onMsgOpen),e.onMsgClose&&(w2popup.onMsgClose=e.onMsgClose),e.width=parseInt(e.width),e.height=parseInt(e.height),null==window.innerHeight?(r=parseInt(document.documentElement.offsetWidth),o=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(r+=21,o+=4)):(r=parseInt(window.innerWidth),o=parseInt(window.innerHeight)),r-10<e.width&&(e.width=r-10),o-10<e.height&&(e.height=o-10);let c=(o-e.height)/2*.6,m=(r-e.width)/2;if(null!=e.actions&&(e.buttons="",Object.keys(e.actions).forEach(E=>{let I=e.actions[E];"function"==typeof I&&(e.buttons+=`<button class="w2ui-btn w2ui-popup-action" data-click='["action","${E}"]'>${E}</button>`),"object"==typeof I&&(e.buttons+=`<button class="w2ui-btn w2ui-popup-action ${I.class||""}" data-click='["action","${E}"]'\n                          style="${I.style}">${I.text||E}</button>`),"string"==typeof I&&(e.buttons+=I)})),0===$("#w2ui-popup").length){if(h=this.trigger({phase:"before",type:"open",target:"popup",options:e,present:!1}),!0===h.isCancelled)return;w2popup.status="opening",w2popup.lockScreen(e);let E="";e.showClose&&(E+='<div class="w2ui-popup-button w2ui-popup-close">\n                              <span class="w2ui-icon w2ui-icon-cross w2ui-popup-action" data-mousedown="stop" data-click="close"></span>\n                          </div>'),e.showMax&&(E+='<div class="w2ui-popup-button w2ui-popup-max">\n                              <span class="w2ui-icon w2ui-icon-box w2ui-popup-action" data-mousedown="stop" data-click="toggle"></span>\n                          </div>'),e.showBack&&(E+='<div class="w2ui-popup-button w2ui-popup-back">\n                              <span class="w2ui-icon w2ui-icon-reload w2ui-popup-action" data-mousedown="stop" data-click="back"></span>\n                          </div>'),u='<div id="w2ui-popup" class="w2ui-popup w2ui-popup-opening" style="left: '+m+"px; top: "+c+"px;     width: "+parseInt(e.width)+"px; height: "+parseInt(e.height)+'px;"></div>',$("body").append(u),$("#w2ui-popup").data("options",e);let I=$("#w2ui-popup");I.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0&&(g=I.find("div[rel=title]"),g.length>0&&(e.title=g.html(),g.remove()),g=I.find("div[rel=buttons]"),g.length>0&&(e.buttons=g.html(),g.remove()),g=I.find("div[rel=body]"),e.body=g.length>0?g.html():I.html()),u='<div class="w2ui-popup-title" style="'+(e.title?"":"display: none")+'">'+E+'</div><div class="w2ui-box" style="'+(e.title?"":"top: 0px !important;")+(e.buttons?"":"bottom: 0px !important;")+'">    <div class="w2ui-popup-body'+(e.title?"":" w2ui-popup-no-title")+(e.buttons?"":" w2ui-popup-no-buttons")+'" style="'+e.style+'">    </div></div><div class="w2ui-popup-buttons" style="'+(e.buttons?"":"display: none")+'"></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>',$("#w2ui-popup").html(u),e.title&&$("#w2ui-popup .w2ui-popup-title").append(e.title),e.buttons&&$("#w2ui-popup .w2ui-popup-buttons").append(e.buttons),e.body&&$("#w2ui-popup .w2ui-popup-body").append(e.body),setTimeout(()=>{$("#w2ui-popup").css(w2utils.cssPrefix({transition:e.speed+"s opacity, "+e.speed+"s -webkit-transform"})).removeClass("w2ui-popup-opening"),s.focus()},1),setTimeout(()=>{$("#w2ui-popup").css(w2utils.cssPrefix("transform","")),w2popup.status="open"},1e3*e.speed),setTimeout(()=>{s.trigger($.extend(h,{phase:"after"})),w2utils.bindEvents("#w2ui-popup .w2ui-popup-action",w2popup),$("#w2ui-popup").find(".w2ui-popup-body").show(),t(h)},50)}else if(!0===e.multiple)w2popup.message(l);else{if(null==w2popup._prev&&null!=w2popup._template&&s.restoreTemplate(),h=this.trigger({phase:"before",type:"open",target:"popup",options:e,present:!0}),!0===h.isCancelled)return;w2popup.status="opening",null!=n&&(!n.maximized&&(n.width!=e.width||n.height!=e.height)&&w2popup.resize(e.width,e.height),e.prevSize=e.width+"px:"+e.height+"px",e.maximized=n.maximized);let E=$("#w2ui-popup .w2ui-box").clone();E.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(e.body),"string"==typeof e.body&&E.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0&&(g=E.find("div[rel=title]"),g.length>0&&(e.title=g.html(),g.remove()),g=E.find("div[rel=buttons]"),g.length>0&&(e.buttons=g.html(),g.remove()),g=E.find("div[rel=body]"),e.body=g.length>0?g.html():E.html(),E.html(e.body)),$("#w2ui-popup .w2ui-box").after(E),e.buttons?($("#w2ui-popup .w2ui-popup-buttons").show().html("").append(e.buttons),$("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):($("#w2ui-popup .w2ui-popup-buttons").hide().html(""),$("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),e.title?($("#w2ui-popup .w2ui-popup-title").show().html((e.showClose?'<div class="w2ui-popup-button w2ui-popup-close">\n                               <span class="w2ui-icon w2ui-icon-cross w2ui-popup-action" data-mousedown="stop" data-click="close"></span>\n                             </div>':"")+(e.showMax?'<div class="w2ui-popup-button w2ui-popup-max">\n                                <span class="w2ui-icon w2ui-icon-box w2ui-popup-action" data-mousedown="stop" data-click="toggle"></span>\n                             </div>':"")+(e.showBack?'<div class="w2ui-popup-button w2ui-popup-back">\n                              <span class="w2ui-icon w2ui-icon-reload w2ui-popup-action" data-mousedown="stop" data-click="back"></span>\n                          </div>':"")).append(e.title),$("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):($("#w2ui-popup .w2ui-popup-title").hide().html(""),$("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));let I=$("#w2ui-popup .w2ui-box")[0],N=$("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(I,N,e.transition,()=>{s.restoreTemplate(),$(I).remove(),$(N).removeClass("w2ui-box-temp").addClass("w2ui-box");let L=$(N).find(".w2ui-popup-body");1==L.length&&(L[0].style.cssText=e.style,L.show()),$("#w2ui-popup").data("prev-size",null),s.focus()}),w2popup.status="open",s.trigger($.extend(h,{phase:"after"})),w2utils.bindEvents("#w2ui-popup .w2ui-popup-action",w2popup),$("#w2ui-popup").find(".w2ui-popup-body").show(),t(h)}e.openMaximized&&this.max(),e._last_focus=$(":focus"),e.keyboard&&$(document).on("keydown",this.keydown),g={resizing:!1,mvMove:function _(E){if(1!=g.resizing)return;E||(E=window.event),g.div_x=E.screenX-g.x,g.div_y=E.screenY-g.y;let I=w2popup.trigger({phase:"before",type:"move",target:"popup",div_x:g.div_x,div_y:g.div_y});!0!==I.isCancelled&&($("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+g.div_x+"px, "+g.div_y+"px, 0px)"})),w2popup.trigger($.extend(I,{phase:"after"})))},mvStop:function k(E){1==g.resizing&&(E||(E=window.event),w2popup.status="open",g.div_x=E.screenX-g.x,g.div_y=E.screenY-g.y,$("#w2ui-popup").css({left:g.pos_x+g.div_x+"px",top:g.pos_y+g.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),g.resizing=!1,$(document).off("mousemove",g.mvMove),$(document).off("mouseup",g.mvStop),g.isLocked||w2popup.unlock())}},$("#w2ui-popup .w2ui-popup-title").on("mousedown",function(E){w2popup.get().maximized||function w(E){if(E||(E=window.event),w2popup.status="moving",g.resizing=!0,g.isLocked=1==$("#w2ui-popup > .w2ui-lock").length,g.x=E.screenX,g.y=E.screenY,g.pos_x=$("#w2ui-popup").position().left,g.pos_y=$("#w2ui-popup").position().top,g.isLocked||w2popup.lock({opacity:0}),$(document).on("mousemove",g.mvMove),$(document).on("mouseup",g.mvStop),E.stopPropagation?E.stopPropagation():E.cancelBubble=!0,!E.preventDefault)return!1;E.preventDefault()}(E)})})}load(e){return new Promise((t,i)=>{if("string"==typeof e&&(e={url:e}),null==e.url)return console.log("ERROR: The url is not defined."),void i("The url is not defined");w2popup.status="loading";let s=String(e.url).split("#"),l=s[0],n=s[1];null==e&&(e={});let r=$("#w2ui-popup").data(l);null!=r?this.template(r,n):$.get(l,(o,h,u)=>{this.template(u.responseText,n,e).then(()=>{t()})})})}template(e,t,i={}){let s=$(e);return t&&(s=s.filter("#"+t)),$.extend(i,{style:s[0].style.cssText,width:s.width(),height:s.height(),title:s.find("[rel=title]").html(),body:s.find("[rel=body]").html(),buttons:s.find("[rel=buttons]").html()}),w2popup.open(i)}action(e,t){let i=this,s=$("#w2ui-popup").data("options");null!=t&&(s=$("#w2ui-message"+t).data("options"),i={parent:this,options:s,close(){w2popup.message({msgId:t})}});let l=s.actions[e],n=l;$.isPlainObject(l)&&l.onClick&&(n=l.onClick);let r=this.trigger({phase:"before",target:e,msgId:t,type:"action",action:l,originalEvent:event});!0!==r.isCancelled&&("function"==typeof n&&n.call(i,event),this.trigger($.extend(r,{phase:"after"})))}keydown(e){let t=$("#w2ui-popup").data("options");if(t&&!t.keyboard)return;let i=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:t,originalEvent:e});!0!==i.isCancelled&&(27===e.keyCode&&(e.preventDefault(),$("#w2ui-popup .w2ui-message").length>0?w2popup.message():w2popup.close()),w2popup.trigger($.extend(i,{phase:"after"})))}close(e){let t=this;if(e=$.extend({},$("#w2ui-popup").data("options"),e),0===$("#w2ui-popup").length||"closed"==this.status)return;if("opening"==this.status)return void setTimeout(()=>{w2popup.close()},100);let i=this.trigger({phase:"before",type:"close",target:"popup",options:e});!0!==i.isCancelled&&(w2popup.status="closing",$("#w2ui-popup").css(w2utils.cssPrefix({transition:e.speed+"s opacity, "+e.speed+"s -webkit-transform"})).addClass("w2ui-popup-closing"),w2popup.unlockScreen(e),setTimeout(()=>{t.restoreTemplate(),$("#w2ui-popup").remove(),w2popup.status="closed",e._last_focus&&e._last_focus.length>0&&e._last_focus.focus(),t.trigger($.extend(i,{phase:"after"}))},1e3*e.speed),e.keyboard&&$(document).off("keydown",this.keydown))}toggle(){let e=this,t=$("#w2ui-popup").data("options"),i=this.trigger({phase:"before",type:"toggle",target:"popup",options:t});!0!==i.isCancelled&&(!0===t.maximized?w2popup.min():w2popup.max(),setTimeout(()=>{e.trigger($.extend(i,{phase:"after"}))},1e3*t.speed+50))}back(){if($("#w2ui-popup").data("options"),0!=BACKUP.length){var t=BACKUP[BACKUP.length-2];setTimeout(()=>{Object.keys(t).forEach(i=>{$(t[i]).w2render(i),w2ui[i].resize(),w2ui[i].refresh(),w2ui[i].tabs.click(w2ui[i].tabs.active)})},100),BACKUP.shift(),this.showBack=BACKUP.length>1,!1===this.showBack&&$(".w2ui-popup-back").remove()}}max(){let e=this,t=$("#w2ui-popup").data("options");if(!0===t.maximized)return;let i=this.trigger({phase:"before",type:"max",target:"popup",options:t});!0!==i.isCancelled&&(w2popup.status="resizing",t.prevSize=$("#w2ui-popup").css("width")+":"+$("#w2ui-popup").css("height"),w2popup.resize(1e4,1e4,()=>{w2popup.status="open",t.maximized=!0,e.trigger($.extend(i,{phase:"after"})),$("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(()=>{let s=$(this).attr("name");w2ui[s]&&w2ui[s].resize&&w2ui[s].resize()})}))}min(){let e=this,t=$("#w2ui-popup").data("options");if(!0!==t.maximized)return;let i=t.prevSize.split(":"),s=this.trigger({phase:"before",type:"min",target:"popup",options:t});!0!==s.isCancelled&&(w2popup.status="resizing",w2popup.resize(parseInt(i[0]),parseInt(i[1]),()=>{w2popup.status="open",t.maximized=!1,t.prevSize=null,e.trigger($.extend(s,{phase:"after"})),$("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(()=>{let l=$(this).attr("name");w2ui[l]&&w2ui[l].resize&&w2ui[l].resize()})}))}get(){return $("#w2ui-popup").data("options")}set(e){w2popup.open(e)}clear(){$("#w2ui-popup .w2ui-popup-title").html(""),$("#w2ui-popup .w2ui-popup-body").html(""),$("#w2ui-popup .w2ui-popup-buttons").html("")}reset(){w2popup.open(w2popup.defaults)}message(e){return new Promise((t,i)=>{let s=this;$().w2tag(),"string"==typeof e&&(e={html:e,width:200,height:100}),e||(e={width:200,height:100});let l=parseInt($("#w2ui-popup").width()),n=parseInt($("#w2ui-popup").height());e.originalWidth=e.width,e.originalHeight=e.height,parseInt(e.width)<10&&(e.width=10),parseInt(e.height)<10&&(e.height=10),null==e.hideOnClick&&(e.hideOnClick=!1);let r=$("#w2ui-popup").data("options")||{},o=parseInt($("#w2ui-popup > .w2ui-popup-title").css("height"));(null==e.width||e.width>r.width-10)&&(e.width=r.width-10),(null==e.height||e.height>r.height-o-5)&&(e.height=r.height-o-5),e.originalHeight<0&&(e.height=n+e.originalHeight-o),e.originalWidth<0&&(e.width=l+2*e.originalWidth);let h=$("#w2ui-popup .w2ui-popup-title"),u=$("#w2ui-popup .w2ui-message").length;if(null!=e.actions&&(e.buttons="",Object.keys(e.actions).forEach(g=>{let c=e.actions[g];"function"==typeof c&&(e.buttons+=`<button class="w2ui-btn w2ui-popup-action" data-click='["action","${g}","${u}"]'>${g}</button>`),"object"==typeof c&&(e.buttons+=`<button class="w2ui-btn w2ui-popup-action ${c.class||""}" style="${c.style||""}"\n                          data-click='["action","${g}","${u}"]'>${c.text||g}</button>`),"string"==typeof c&&(e.buttons+=c)})),""===(e.html||"").trim()&&""===(e.body||"").trim()&&""===(e.buttons||"").trim()){let g=$("#w2ui-popup .w2ui-message").last();null!=e.msgId&&(g=$("#w2ui-message"+e.msgId)),e=g.data("options")||{};let c=s.trigger({phase:"before",type:"msgClose",msgId:g.attr("data-msgId"),target:"popup",options:e});if(!0===c.isCancelled)return;g.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+e.height+"px)"}));let m=$("#w2ui-popup .w2ui-message");m=$(m[m.length-2]).css("z-index",1500).data("msg-focus"),m&&m.length>0?m.focus():s.focus(),1==u&&w2popup.unlock(150),setTimeout(()=>{g.remove(),"function"==typeof e.onClose&&e.onClose(c),s.trigger($.extend(c,{phase:"after"})),t(c)},150)}else{(""!==(e.body||"").trim()||""!==(e.buttons||"").trim())&&(e.html='<div class="w2ui-message-body">'+e.body+'</div><div class="w2ui-message-buttons">'+e.buttons+"</div>"),$("#w2ui-popup .w2ui-message").css("z-index",1390).data("msg-focus",$(":focus")),h.css("z-index",1501),null==e.close&&(e.close=()=>{w2popup.message({msgId:u})}),$("#w2ui-popup .w2ui-box").before('<div id="w2ui-message'+u+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===h.length?"top: 0px;":"top: "+w2utils.getSize(h,"height")+"px;")+(null!=e.width?"width: "+e.width+"px; left: "+(l-e.width)/2+"px;":"left: 10px; right: 10px;")+(null!=e.height?"height: "+e.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition","0s",!0)+'" data-msgId="'+u+'" '+(!0===e.hideOnClick?'onclick="w2popup.message();"':"")+"></div>"),$("#w2ui-popup #w2ui-message"+u).data("options",e);let g=$("#w2ui-popup #w2ui-message"+u).css("display");if($("#w2ui-popup #w2ui-message"+u).css(w2utils.cssPrefix({transform:"none"==g?"translateY(-"+e.height+"px)":"translateY(0px)"})),"none"==g){$("#w2ui-popup #w2ui-message"+u).show().html(e.html),setTimeout(()=>{$("#w2ui-popup #w2ui-message"+u).css($.extend(w2utils.cssPrefix("transition",".3s",!1),w2utils.cssPrefix({transform:"none"==g?"translateY(0px)":"translateY(-"+e.height+"px)"})))},1),0===u&&w2popup.lock();let c=s.trigger({phase:"before",type:"msgOpen",msgId:u,target:"popup",options:e});if(!0===c.isCancelled)return;setTimeout(()=>{s.focus(),$("#w2ui-popup #w2ui-message"+u).css(w2utils.cssPrefix({transition:"0s"})),"function"==typeof e.onOpen&&e.onOpen(c),s.trigger($.extend(c,{phase:"after"})),w2utils.bindEvents(`#w2ui-popup #w2ui-message${u} .w2ui-popup-action`,w2popup),t(c)},350)}}})}focus(){let e=null,t=$("#w2ui-popup"),i="input:visible, button:visible, select:visible, textarea:visible, [contentEditable], .w2ui-input";$(t).find(i).off(".keep-focus");let s=$("#w2ui-popup .w2ui-message").length-1,l=$("#w2ui-popup #w2ui-message"+s);if(l.length>0){let n=$(l[l.length-1]).find("button");n.length>0&&n[0].focus(),e=l}else if(t.length>0){let n=t.find(".w2ui-popup-buttons button");n.length>0&&n[0].focus(),e=t}$(e).find(i).on("blur.keep-focus",function(n){setTimeout(()=>{let r=$(":focus");if(r.length>0&&!$(e).find(i).is(r)||r.hasClass("w2ui-popup-hidden")){let o=$(e).find(i);o.length>0&&o[0].focus()}},1)})}lock(e,t){let i=Array.prototype.slice.call(arguments,0);i.unshift($("#w2ui-popup")),w2utils.lock.apply(window,i)}unlock(e){w2utils.unlock($("#w2ui-popup"),e)}lockScreen(e){return!($("#w2ui-lock").length>0||(null==e&&(e=$("#w2ui-popup").data("options")),null==e&&(e={}),e=$.extend({},w2popup.defaults,e),$("body").append('<div id="w2ui-lock"     style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+e.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(()=>{$("#w2ui-lock").css("opacity",e.opacity).css(w2utils.cssPrefix("transition",e.speed+"s opacity"))},1),1==e.modal?$("#w2ui-lock").on("mousedown",function(){$("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}).on("mouseup",function(){setTimeout(()=>{$("#w2ui-lock").css("opacity",e.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)}).on("mousewheel",function(t){if(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!t.preventDefault)return!1;t.preventDefault()}):$("#w2ui-lock").on("mousedown",function(){w2popup.close()}),0))}unlockScreen(e){return 0!==$("#w2ui-lock").length&&(null==e&&(e=$("#w2ui-popup").data("options")),null==e&&(e={}),e=$.extend({},w2popup.defaults,e),$("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",e.speed+"s opacity")),setTimeout(()=>{$("#w2ui-lock").remove()},1e3*e.speed),!0)}resizeMessages(){$("#w2ui-popup .w2ui-message").each(()=>{let e=$(this).data("options"),t=$("#w2ui-popup");parseInt(e.width)<10&&(e.width=10),parseInt(e.height)<10&&(e.height=10);let i=parseInt(t.find("> .w2ui-popup-title").css("height")),s=parseInt(t.width()),l=parseInt(t.height());e.width=e.originalWidth,e.width>s-10&&(e.width=s-10),e.height=e.originalHeight,e.height>l-i-5&&(e.height=l-i-5),e.originalHeight<0&&(e.height=l+e.originalHeight-i),e.originalWidth<0&&(e.width=s+2*e.originalWidth),$(this).css({left:(s-e.width)/2+"px",width:e.width+"px",height:e.height+"px"})})}resize(e,t,i){let n,r,s=this,l=$("#w2ui-popup").data("options")||{};null==l.speed&&(l.speed=0),e=parseInt(e),t=parseInt(t),null==window.innerHeight?(n=parseInt(document.documentElement.offsetWidth),r=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(n+=21,r+=4)):(n=parseInt(window.innerWidth),r=parseInt(window.innerHeight)),n-10<e&&(e=n-10),r-10<t&&(t=r-10);let o=(r-t)/2*.6,h=(n-e)/2;$("#w2ui-popup").css(w2utils.cssPrefix({transition:l.speed+"s width, "+l.speed+"s height, "+l.speed+"s left, "+l.speed+"s top"})).css({top:o,left:h,width:e,height:t});let u=setInterval(()=>{s.resizeMessages()},10);setTimeout(()=>{clearInterval(u),l.width=e,l.height=t,s.resizeMessages(),"function"==typeof i&&i()},1e3*l.speed+50)}restoreTemplate(){let e=$("#w2ui-popup").data("options");if(null==e)return;let t=w2popup._template,i=e.title,s=e.body,l=e.buttons;if(w2popup._prev?(t=w2popup._prev.template,i=w2popup._prev.title,s=w2popup._prev.body,l=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template,null!=t){let n=$(t);if(0===n.length)return;"body"==$(s).attr("rel")?(i&&n.append(i),s&&n.append(s),l&&n.append(l)):n.append(s)}}}function w2alert(v,e,t){let i=jQuery;return null==e&&(e=w2utils.lang("Notification")),i("#w2ui-popup").length>0&&"closing"!=w2popup.status?w2popup.message({width:400,height:180,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+v+"</div>",actions:{Ok:{text:w2utils.lang("Ok"),onClick(){w2popup.message()}}},onOpen(){i("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose(){"function"==typeof t&&t()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:e,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+v+"</div>",actions:{Ok:{text:w2utils.lang("Ok"),onClick(){w2popup.close()}}},onOpen(s){setTimeout(()=>{i("#w2ui-popup .w2ui-popup-btn").focus()},1)},onKeydown(s){i("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose(){"function"==typeof t&&t()}}),{ok(s){return t=s,this},done(s){return t=s,this},then(s){return t=s,this}}}function w2confirm(v,e,t){let i=jQuery,s={},l={msg:"",title:w2utils.lang("Confirmation"),width:i("#w2ui-popup").length>0?400:450,height:i("#w2ui-popup").length>0?180:220,btn_yes:{text:"Yes",class:"",styel:"",click:null},btn_no:{text:"No",class:"",styel:"",click:null},focus_to_no:!1,callBack:null};return i.extend(s,l,1==arguments.length&&"object"==typeof v?v:"function"==typeof e?{msg:v,callBack:e}:{msg:v,title:e,callBack:t}),s.yes_text&&(s.btn_yes.text=s.yes_text),s.yes_class&&(s.btn_yes.class=s.yes_class),s.yes_style&&(s.btn_yes.style=s.yes_style),s.yes_onClick&&(s.btn_yes.click=s.yes_onClick),s.yes_callBack&&(s.btn_yes.click=s.yes_callBack),s.no_text&&(s.btn_no.text=s.no_text),s.no_class&&(s.btn_no.class=s.no_class),s.no_style&&(s.btn_no.style=s.no_style),s.no_onClick&&(s.btn_no.click=s.no_onClick),s.no_callBack&&(s.btn_no.click=s.no_callBack),i("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(s.width>w2popup.get().width&&(s.width=w2popup.get().width),s.height>w2popup.get().height-50&&(s.height=w2popup.get().height-50),w2popup.message({width:s.width,height:s.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+s.msg+"</div>",buttons:w2utils.settings.macButtonOrder?'<button id="No" class="w2ui-popup-btn w2ui-btn '+s.btn_no.class+'" style="'+s.btn_no.style+'">'+w2utils.lang(s.btn_no.text)+'</button><button id="Yes" class="w2ui-popup-btn w2ui-btn '+s.btn_yes.class+'" style="'+s.btn_yes.style+'">'+w2utils.lang(s.btn_yes.text)+"</button>":'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+s.btn_yes.class+'" style="'+s.btn_yes.style+'">'+w2utils.lang(s.btn_yes.text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+s.btn_no.class+'" style="'+s.btn_no.style+'">'+w2utils.lang(s.btn_no.text)+"</button>",onOpen(n){i("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",function(r){w2popup._confirm_btn=r.target.id,w2popup.message()}),"function"==typeof s.onOpen&&s.onOpen()},onClose(n){i("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm"),setTimeout(()=>{"function"==typeof s.callBack&&s.callBack(w2popup._confirm_btn),"Yes"==w2popup._confirm_btn&&"function"==typeof s.btn_yes.click&&s.btn_yes.click(),"No"==w2popup._confirm_btn&&"function"==typeof s.btn_no.click&&s.btn_no.click()},300),"function"==typeof s.onClose&&s.onClose()}})):(w2utils.isInt(s.height)||(s.height=s.height+50),w2popup.open({width:s.width,height:s.height,title:s.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+s.msg+"</div>",buttons:w2utils.settings.macButtonOrder?'<button id="No" class="w2ui-popup-btn w2ui-btn '+s.btn_no.class+'" style="'+s.btn_no.style+'">'+w2utils.lang(s.btn_no.text)+'</button><button id="Yes" class="w2ui-popup-btn w2ui-btn '+s.btn_yes.class+'" style="'+s.btn_yes.style+'">'+w2utils.lang(s.btn_yes.text)+"</button>":'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+s.btn_yes.class+'" style="'+s.btn_yes.style+'">'+w2utils.lang(s.btn_yes.text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+s.btn_no.class+'" style="'+s.btn_no.style+'">'+w2utils.lang(s.btn_no.text)+"</button>",onOpen(n){setTimeout(()=>{i("#w2ui-popup .w2ui-popup-btn").on("click",function(r){w2popup.close(),"function"==typeof s.callBack&&s.callBack(r.target.id),"Yes"==r.target.id&&"function"==typeof s.btn_yes.click&&s.btn_yes.click(),"No"==r.target.id&&"function"==typeof s.btn_no.click&&s.btn_no.click()}),s.focus_to_no?i("#w2ui-popup .w2ui-popup-btn#No").focus():i("#w2ui-popup .w2ui-popup-btn#Yes").focus(),"function"==typeof s.onOpen&&s.onOpen()},1)},onClose(n){"function"==typeof s.onClose&&s.onClose()},onKeydown(n){if(0===i("#w2ui-popup .w2ui-message").length)switch(n.originalEvent.keyCode){case 13:i("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked"),w2popup.close();break;case 27:i("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}})),{yes(n){return s.btn_yes.click=n,this},no(n){return s.btn_no.click=n,this}}}function w2prompt(v,e,t){let i=jQuery,s={},l={title:w2utils.lang("Notification"),width:i("#w2ui-popup").length>0?400:450,height:i("#w2ui-popup").length>0?180:220,label:"",value:"",attrs:"",textarea:!1,btn_ok:{text:"Ok",class:"",style:"",click:null},btn_cancel:{text:"Cancel",class:"",style:"",click:null},callBack:null,onOpen:null,onClose:null};function n(r,o){"ok"==r&&"function"==typeof s.btn_ok.click&&s.btn_ok.click(o),"cancel"==r&&"function"==typeof s.btn_cancel.click&&s.btn_cancel.click(o),"function"==typeof s.callBack&&s.callBack(r,o)}return w2popup.tmp=w2popup.tmp||{},i.extend(s,l,1==arguments.length&&"object"==typeof v?v:"function"==typeof e?{label:v,callBack:e}:{label:v,title:e,callBack:t}),s.ok_text&&(s.btn_ok.text=s.ok_text),s.ok_class&&(s.btn_ok.class=s.ok_class),s.ok_style&&(s.btn_ok.style=s.ok_style),s.ok_onClick&&(s.btn_ok.click=s.ok_onClick),s.ok_callBack&&(s.btn_ok.click=s.ok_callBack),s.cancel_text&&(s.btn_cancel.text=s.cancel_text),s.cancel_class&&(s.btn_cancel.class=s.cancel_class),s.cancel_style&&(s.btn_cancel.style=s.cancel_style),s.cancel_onClick&&(s.btn_cancel.click=s.cancel_onClick),s.cancel_callBack&&(s.btn_cancel.click=s.cancel_callBack),i("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(s.width>w2popup.get().width&&(s.width=w2popup.get().width),s.height>w2popup.get().height-50&&(s.height=w2popup.get().height-50),w2popup.message({width:s.width,height:s.height,body:s.textarea?'<div class="w2ui-prompt textarea">  <div>'+s.label+'</div>  <textarea id="w2prompt" class="w2ui-input" '+s.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered">  <label>'+s.label+'</label>  <input id="w2prompt" class="w2ui-input" '+s.attrs+"></div>",buttons:w2utils.settings.macButtonOrder?'<button id="Cancel" class="w2ui-popup-btn w2ui-btn '+s.btn_cancel.class+'" style="'+s.btn_cancel.style+'">'+s.btn_cancel.text+'</button><button id="Ok" class="w2ui-popup-btn w2ui-btn '+s.btn_ok.class+'" style="'+s.btn_ok.style+'">'+s.btn_ok.text+"</button>":'<button id="Ok" class="w2ui-popup-btn w2ui-btn '+s.btn_ok.class+'" style="'+s.btn_ok.style+'">'+s.btn_ok.text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn '+s.btn_cancel.class+'" style="'+s.btn_cancel.style+'">'+s.btn_cancel.text+"</button>",onOpen(){i("#w2prompt").val(s.value).off(".w2prompt").on("keydown.w2prompt",function(r){13==r.keyCode&&i("#w2ui-popup .w2ui-message .w2ui-btn#Ok").click()}),i("#w2ui-popup .w2ui-message .w2ui-btn#Ok").off(".w2prompt").on("click.w2prompt",function(r){w2popup.tmp.btn="ok",w2popup.tmp.value=i("#w2prompt").val(),w2popup.message()}),i("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").off(".w2prompt").on("click.w2prompt",function(r){w2popup.tmp.btn="cancel",w2popup.tmp.value=null,w2popup.message()}),setTimeout(()=>{i("#w2prompt").focus()},100),"function"==typeof s.onOpen&&s.onOpen()},onClose(){i("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt"),setTimeout(()=>{n(w2popup.tmp.btn,w2popup.tmp.value)},300),"function"==typeof s.onClose&&s.onClose()}})):(w2utils.isInt(s.height)||(s.height=s.height+50),w2popup.open({width:s.width,height:s.height,title:s.title,modal:!0,showClose:!1,body:s.textarea?'<div class="w2ui-prompt">  <div>'+s.label+'</div>  <textarea id="w2prompt" class="w2ui-input" '+s.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered" style="font-size: 13px;">  <label>'+s.label+'</label>  <input id="w2prompt" class="w2ui-input" '+s.attrs+"></div>",buttons:w2utils.settings.macButtonOrder?'<button id="Cancel" class="w2ui-popup-btn w2ui-btn '+s.btn_cancel.class+'" style="'+s.btn_cancel.style+'">'+s.btn_cancel.text+'</button><button id="Ok" class="w2ui-popup-btn w2ui-btn '+s.btn_ok.class+'" style="'+s.btn_ok.style+'">'+s.btn_ok.text+"</button>":'<button id="Ok" class="w2ui-popup-btn w2ui-btn '+s.btn_ok.class+'" style="'+s.btn_ok.style+'">'+s.btn_ok.text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn '+s.btn_cancel.class+'" style="'+s.btn_cancel.style+'">'+s.btn_cancel.text+"</button>",onOpen(r){setTimeout(()=>{i("#w2prompt").val(s.value),i("#w2prompt").w2field("text"),i("#w2ui-popup .w2ui-popup-btn#Ok").on("click",function(o){w2popup.tmp.btn="ok",w2popup.tmp.value=i("#w2prompt").val(),w2popup.close()}),i("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",function(o){w2popup.tmp.btn="cancel",w2popup.tmp.value=null,w2popup.close()}),i("#w2ui-popup .w2ui-popup-btn#Ok"),setTimeout(()=>{i("#w2prompt").focus()},100),"function"==typeof s.onOpen&&s.onOpen()},1)},onClose(r){n(w2popup.tmp.btn,w2popup.tmp.value),"function"==typeof s.onClose&&s.onClose()},onKeydown(r){if(0===i("#w2ui-popup .w2ui-message").length)switch(r.originalEvent.keyCode){case 13:i("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked");break;case 27:w2popup.tmp.btn="cancel",w2popup.tmp.value=null}}})),{change(r){return i("#w2prompt").on("keyup",r).keyup(),this},ok(r){return s.btn_ok.click=r,this},cancel(r){return s.btn_cancel.click=r,this}}}let w2popup=new w2dialog;class w2tabs extends w2event{constructor(e){super(e.name),this.box=null,this.name=null,this.active=null,this.reorder=!1,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.tmp={},this.right="",this.style="",this.onClick=null,this.onClose=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.tab_template={id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null};let t=e.tabs;delete e.tabs,$.extend(!0,this,e),Array.isArray(t)&&this.add(t)}add(e){return this.insert(null,e)}insert(e,t){Array.isArray(t)||(t=[t]),t.forEach(i=>{if(null==i.id)return void console.log(`ERROR: The parameter "id" is required but not supplied. (obj: ${this.name})`);if(!w2utils.checkUniqueId(i.id,this.tabs,"tabs",this.name))return;let s=Object.assign({},this.tab_template,i);if(null==e)this.tabs.push(s),this.animateInsert(null,s);else{let l=this.get(e,!0),n=this.tabs[l].id;this.tabs.splice(l,0,s),this.animateInsert(n,s)}})}remove(){let e=0;return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||(e++,this.tabs.splice(this.get(i.id,!0),1),$(this.box).find(`#tabs_${this.name}_tab_${w2utils.escapeId(i.id)}`).remove())}),this.resize(),e}select(e){return console.log(e),this.active!=e&&null!=this.get(e)&&(this.active=e,this.refresh(),!0)}set(e,t){console.log(e);let i=this.get(e,!0);return null!=i&&($.extend(this.tabs[i],t),this.refresh(e),!0)}get(e,t){if(0===arguments.length){let i=[];for(let s=0;s<this.tabs.length;s++)null!=this.tabs[s].id&&i.push(this.tabs[s].id);return i}for(let i=0;i<this.tabs.length;i++)if(this.tabs[i].id==e)return!0===t?i:this.tabs[i];return null}show(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||!1===i.hidden||(i.hidden=!1,e.push(i.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.resize()})},15),e}hide(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||!0===i.hidden||(i.hidden=!0,e.push(i.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.resize()})},15),e}enable(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||!1===i.disabled||(i.disabled=!1,e.push(i.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}disable(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||!0===i.disabled||(i.disabled=!0,e.push(i.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}dragMove(e){if(!this.tmp.reordering)return;let t=this,i=this.tmp.moving,s=this.tabs[i.index],l=o(i.index,1),n=o(i.index,-1),r=$("#tabs_"+this.name+"_tab_"+w2utils.escapeId(s.id));if(i.divX>0&&l){let h=$("#tabs_"+this.name+"_tab_"+w2utils.escapeId(l.id)),u=parseInt(r.css("width")),g=parseInt(h.css("width"));if(u<g?(u=Math.floor(u/3),g-=u):(u=Math.floor(g/3),g-=u),i.divX>g){let c=this.tabs.indexOf(l);return this.tabs.splice(i.index,0,this.tabs.splice(c,1)[0]),i.$tab.before(h),i.$tab.css("opacity",0),void Object.assign(this.tmp.moving,{index:c,divX:-u,x:e.pageX+u,left:i.left+i.divX+u})}}if(i.divX<0&&n){let h=$("#tabs_"+this.name+"_tab_"+w2utils.escapeId(n.id)),u=parseInt(r.css("width")),g=parseInt(h.css("width"));if(u<g?(u=Math.floor(u/3),g-=u):(u=Math.floor(g/3),g-=u),Math.abs(i.divX)>g){let c=this.tabs.indexOf(n);return this.tabs.splice(i.index,0,this.tabs.splice(c,1)[0]),h.before(i.$tab),i.$tab.css("opacity",0),void Object.assign(i,{index:c,divX:u,x:e.pageX-u,left:i.left+i.divX-u})}}function o(h,u){let g=t.tabs[h+=u];return g&&g.hidden&&(g=o(h,u)),g}}tooltipShow(e,t,i){let s=this.get(e),l=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e));if(null==this.tooltip||s.disabled||this.tmp.reordering)return;let n=this.tooltip,r=s.tooltip;"function"==typeof r&&(r=r.call(this,s)),l.prop("_mouse_over",!0),setTimeout(()=>{!0===l.prop("_mouse_over")&&!0!==l.prop("_mouse_tooltip")&&(l.prop("_mouse_tooltip",!0),l.w2tag(w2utils.lang(r,!0),{position:n})),1==i&&l.w2tag(w2utils.lang(r,!0),{position:n})},1)}tooltipHide(e){let t=this.get(e),i=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e));null==this.tooltip||t.disabled||this.tmp.reordering||(i.removeProp("_mouse_over"),setTimeout(()=>{!0!==i.prop("_mouse_over")&&!0===i.prop("_mouse_tooltip")&&(i.removeProp("_mouse_tooltip"),i.w2tag())},1))}getTabHTML(e){let t=this.get(e,!0),i=this.tabs[t];if(null==i)return!1;null==i.text&&null!=i.caption&&(i.text=i.caption),null==i.tooltip&&null!=i.hint&&(i.tooltip=i.hint),null!=i.caption&&console.log("NOTICE: tabs tab.caption property is deprecated, please use tab.text. Tab -> ",i),null!=i.hint&&console.log("NOTICE: tabs tab.hint property is deprecated, please use tab.tooltip. Tab -> ",i);let s=i.text;"function"==typeof s&&(s=s.call(this,i)),null==s&&(s="");let l="",n="";return i.hidden&&(n+="display: none;"),i.disabled&&(n+="opacity: 0.2;"),i.closable&&!i.disabled&&(l=`<div class="w2ui-tab-close w2ui-action ${this.active===i.id?"active":""}"\n              data-mouseenter='["tooltipShow", "${i.id}", "event"]'\n              data-mouseleave='["tooltipHide", "${i.id}", "event"]'\n              data-mousedown="stop"\n              data-mouseup='["clickClose", "${i.id}", "event"]'>\n          </div>`),`\n          <div id="tabs_${this.name}_tab_${i.id}" style="${n} ${i.style}"\n             class="w2ui-tab w2ui-action ${this.active===i.id?"active":""} ${i.closable?"closable":""} ${i.class?i.class:""}"\n             data-mouseenter ='["tooltipShow", "${i.id}", "event"]'\n             data-mouseleave ='["tooltipHide", "${i.id}", "event"]'\n             data-mousedown  ='["initReorder", "${i.id}", "event"]'\n             data-click      ='["click", "${i.id}", "event"]'\n             >\n                  ${w2utils.lang(s,!0)+l}\n          </div>`}refresh(e){let t=(new Date).getTime();"up"==this.flow?$(this.box).addClass("w2ui-tabs-up"):$(this.box).removeClass("w2ui-tabs-up");let i=this.trigger({phase:"before",type:"refresh",target:null!=e?e:this.name,object:this.get(e)});if(!0!==i.isCancelled){if(null==e)for(let s=0;s<this.tabs.length;s++)this.refresh(this.tabs[s].id);else{let s="#tabs_"+this.name+"_tab_"+w2utils.escapeId(e),l=$(this.box).find(s),n=this.getTabHTML(e);0===l.length?$(this.box).find("#tabs_"+this.name+"_right").before(n):0==$(this.box).find(".tab-animate-insert").length&&l.replaceWith(n),w2utils.bindEvents(`${s}, ${s} .w2ui-action`,this)}return $("#tabs_"+this.name+"_right").html(this.right),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}}render(e){let t=(new Date).getTime(),i=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(!0===i.isCancelled)return;if(null!=e&&($(this.box).find("#tabs_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=e),!this.box)return!1;let s=`\n          <div class="w2ui-tabs-line"></div>\n          <div class="w2ui-scroll-wrapper w2ui-action" data-mousedown="resize">\n              <div id="tabs_${this.name}_right" class="w2ui-tabs-right">${this.right}</div>\n          </div>\n          <div class="w2ui-scroll-left w2ui-action" data-click='["scroll","left"]'></div>\n          <div class="w2ui-scroll-right w2ui-action" data-click='["scroll","right"]'></div>`;return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(s),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),w2utils.bindEvents($(this.box).find(".w2ui-action"),this),this.trigger($.extend(i,{phase:"after"})),this.refresh(),this.resize(),(new Date).getTime()-t}initReorder(e,t){if(!this.reorder)return;let r,i=this,s=$("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e)),l=this.get(e,!0),n=s.clone();n.attr("id","#tabs_"+this.name+"_tab_ghost"),this.tmp.moving={index:l,indexFrom:l,$tab:s,$ghost:n,divX:0,left:s.offset().left,parentX:$(this.box).offset().left,x:t.pageX,opacity:s.css("opacity")},$("body").off(".w2uiTabReorder").on("mousemove.w2uiTabReorder",function(o){if(!i.tmp.reordering){if(r=i.trigger({phase:"before",type:"reorder",target:i.tabs[l].id,indexFrom:l,tab:i.tabs[l]}),!0===r.isCancelled)return;$().w2tag(),i.tmp.reordering=!0,n.addClass("moving"),n.css({"pointer-events":"none",position:"absolute",left:s.offset().left}),s.css("opacity",0),$(i.box).find(".w2ui-scroll-wrapper").append(n),$(i.box).find(".w2ui-tab-close").hide()}i.tmp.moving.divX=o.pageX-i.tmp.moving.x,n.css("left",i.tmp.moving.left-i.tmp.moving.parentX+i.tmp.moving.divX+"px"),i.dragMove(o)}).on("mouseup.w2uiTabReorder",function(){$("body").off(".w2uiTabReorder"),n.css({transition:"0.1s",left:i.tmp.moving.$tab.offset().left-i.tmp.moving.parentX}),$(i.box).find(".w2ui-tab-close").show(),setTimeout(()=>{n.remove(),s.css({opacity:i.tmp.moving.opacity}),i.tmp.reordering&&i.trigger($.extend(r,{phase:"after",indexTo:i.tmp.moving.index})),i.tmp.reordering=!1},100)})}scroll(e,t){let i=$(this.box),s=this,l=i.find(".w2ui-scroll-wrapper"),n=l.scrollLeft(),r=i.find(".w2ui-tabs-right"),o=l.outerWidth(),h=n+parseInt(r.offset().left)+parseInt(r.width()),u=!1;switch(e){case"left":u=n-o+50,u<=0&&(u=0);break;case"right":u=n+o-50,u>=h-o&&(u=h-o)}!1!==u&&l.animate({scrollLeft:u},t?0:300,function(){s.resize()})}scrollIntoView(e,t,i){let s=this;null==e&&(e=s.active);let l=s.get(e);if(null==l)return;let n=$(s.box),r=n.find(".w2ui-scroll-wrapper"),o=n.find("#tabs_"+s.name+"_tab_"+w2utils.escapeId(e)),h=o.offset().left-r.offset().left;r.animate({scrollLeft:r.scrollLeft()+h-r.width()/2+o.width()},t?0:350,"linear",function(){s.resize(),"function"==typeof i&&i(e,l)})}resize(){let e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});if(!0===t.isCancelled)return;let i=$(this.box);i.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();let s=i.find(".w2ui-scroll-wrapper"),l=$(i).find(".w2ui-tabs-right"),n=s.outerWidth(),r=l.length>0?l[0].offsetLeft+l[0].clientWidth:0,o=parseInt(i.css("padding-right"));if(n<r-o){s.scrollLeft()>0&&i.find(".w2ui-scroll-left").show();let h=parseInt(s.css("padding-right"));n<r-s.scrollLeft()-o-h&&i.find(".w2ui-scroll-right").show()}return this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}destroy(){let e=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==e.isCancelled&&($(this.box).find("#tabs_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))}click(e,t){let i=this.get(e);if(null==i||i.disabled||this.tmp.reordering)return!1;let s=this.trigger({phase:"before",type:"click",target:e,tab:i,object:i,originalEvent:t});if(!0===s.isCancelled)return;if($(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)).removeClass("active"),$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)).removeClass("active"),this.active=i.id,"string"==typeof i.route){let n=""!==i.route?String("/"+i.route).replace(/\/{2,}/g,"/"):"",r=w2utils.parseRoute(n);if(r.keys.length>0)for(let o=0;o<r.keys.length;o++)null!=this.routeData[r.keys[o].name]&&(n=n.replace(new RegExp(":"+r.keys[o].name,"g"),this.routeData[r.keys[o].name]));setTimeout(()=>{window.location.hash=n},1)}let l=this.tabs.findIndex(function(n){return n.id===e});if(null!=i.gridName&&""!==i.gridName&&null!=w2ui[i.gridName]){$(`#${i.gridName}_extend_grid`).length>0&&$(`#${i.gridName}_extend_grid`).remove();let n=$(".w2ui-form-box>.page-"+l).height(),r=$(`.w2ui-form-box>.page-${l}>.w2ui-column-container`).height();$(".w2ui-form-box>.page-"+l).append(`<div id="${i.gridName}_extend_grid" style="height: calc(${n}px - ${r}px); min-height:500px; width:100%;">`),$(`#${i.gridName}_extend_grid`).w2render(i.gridName),setTimeout(()=>{let o={};o[i.filterKey]=this.owner.record.Id;const h=new URLSearchParams(o).toString();w2ui[i.gridName].url.get=w2ui[i.gridName].url.get.split("?")[0]+"?"+h,w2ui[i.gridName].reload()},300)}this.trigger($.extend(s,{phase:"after"})),this.refresh(e)}clickClose(e,t){let i=this.get(e);if(null==i||i.disabled)return!1;let s=this.trigger({phase:"before",type:"close",target:e,object:this.get(e),originalEvent:t});!0!==s.isCancelled&&(this.animateClose(e).then(()=>{this.remove(e),this.trigger($.extend(s,{phase:"after"})),this.refresh()}),t.stopPropagation())}animateClose(e){return new Promise((t,i)=>{let s=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e)),l=parseInt(s.css("width")||0),n=$(`<div class="tab-animate-close" style="display: inline-block; flex-shrink: 0; width: ${l}px; transition: width 0.25s"></div>`);s.replaceWith(n),setTimeout(()=>{n.css({width:"0px"})},1),setTimeout(()=>{n.remove(),this.resize(),t()},300)})}animateInsert(e,t){return new Promise((i,s)=>{let l=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e)),n=$(this.getTabHTML(t.id));if(0==l.length)l=$(this.box).find("#tabs_tabs_right"),l.before(n),this.resize();else{n.css({opacity:0}),$(this.box).find("#tabs_tabs_right").before(n);let r=$("#"+n.attr("id")),o=parseInt(r.css("width")||0),h=$('<div class="tab-animate-insert" style="display: inline-block; flex-shrink: 0; width: 0px; transition: width 0.25s"></div>');l.before(h),n.hide(),n.insertBefore(h),setTimeout(()=>{h.css({width:o+"px"})},1),setTimeout(()=>{h.remove(),n.css({opacity:1}).show(),this.refresh(t.id),this.resize(),i()},300)}})}}class w2toolbar extends w2event{constructor(e){super(e.name),this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",this.onClick=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.item_template={id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,icon:null,route:null,arrow:null,style:null,group:null,items:null,selected:null,overlay:{},color:null,options:{advanced:!1,transparent:!0,html:""},onClick:null,onRefresh:null},this.tmp={badge:{}};let t=e.items;delete e.items,$.extend(!0,this,e),Array.isArray(t)&&this.add(t)}add(e){this.insert(null,e)}insert(e,t){Array.isArray(t)||(t=[t]),t.forEach((i,s,l)=>{"string"==typeof i&&(i=l[s]={id:i,text:i});let n=["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","html","break","spacer","new-line"];if(-1==n.indexOf(String(i.type)))return void console.log('ERROR: The parameter "type" should be one of the following:',n,`, but ${i.type} is supplied.`,i);if(null==i.id&&-1==["break","spacer","new-line"].indexOf(i.type))return void console.log('ERROR: The parameter "id" is required but not supplied.',i);if(null==i.type)return void console.log('ERROR: The parameter "type" is required but not supplied.',i);if(!w2utils.checkUniqueId(i.id,this.items,"toolbar",this.name))return;let r=Object.assign({},this.item_template,i);if("menu-check"==r.type?(Array.isArray(r.selected)||(r.selected=[]),Array.isArray(r.items)&&r.items.forEach(o=>{"string"==typeof o&&(o=l[s]={id:o,text:o}),o.checked&&-1==r.selected.indexOf(o.id)&&r.selected.push(o.id),!o.checked&&-1!=r.selected.indexOf(o.id)&&(o.checked=!0),null==o.checked&&(o.checked=!1)})):"menu-radio"==r.type&&Array.isArray(r.items)&&r.items.forEach((o,h,u)=>{"string"==typeof o&&(o=u[h]={id:o,text:o}),o.checked&&null==r.selected?r.selected=o.id:o.checked=!1,!o.checked&&r.selected==o.id&&(o.checked=!0),null==o.checked&&(o.checked=!1)}),null==e)this.items.push(r);else{let o=this.get(e,!0);this.items=this.items.slice(0,o).concat([r],this.items.slice(o))}r.line=r.line||1,this.refresh(r.id)}),this.resize()}remove(){let e=0;return Array.from(arguments).forEach(t=>{let i=this.get(t);if(!i||-1!=String(t).indexOf(":"))return;e++,$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(i.id)).remove();let s=this.get(i.id,!0);null!=s&&this.items.splice(s,1)}),this.resize(),e}set(e,t){let i=this.get(e);return null!=i&&(Object.assign(i,t),this.refresh(String(e).split(":")[0]),!0)}get(e,t){if(0===arguments.length){let s=[];for(let l=0;l<this.items.length;l++)null!=this.items[l].id&&s.push(this.items[l].id);return s}let i=String(e).split(":");for(let s=0;s<this.items.length;s++){let l=this.items[s];if(-1!=["menu","menu-radio","menu-check"].indexOf(l.type)&&2==i.length&&l.id==i[0]){let n=l.items;"function"==typeof n&&(n=n(this));for(let r=0;r<n.length;r++){let o=n[r];if(o.id==i[1]||null==o.id&&o.text==i[1])return 1==t?r:o;if(Array.isArray(o.items))for(let h=0;h<o.items.length;h++)if(o.items[h].id==i[1]||null==o.items[h].id&&o.items[h].text==i[1])return 1==t?r:o.items[h]}}else if(l.id==i[0])return 1==t?s:l}return null}setCount(e,t,i,s){$(`#tb_${this.name}_item_${e} .w2ui-tb-count > span`).removeClass().addClass(i||"").text(t)[0].style.cssText=s||"",this.tmp.badge[e]={className:i||"",style:s||""},this.get(e).count=t}show(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||(i.hidden=!1,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.resize()})},15),e}hide(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||(i.hidden=!0,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.tooltipHide(t),this.resize()})},15),e}enable(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||(i.disabled=!1,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}disable(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||(i.disabled=!0,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.tooltipHide(t)})},15),e}check(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);!i||-1!=String(t).indexOf(":")||(i.checked=!0,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}uncheck(){let e=this,t=[];return Array.from(arguments).forEach(i=>{let s=this.get(i);!s||-1!=String(i).indexOf(":")||(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(s.type)&&s.checked&&setTimeout(()=>{$("#tb_"+e.name+"_item_"+w2utils.escapeId(s.id)).w2overlay({name:e.name,data:{"tb-item":s.id}})},1),s.checked=!1,t.push(String(i).split(":")[0]))}),setTimeout(()=>{t.forEach(i=>{this.refresh(i)})},15),t}click(e,t){let i=this,s=String(e).split(":"),l=this.get(s[0]),n=l&&l.items?w2utils.normMenu.call(this,l.items,l):[];if(s.length>1){let r=this.get(e);r&&!r.disabled&&i.menuClick({name:i.name,item:l,subItem:r,originalEvent:t})}else if(l&&!l.disabled){let r=this.trigger({phase:"before",type:"click",target:null!=e?e:this.name,item:l,object:l,originalEvent:t});if(!0===r.isCancelled)return;let o="#tb_"+this.name+"_item_"+w2utils.escapeId(l.id);if($(o).removeClass("down"),"radio"==l.type){for(let h=0;h<this.items.length;h++){let u=this.items[h];null==u||u.id==l.id||"radio"!==u.type||u.group==l.group&&u.checked&&(u.checked=!1,this.refresh(u.id))}l.checked=!0,$(o).addClass("checked")}if(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(l.type)&&(i.tooltipHide(e),l.checked?setTimeout(()=>{$("#tb_"+i.name+"_item_"+w2utils.escapeId(l.id)).w2overlay({name:i.name,data:{"tb-item":l.id}}),l.checked=!1,i.refresh(l.id)},1):setTimeout(()=>{let h=$("#tb_"+i.name+"_item_"+w2utils.escapeId(l.id));$.isPlainObject(l.overlay)||(l.overlay={});let u=(h.width()-50)/2;if(u>19&&(u=19),"drop"==l.type&&h.w2overlay(l.html,$.extend({name:i.name,left:u,top:3,data:{"tb-item":l.id}},l.overlay,{onHide(c){g()}})),-1!=["menu","menu-radio","menu-check"].indexOf(l.type)){let c="normal";"menu-radio"==l.type&&(c="radio",n.forEach(m=>{m.checked=l.selected==m.id})),"menu-check"==l.type&&(c="check",n.forEach(m=>{m.checked=!(!Array.isArray(l.selected)||-1==l.selected.indexOf(m.id))})),i.tmp.overlayEl=h,h.w2menu($.extend({name:i.name,items:n,left:u,top:3,data:{"tb-item":l.id}},l.overlay,{type:c,remove(m){i.menuClick({name:i.name,remove:!0,item:l,subItem:m.item,originalEvent:m.originalEvent,keepOpen:m.keepOpen})},select(m){i.menuClick({name:i.name,item:l,subItem:m.item,originalEvent:m.originalEvent,keepOpen:m.keepOpen})},onHide(m){g()}}))}function g(c){l.checked=!1,$(o).removeClass("checked")}-1!=["color","text-color"].indexOf(l.type)&&$(h).w2color($.extend({color:l.color,onHide(c){g(),i._tmpColor&&i.colorClick({name:i.name,item:l,color:i._tmpColor,final:!0}),delete i._tmpColor},onSelect(c){null!=c&&(i.colorClick({name:i.name,item:l,color:c}),i._tmpColor=c)}},l.options))},1)),-1!=["check","menu","menu-radio","menu-check","drop","color","text-color"].indexOf(l.type)&&(l.checked=!l.checked,l.checked?$(o).addClass("checked"):$(o).removeClass("checked")),l.route){let h=String("/"+l.route).replace(/\/{2,}/g,"/"),u=w2utils.parseRoute(h);if(u.keys.length>0)for(let g=0;g<u.keys.length;g++)h=h.replace(new RegExp(":"+u.keys[g].name,"g"),this.routeData[u.keys[g].name]);setTimeout(()=>{window.location.hash=h},1)}t&&-1!=["button","check","radio"].indexOf(l.type)&&this.tooltipShow(e,t,!0),this.trigger($.extend(r,{phase:"after"}))}}scroll(e,t){let o,i=$(this.box).find(`.w2ui-tb-line:nth-child(${t}) .w2ui-scroll-wrapper`),s=i.scrollLeft(),l=$(i).find(".w2ui-tb-right"),n=i.outerWidth(),r=s+parseInt(l.offset().left)+parseInt(l.width());switch(e){case"left":o=s-n+50,o<=0&&(o=0),i.animate({scrollLeft:o},300);break;case"right":o=s+n-50,o>=r-n&&(o=r-n),i.animate({scrollLeft:o},300)}setTimeout(()=>{this.resize()},350)}render(e){let t=(new Date).getTime(),i=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(!0===i.isCancelled||(null!=e&&($(this.box).find(".w2ui-scroll-wrapper .w2ui-tb-right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=e),!this.box))return;Array.isArray(this.right)||(this.right=[this.right]);let s="",l=0;for(let n=0;n<this.items.length;n++){let r=this.items[n];null!=r&&(null==r.id&&(r.id="item_"+n),null!=r.caption&&console.log("NOTICE: toolbar item.caption property is deprecated, please use item.text. Item -> ",r),null!=r.hint&&console.log("NOTICE: toolbar item.hint property is deprecated, please use item.tooltip. Item -> ",r),(0===n||"new-line"==r.type)&&(l++,s+=`\n                  <div class="w2ui-tb-line">\n                      <div class="w2ui-scroll-wrapper w2ui-action" data-mousedown="resize">\n                          <div class="w2ui-tb-right">${this.right[l-1]||""}</div>\n                      </div>\n                      <div class="w2ui-scroll-left w2ui-action" data-click='["scroll", "left", "${l}"]'></div>\n                      <div class="w2ui-scroll-right w2ui-action" data-click='["scroll", "right", "${l}"]'></div>\n                  </div>\n              `),r.line=l)}return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(s),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),w2utils.bindEvents($(this.box).find(".w2ui-tb-line .w2ui-action"),this),this.refresh(),this.resize(),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}refresh(e){let s,t=(new Date).getTime(),i=this.trigger({phase:"before",type:"refresh",target:null!=e?e:this.name,item:this.get(e)});if(!0===i.isCancelled)return;if(null==e){for(let o=0;o<this.items.length;o++){let h=this.items[o];null==h.id&&(h.id="item_"+o),this.refresh(h.id)}return}let l=this.get(e);if(null==l)return!1;if("function"==typeof l.onRefresh&&(s=this.trigger({phase:"before",type:"refresh",target:e,item:l,object:l}),!0===s.isCancelled))return;let n=$(this.box).find(`#tb_${this.name}_item_${w2utils.escapeId(l.id)}`),r=this.getItemHTML(l);if(this.tooltipHide(e,{}),"spacer"==l.type&&$(this.box).find(`.w2ui-tb-line:nth-child(${l.line}`).find(".w2ui-tb-right").css("width","auto"),0===n.length){let o=parseInt(this.get(e,!0))+1,h=$(this.box).find(`#tb_${this.name}_item_${w2utils.escapeId(this.items[o]?this.items[o].id:"")}`);0==h.length?h=$(this.box).find(`.w2ui-tb-line:nth-child(${l.line}`).find(".w2ui-tb-right").before(r):h.after(r),w2utils.bindEvents(`#tb_${this.name}_item_${w2utils.escapeId(l.id)}`,this)}else{if(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(l.type)){let o=$("#w2ui-overlay-"+this.name);o.length>0&&(0==l.checked?o[0].hide():-1!=["menu","menu-radio","menu-check"].indexOf(l.type)&&$(this.tmp.overlayEl).w2menu("refresh",{items:l.items}))}n.replaceWith($(r)),n.css("display",l.hidden?"none":""),l.disabled?n.addClass("disabled"):n.removeClass("disabled"),w2utils.bindEvents(`#tb_${this.name}_item_${w2utils.escapeId(l.id)}`,this)}return"function"==typeof l.onRefresh&&this.trigger($.extend(s,{phase:"after"})),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}resize(){let e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==t.isCancelled)return $(this.box).find(".w2ui-tb-line").each((i,s)=>{let l=$(s);l.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();let n=l.find(".w2ui-scroll-wrapper"),r=$(l).find(".w2ui-tb-right"),o=n.outerWidth(),h=r.length>0?r[0].offsetLeft+r[0].clientWidth:0,u=parseInt(l.css("padding-right"));if(o<h-u){n.scrollLeft()>0&&l.find(".w2ui-scroll-left").show();let g=parseInt(n.css("padding-right"));o<h-n.scrollLeft()-u-g&&l.find(".w2ui-scroll-right").show()}}),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}destroy(){let e=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==e.isCancelled&&($(this.box).find(".w2ui-scroll-wrapper  .w2ui-tb-right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),$(this.box).html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))}getItemHTML(e){let t="";null!=e.caption&&null==e.text&&(e.text=e.caption),null==e.text&&(e.text=""),null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint),null==e.tooltip&&(e.tooltip=""),"function"!=typeof e.get&&(Array.isArray(e.items)||"function"==typeof e.items)&&(e.get=function(n){let r=e.items;return"function"==typeof r&&(r=e.items(e)),r.find(o=>o.id==n)});let i="",s="function"==typeof e.text?e.text.call(this,e):e.text;switch(e.icon&&(i=`<div class="w2ui-tb-icon">\n                     <span class="${"function"==typeof e.icon?e.icon.call(this,e):e.icon}"></span>\n                 </div>`),e.type){case"color":case"text-color":"string"==typeof e.color&&("#"==e.color.substr(0,1)&&(e.color=e.color.substr(1)),(3==e.color.length||6==e.color.length)&&(e.color="#"+e.color)),"color"==e.type&&(s=`<span class="w2ui-tb-color-box" style="background-color: ${null!=e.color?e.color:"#fff"}"></span>\n                         ${e.text?`<div style="margin-left: 17px;">${w2utils.lang(e.text,!0)}</div>`:""}`),"text-color"==e.type&&(s='<span style="color: '+(null!=e.color?e.color:"#444")+';">'+(e.text?w2utils.lang(e.text,!0):"<b>Aa</b>")+"</span>");case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":let l=!0===e.arrow||!1!==e.arrow&&-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(e.type);t=`\n                  <div id="tb_${this.name}_item_${e.id}" style="${e.hidden?"display: none":""}"\n                      class="w2ui-tb-button${e.checked?" checked":""}${e.class?" "+e.class:""}${e.disabled?" disabled":""}${i?"":" no-icon"}"\n                      ${e.disabled?"":`data-click='["click","${e.id}"]'\n                             data-mouseenter='["mouseAction", "event", "this", "enter", "${e.id}"]'\n                             data-mouseleave='["mouseAction", "event", "this", "leave", "${e.id}"]'\n                             data-mousedown='["mouseAction", "event", "this", "down", "${e.id}"]'\n                             data-mouseup='["mouseAction", "event", "this", "up", "${e.id}"]'`}\n                  >\n                      ${i}\n                      ${""!=s?`<div class="w2ui-tb-text" style="${e.style?e.style:""}">\n                                  ${w2utils.lang(s,!0)}\n                                  ${null!=e.count?`<span class="w2ui-tb-count">\n                                              <span class="${this.tmp.badge[e.id]&&this.tmp.badge[e.id].className||""}"\n                                                  style="${this.tmp.badge[e.id]&&this.tmp.badge[e.id].style||""}">\n                                                      ${e.count}\n                                              </span>\n                                         </span>`:""}\n                                  ${l?'<span class="w2ui-tb-down"><span></span></span>':""}\n                              </div>`:""}\n                  </div>\n              `;break;case"break":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-break">&#160;</div>`;break;case"spacer":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-spacer"></div>`;break;case"html":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-html">${"function"==typeof e.html?e.html.call(this,e):e.html}</div>`}return t}tooltipShow(e,t,i){if(null==this.tooltip)return;let s=$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(e)),l=this.get(e),n=this.tooltip,r=l.tooltip;"function"==typeof r&&(r=r.call(this,l)),clearTimeout(this._tooltipTimer),this._tooltipTimer=setTimeout(()=>{if(!0!==s.prop("_mouse_tooltip")){if(s.prop("_mouse_tooltip",!0),-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(l.type)&&1==l.checked)return;s.w2tag(w2utils.lang(r,!0),{position:n})}},0),s.prop("_mouse_tooltip")&&1==i&&s.w2tag(w2utils.lang(r,!0),{position:n})}tooltipHide(e,t){if(null==this.tooltip)return;let i=$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(e));clearTimeout(this._tooltipTimer),setTimeout(()=>{!0===i.prop("_mouse_tooltip")&&(i.removeProp("_mouse_tooltip"),i.w2tag())},1)}menuClick(e){let t=this;if(e.item&&!e.item.disabled){let i=this.trigger({phase:"before",type:!0!==e.remove?"click":"remove",target:e.item.id+":"+e.subItem.id,item:e.item,subItem:e.subItem,originalEvent:e.originalEvent});if(!0===i.isCancelled)return;let s=e.subItem,l=this.get(e.item.id),n=l.items;if("function"==typeof n&&(n=l.items()),"menu-radio"==l.type&&(l.selected=s.id,Array.isArray(n)&&n.forEach(r=>{!0===r.checked&&delete r.checked,Array.isArray(r.items)&&r.items.forEach(o=>{!0===o.checked&&delete o.checked})}),s.checked=!0),"menu-check"==l.type)if(Array.isArray(l.selected)||(l.selected=[]),null==s.group){let r=l.selected.indexOf(s.id);-1==r?(l.selected.push(s.id),s.checked=!0):(l.selected.splice(r,1),s.checked=!1)}else if(!1!==s.group){let r=[];(function h(u){u.forEach(g=>{if(g.group===s.group){let c=l.selected.indexOf(g.id);-1!=c&&(g.id!=s.id&&r.push(g.id),l.selected.splice(c,1))}Array.isArray(g.items)&&h(g.items)})})(n),-1==l.selected.indexOf(s.id)&&(l.selected.push(s.id),s.checked=!0)}if("string"==typeof s.route){let r=""!==s.route?String("/"+s.route).replace(/\/{2,}/g,"/"):"",o=w2utils.parseRoute(r);if(o.keys.length>0)for(let h=0;h<o.keys.length;h++)null!=t.routeData[o.keys[h].name]&&(r=r.replace(new RegExp(":"+o.keys[h].name,"g"),this.routeData[o.keys[h].name]));setTimeout(()=>{window.location.hash=r},1)}this.refresh(e.item.id),this.trigger($.extend(i,{phase:"after"}))}}colorClick(e){let t=this;if(e.item&&!e.item.disabled){let i=this.trigger({phase:"before",type:"click",target:e.item.id,item:e.item,color:e.color,final:e.final,originalEvent:e.originalEvent});if(!0===i.isCancelled)return;e.item.color=e.color,t.refresh(e.item.id),this.trigger($.extend(i,{phase:"after"}))}}mouseAction(e,t,i,s){let l=this.get(s);if(!l.disabled&&!l.hidden)switch(i){case"enter":$(t).addClass("over"),this.tooltipShow(s,e);break;case"leave":$(t).removeClass("over").removeClass("down"),this.tooltipHide(s,e);break;case"down":$(t).addClass("down");break;case"up":$(t).removeClass("down")}}}class w2sidebar extends w2event{constructor(e){super(e.name),this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.flatButton=!1,this.keyboard=!0,this.flat=!1,this.hasFocus=!1,this.levelPadding=12,this.skipRefresh=!1,this.tabIndex=0,this.handle={size:0,style:"",content:""},this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onMenuClick=null,this.onExpand=null,this.onCollapse=null,this.onKeydown=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.onFocus=null,this.onBlur=null,this.onFlat=null,this.node_template={id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!1,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},this.tmp={badge:{}};let t=e.nodes;delete e.nodes,$.extend(!0,this,e),Array.isArray(t)&&this.add(t)}add(e,t){return 1==arguments.length&&(t=arguments[0],e=this),"string"==typeof e&&(e=this.get(e)),(null==e||""==e)&&(e=this),this.insert(e,null,t)}insert(e,t,i){let s,l,n,r,o;if(2==arguments.length&&"string"==typeof e)if(i=arguments[1],null!=(t=arguments[0])){if(l=this.get(t),null==l)return Array.isArray(i)||(i=[i]),null!=i[0].caption&&null==i[0].text&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",i[0]),i[0].text=i[0].caption),s=i[0].text,console.log('ERROR: Cannot insert node "'+s+'" because cannot find node "'+t+'" to insert before.'),null;e=this.get(t).parent}else e=this;"string"==typeof e&&(e=this.get(e)),(null==e||""==e)&&(e=this),Array.isArray(i)||(i=[i]);for(let h=0;h<i.length;h++)if(r=i[h],null!=typeof r.id)if(null==this.get(this,r.id)){if(n=Object.assign({},this.node_template,r),n.sidebar=this,n.parent=e,o=n.nodes||[],n.nodes=[],null==t)e.nodes.push(n);else{if(l=this.get(e,t,!0),null==l)return console.log('ERROR: Cannot insert node "'+r.text+'" because cannot find node "'+t+'" to insert before.'),null;e.nodes.splice(l,0,n)}o.length>0&&this.insert(n,null,o)}else console.log("ERROR: Cannot insert node with id="+r.id+" (text: "+r.text+") because another node with the same id already exists.");else null!=r.caption&&null==r.text&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text"),r.text=r.caption),s=r.text,console.log('ERROR: Cannot insert node "'+s+'" because it has no id.');return this.skipRefresh||this.refresh(e.id),n}remove(){let t,e=0;return Array.from(arguments).forEach(i=>{if(t=this.get(i),null==t)return;null!=this.selected&&this.selected===t.id&&(this.selected=null);let s=this.get(t.parent,i,!0);null!=s&&(t.parent.nodes[s].selected&&t.sidebar.unselect(t.id),t.parent.nodes.splice(s,1),e++)}),this.skipRefresh||(e>0&&1==arguments.length?this.refresh(t.parent.id):this.refresh()),e}set(e,t,i){if(2==arguments.length&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(let s=0;s<e.nodes.length;s++){if(e.nodes[s].id===t){let l=this.update(t,i);if(0!=Object.keys(l).length){let n=i.nodes;$.extend(e.nodes[s],i,{nodes:[]}),null!=n&&this.add(e.nodes[s],n),this.skipRefresh||this.refresh(t)}return!0}if(this.set(e.nodes[s],t,i))return!0}return!1}get(e,t,i){if(0===arguments.length){let s=[],l=this.find({});for(let n=0;n<l.length;n++)null!=l[n].id&&s.push(l[n].id);return s}if((1==arguments.length||2==arguments.length&&!0===t)&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(let s=0;s<e.nodes.length;s++){if(e.nodes[s].id==t)return!0===i?s:e.nodes[s];{let l=this.get(e.nodes[s],t,i);if(l||0===l)return l}}return null}setCount(e,t,i,s){$(`#node_${e} .w2ui-node-count`).removeClass().addClass(`w2ui-node-count ${i||""}`).text(t)[0].style.cssText=s||"",this.tmp.badge[e]={className:i||"",style:s||""},this.get(e).count=t}find(e,t,i){if(1==arguments.length&&(t=e,e=this),i||(i=[]),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return i;for(let s=0;s<e.nodes.length;s++){let l=!0;for(let n in t)e.nodes[s][n]!=t[n]&&(l=!1);l&&i.push(e.nodes[s]),e.nodes[s].nodes.length>0&&(i=this.find(e.nodes[s],t,i))}return i}sort(e,t){(!e||"object"!=typeof e)&&(e={}),null==e.foldersFirst&&(e.foldersFirst=!0),null==e.caseSensitive&&(e.caseSensitive=!1),null==e.reverse&&(e.reverse=!1),null==t&&(t=this.nodes),t.sort((i,s)=>{let l=i.nodes&&i.nodes.length>0,n=s.nodes&&s.nodes.length>0;if(!1===e.foldersFirst||!l&&!n||l&&n){let r=i.text,o=s.text;e.caseSensitive||(r=r.toLowerCase(),o=o.toLowerCase()),null!=i.order&&(r=i.order),null!=s.order&&(o=s.order);let h=w2utils.naturalCompare(r,o);return(1===h||-1===h)&e.reverse?-h:h}return l&&!n?e.reverse?1:-1:!l&&n?e.reverse?-1:1:void 0}),t.forEach(i=>{i.nodes&&i.nodes.length>0&&this.sort(e,i.nodes)})}each(e,t){null==t&&(t=this.nodes),t.forEach(i=>{e.call(this,i),i.nodes&&i.nodes.length>0&&this.each(e,i.nodes)})}search(e){let t=0,i=e.toLowerCase();return this.each(l=>{-1===l.text.toLowerCase().indexOf(i)?l.hidden=!0:(t++,s(l),l.hidden=!1)}),this.refresh(),t;function s(l){l.parent&&(l.parent.hidden=!1,s(l.parent))}}show(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);null==i||!1===i.hidden||(i.hidden=!1,e.push(i.id))}),e.length>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}hide(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);null==i||!0===i.hidden||(i.hidden=!0,e.push(i.id))}),e.length>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}enable(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);null==i||!1===i.disabled||(i.disabled=!1,e.push(i.id))}),e.length>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}disable(){let e=[];return Array.from(arguments).forEach(t=>{let i=this.get(t);null==i||!0===i.disabled||(i.disabled=!0,i.selected&&this.unselect(i.id),e.push(i.id))}),e.length>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}select(e){let t=this.get(e);if(!t||this.selected==e&&t.selected)return!1;this.unselect(this.selected);let i=$(this.box).find("#node_"+w2utils.escapeId(e));return i.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),i.length>0&&this.scrollIntoView(e,!0),t.selected=!0,this.selected=e,!0}unselect(e){0===arguments.length&&(e=this.selected);let t=this.get(e);return!!t&&(t.selected=!1,$(this.box).find("#node_"+w2utils.escapeId(e)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==e&&(this.selected=null),!0)}toggle(e){let t=this.get(e);return null!=t&&(t.plus?(this.set(e,{plus:!1}),this.expand(e),void this.refresh(e)):!(0===t.nodes.length||!t.collapsible)&&(this.get(e).expanded?this.collapse(e):this.expand(e)))}collapse(e){let t=this,i=this.get(e);if(null==i)return!1;let s=this.trigger({phase:"before",type:"collapse",target:e,object:i});return!0!==s.isCancelled?($(this.box).find("#node_"+w2utils.escapeId(e)+"_sub").slideUp(200),$(this.box).find("#node_"+w2utils.escapeId(e)+" .w2ui-expanded").removeClass("w2ui-expanded").addClass("w2ui-collapsed"),i.expanded=!1,this.trigger($.extend(s,{phase:"after"})),setTimeout(()=>{t.refresh(e)},200),!0):void 0}collapseAll(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(let t=0;t<e.nodes.length;t++)!0===e.nodes[t].expanded&&(e.nodes[t].expanded=!1),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.collapseAll(e.nodes[t]);return this.refresh(e.id),!0}expand(e){let t=this,i=this.get(e),s=this.trigger({phase:"before",type:"expand",target:e,object:i});if(!0!==s.isCancelled)return $(this.box).find("#node_"+w2utils.escapeId(e)+"_sub").slideDown(200),$(this.box).find("#node_"+w2utils.escapeId(e)+" .w2ui-collapsed").removeClass("w2ui-collapsed").addClass("w2ui-expanded"),i.expanded=!0,this.trigger($.extend(s,{phase:"after"})),setTimeout(()=>{t.refresh(e)},200),!0}expandAll(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(let t=0;t<e.nodes.length;t++)!1===e.nodes[t].expanded&&(e.nodes[t].expanded=!0),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.expandAll(e.nodes[t]);this.refresh(e.id)}expandParents(e){let t=this.get(e);return null!=t&&(t.parent&&(t.parent.expanded||(t.parent.expanded=!0,this.refresh(t.parent.id)),this.expandParents(t.parent.id)),!0)}click(e,t){let i=this,s=this.get(e);if(null==s||s.disabled||s.group)return;$(i.box).find(".w2ui-node.w2ui-selected").each((r,o)=>{let h=$(o).attr("id").replace("node_",""),u=i.get(h);null!=u&&(u.selected=!1),$(o).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});let l=$(i.box).find("#node_"+w2utils.escapeId(e)),n=$(i.box).find("#node_"+w2utils.escapeId(i.selected));l.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout(()=>{let r=i.trigger({phase:"before",type:"click",target:e,originalEvent:t,node:s,object:s});if(!0===r.isCancelled)return l.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),void n.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");if(null!=n&&(n.selected=!1),i.get(e).selected=!0,i.selected=e,"string"==typeof s.route){let o=""!==s.route?String("/"+s.route).replace(/\/{2,}/g,"/"):"",h=w2utils.parseRoute(o);if(h.keys.length>0)for(let u=0;u<h.keys.length;u++)null!=i.routeData[h.keys[u].name]&&(o=o.replace(new RegExp(":"+h.keys[u].name,"g"),i.routeData[h.keys[u].name]));setTimeout(()=>{window.location.hash=o},1)}i.trigger($.extend(r,{phase:"after"}))},1)}focus(e){let t=this,i=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:e});if(!0===i.isCancelled)return!1;this.hasFocus=!0,$(this.box).find(".w2ui-sidebar-body").addClass("w2ui-focus"),setTimeout(()=>{let s=$(t.box).find("#sidebar_"+t.name+"_focus");s.is(":focus")||s.focus()},10),this.trigger($.extend(i,{phase:"after"}))}blur(e){let t=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:e});if(!0===t.isCancelled)return!1;this.hasFocus=!1,$(this.box).find(".w2ui-sidebar-body").removeClass("w2ui-focus"),this.trigger($.extend(t,{phase:"after"}))}keydown(e){let t=this,i=t.get(t.selected);if(!0!==t.keyboard)return;i||(i=t.nodes[0]);let s=t.trigger({phase:"before",type:"keydown",target:t.name,originalEvent:e});function l(u,g){null!=u&&!u.hidden&&!u.disabled&&!u.group&&(t.click(u.id,g),setTimeout(()=>{t.scrollIntoView()},50))}function n(u,g){for(u=g(u);null!=u&&(u.hidden||u.disabled)&&!u.group;)u=g(u);return u}function o(u){if(null==u)return null;let g=u.parent,c=t.get(u.id,!0),m=c>0?h(g.nodes[c-1]):g;return null!=m&&(m.hidden||m.disabled||m.group)&&(m=o(m)),m}function h(u){if(u.expanded&&u.nodes.length>0){let g=u.nodes[u.nodes.length-1];return g.hidden||g.disabled||g.group?o(g):h(g)}return u}!0!==s.isCancelled&&((13==e.keyCode||32==e.keyCode)&&i.nodes.length>0&&t.toggle(t.selected),37==e.keyCode&&(i.nodes.length>0&&i.expanded?t.collapse(t.selected):(l(i.parent),i.parent.group||t.collapse(i.parent.id))),39==e.keyCode&&(i.nodes.length>0||i.plus)&&!i.expanded&&t.expand(t.selected),38==e.keyCode&&(null==t.get(t.selected)?l(this.nodes[0]||null):l(n(i,o))),40==e.keyCode&&(null==t.get(t.selected)?l(this.nodes[0]||null):l(n(i,function r(u,g){if(null==u)return null;let c=u.parent,m=t.get(u.id,!0),w=null;if(u.expanded&&u.nodes.length>0&&!0!==g){let _=u.nodes[0];w=_.hidden||_.disabled||_.group?r(_):_}else w=c&&m+1<c.nodes.length?c.nodes[m+1]:r(c,!0);return null!=w&&(w.hidden||w.disabled||w.group)&&(w=r(w)),w}))),-1!=$.inArray(e.keyCode,[13,32,37,38,39,40])&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()),t.trigger($.extend(s,{phase:"after"})))}scrollIntoView(e,t){if(null==e&&(e=this.selected),null==this.get(e))return;let s=$(this.box).find(".w2ui-sidebar-body"),l=$(this.box).find("#node_"+w2utils.escapeId(e)),n=l.offset().top-s.offset().top;(n+l.height()>s.height()||n<=0)&&s.animate({scrollTop:s.scrollTop()+n-s.height()/2+l.height()},t?0:250,"linear")}dblClick(e,t){let i=this.get(e),s=this.trigger({phase:"before",type:"dblClick",target:e,originalEvent:t,object:i});!0!==s.isCancelled&&(this.toggle(e),this.trigger($.extend(s,{phase:"after"})))}contextMenu(e,t){let i=this,s=i.get(e);e!=i.selected&&i.click(e);let l=i.trigger({phase:"before",type:"contextMenu",target:e,originalEvent:t,object:s,allowOnDisabled:!1});!0!==l.isCancelled&&(s.disabled&&!l.allowOnDisabled||(i.menu.length>0&&$(i.box).find("#node_"+w2utils.escapeId(e)).w2menu({items:i.menu,contextMenu:!0,originalEvent:t,onSelect(n){i.menuClick(e,parseInt(n.index),n.originalEvent)}}),t.preventDefault&&t.preventDefault(),i.trigger($.extend(l,{phase:"after"}))))}menuClick(e,t,i){let s=this,l=s.trigger({phase:"before",type:"menuClick",target:e,originalEvent:i,menuIndex:t,menuItem:s.menu[t]});!0!==l.isCancelled&&s.trigger($.extend(l,{phase:"after"}))}goFlat(){let e=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});!0!==e.isCancelled&&(this.flat=!this.flat,this.refresh(),this.trigger($.extend(e,{phase:"after"})))}render(e){let t=(new Date).getTime(),i=this,s=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(!0===s.isCancelled||(null!=e&&($(this.box).find("> div > div.w2ui-sidebar-body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=e),!this.box))return;$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><input id="sidebar_'+this.name+'_focus" '+(this.tabIndex?'tabindex="'+this.tabIndex+'"':"")+'   style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0" '+(w2utils.isIOS?"readonly":"")+'/><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-body"></div><div class="w2ui-sidebar-bottom"></div></div>'),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style);let n,l="";return 1==this.flatButton&&(l='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),(""!==this.topHTML||""!==l)&&($(this.box).find(".w2ui-sidebar-top").html(this.topHTML+l),$(this.box).find(".w2ui-sidebar-body").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-body").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+"px")),$(this.box).find("#sidebar_"+this.name+"_focus").on("focus",function(r){clearTimeout(n),i.hasFocus||i.focus(r)}).on("blur",function(r){n=setTimeout(()=>{i.hasFocus&&i.blur(r)},100)}).on("keydown",function(r){9!=r.keyCode&&w2ui[i.name].keydown.call(w2ui[i.name],r)}),$(this.box).off("mousedown").on("mousedown",function(r){setTimeout(()=>{if(-1==["INPUT","TEXTAREA","SELECT"].indexOf(r.target.tagName.toUpperCase())){let o=$(i.box).find("#sidebar_"+i.name+"_focus");if(!o.is(":focus")){if($(r.target).hasClass("w2ui-node")){let h=$(r.target).position().top+$(i.box).find(".w2ui-sidebar-top").height()+r.offsetY;o.css({top:h+"px",left:"0px"})}o.focus()}}},1)}),this.trigger($.extend(s,{phase:"after"})),this.refresh(),(new Date).getTime()-t}update(e,t){let s,i=this.get(e);if(i){let l=$(this.box).find("#node_"+w2utils.escapeId(i.id));if(i.group)t.text&&(i.text=t.text,l.find(".w2ui-group-text").replaceWith("function"==typeof i.text?i.text.call(this,i):'<span class="w2ui-group-text">'+i.text+"</span>"),delete t.text),t.class&&(i.class=t.class,s=l.data("level"),l[0].className="w2ui-node-group w2ui-level-"+s+(i.class?" "+i.class:""),delete t.class),t.style&&(i.style=t.style,l.next()[0].style=i.style+";"+(!i.hidden&&i.expanded?"":"display: none;"),delete t.style);else{if(t.icon){let n=l.find(".w2ui-node-image > span");n.length>0&&(i.icon=t.icon,n[0].className="function"==typeof i.icon?i.icon.call(this,i):i.icon,delete t.icon)}if(t.count&&(i.count=t.count,l.find(".w2ui-node-count").html(i.count),l.find(".w2ui-node-count").length>0&&delete t.count),t.class&&l.length>0&&(i.class=t.class,s=l.data("level"),l[0].className="w2ui-node w2ui-level-"+s+(i.selected?" w2ui-selected":"")+(i.disabled?" w2ui-disabled":"")+(i.class?" "+i.class:""),delete t.class),t.text&&(i.text=t.text,l.find(".w2ui-node-text").html("function"==typeof i.text?i.text.call(this,i):i.text),delete t.text),t.style&&l.length>0){let n=l.find(".w2ui-node-text");i.style=t.style,n[0].style=i.style,delete t.style}}}return t}refresh(e){let t=(new Date).getTime(),i=this.trigger({phase:"before",type:"refresh",target:null!=e?e:this.name,fullRefresh:null==e});if(!0===i.isCancelled)return;let s="";if(1==this.flatButton&&(s='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),(""!==this.topHTML||""!==s)&&($(this.box).find(".w2ui-sidebar-top").html(this.topHTML+s),$(this.box).find(".w2ui-sidebar-body").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-body").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+"px")),$(this.box).find("> div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),this.nodes.length>0&&null==this.nodes[0].parent){let c=this.nodes;this.nodes=[],this.add(this,c)}let n,r,o,h,l=this;if(null==e)n=this,o=".w2ui-sidebar-body";else{if(n=this.get(e),null==n)return;o="#node_"+w2utils.escapeId(n.id)+"_sub"}if(n!==this){let c="#node_"+w2utils.escapeId(n.id);h=g(n),$(this.box).find(c).before('<div id="sidebar_'+this.name+'_tmp"></div>'),$(this.box).find(c).remove(),$(this.box).find(o).remove(),$("#sidebar_"+this.name+"_tmp").before(h),$("#sidebar_"+this.name+"_tmp").remove()}let u={top:$(this.box).find(o).scrollTop(),left:$(this.box).find(o).scrollLeft()};$(this.box).find(o).html("");for(let c=0;c<n.nodes.length;c++)if(r=n.nodes[c],h=g(r),$(this.box).find(o).append(h),0!==r.nodes.length)this.refresh(r.id);else{let m=this.trigger({phase:"before",type:"refresh",target:r.id});if(!0===m.isCancelled)return;this.trigger($.extend(m,{phase:"after"}))}return $(this.box).find(o).scrollLeft(u.left).scrollTop(u.top),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t;function g(c){let m="",w=c.img,_=c.icon;null==_&&null==w&&(null==_&&(_=l.icon),null==w&&(w=l.img));let k=c.parent,E=0;for(;k&&null!=k.parent;)k=k.parent,E++;if(null!=c.caption&&null==c.text&&(c.text=c.caption),null!=c.caption&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",c),c.text=c.caption),Array.isArray(c.nodes)&&c.nodes.length>0&&(c.collapsible=!0),c.group)m='<div class="w2ui-node-group w2ui-level-'+E+(c.class?" "+c.class:"")+'" id="node_'+c.id+'" data-level="'+E+'"   style="'+(c.hidden?"display: none":"")+'" onclick="w2ui[\''+l.name+"'].toggle('"+c.id+"')\"   oncontextmenu=\"w2ui['"+l.name+"'].contextMenu('"+c.id+"', event);\"   onmouseout=\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover=\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(c.groupShowHide&&c.collapsible?"<span>"+w2utils.lang(!c.hidden&&c.expanded?"Hide":"Show")+"</span>":"<span></span>")+("function"==typeof c.text?c.text.call(l,c):'<span class="w2ui-group-text">'+c.text+"</span>")+'</div><div class="w2ui-node-sub" id="node_'+c.id+'_sub" style="'+c.style+";"+(!c.hidden&&c.expanded?"":"display: none;")+'"></div>',l.flat&&(m='<div class="w2ui-node-group" id="node_'+c.id+'"><span>&#160;</span></div><div id="node_'+c.id+'_sub" style="'+c.style+";"+(!c.hidden&&c.expanded?"":"display: none;")+'"></div>');else{c.selected&&!c.disabled&&(l.selected=c.id),k="",w&&(k='<div class="w2ui-node-image w2ui-icon '+w+(c.selected&&!c.disabled?" w2ui-icon-selected":"")+'"></div>'),_&&(k='<div class="w2ui-node-image"><span class="'+("function"==typeof _?_.call(l,c):_)+'"></span></div>');let I=c.text,N="",L=null!=c.count?`<div class="w2ui-node-count ${l.tmp.badge[c.id]&&l.tmp.badge[c.id].className||""}"\n                          style="${l.tmp.badge[c.id]&&l.tmp.badge[c.id].style||""}">\n                              ${c.count}\n                     </div>`:"";!0===c.collapsible&&(N='<div class="w2ui-'+(c.expanded?"expanded":"collapsed")+'"><span></span></div>'),"function"==typeof c.text&&(I=c.text.call(l,c)),m='<div class="w2ui-node w2ui-level-'+E+(c.selected?" w2ui-selected":"")+(c.disabled?" w2ui-disabled":"")+(c.class?" "+c.class:"")+'"    id="node_'+c.id+'" data-level="'+E+'" style="position: relative; '+(c.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+l.name+"'].dblClick('"+c.id+"', event);\"    oncontextmenu=\"w2ui['"+l.name+"'].contextMenu('"+c.id+"', event);\"    onClick=\"w2ui['"+l.name+"'].click('"+c.id+"', event); \">"+(l.handle.content?'<div class="w2ui-node-handle" style="width: '+l.handle.size+"px; "+l.handle.style+'">'+("function"==typeof l.handle.content?l.handle.content.call(l,c):l.handle.content)+"</div>":"")+'   <div class="w2ui-node-data" style="margin-left:'+(E*l.levelPadding+l.handle.size)+'px">'+N+k+L+'<div class="w2ui-node-text w2ui-node-caption" style="'+(c.style||"")+'">'+I+'</div>   </div></div><div class="w2ui-node-sub" id="node_'+c.id+'_sub" style="'+c.style+";"+(!c.hidden&&c.expanded?"":"display: none;")+'"></div>',l.flat&&(m='<div class="w2ui-node w2ui-level-'+E+" "+(c.selected?"w2ui-selected":"")+" "+(c.disabled?"w2ui-disabled":"")+(c.class?" "+c.class:"")+'" id="node_'+c.id+'" style="'+(c.hidden?"display: none;":"")+"\"    onmouseover=\"jQuery(this).find('.w2ui-node-data').w2tag(w2utils.base64decode('"+w2utils.base64encode(I+(c.count||0===c.count?' - <span class="w2ui-node-count">'+c.count+"</span>":""))+"'),                { id: '"+c.id+"', left: -5 })\"    onmouseout=\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+c.id+"' })\"    ondblclick=\"w2ui['"+l.name+"'].dblClick('"+c.id+"', event);\"    oncontextmenu=\"w2ui['"+l.name+"'].contextMenu('"+c.id+"', event);\"    onClick=\"w2ui['"+l.name+"'].click('"+c.id+'\', event); "><div class="w2ui-node-data w2ui-node-flat">'+k+'</div></div><div class="w2ui-node-sub" id="node_'+c.id+'_sub" style="'+c.style+";"+(!c.hidden&&c.expanded?"":"display: none;")+'"></div>')}return m}}resize(){let e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==t.isCancelled)return $(this.box).css("overflow","hidden"),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}destroy(){let e=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==e.isCancelled&&($(this.box).find("> div > div.w2ui-sidebar-body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))}lock(e,t){let i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),w2utils.lock.apply(window,i)}unlock(e){w2utils.unlock(this.box,e)}}let custom={};function addType(v,e){return v=String(v).toLowerCase(),custom[v]=e,!0}function removeType(v){return v=String(v).toLowerCase(),!!custom[v]&&(delete custom[v],!0)}class w2field extends w2event{constructor(e,t){super(),"string"==typeof e&&null==t&&(t={type:e}),"object"==typeof e&&null==t&&(t=$.extend(!0,{},e)),"string"==typeof e&&"object"==typeof t&&(t.type=e),t.type=String(t.type).toLowerCase(),this.options=t,this.el=null,this.helpers={},this.type=t.type||"text",this.options=$.extend(!0,{},t),this.onSearch=t.onSearch||null,this.onRequest=t.onRequest||null,this.onLoad=t.onLoad||null,this.onError=t.onError||null,this.onClick=t.onClick||null,this.onAdd=t.onAdd||null,this.onNew=t.onNew||null,this.onRemove=t.onRemove||null,this.onMouseOver=t.onMouseOver||null,this.onMouseOut=t.onMouseOut||null,this.onIconClick=t.onIconClick||null,this.onScroll=t.onScroll||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,delete this.options.onScroll}render(e){0!=$(e).length?(this.el=$(e)[0],this.init()):console.log("ERROR: Cannot init w2field on empty set")}init(){let i,e=this,t=this.options;if("function"!=typeof custom[this.type])if(-1!=["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())){switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":i={min:null,max:null,step:1,autoFormat:!0,autoCorrect:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,prefix:"",suffix:""},this.options=$.extend(!0,{},i,t),t=this.options,t.numberRE=new RegExp("["+t.groupSymbol+"]","g"),t.moneyRE=new RegExp("["+t.currencyPrefix+t.currencySuffix+t.groupSymbol+"]","g"),t.percentRE=new RegExp("["+t.groupSymbol+"%]","g"),-1!==["text","alphanumeric","hex","bin"].indexOf(this.type)&&(t.arrows=!1,t.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":i={prefix:"",suffix:'<div style="width: '+(parseInt($(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,advanced:null,transparent:!0},this.options=$.extend(!0,{},i,t),t=this.options,this.addPrefix(),this.addSuffix(),""!==$(this.el).val()&&setTimeout(()=>{e.change()},1);break;case"date":i={format:w2utils.settings.dateFormat,keyboard:!0,autoCorrect:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=$.extend(!0,{},i,t),t=this.options,null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",t.format);break;case"time":i={format:w2utils.settings.timeFormat,keyboard:!0,autoCorrect:!0,start:"",end:"",noMinutes:!1},this.options=$.extend(!0,{},i,t),t=this.options,null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",t.format);break;case"datetime":i={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,autoCorrect:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=$.extend(!0,{},i,t),t=this.options,null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",t.placeholder||t.format);break;case"list":case"combo":if(i={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,minDropWidth:null,match:"begins",icon:null,iconStyle:"",align:"both",altRows:!0,onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},"function"==typeof t.items&&(t._items_fun=t.items),t.items=w2utils.normMenu.call(this,t.items),"list"===this.type){if(i.openOnFocus=!0,$(this.el).addClass("w2ui-select"),!$.isPlainObject(t.selected)&&Array.isArray(t.items))for(let s=0;s<t.items.length;s++){let l=t.items[s];if(l&&l.id===t.selected){t.selected=$.extend(!0,{},l);break}}this.watchSize()}t=$.extend({},i,t),this.options=t,$.isPlainObject(t.selected)||(t.selected={}),$(this.el).data("selected",t.selected),t.url&&(t.items=[],this.request(0)),"list"===this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(()=>{e.refresh()},10),$(this.el).attr("autocapitalize","off").attr("autocomplete","off").attr("autocorrect","off").attr("spellcheck","false"),null!=t.selected.text&&$(this.el).val(t.selected.text);break;case"enum":i={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",align:"both",altRows:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},t=$.extend({},i,t,{suffix:""}),"function"==typeof t.items&&(t._items_fun=t.items),t.items=w2utils.normMenu.call(this,t.items),t.selected=w2utils.normMenu.call(this,t.selected),this.options=t,Array.isArray(t.selected)||(t.selected=[]),$(this.el).data("selected",t.selected),t.url&&(t.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":i={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,align:"both",altRows:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},t=$.extend({},i,t),this.options=t,Array.isArray(t.selected)||(t.selected=[]),$(this.el).data("selected",t.selected),null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange(s){e.change.call(e,s)},onClick(s){e.click.call(e,s)},onFocus(s){e.focus.call(e,s)},onBlur(s){e.blur.call(e,s)},onKeydown(s){e.keyDown.call(e,s)},onKeyup(s){e.keyUp.call(e,s)},onKeypress(s){e.keyPress.call(e,s)}},$(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change($.Event("change"))}else console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else custom[this.type].call(this,t)}watchSize(){let e=this,t=$(e.el).data("tmp")||{};t.sizeTimer=setInterval(()=>{$(e.el).parents("body").length>0?e.resize():clearInterval(t.sizeTimer)},200),$(e.el).data("tmp",t)}get(){let e;return e=-1!==["list","enum","file"].indexOf(this.type)?$(this.el).data("selected"):$(this.el).val(),e}set(e,t){if(-1!==["list","enum","file"].indexOf(this.type)){if("list"!==this.type&&t)null==$(this.el).data("selected")&&$(this.el).data("selected",[]),$(this.el).data("selected").push(e),$(this.el).trigger("input").trigger("change");else{let i="enum"===this.type?[e]:e;$(this.el).data("selected",i).trigger("input").trigger("change")}this.refresh()}else $(this.el).val(e)}setIndex(e,t){if(-1!==["list","enum"].indexOf(this.type)){let i=this.options.items;if(i&&i[e]){if("list"!==this.type&&t)null==$(this.el).data("selected")&&$(this.el).data("selected",[]),$(this.el).data("selected").push(i[e]),$(this.el).trigger("input").trigger("change");else{let s="enum"===this.type?[i[e]]:i[e];$(this.el).data("selected",s).trigger("input").trigger("change")}return this.refresh(),!0}}return!1}clear(){let e=this.options;-1!==["money","currency"].indexOf(this.type)&&$(this.el).val($(this.el).val().replace(e.moneyRE,"")),"percent"===this.type&&$(this.el).val($(this.el).val().replace(/%/g,"")),"list"===this.type&&$(this.el).removeClass("w2ui-select"),this.type="clear";let t=$(this.el).data("tmp");if(this.tmp){null!=t&&($(this.el).height("auto"),t&&t["old-padding-left"]&&$(this.el).css("padding-left",t["old-padding-left"]),t&&t["old-padding-right"]&&$(this.el).css("padding-right",t["old-padding-right"]),t&&t["old-background-color"]&&$(this.el).css("background-color",t["old-background-color"]),t&&t["old-border-color"]&&$(this.el).css("border-color",t["old-border-color"]),clearInterval(t.sizeTimer)),$(this.el).val(this.clean($(this.el).val())).removeClass("w2field").removeData().off(".w2field");for(let i in this.helpers)$(this.helpers[i]).remove();this.helpers={}}}refresh(){let e=this,t=this.options,i=$(this.el).data("selected"),s=(new Date).getTime();if(-1!==["list"].indexOf(this.type)&&($(e.el).parent().css("white-space","nowrap"),e.helpers.prefix&&e.helpers.prefix.hide(),setTimeout(()=>{if(!e.helpers.focus)return;!$.isEmptyObject(i)&&t.icon?(t.prefix='<span class="w2ui-icon '+t.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+t.iconStyle+'"></span>',e.addPrefix()):(t.prefix="",e.addPrefix());let l=e.helpers.focus.find("input");""===$(l).val()?($(l).css({"text-indent":"-9999em",outline:"none"}).prev().css("opacity",0),$(e.el).val(i&&null!=i.text?w2utils.lang(i.text):"")):($(l).css("text-indent",0).prev().css("opacity",1),$(e.el).val(""),setTimeout(()=>{e.helpers.prefix&&e.helpers.prefix.hide(),t.icon?($(l).css("margin-left","17px"),$(e.helpers.focus).find(".w2ui-icon-search").addClass("show-search")):($(l).css("margin-left","0px"),$(e.helpers.focus).find(".w2ui-icon-search").removeClass("show-search"))},1)),$(e.el).prop("readonly")||$(e.el).prop("disabled")?setTimeout(()=>{$(e.helpers.prefix).css("opacity","0.6"),$(e.helpers.suffix).css("opacity","0.6")},1):setTimeout(()=>{$(e.helpers.prefix).css("opacity","1"),$(e.helpers.suffix).css("opacity","1")},1)},1)),-1!==["enum","file"].indexOf(this.type)){let l="";if(i)for(let u=0;u<i.length;u++){let g=i[u],c="";c="function"==typeof t.renderItem?t.renderItem(g,u,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+u+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+u+'">&#160;&#160;</div>'+("enum"===e.type?g.text:g.name+'<span class="file-size"> - '+w2utils.formatSize(g.size)+"</span>"),l+='<li index="'+u+'" style="max-width: '+parseInt(t.maxWidth)+"px; "+(g.style?g.style:"")+'">'+c+"</li>"}let n=e.helpers.multi,r=n.find("ul");if(n.attr("style",n.attr("style")+";"+t.style),$(e.el).css("z-index","-1"),$(e.el).prop("readonly")||$(e.el).prop("disabled")?setTimeout(()=>{n[0].scrollTop=0,n.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(()=>{n.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1),n.find(".w2ui-enum-placeholder").remove(),r.find("li").not("li.nomouse").remove(),""!==l)r.prepend(l);else if(null!=$(e.el).attr("placeholder")&&""===n.find("input").val()){let u="padding-top: "+$(this.el).css("padding-top")+";padding-left: "+$(this.el).css("padding-left")+"; box-sizing: "+$(this.el).css("box-sizing")+"; line-height: "+$(this.el).css("line-height")+"; font-size: "+$(this.el).css("font-size")+"; font-family: "+$(this.el).css("font-family")+"; ";n.prepend('<div class="w2ui-enum-placeholder" style="'+u+'">'+$(e.el).attr("placeholder")+"</div>")}n.off("scroll.w2field").on("scroll.w2field",function(u){let g=e.trigger({phase:"before",type:"scroll",target:e.el,originalEvent:u});!0!==g.isCancelled&&e.trigger($.extend(g,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(u){let m,g="LI"===u.target.tagName.toUpperCase()?u.target:$(u.target).parents("LI"),c=i[$(g).attr("index")];if(!$(g).hasClass("nomouse"))if(u.stopPropagation(),$(u.target).hasClass("w2ui-list-remove")){if($(e.el).prop("readonly")||$(e.el).prop("disabled")||(m=e.trigger({phase:"before",type:"remove",target:e.el,originalEvent:u.originalEvent,item:c}),!0===m.isCancelled))return;$().w2overlay(),i.splice($(u.target).attr("index"),1),$(e.el).trigger("input").trigger("change"),$(u.target).parent().fadeOut("fast"),setTimeout(()=>{e.refresh(),e.trigger($.extend(m,{phase:"after"}))},300)}else{if(m=e.trigger({phase:"before",type:"click",target:e.el,originalEvent:u.originalEvent,item:c}),!0===m.isCancelled)return;if("file"===e.type){let w="";/image/i.test(c.type)&&(w='<div style="padding: 3px;">    <img src="'+(c.content?"data:"+c.type+";base64,"+c.content:"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');let _='style="padding: 3px; text-align: right; color: #777;"',k='style="padding: 3px"';w+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td '+_+">"+w2utils.lang("Name")+":</td><td "+k+">"+c.name+"</td></tr>    <tr><td "+_+">"+w2utils.lang("Size")+":</td><td "+k+">"+w2utils.formatSize(c.size)+"</td></tr>    <tr><td "+_+">"+w2utils.lang("Type")+":</td><td "+k+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+c.type+"</span>    </td></tr>    <tr><td "+_+">"+w2utils.lang("Modified")+":</td><td "+k+">"+w2utils.date(c.modified)+"</td></tr>    </tbody></table></div>",$("#w2ui-overlay").remove(),$(g).w2overlay(w)}e.trigger($.extend(m,{phase:"after"}))}}).on("mouseover",function(u){let g="LI"===u.target.tagName.toUpperCase()?u.target:$(u.target).parents("LI");if(!$(g).hasClass("nomouse")){if("out"===$(g).data("mouse")){let c=i[$(u.target).attr("index")],m=e.trigger({phase:"before",type:"mouseOver",target:e.el,originalEvent:u.originalEvent,item:c});if(!0===m.isCancelled)return;e.trigger($.extend(m,{phase:"after"}))}$(g).data("mouse","over")}}).on("mouseout",function(u){let g="LI"===u.target.tagName.toUpperCase()?u.target:$(u.target).parents("LI");$(g).hasClass("nomouse")||($(g).data("mouse","leaving"),setTimeout(()=>{if("leaving"===$(g).data("mouse")){$(g).data("mouse","out");let c=i[$(u.target).attr("index")],m=e.trigger({phase:"before",type:"mouseOut",target:e.el,originalEvent:u.originalEvent,item:c});if(!0===m.isCancelled)return;e.trigger($.extend(m,{phase:"after"}))}},0))}),$(this.el).height("auto");let o=$(n).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(n,"+height");o<26&&(o=26),o>t.maxHeight&&(o=t.maxHeight),n.length>0&&(n[0].scrollTop=1e3);let h=w2utils.getSize($(this.el),"height")-2;if(h>o&&(o=h),$(n).css({height:o+"px",overflow:o==t.maxHeight?"auto":"hidden"}),o<t.maxHeight&&$(n).prop("scrollTop",0),$(this.el).css({height:o+0+"px"}),"enum"===e.type){let u=e.helpers.multi.find("input");u.width(8*(u.val().length+2)+"px")}}return(new Date).getTime()-s}reset(){let e=this.type;this.clear(),this.type=e,this.init()}resize(){let e=this,t=$(e.el).width(),i=$(e.el).height();if(e.tmp.current_width==t&&i>0)return;let s=this.helpers.focus,l=this.helpers.multi,n=this.helpers.suffix,r=this.helpers.prefix;if(s&&s.width($(e.el).width()),l){let o=w2utils.getSize(e.el,"width")-parseInt($(e.el).css("margin-left"),10)-parseInt($(e.el).css("margin-right"),10);$(l).width(o)}n&&(e.options.suffix='<div class="arrow-down" style="margin-top: '+(parseInt($(e.el).height())-6)/2+'px;"></div>',e.addSuffix()),r&&e.addPrefix(),e.tmp.current_width=t}clean(e){if("number"==typeof e)return e;let t=this.options;return e=String(e).trim(),-1!==["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof e&&(t.autoFormat&&-1!==["money","currency"].indexOf(this.type)&&(e=String(e).replace(t.moneyRE,"")),t.autoFormat&&"percent"===this.type&&(e=String(e).replace(t.percentRE,"")),t.autoFormat&&-1!==["int","float"].indexOf(this.type)&&(e=String(e).replace(t.numberRE,"")),e=e.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),e=""!==e&&w2utils.isFloat(e)?Number(e):""),e}format(e){let t=this.options;if(t.autoFormat&&""!==e)switch(this.type){case"money":case"currency":""!==(e=w2utils.formatNumber(e,t.currencyPrecision,t.groupSymbol))&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":""!==(e=w2utils.formatNumber(e,t.precision,t.groupSymbol))&&(e+="%");break;case"float":e=w2utils.formatNumber(e,t.precision,t.groupSymbol);break;case"int":e=w2utils.formatNumber(e,0,t.groupSymbol)}return e}change(e){let t=this,i=t.options;if(-1!==["int","float","money","currency","percent"].indexOf(this.type)){let s=$(this.el).val(),l=this.format(this.clean($(this.el).val()));if(""!==s&&s!=l)return $(this.el).val(l).trigger("input").trigger("change"),e.stopPropagation(),e.preventDefault(),!1}if("color"===this.type){let s=$(this.el).val();if("rgb"!==s.substr(0,3).toLowerCase()){s="#"+s;let l=$(this.el).val().length;8!==l&&6!==l&&3!==l&&(s="")}$(this.el).next().find("div").css("background-color",s),$(this.el).hasClass("has-focus")&&!0!==$(this.el).data("skipInit")&&this.updateOverlay()}if(-1!==["list","enum","file"].indexOf(this.type)&&(t.refresh(),setTimeout(()=>{t.refresh()},5)),-1!==["date","time","datetime"].indexOf(this.type)){let s=parseInt(t.el.value);w2utils.isInt(t.el.value)&&s>3e3&&("time"===this.type&&$(t.el).val(w2utils.formatTime(new Date(s),i.format)).trigger("input").trigger("change"),"date"===this.type&&$(t.el).val(w2utils.formatDate(new Date(s),i.format)).trigger("input").trigger("change"),"datetime"===this.type&&$(t.el).val(w2utils.formatDateTime(new Date(s),i.format)).trigger("input").trigger("change"))}}click(e){e.stopPropagation(),-1!==["list","combo","enum"].indexOf(this.type)&&($(this.el).hasClass("has-focus")||this.focus(e),"combo"==this.type&&this.updateOverlay()),-1!==["date","time","color","datetime"].indexOf(this.type)&&this.updateOverlay()}focus(e){let t=this;if(!$(t.el).hasClass("has-focus")){if($(t.el).addClass("has-focus"),-1!==["color","date","time","datetime"].indexOf(t.type)){if($(t.el).prop("readonly")||$(t.el).prop("disabled"))return;$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),setTimeout(()=>{t.updateOverlay()},150)}if(-1!==["list","combo","enum"].indexOf(t.type)){if($(t.el).prop("readonly")||$(t.el).prop("disabled"))return;$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),t.resize(),setTimeout(()=>{"list"===t.type&&$(t.el).is(":focus")?$(t.helpers.focus).find("input").focus():(t.updateOverlay(),t.search())},1),"function"==typeof t.options._items_fun&&(t.options.items=w2utils.normMenu.call(this,t.options._items_fun))}}}blur(e){let t=this,i=t.options,s=$(t.el).val().trim(),l=$("#w2ui-overlay");if($(t.el).removeClass("has-focus"),-1!==["color","date","time","list","combo","enum","datetime"].indexOf(t.type)){let n=setTimeout(()=>{!0!==l.data("keepOpen")&&l.hide()},0);$(".menu",l).one("focus",function(){clearTimeout(n),$(this).one("focusout",function(r){l.hide()})})}if(-1!==["int","float","money","currency","percent"].indexOf(t.type)&&""!==s){let n=s,r="";if(t.checkType(s)){let o=this.clean(s);null!=i.min&&o<i.min&&(n=i.min,r=`Should be >= ${i.min}`),null!=i.max&&o>i.max&&(n=i.max,r=`Should be <= ${i.max}`)}else n="";i.autoCorrect&&($(t.el).val(n).trigger("input").trigger("change"),r&&($(t.el).w2tag(r),setTimeout(()=>{$(t.el).w2tag("")},3e3)))}-1!==["date","time","datetime"].indexOf(t.type)&&(""!==s&&!t.inRange(t.el.value)||"date"===t.type&&""!==s&&!w2utils.isDate(t.el.value,i.format)||"time"===t.type&&""!==s&&!w2utils.isTime(t.el.value)?i.autoCorrect&&$(t.el).val("").removeData("selected").trigger("input").trigger("change"):"datetime"===t.type&&""!==s&&!w2utils.isDateTime(t.el.value,i.format)&&i.autoCorrect&&$(t.el).val("").removeData("selected").trigger("input").trigger("change")),"enum"===t.type&&$(t.helpers.multi).find("input").val("").width(20)}keyPress(e){let t=this;if(-1!==["int","float","money","currency","percent","hex","bin","color","alphanumeric"].indexOf(t.type)){if(e.metaKey||e.ctrlKey||e.altKey||e.charCode!=e.keyCode&&e.keyCode>0)return;let i=String.fromCharCode(e.charCode);if(!t.checkType(i,!0)&&13!=e.keyCode)return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1}-1!==["date","time","datetime"].indexOf(t.type)&&9!==e.keyCode&&setTimeout(()=>{t.updateOverlay()},1)}keyDown(e,t){let r,o,h,u,g,c,i=this,s=i.options,l=e.keyCode||t&&t.keyCode,n=!1;if(-1!==["int","float","money","currency","percent"].indexOf(i.type)){if(!s.keyboard||$(i.el).prop("readonly")||$(i.el).prop("disabled"))return;switch(r=parseFloat($(i.el).val().replace(s.moneyRE,""))||0,o=s.step,(e.ctrlKey||e.metaKey)&&(o=10),l){case 38:if(e.shiftKey)break;g=r+o<=s.max||null==s.max?Number((r+o).toFixed(12)):s.max,$(i.el).val(g).trigger("input").trigger("change"),n=!0;break;case 40:if(e.shiftKey)break;g=r-o>=s.min||null==s.min?Number((r-o).toFixed(12)):s.min,$(i.el).val(g).trigger("input").trigger("change"),n=!0}n&&(e.preventDefault(),setTimeout(()=>{i.el.setSelectionRange(i.el.value.length,i.el.value.length)},0))}if("date"===i.type){if(!s.keyboard||$(i.el).prop("readonly")||$(i.el).prop("disabled"))return;switch(h=864e5,o=1,(e.ctrlKey||e.metaKey)&&(o=10),u=w2utils.isDate($(i.el).val(),s.format,!0),u||(u=new Date,h=0),l){case 38:if(e.shiftKey)break;c=w2utils.formatDate(u.getTime()+h,s.format),10==o&&(c=w2utils.formatDate(new Date(u.getFullYear(),u.getMonth()+1,u.getDate()),s.format)),$(i.el).val(c).trigger("input").trigger("change"),n=!0;break;case 40:if(e.shiftKey)break;c=w2utils.formatDate(u.getTime()-h,s.format),10==o&&(c=w2utils.formatDate(new Date(u.getFullYear(),u.getMonth()-1,u.getDate()),s.format)),$(i.el).val(c).trigger("input").trigger("change"),n=!0}n&&(e.preventDefault(),setTimeout(()=>{i.el.setSelectionRange(i.el.value.length,i.el.value.length),i.updateOverlay()},0))}if("time"===i.type){if(!s.keyboard||$(i.el).prop("readonly")||$(i.el).prop("disabled"))return;o=e.ctrlKey||e.metaKey?60:1,r=$(i.el).val();let m=i.toMin(r)||i.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(l){case 38:if(e.shiftKey)break;m+=o,n=!0;break;case 40:if(e.shiftKey)break;m-=o,n=!0}n&&($(i.el).val(i.fromMin(m)).trigger("input").trigger("change"),e.preventDefault(),setTimeout(()=>{i.el.setSelectionRange(i.el.value.length,i.el.value.length)},0))}if("datetime"===i.type){if(!s.keyboard||$(i.el).prop("readonly")||$(i.el).prop("disabled"))return;h=864e5,o=1,(e.ctrlKey||e.metaKey)&&(o=10);let m=$(i.el).val();switch(u=w2utils.isDateTime(m,this.options.format,!0),u||(u=new Date,h=0),l){case 38:if(e.shiftKey)break;c=w2utils.formatDateTime(u.getTime()+h,s.format),10==o&&(c=w2utils.formatDateTime(new Date(u.getFullYear(),u.getMonth()+1,u.getDate()),s.format)),$(i.el).val(c).trigger("input").trigger("change"),n=!0;break;case 40:if(e.shiftKey)break;c=w2utils.formatDateTime(u.getTime()-h,s.format),10==o&&(c=w2utils.formatDateTime(new Date(u.getFullYear(),u.getMonth()-1,u.getDate()),s.format)),$(i.el).val(c).trigger("input").trigger("change"),n=!0}n&&(e.preventDefault(),setTimeout(()=>{i.el.setSelectionRange(i.el.value.length,i.el.value.length),i.updateOverlay()},0))}if("color"===i.type){if($(i.el).prop("readonly")||$(i.el).prop("disabled"))return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){let m=null,w=null;switch(l){case 38:m="up";break;case 40:m="down";break;case 39:m="right";break;case 37:m="left"}i.el.nav&&null!=m&&(w=i.el.nav(m),$(i.el).val(w).trigger("input").trigger("change"),e.preventDefault())}}if(-1!==["list","combo","enum"].indexOf(i.type)){if($(i.el).prop("readonly")||$(i.el).prop("disabled"))return;let m=$(i.el).data("selected"),w=$(i.el),_=!1;switch(-1!==["list","enum"].indexOf(i.type)&&("list"===i.type&&(w=$(i.helpers.focus).find("input")),"enum"===i.type&&(w=$(i.helpers.multi).find("input")),-1==[37,38,39,40].indexOf(l)&&setTimeout(()=>{i.refresh()},1),86==e.keyCode&&(e.ctrlKey||e.metaKey)&&setTimeout(()=>{i.refresh(),i.search(),i.request()},50)),l){case 27:"list"===i.type&&(""!==w.val()&&w.val(""),e.stopPropagation());break;case 37:case 39:break;case 13:{if(0===$("#w2ui-overlay").length){i.updateOverlay();break}let k=s.items[s.index];if("enum"===i.type)if(null==k||k.hidden||k.disabled){k={id:w.val(),text:w.val()};let E=i.trigger({phase:"before",type:"new",target:i.el,originalEvent:e.originalEvent,item:k});if(!0===E.isCancelled)return;if(k=E.item,i.options.autoAdd){if(!k||void 0===k.id||""===String(k.id).trim()||k.disabled||k.hidden)return void e.preventDefault();delete i.tmp.force_open,m.length>=s.max&&s.max>0&&m.pop(),m.push(k),$(i.el).trigger("input").trigger("change"),w.val("").width(20),i.refresh()}i.trigger($.extend(E,{phase:"after"}))}else{let E=i.trigger({phase:"before",type:"add",target:i.el,originalEvent:e.originalEvent,item:k});if(!0===E.isCancelled)return;k=E.item,m.length>=s.max&&s.max>0&&m.pop(),delete k.hidden,delete i.tmp.force_open,m.push(k),$(i.el).trigger("input").trigger("change"),w.val("").width(20),i.refresh(),i.trigger($.extend(E,{phase:"after"}))}else k&&$(i.el).data("selected",k).val(k.text).trigger("input").trigger("change"),""===$(i.el).val()&&$(i.el).data("selected")&&$(i.el).removeData("selected").val("").trigger("input").trigger("change"),"list"===i.type&&(w.val(""),i.refresh()),i.tmp.force_hide=!0;break}case 8:case 46:if("enum"===i.type&&8===l&&""===w.val()&&m.length>0){let E=i.trigger({phase:"before",type:"remove",target:i.el,originalEvent:e.originalEvent,item:m[m.length-1]});if(!0===E.isCancelled)return;m.pop(),$(i.el).trigger("input").trigger("change"),i.refresh(),i.trigger($.extend(E,{phase:"after"}))}"list"===i.type&&""===w.val()&&($(i.el).data("selected",{}).trigger("input").trigger("change"),i.refresh());break;case 38:if(0===$("#w2ui-overlay").length){i.updateOverlay();break}for(s.index=w2utils.isInt(s.index)?parseInt(s.index):0,s.index--;s.index>0&&(s.items[s.index].hidden||s.items[s.index].disabled);)s.index--;if(0===s.index&&(s.items[s.index].hidden||s.items[s.index].disabled))for(;s.items[s.index]&&(s.items[s.index].hidden||s.items[s.index].disabled);)s.index++;_=!0;break;case 40:if(0===$("#w2ui-overlay").length){i.updateOverlay();break}for(s.index=w2utils.isInt(s.index)?parseInt(s.index):-1,s.index++;s.index<s.items.length-1&&(s.items[s.index].hidden||s.items[s.index].disabled);)s.index++;if(s.index==s.items.length-1&&(s.items[s.index].hidden||s.items[s.index].disabled))for(;s.items[s.index]&&(s.items[s.index].hidden||s.items[s.index].disabled);)s.index--;""===w.val()&&0===$("#w2ui-overlay").length?i.tmp.force_open=!0:_=!0;break;default:0===$("#w2ui-overlay").length&&i.updateOverlay()}if(_)return s.index<0&&(s.index=0),s.index>=s.items.length&&(s.index=s.items.length-1),i.updateOverlay(_),e.preventDefault(),void setTimeout(()=>{if("enum"===i.type){let k=w.get(0);k.setSelectionRange(k.value.length,k.value.length)}else if("list"===i.type){let k=w.get(0);k.setSelectionRange(k.value.length,k.value.length)}else i.el.setSelectionRange(i.el.value.length,i.el.value.length)},0);"enum"===i.type&&w.width(8*(w.val().length+2)+"px")}}keyUp(e){let t=this;if(-1!==["list","combo","enum"].indexOf(this.type)){if($(t.el).prop("readonly")||$(t.el).prop("disabled"))return;if(-1==[16,17,18,20,37,39,91].indexOf(e.keyCode)){let i=$(this.helpers.focus).find("input");0===i.length&&(i=$(this.el));let s=this.trigger({phase:"before",type:"search",originalEvent:e,target:i,search:i.val()});if(!0===s.isCancelled)return;this.tmp.force_hide||this.request(),1==i.val().length&&this.refresh(),(0===$("#w2ui-overlay").length||-1==[38,40].indexOf(e.keyCode))&&this.search(),this.trigger($.extend(s,{phase:"after"}))}}}clearCache(){this.options.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1}request(e){let t=this,i=this.options,s=$(t.el).val()||"";if(i.url){if("enum"===t.type){let l=$(t.helpers.multi).find("input");s=0===l.length?"":l.val()}if("list"===t.type){let l=$(t.helpers.focus).find("input");s=0===l.length?"":l.val()}if(0!==i.minLength&&s.length<i.minLength)return i.items=[],void this.updateOverlay();if(null==e&&(e=i.interval),null==t.tmp.xhr_search&&(t.tmp.xhr_search=""),null==t.tmp.xhr_total&&(t.tmp.xhr_total=-1),i.url&&!0!==$(t.el).prop("readonly")&&!0!==$(t.el).prop("disabled")&&(0===i.items.length&&0!==t.tmp.xhr_total||t.tmp.xhr_total==i.cacheMax&&s.length>t.tmp.xhr_search.length||s.length>=t.tmp.xhr_search.length&&s.substr(0,t.tmp.xhr_search.length)!==t.tmp.xhr_search||s.length<t.tmp.xhr_search.length)){if(t.tmp.xhr)try{t.tmp.xhr.abort()}catch(l){}t.tmp.xhr_loading=!0,t.search(),clearTimeout(t.tmp.timeout),t.tmp.timeout=setTimeout(()=>{let l=i.url,n={search:s,max:i.cacheMax};$.extend(n,i.postData);let r=t.trigger({phase:"before",type:"request",search:s,target:t.el,url:l,postData:n});if(!0===r.isCancelled)return;l=r.url,n=r.postData;let o={type:"GET",url:l,data:n,dataType:"JSON"};null!=localStorage.getItem("token")&&(o.headers.Authorization="Bearer "+localStorage.getItem("token")),null!=localStorage.getItem("lang")&&(o.headers["Accept-Language"]=localStorage.getItem("lang")),i.method&&(o.type=i.method),"JSON"===w2utils.settings.dataType&&(o.type="POST",o.data=JSON.stringify(o.data),o.contentType="application/json"),"HTTPJSON"===w2utils.settings.dataType&&(o.data={request:JSON.stringify(o.data)}),"RESTFULLJSON"===w2utils.settings.dataType&&(o.data=JSON.stringify(o.data),o.contentType="application/json"),null!=i.method&&(o.type=i.method),t.tmp.xhr=$.ajax(o).done((h,u,g)=>{let c=t.trigger({phase:"before",type:"load",target:t.el,search:n.search,data:h,xhr:g});if(!0===c.isCancelled)return;if("string"==typeof(h=c.data)&&(h=JSON.parse(h)),Array.isArray(h)&&(h={records:h}),null==h.records&&null!=h.items&&(h.records=h.items,delete h.items),"success"==h.status&&null==h.records&&(h.records=[]),!Array.isArray(h.records))return void console.error("ERROR: server did not return proper data structure","\n"," - it should return",{status:"success",records:[{id:1,text:"item"}]},"\n"," - or just an array ",[{id:1,text:"item"}],"\n"," - actual response","object"==typeof h?h:g.responseText);h.records.length>i.cacheMax&&h.records.splice(i.cacheMax,1e5),null==i.recId&&null!=i.recid&&(i.recId=i.recid),(i.recId||i.recText)&&h.records.forEach(w=>{"string"==typeof i.recId&&(w.id=w[i.recId]),"function"==typeof i.recId&&(w.id=i.recId(w)),"string"==typeof i.recText&&(w.text=w[i.recText]),"function"==typeof i.recText&&(w.text=i.recText(w))}),t.tmp.xhr_loading=!1,t.tmp.xhr_search=s,t.tmp.xhr_total=h.records.length,t.tmp.lastError="",i.items=w2utils.normMenu(h.records),t.tmp.emptySet=""===s&&0===h.records.length;let m=$(t.el).data("find_selected");if(m){let w;Array.isArray(m)?(w=[],m.forEach(_=>{let k=!1;i.items.forEach(E=>{(E.id==_||_&&_.id==E.id)&&(w.push($.extend(!0,{},E)),k=!0)}),k||w.push(_)})):(w=m,i.items.forEach(_=>{(_.id==m||m&&m.id==_.id)&&(w=_)})),$(t.el).data("selected",w).removeData("find_selected").trigger("input").trigger("change")}t.search(),t.trigger($.extend(c,{phase:"after"}))}).fail((h,u,g)=>{let m=t.trigger({phase:"before",type:"error",target:t.el,search:s,error:{status:u,error:g,rawResponseText:h.responseText},xhr:h});if(!0!==m.isCancelled){if("abort"!==u){let w;try{w=JSON.parse(h.responseText)}catch(_){}console.error("ERROR: server did not return proper data structure","\n"," - it should return",{status:"success",records:[{id:1,text:"item"}]},"\n"," - or just an array ",[{id:1,text:"item"}],"\n"," - actual response","object"==typeof w?w:h.responseText)}t.tmp.xhr_loading=!1,t.tmp.xhr_search=s,t.tmp.xhr_total=0,t.tmp.emptySet=!0,t.tmp.lastError=m.error||"Server communication failed",i.items=[],t.clearCache(),t.search(),t.updateOverlay(!1),t.trigger($.extend(m,{phase:"after"}))}}),t.trigger($.extend(r,{phase:"after"}))},e)}}}search(){let e=this,t=this.options,i=$(e.el).val(),s=e.el,l=[],n=$(e.el).data("selected");if("enum"===e.type){s=$(e.helpers.multi).find("input"),i=s.val();for(let o in n)n[o]&&l.push(n[o].id)}else if("list"===e.type){s=$(e.helpers.focus).find("input"),i=s.val();for(let o in n)n[o]&&l.push(n[o].id)}let r=t.items;if(!0!==e.tmp.xhr_loading){let o=0;for(let h=0;h<r.length;h++){let u=r[h];if(null!=t.compare)"function"==typeof t.compare&&(u.hidden=!1===t.compare.call(this,u,i));else{let g="",c="";-1!==["is","begins"].indexOf(t.match)&&(g="^"),-1!==["is","ends"].indexOf(t.match)&&(c="$");try{u.hidden=!new RegExp(g+i+c,"ig").test(u.text)&&"..."!==u.text}catch(m){}}!1===t.filter&&(u.hidden=!1),"enum"===e.type&&-1!==$.inArray(u.id,l)&&(u.hidden=!0),!0!==u.hidden&&(o++,delete u.hidden)}for(t.index=-1;r[t.index]&&r[t.index].hidden;)t.index++;o<=0&&(t.index=-1),t.spinner=!1,setTimeout(()=>{t.markSearch&&0==$("#w2ui-overlay .no-matches").length&&$("#w2ui-overlay").w2marker(i)},1)}else r.splice(0,t.cacheMax),t.spinner=!0;$("#w2ui-overlay").length>0&&e.updateOverlay()}updateOverlay(e){let s,l,n,r,t=this,i=this.options;if("color"===this.type){if($(t.el).prop("readonly")||$(t.el).prop("disabled"))return;$(this.el).w2color({color:$(this.el).val(),transparent:i.transparent,advanced:i.advanced},o=>{null!=o&&$(t.el).val(o).trigger("input").trigger("change")})}if("date"===this.type){if($(t.el).prop("readonly")||$(t.el).prop("disabled"))return;0===$("#w2ui-overlay").length&&$(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar"></div>',{css:{"background-color":"#f5f5f5"},onShow(o){w2utils.isIE&&$(".w2ui-calendar").on("mousedown",function(h){let u=$(h.target);1===u.length&&"w2ui-jump-year"===u[0].id&&$("#w2ui-overlay").data("keepOpen",!0)})}}),n=w2utils.isDate($(t.el).val(),t.options.format,!0),n&&(s=n.getMonth()+1,l=n.getFullYear()),function o(h,u){if(!h&&!u){let g=new Date;h=g.getMonth(),u=g.getFullYear()}$("#w2ui-overlay > div > div").html(t.getMonthHTML(h,u,$(t.el).val())),$("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if($(this).next().hasClass("w2ui-calendar-jump"))$(this).next().remove();else{let g,c;$(this).after('<div class="w2ui-calendar-jump" style=""></div>'),$(this).next().hide().html(t.getYearHTML()).fadeIn(200),setTimeout(()=>{$("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("dblclick",function(){$(this).hasClass("w2ui-jump-month")&&($(this).parent().find(".w2ui-jump-month").removeClass("selected"),$(this).addClass("selected"),c=$(this).attr("name")),$(this).hasClass("w2ui-jump-year")&&($(this).parent().find(".w2ui-jump-year").removeClass("selected"),$(this).addClass("selected"),g=$(this).attr("name")),null==c&&(c=h),null==g&&(g=u),$("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(()=>{o(parseInt(c)+1,g)},100)}).on("click",function(){$(this).hasClass("w2ui-jump-month")&&($(this).parent().find(".w2ui-jump-month").removeClass("selected"),$(this).addClass("selected"),c=$(this).attr("name")),$(this).hasClass("w2ui-jump-year")&&($(this).parent().find(".w2ui-jump-year").removeClass("selected"),$(this).addClass("selected"),g=$(this).attr("name")),null!=g&&null!=c&&($("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(()=>{o(parseInt(c)+1,g)},100))}),$("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),$("#w2ui-overlay .w2ui-date").on("mousedown",function(){let g=$(this).attr("date");$(t.el).val(g).trigger("input").trigger("change"),$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(()=>{$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),$("#w2ui-overlay .previous").on("mousedown",function(){let g=t.options.current.split("/");g[0]=parseInt(g[0])-1,o(g[0],g[1])}),$("#w2ui-overlay .next").on("mousedown",function(){let g=t.options.current.split("/");g[0]=parseInt(g[0])+1,o(g[0],g[1])})}(s,l)}if("time"===this.type){if($(t.el).prop("readonly")||$(t.el).prop("disabled"))return;0===$("#w2ui-overlay").length&&$(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});let o="h24"===this.options.format;$("#w2ui-overlay > div").html(t.getHourHTML()),$("#w2ui-overlay .w2ui-time").on("mousedown",function(h){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});let u=$(this).attr("hour");$(t.el).val((u>12&&!o?u-12:u)+":00"+(o?"":u<12?" am":" pm")).trigger("input").trigger("change")}),null==this.options.noMinutes||!1===this.options.noMinutes?$("#w2ui-overlay .w2ui-time").on("mouseup",function(){let h=$(this).attr("hour");$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),$(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),$("#w2ui-overlay > div").html(t.getMinHTML(h)),$("#w2ui-overlay .w2ui-time").on("mousedown",function(){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});let u=$(this).attr("min");$(t.el).val((h>12&&!o?h-12:h)+":"+(u<10?0:"")+u+(o?"":h<12?" am":" pm")).trigger("input").trigger("change")}).on("mouseup",function(){setTimeout(()=>{$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):$("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(()=>{$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"===this.type){if($(t.el).prop("readonly")||$(t.el).prop("disabled"))return;$("#w2ui-overlay .w2ui-time").length>0&&$("#w2ui-overlay")[0].hide(),0===$("#w2ui-overlay").length&&$(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"},onShow(h){w2utils.isIE&&$(".w2ui-calendar").on("mousedown",function(u){let g=$(u.target);1===g.length&&"w2ui-jump-year"===g[0].id&&$("#w2ui-overlay").data("keepOpen",!0)})}}),n=w2utils.isDateTime($(t.el).val(),t.options.format,!0),n&&(s=n.getMonth()+1,l=n.getFullYear());let o=null;!function h(u,g){$("#w2ui-overlay > div > div").html(t.getMonthHTML(u,g,$(t.el).val())+(i.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+"</div>":"")),$("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if($(this).next().hasClass("w2ui-calendar-jump"))$(this).next().remove();else{let c,m;$(this).after('<div class="w2ui-calendar-jump" style=""></div>'),$(this).next().hide().html(t.getYearHTML()).fadeIn(200),setTimeout(()=>{$("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){$(this).hasClass("w2ui-jump-month")&&($(this).parent().find(".w2ui-jump-month").removeClass("selected"),$(this).addClass("selected"),m=$(this).attr("name")),$(this).hasClass("w2ui-jump-year")&&($(this).parent().find(".w2ui-jump-year").removeClass("selected"),$(this).addClass("selected"),c=$(this).attr("name")),null!=c&&null!=m&&($("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(()=>{h(parseInt(m)+1,c)},100))}),$("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),$("#w2ui-overlay .w2ui-date").on("mousedown",function(){let c=$(this).attr("date");$(t.el).val(c).trigger("input").trigger("change"),$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),o=new Date($(this).attr("data-date"))}).on("mouseup",function(){let c,m;$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),$(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),$("#w2ui-overlay > div").html(t.getHourHTML()),$("#w2ui-overlay .w2ui-time").on("mousedown",function(w){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),c=$(this).attr("hour"),o.setHours(c);let _=w2utils.formatDateTime(o,t.options.format);$(t.el).val(_).trigger("input").trigger("change")}),null==t.options.noMinutes||!1===t.options.noMinutes?$("#w2ui-overlay .w2ui-time").on("mouseup",function(){let w=$(this).attr("hour");$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),$(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),$("#w2ui-overlay > div").html(t.getMinHTML(w)),$("#w2ui-overlay .w2ui-time").on("mousedown",function(){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),m=$(this).attr("min"),o.setHours(c,m);let _=w2utils.formatDateTime(o,t.options.format);$(t.el).val(_).trigger("input").trigger("change")}).on("mouseup",function(){setTimeout(()=>{$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):$("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(()=>{$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}),$("#w2ui-overlay .previous").on("mousedown",function(){let c=t.options.current.split("/");c[0]=parseInt(c[0])-1,h(c[0],c[1])}),$("#w2ui-overlay .next").on("mousedown",function(){let c=t.options.current.split("/");c[0]=parseInt(c[0])+1,h(c[0],c[1])}),$("#w2ui-overlay .now").on("mousedown",function(){let c=w2utils.formatDateTime(new Date,t.options.format);return $(t.el).val(c).trigger("input").trigger("change"),!1}).on("mouseup",function(){setTimeout(()=>{$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}(s,l)}if(-1!==["list","combo","enum"].indexOf(this.type)){let o=this.el,h=this.el;if("enum"===this.type&&(o=$(this.helpers.multi),h=$(o).find("input")),"list"===this.type){let u=$(h).data("selected");$.isPlainObject(u)&&!$.isEmptyObject(u)&&-1==i.index&&i.items.forEach((g,c)=>{g.id===u.id&&(i.index=c)}),h=$(this.helpers.focus).find("input")}if($(this.el).hasClass("has-focus")){if(!1===i.openOnFocus&&""===$(h).val()&&!0!==t.tmp.force_open)return void $().w2overlay();if(t.tmp.force_hide)return $().w2overlay(),void setTimeout(()=>{delete t.tmp.force_hide},1);""!==$(h).val()&&delete t.tmp.force_open;let u=w2utils.lang("No matches");if(null!=i.url&&String($(h).val()).length<i.minLength&&!0!==t.tmp.emptySet&&(u=w2utils.lang("${count} letters or more...",{count:i.minLength})),null!=i.url&&""===$(h).val()&&!0!==t.tmp.emptySet&&(u=w2utils.lang(i.msgSearch||"Type to search...")),null==i.url&&0===i.items.length&&(u=w2utils.lang("Empty list")),null!=i.msgNoItems){let g={search:$(h).val(),options:$.extend(!0,{},i)};i.url&&(g.remote={url:i.url,empty:!!t.tmp.emptySet,error:t.tmp.lastError,minLength:i.minLength}),u="function"==typeof i.msgNoItems?i.msgNoItems(g):i.msgNoItems}t.tmp.lastError&&(u=t.tmp.lastError),u&&(u='<div class="no-matches" style="white-space: normal; line-height: 1.3">'+u+"</div>"),r=$.extend(!0,{},i,{search:!1,render:i.renderDrop,maxHeight:i.maxDropHeight,maxWidth:i.maxDropWidth,minWidth:i.minDropWidth,msgNoItems:u,onSelect(g){if("enum"===t.type){let c=$(t.el).data("selected");if(g.item){let m=t.trigger({phase:"before",type:"add",target:t.el,originalEvent:g.originalEvent,item:g.item});if(!0===m.isCancelled)return;if(c.length>=i.max&&i.max>0&&c.pop(),delete g.item.hidden,c.push(g.item),$(t.el).data("selected",c).trigger("input").trigger("change"),$(t.helpers.multi).find("input").val("").width(20),t.refresh(),!0!==g.keepOpen)$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide();else{let w;r.items.forEach((_,k)=>{_.id==g.item.id&&(w=k)}),null!=w&&r.items.splice(w,1),r.selected=c,$(o).w2menu("refresh",r)}t.trigger($.extend(m,{phase:"after"}))}}else $(t.el).data("selected",g.item).val(g.item.text).trigger("input").trigger("change"),t.helpers.focus&&t.helpers.focus.find("input").val("")}}),e?$(o).w2menu("refresh-index",r):$("#w2ui-overlay").length>0?$(o).w2menu("refresh",r):$(o).w2menu(r)}}}inRange(e,t){let i=!1;if("date"===this.type){let s=w2utils.isDate(e,this.options.format,!0);if(s){if(this.options.start||this.options.end){let l="string"==typeof this.options.start?this.options.start:$(this.options.start).val(),n="string"==typeof this.options.end?this.options.end:$(this.options.end).val(),r=w2utils.isDate(l,this.options.format,!0),o=w2utils.isDate(n,this.options.format,!0),h=new Date(s);r||(r=h),o||(o=h),h>=r&&h<=o&&(i=!0)}else i=!0;if(this.options.blocked&&-1!==$.inArray(e,this.options.blocked)&&(i=!1),null!=this.options.blockWeekDays&&null!=this.options.blockWeekDays.length){let l=this.options.blockWeekDays.length;for(let n=0;n<l;n++)s.getDay()==this.options.blockWeekDays[n]&&(i=!1)}}}else if("time"===this.type)if(this.options.start||this.options.end){let s=this.toMin(e),l=this.toMin(this.options.start),n=this.toMin(this.options.end);l||(l=s),n||(n=s),s>=l&&s<=n&&(i=!0)}else i=!0;else if("datetime"===this.type){let s=w2utils.isDateTime(e,this.options.format,!0);if(s){if(this.options.start||this.options.end){let l,n;if("object"==typeof this.options.start&&this.options.start instanceof Date)l=this.options.start;else{let o="string"==typeof this.options.start?this.options.start:$(this.options.start).val();l=""!==o.trim()?w2utils.isDateTime(o,this.options.format,!0):""}if("object"==typeof this.options.end&&this.options.end instanceof Date)n=this.options.end;else{let o="string"==typeof this.options.end?this.options.end:$(this.options.end).val();n=""!==o.trim()?w2utils.isDateTime(o,this.options.format,!0):""}let r=s;l||(l=r),n||(n=r),t&&l instanceof Date&&(l.setHours(0),l.setMinutes(0),l.setSeconds(0)),r>=l&&r<=n&&(i=!0)}else i=!0;if(i&&this.options.blocked)for(let l=0;l<this.options.blocked.length;l++){let n=this.options.blocked[l];if("string"==typeof n&&(n=w2utils.isDateTime(n,this.options.format,!0)),"object"==typeof n&&n instanceof Date&&n.getFullYear()==s.getFullYear()&&n.getMonth()==s.getMonth()&&n.getDate()==s.getDate()){i=!1;break}}}}return i}checkType(e,t){let i=this;switch(i.type){case"int":return!(!t||-1===["-",i.options.groupSymbol].indexOf(e))||w2utils.isInt(e.replace(i.options.numberRE,""));case"percent":e=e.replace(/%/g,"");case"float":return!(!t||-1===["-",w2utils.settings.decimalSymbol,i.options.groupSymbol].indexOf(e))||w2utils.isFloat(e.replace(i.options.numberRE,""));case"money":case"currency":return!(!t||-1===["-",i.options.decimalSymbol,i.options.groupSymbol,i.options.currencyPrefix,i.options.currencySuffix].indexOf(e))||w2utils.isFloat(e.replace(i.options.moneyRE,""));case"bin":return w2utils.isBin(e);case"hex":return w2utils.isHex(e);case"alphanumeric":return w2utils.isAlphaNumeric(e)}return!0}addPrefix(){let e=this;setTimeout(()=>{if("clear"===e.type)return;let t,i=$(e.el).data("tmp")||{};i["old-padding-left"]&&$(e.el).css("padding-left",i["old-padding-left"]),i["old-padding-left"]=$(e.el).css("padding-left"),$(e.el).data("tmp",i),e.helpers.prefix&&$(e.helpers.prefix).remove(),""!==e.options.prefix&&($(e.el).before('<div class="w2ui-field-helper">'+e.options.prefix+"</div>"),t=$(e.el).prev(),t.css({color:$(e.el).css("color"),"font-family":$(e.el).css("font-family"),"font-size":$(e.el).css("font-size"),"padding-top":$(e.el).css("padding-top"),"padding-bottom":$(e.el).css("padding-bottom"),"padding-left":$(e.el).css("padding-left"),"padding-right":0,"margin-top":parseInt($(e.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt($(e.el).css("margin-bottom"),10)+1+"px","margin-left":$(e.el).css("margin-left"),"margin-right":0}).on("click",function(s){if(e.options.icon&&"function"==typeof e.onIconClick){let l=e.trigger({phase:"before",type:"iconClick",target:e.el,el:$(this).find("span.w2ui-icon")[0]});if(!0===l.isCancelled)return;e.trigger($.extend(l,{phase:"after"}))}else"list"===e.type?$(e.helpers.focus).find("input").focus():$(e.el).focus()}),$(e.el).css("padding-left",t.width()+parseInt($(e.el).css("padding-left"),10)+"px"),e.helpers.prefix=t)},1)}addSuffix(){let t,i,e=this;setTimeout(()=>{if("clear"===e.type)return;let s=$(e.el).data("tmp")||{};s["old-padding-right"]&&$(e.el).css("padding-right",s["old-padding-right"]),s["old-padding-right"]=$(e.el).css("padding-right"),$(e.el).data("tmp",s),i=parseInt($(e.el).css("padding-right"),10),e.options.arrows&&(e.helpers.arrows&&$(e.helpers.arrows).remove(),$(e.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>'),t=$(e.el).next(),t.css({color:$(e.el).css("color"),"font-family":$(e.el).css("font-family"),"font-size":$(e.el).css("font-size"),height:$(e.el).height()+parseInt($(e.el).css("padding-top"),10)+parseInt($(e.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt($(e.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(t.width()+parseInt($(e.el).css("margin-right"),10)+12)+"px").on("mousedown",function(l){let n=$("body");function o(h){$(e.el).focus(),e.keyDown($.Event("keydown"),{keyCode:"up"===$(l.target).attr("type")?38:40}),!1!==h&&$("body").data("_field_update_timer",setTimeout(o,60))}n.on("mouseup",function r(){clearTimeout(n.data("_field_update_timer")),n.off("mouseup",r)}),n.data("_field_update_timer",setTimeout(o,700)),o(!1)}),i+=t.width()+12,$(e.el).css("padding-right",i+"px"),e.helpers.arrows=t),""!==e.options.suffix&&(e.helpers.suffix&&$(e.helpers.suffix).remove(),$(e.el).after('<div class="w2ui-field-helper">'+e.options.suffix+"</div>"),t=$(e.el).next(),t.css({color:$(e.el).css("color"),"font-family":$(e.el).css("font-family"),"font-size":$(e.el).css("font-size"),"padding-top":$(e.el).css("padding-top"),"padding-bottom":$(e.el).css("padding-bottom"),"padding-left":"3px","padding-right":$(e.el).css("padding-right"),"margin-top":parseInt($(e.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt($(e.el).css("margin-bottom"),10)+1+"px"}).on("click",function(l){"list"===e.type?$(e.helpers.focus).find("input").focus():$(e.el).focus()}),t.css("margin-left","-"+(w2utils.getSize(t,"width")+parseInt($(e.el).css("margin-right"),10)+2)+"px"),i+=t.width()+3,$(e.el).css("padding-right",i+"px"),e.helpers.suffix=t)},1)}addFocus(){let i,e=this;$(e.helpers.focus).remove();let s=parseInt($(e.el).attr("tabIndex"));!isNaN(s)&&-1!==s&&(e.el._tabIndex=s),e.el._tabIndex&&(s=e.el._tabIndex),null==s&&(s=-1),isNaN(s)&&(s=0);let l="";null!=$(e.el).attr("id")&&(l='id="'+$(e.el).attr("id")+'_search"');let n='<div class="w2ui-field-helper">    <span class="w2ui-icon w2ui-icon-search"></span>    <input '+l+' type="text" tabIndex="'+s+'" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"/></div>';$(e.el).attr("tabindex",-1).before(n);let r=$(e.el).prev();e.helpers.focus=r,r.css({width:$(e.el).width(),"margin-top":$(e.el).css("margin-top"),"margin-left":parseInt($(e.el).css("margin-left"))+parseInt($(e.el).css("padding-left"))+"px","margin-bottom":$(e.el).css("margin-bottom"),"margin-right":$(e.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",opacity:1,margin:0,border:"1px solid transparent",padding:$(e.el).css("padding-top"),"padding-left":0,"margin-left":0,"background-color":"transparent"}),r.find("input").on("click",function(o){0==$("#w2ui-overlay").length?e.updateOverlay():$("#w2ui-overlay").data("keepOpen",!0)}).on("focus",function(o){i=$(e.el).attr("placeholder"),$(this).val(""),$(e.el).triggerHandler("focus"),o.stopPropagation?o.stopPropagation():o.cancelBubble=!0}).on("blur",function(o){$(this).val(""),e.refresh(),$(e.el).triggerHandler("blur"),o.stopPropagation?o.stopPropagation():o.cancelBubble=!0,null!=i&&$(e.el).attr("placeholder",i)}).on("keydown",function(o){let h=this;e.keyDown(o),setTimeout(()=>{""===h.value?$(e.el).attr("placeholder",i):$(e.el).attr("placeholder","")},10)}).on("keyup",function(o){e.keyUp(o)}).on("keypress",function(o){e.keyPress(o)}),r.on("click",function(o){$(this).find("input").focus()}),e.refresh()}addMulti(){let e=this;$(e.helpers.multi).remove();let t="",i="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+$(e.el).css("margin-left")+"; margin-right   : "+$(e.el).css("margin-right")+"; width          : "+(w2utils.getSize(e.el,"width")-parseInt($(e.el).css("margin-left"),10)-parseInt($(e.el).css("margin-right"),10))+"px;",s="";if(null!=$(e.el).attr("id")&&(s='id="'+$(e.el).attr("id")+'_search" '),"enum"===e.type){let r=$(e.el).attr("tabIndex");r&&-1!==r&&(e.el._tabIndex=r),e.el._tabIndex&&(r=e.el._tabIndex),null==r&&(r=0),t='<div class="w2ui-field-helper w2ui-list" style="'+i+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input '+s+' type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: transparent" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"'+($(e.el).prop("readonly")?' readonly="readonly"':"")+($(e.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+r+'"/>        </li>    </ul>    </div></div>'}"file"===e.type&&(t='<div class="w2ui-field-helper w2ui-list" style="'+i+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input '+s+' name="attachment" class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" tabindex="-1"'+(1!==e.options.max?' multiple="multiple"':"")+($(e.el).prop("readonly")?' readonly="readonly"':"")+($(e.el).prop("disabled")?' disabled="disabled"':"")+($(e.el).attr("accept")?' accept="'+$(e.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');let l=$(e.el).data("tmp")||{};l["old-background-color"]=$(e.el).css("background-color"),l["old-border-color"]=$(e.el).css("border-color"),$(e.el).data("tmp",l),$(e.el).before(t).css({"background-color":"transparent","border-color":"transparent"});let n=$(e.el).prev();e.helpers.multi=n,"enum"===e.type&&($(e.el).attr("tabindex",-1),n.find("input").on("click",function(r){0===$("#w2ui-overlay").length&&e.focus(r),$(e.el).triggerHandler("click")}).on("focus",function(r){$(e.el).triggerHandler("focus"),r.stopPropagation?r.stopPropagation():r.cancelBubble=!0}).on("blur",function(r){$(e.el).triggerHandler("blur"),r.stopPropagation?r.stopPropagation():r.cancelBubble=!0}).on("keyup",function(r){e.keyUp(r)}).on("keydown",function(r){e.keyDown(r)}).on("keypress",function(r){e.keyPress(r)}),n.on("click",function(r){$(this).find("input").focus()})),"file"===e.type&&n.find("input").off(".drag").on("click.drag",function(r){r.stopPropagation(),!$(e.el).prop("readonly")&&!$(e.el).prop("disabled")&&$(e.el).focus()}).on("dragenter.drag",function(r){$(e.el).prop("readonly")||$(e.el).prop("disabled")||$(n).addClass("w2ui-file-dragover")}).on("dragleave.drag",function(r){$(e.el).prop("readonly")||$(e.el).prop("disabled")||$(n).removeClass("w2ui-file-dragover")}).on("drop.drag",function(r){if($(e.el).prop("readonly")||$(e.el).prop("disabled"))return;$(n).removeClass("w2ui-file-dragover");let o=r.originalEvent.dataTransfer.files;for(let h=0,u=o.length;h<u;h++)e.addFile.call(e,o[h]);$(e.el).focus(),r.preventDefault(),r.stopPropagation()}).on("dragover.drag",function(r){r.preventDefault(),r.stopPropagation()}).on("change.drag",function(){if($(e.el).focus(),void 0!==this.files)for(let r=0,o=this.files.length;r<o;r++)e.addFile.call(e,this.files[r])}),e.refresh()}addFile(e){let o,t=this,i=this.options,s=$(t.el).data("selected"),l={name:e.name,type:e.type,modified:e.lastModifiedDate,size:e.size,content:null,file:e},n=0,r=0;if(s)for(let u=0;u<s.length;u++){if(s[u].name==e.name&&s[u].size==e.size)return;n+=s[u].size,r++}let h=t.trigger({phase:"before",type:"add",target:t.el,file:l,total:r,totalSize:n});if(!0!==h.isCancelled){if(0!==i.maxFileSize&&l.size>i.maxFileSize)return o="Maximum file size is "+w2utils.formatSize(i.maxFileSize),!1===i.silent&&$(t.el).w2tag(o),void console.log("ERROR: "+o);if(0!==i.maxSize&&n+l.size>i.maxSize)return o=w2utils.lang("Maximum total size is ${count}",{count:w2utils.formatSize(i.maxSize)}),!1===i.silent&&$(t.el).w2tag(o),void console.log("ERROR: "+o);if(0!==i.max&&r>=i.max)return o=w2utils.lang("Maximum number of files is ${count}",{count:i.max}),!1===i.silent&&$(t.el).w2tag(o),void console.log("ERROR: "+o);if(s.push(l),"undefined"!=typeof FileReader&&!0===i.readContent){let u=new FileReader;u.onload=function(m){let w=m.target.result,_=w.indexOf(",");l.content=w.substr(_+1),t.refresh(),$(t.el).trigger("input").trigger("change"),t.trigger($.extend(h,{phase:"after"}))},u.readAsDataURL(e)}else t.refresh(),$(t.el).trigger("input").trigger("change"),t.trigger($.extend(h,{phase:"after"}))}}getMonthHTML(e,t,i){let s=new Date,l=w2utils.settings.fullmonths,n=["31","28","31","30","31","30","31","31","30","31","30","31"],r=s.getFullYear()+"/"+(Number(s.getMonth())+1)+"/"+s.getDate(),o=w2utils.settings.fulldays.slice(),h=w2utils.settings.shortdays.slice();"M"!==w2utils.settings.weekStarts&&(o.unshift(o.pop()),h.unshift(h.pop()));let u=this.options;null==u&&(u={}),t=w2utils.isInt(t)?parseInt(t):s.getFullYear(),(e=w2utils.isInt(e)?parseInt(e):s.getMonth()+1)>12&&(e-=12,t++),(e<1||0===e)&&(e+=12,t--),n[1]=t/4==Math.floor(t/4)?"29":"28",u.current=e+"/"+t,s=new Date(t,e-1,1);let g=s.getDay(),c="";for(let _=0;_<h.length;_++)c+='<td title="'+o[_]+'">'+h[_]+"</td>";let m='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+l[e-1]+", "+t+'       <span class="arrow-down" style="position: relative; top: -1px; left: 5px; opacity: 0.6;"></span></div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+c+"</tr>    <tr>",w=1;if("M"!==w2utils.settings.weekStarts&&g++,"datetime"===this.type){let _=w2utils.isDateTime(i,u.format,!0);i=w2utils.formatDate(_,w2utils.settings.dateFormat)}for(let _=1;_<43;_++){if(0===g&&1==_){for(let Q=0;Q<6;Q++)m+='<td class="w2ui-day-empty">&#160;</td>';_+=6}else if(_<g||w>n[e-1]){m+='<td class="w2ui-day-empty">&#160;</td>',_%7==0&&(m+="</tr><tr>");continue}let k=t+"/"+e+"/"+w,E=new Date(k),I="";6===E.getDay()&&(I=" w2ui-saturday"),0===E.getDay()&&(I=" w2ui-sunday"),k==r&&(I+=" w2ui-today");let H,B,N=w,L="",f="";if("datetime"===this.type?(H=w2utils.formatDateTime(k,u.format),B=w2utils.formatDate(k,w2utils.settings.dateFormat)):(H=w2utils.formatDate(k,u.format),B=H),u.colored&&void 0!==u.colored[B]){let Q=u.colored[B].split(":");f="background-color: "+Q[0]+";",L="color: "+Q[1]+";"}m+='<td class="'+(this.inRange(H,!0)?"w2ui-date "+(B==i?"w2ui-date-selected":""):"w2ui-blocked")+I+'"    style="'+L+f+'" date="'+H+'" data-date="'+E+'">'+N+"</td>",(_%7==0||0===g&&1==_)&&(m+="</tr><tr>"),w++}return m+="</tr></tbody></table>",m}getYearHTML(){let e=w2utils.settings.shortmonths,t=w2utils.settings.dateStartYear,i=w2utils.settings.dateEndYear,s="",l="";for(let n=0;n<e.length;n++)s+='<div class="w2ui-jump-month" name="'+n+'">'+e[n]+"</div>";for(let n=t;n<=i;n++)l+='<div class="w2ui-jump-year" name="'+n+'">'+n+"</div>";return'<div id="w2ui-jump-month">'+s+'</div><div id="w2ui-jump-year">'+l+"</div>"}getHourHTML(){let e=[],t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});let i=t.format.indexOf("h24")>-1;for(let l=0;l<24;l++){let n=(l>=12&&!i?l-12:l)+":00"+(i?"":l<12?" am":" pm");12==l&&!i&&(n="12:00 pm"),e[Math.floor(l/8)]||(e[Math.floor(l/8)]="");let r=this.fromMin(this.toMin(n)),o=this.fromMin(this.toMin(n)+59);if("datetime"===this.type){let h=w2utils.isDateTime(this.el.value,t.format,!0),u=t.format.split("|")[0].trim();r=w2utils.formatDate(h,u)+" "+r,o=w2utils.formatDate(h,u)+" "+o}e[Math.floor(l/8)]+='<div class="'+(this.inRange(r)||this.inRange(o)?"w2ui-time ":"w2ui-blocked")+'" hour="'+l+'">'+n+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+e[0]+"</td>       <td>"+e[1]+"</td>       <td>"+e[2]+"</td>   </tr></tbody></table></div></div>"}getMinHTML(e){null==e&&(e=0);let t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});let i=t.format.indexOf("h24")>-1,s=[];for(let n=0;n<60;n+=5){let r=(e>12&&!i?e-12:e)+":"+(n<10?0:"")+n+" "+(i?"":e<12?"am":"pm"),o=r,h=n<20?0:n<40?1:2;if(s[h]||(s[h]=""),"datetime"===this.type){let u=w2utils.isDateTime(this.el.value,t.format,!0),g=t.format.split("|")[0].trim();o=w2utils.formatDate(u,g)+" "+o}s[h]+='<div class="'+(this.inRange(o)?"w2ui-time ":"w2ui-blocked")+'" min="'+n+'">'+r+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+s[0]+"</td>       <td>"+s[1]+"</td>       <td>"+s[2]+"</td>   </tr></tbody></table></div></div>"}toMin(e){if("string"!=typeof e)return null;let t=e.split(":");return 2!==t.length?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),-1!==e.indexOf("pm")&&12!==t[0]&&(t[0]+=12),60*t[0]+t[1])}fromMin(e){let t="";e>=1440&&(e%=1440),e<0&&(e=1440+e);let i=Math.floor(e/60),s=(e%60<10?"0":"")+e%60,l=this.options;return null==l&&(l={format:w2utils.settings.timeFormat}),t=-1!==l.format.indexOf("h24")?i+":"+s:(i<=12?i:i-12)+":"+s+" "+(i>=12?"pm":"am"),t}}class w2form extends w2event{constructor(e){super(e.name),this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.pageStyle="",this.recid=0,this.fields=[],this.actions={},this.record={},this.original=null,this.postData={},this.httpHeaders={},this.method=null,this.toolbar={},this.tabs={},this.style="",this.focus=0,this.autosize=!0,this.nestedFields=!0,this.multipart=!1,this.tabindexBase=0,this.isGenerated=!1,this.last={xhr:null,errors:[]},this.onRequest=null,this.onLoad=null,this.onValidate=null,this.onSubmit=null,this.onProgress=null,this.onSave=null,this.onChange=null,this.onInput=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.onAction=null,this.onToolbar=null,this.onError=null,this.msgNotJSON="Returned data is not in valid JSON format.",this.msgAJAXerror="AJAX error. See console for more details.",this.msgRefresh="Loading...",this.msgSaving="Saving...",$.extend(!0,this,e);let t=e.record,i=e.original,s=e.fields,l=e.toolbar,n=e.tabs;if($.extend(this,{record:{},original:null,fields:[],tabs:{},toolbar:{},handlers:[]}),Array.isArray(n)){$.extend(!0,this.tabs,{tabs:[]});for(let o=0;o<n.length;o++){let h=n[o];"object"==typeof h?(this.tabs.tabs.push(h),!0===h.active&&(this.tabs.active=h.id)):this.tabs.tabs.push({id:h,text:h})}}else $.extend(!0,this.tabs,n);$.extend(!0,this.toolbar,l),s&&(this.fields=function r(o){let h=[];if($.isPlainObject(o)){let c=function(m){let w=["html"];return null==m.html&&(m.html={}),Object.keys(m).forEach(_=>{-1==w.indexOf(_)&&-1!=["label","attr","style","text","span","page","column","anchor","group","groupStyle","groupTitleStyle","groupCollapsible"].indexOf(_)&&(m.html[_]=m[_],delete m[_])}),m},g=o;o=[],Object.keys(g).forEach(m=>{let w=g[m];if("group"==w.type){if(w.text=m,$.isPlainObject(w.fields)){let _=w.fields;w.fields=[],Object.keys(_).forEach(k=>{let E=_[k];E.field=k,w.fields.push(c(E))})}}else w.field=m;o.push("group"==w.type?w:c(w))})}return o.forEach(g=>{if("group"==g.type){let c={group:g.text||"",groupStyle:g.style||"",groupTitleStyle:g.titleStyle||"",groupCollapsible:!0===g.collapsible};Array.isArray(g.fields)&&g.fields.forEach(m=>{let w=$.extend(!0,{},m);null==w.html&&(w.html={}),$.extend(w.html,c),Array("span","page","column","attr").forEach(_=>{null==w.html[_]&&null!=g[_]&&(w.html[_]=g[_])}),null==w.field&&null!=w.name&&(console.log("NOTICE: form field.name property is deprecated, please use field.field. Field ->",g),w.field=w.name),h.push(w)})}else{let c=$.extend(!0,{},g);null==c.field&&null!=c.name&&(console.log("NOTICE: form field.name property is deprecated, please use field.field. Field ->",g),c.field=c.name),h.push(c)}}),h}(s));for(let o in t)this.record[o]=$.isPlainObject(t[o])?$.extend(!0,{},t[o]):t[o];for(let o in i)this.original[o]=$.isPlainObject(i[o])?$.extend(!0,{},i[o]):i[o];""!==this.formURL?$.get(this.formURL,o=>{this.formHTML=o,this.isGenerated=!0}):!this.formURL&&!this.formHTML&&(this.formHTML=this.generateHTML(),this.isGenerated=!0)}get(e,t){if(0===arguments.length){let i=[];for(let s=0;s<this.fields.length;s++)null!=this.fields[s].field&&i.push(this.fields[s].field);return i}for(let i=0;i<this.fields.length;i++)if(this.fields[i].field==e)return!0===t?i:this.fields[i];return null}set(e,t){for(let i=0;i<this.fields.length;i++)if(this.fields[i].field==e)return $.extend(this.fields[i],t),this.refresh(e),!0;return!1}getValue(e){if(this.nestedFields){let t;try{let i=this.record;t=String(e).split(".").reduce((s,l)=>s[l],i)}catch(i){}return t}return this.record[e]}setValue(e,t){if(!this.nestedFields)return this.record[e]=t,!0;try{let i=this.record;return String(e).split(".").map((s,l,n)=>{n.length-1!==l?(i[s]||(i[s]={}),i=i[s]):i[s]=t}),!0}catch(i){return!1}}show(){let e=[];for(let t=0;t<arguments.length;t++){let i=this.get(arguments[t]);i&&i.hidden&&(i.hidden=!1,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),this.updateEmptyGroups(),e}hide(){let e=[];for(let t=0;t<arguments.length;t++){let i=this.get(arguments[t]);i&&!i.hidden&&(i.hidden=!0,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),this.updateEmptyGroups(),e}enable(){let e=[];for(let t=0;t<arguments.length;t++){let i=this.get(arguments[t]);i&&i.disabled&&(i.disabled=!1,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),e}disable(){let e=[];for(let t=0;t<arguments.length;t++){let i=this.get(arguments[t]);i&&!i.disabled&&(i.disabled=!0,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),e}updateEmptyGroups(){$(this.box).find(".w2ui-group").each((t,i)=>{!function e(t){let i=!0;return t.each((s,l)=>{"none"!=l.style.display&&(i=!1)}),i}($(i).find(".w2ui-field"))?$(i).show():$(i).hide()})}change(){Array.from(arguments).forEach(e=>{let t=this.get(e);t.$el&&t.$el.change()})}reload(e){("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request(e):"function"==typeof e&&e()}clear(){0!=arguments.length?Array.from(arguments).forEach(e=>{let t=this.record;String(e).split(".").map((i,s,l)=>{l.length-1!==s?t=t[i]:delete t[i]}),this.refresh(e)}):(this.recid=0,this.record={},this.original=null,this.refresh()),$().w2tag()}error(e){let t=this,i=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});!0!==i.isCancelled&&(setTimeout(()=>{t.message(e)},1),this.trigger($.extend(i,{phase:"after"})))}message(e){return"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:`<div class="w2ui-centered">${e}</div>`,onOpen(t){setTimeout(()=>{$(t.box).find(".w2ui-btn").focus()},25)}}),e&&null==e.buttons&&(e.buttons=`<button type="button" class="w2ui-btn" onclick="w2ui['${this.name}'].message()">\n              ${w2utils.lang("Ok")}\n          </button>`),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},e)}confirm(e){let t=this;"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>"});let i=()=>{"function"==typeof e.yes_click&&e.yes_click("yes"),"function"==typeof e.callBack&&e.callBack("yes"),t.message()},s=()=>{"function"==typeof e.no_click&&e.no_click("no"),"function"==typeof e.callBack&&e.callBack("no"),t.message()},l=`<button type="button" class="w2ui-btn btn-yes ${e.yes_class||""}">${w2utils.lang(e.yes_text||"Yes")}</button>`,n=`<button type="button" class="w2ui-btn btn-no ${e.no_class||""}">${w2utils.lang(e.no_text||"No")}</button>`;Object.assign(e,{buttons:w2utils.settings.macButtonOrder?n+l:l+n,onOpen(o){setTimeout(()=>{let h=$(this.box).find(".w2ui-btn");h.off(".message").on("blur.message",function(u){h.index(u.target)+1===h.length&&(h.get(0).focus(),u.preventDefault())}).on("keydown.message",function(u){27==u.keyCode&&s()}).focus(),$(this.box).find(".w2ui-btn.btn-yes").off("click").on("click",i),$(this.box).find(".w2ui-btn.btn-no").off("click").on("click",s)},25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},e);let r={yes:o=>(e.yes_click=o,r),no:o=>(e.no_click=o,r),then:o=>(e.callBack=o,r)};return r}validate(e){null==e&&(e=!0),$().w2tag();let t=[];for(let s=0;s<this.fields.length;s++){let l=this.fields[s];if(null==this.getValue(l.field)&&this.setValue(l.field,""),-1!=["int","float","currency","money"].indexOf(l.type)){let r=this.getValue(l.field),o=l.options.min,h=l.options.max;null!=o&&r<o&&t.push({field:l,error:w2utils.lang(`Should be more than ${o}`)}),null!=h&&r>h&&t.push({field:l,error:w2utils.lang(`Should be less than ${h}`)})}switch(l.type){case"alphanumeric":this.getValue(l.field)&&!w2utils.isAlphaNumeric(this.getValue(l.field))&&t.push({field:l,error:w2utils.lang("Not alpha-numeric")});break;case"int":this.getValue(l.field)&&!w2utils.isInt(this.getValue(l.field))&&t.push({field:l,error:w2utils.lang("Not an integer")});break;case"percent":case"float":this.getValue(l.field)&&!w2utils.isFloat(this.getValue(l.field))&&t.push({field:l,error:w2utils.lang("Not a float")});break;case"currency":case"money":this.getValue(l.field)&&!w2utils.isMoney(this.getValue(l.field))&&t.push({field:l,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.getValue(l.field)&&!w2utils.isHex(this.getValue(l.field))&&t.push({field:l,error:w2utils.lang("Not a hex number")});break;case"email":this.getValue(l.field)&&!w2utils.isEmail(this.getValue(l.field))&&t.push({field:l,error:w2utils.lang("Not a valid email")});break;case"checkbox":1==this.getValue(l.field)?this.setValue(l.field,1):this.setValue(l.field,0);break;case"date":l.options.format||(l.options.format=w2utils.settings.dateFormat),this.getValue(l.field)&&!w2utils.isDate(this.getValue(l.field),l.options.format)&&t.push({field:l,error:w2utils.lang("Not a valid date")+": "+l.options.format})}let n=this.getValue(l.field);l.required&&!0!==l.hidden&&-1==["div","custom","html","empty"].indexOf(l.type)&&(""===n||Array.isArray(n)&&0===n.length||$.isPlainObject(n)&&$.isEmptyObject(n))&&t.push({field:l,error:w2utils.lang("Required field")}),l.options&&!0!==l.hidden&&l.options.minLength>0&&-1==["enum","list","combo"].indexOf(l.type)&&this.getValue(l.field).length<l.options.minLength&&t.push({field:l,error:w2utils.lang("Field should be at least ${count} characters.",{count:l.options.minLength})})}let i=this.trigger({phase:"before",target:this.name,type:"validate",errors:t});if(!0!==i.isCancelled)return this.last.errors=t,e&&this.showErrors(),this.trigger($.extend(i,{phase:"after"})),t}showErrors(){let e=this.last.errors;if(e.length>0){let t=e[0];this.goto(e[0].field.page),$(t.field.$el).parents(".w2ui-field")[0].scrollIntoView(!0);for(let i=0;i<e.length;i++){t=e[i];let s=$.extend({class:"w2ui-error",hideOnFocus:!0},t.options);null!=t.field&&("radio"===t.field.type?$($(t.field.el).closest("div")[0]).w2tag(t.error,s):-1!==["enum","file"].indexOf(t.field.type)?function(n){setTimeout(()=>{let r=$(n.field.el).data("w2field").helpers.multi;$(n.field.el).w2tag(n.error,n.options),$(r).addClass("w2ui-error")},1)}(t):$(t.field.el).w2tag(t.error,s))}setTimeout(()=>{let i=e[0];$(i.field.$el).parents(".w2ui-page").off(".hideErrors").on("scroll.hideErrors",function(s){for(let l=0;l<e.length;l++)i=e[l],$(i.field.el).w2tag();$(i.field.$el).parents(".w2ui-page").off(".hideErrors")})},300)}}getChanges(){let e={};return null!=this.original&&"object"==typeof this.original&&!$.isEmptyObject(this.record)&&(e=function t(i,s,l){if(Array.isArray(i)&&Array.isArray(s))for(;i.length<s.length;)i.push(null);for(let n in i)null!=i[n]&&"object"==typeof i[n]?(l[n]=t(i[n],s[n]||{},{}),(!l[n]||$.isEmptyObject(l[n])&&$.isEmptyObject(s[n]))&&delete l[n]):(i[n]!=s[n]||null==i[n]&&null!=s[n])&&(l[n]=i[n]);return $.isEmptyObject(l)?null:l}(this.record,this.original,{})),e}getCleanRecord(e){let t=$.extend(!0,{},this.record);return this.fields.forEach(i=>{if(-1!=["list","combo","enum"].indexOf(i.type)){let s={nestedFields:!0,record:t},l=this.getValue.call(s,i.field);$.isPlainObject(l)&&null!=l.id&&this.setValue.call(s,i.field,l.id),Array.isArray(l)&&l.forEach((n,r)=>{$.isPlainObject(n)&&n.id&&(l[r]=n.id)})}if("map"==i.type){let l=this.getValue.call({nestedFields:!0,record:t},i.field);l._order&&delete l._order}}),!0===e&&Object.keys(t).forEach(i=>{this.get(i)||delete t[i]}),t}request(e,t){console.log(e);let i=this;if("function"==typeof e&&(t=e,e=null),null==e&&(e={}),!this.url||"object"==typeof this.url&&!this.url.get)return;null==this.recid&&(this.recid=0);let s={cmd:"get"};s.recid=this.recid,s.name=this.name,$.extend(s,this.postData),$.extend(s,e);let l=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:s,httpHeaders:this.httpHeaders});if(!0===l.isCancelled)return void("function"==typeof t&&t({status:"error",message:w2utils.lang("Request aborted.")}));this.record={},this.original=null,this.lock(w2utils.lang(this.msgRefresh));let n=l.url;if("object"==typeof l.url&&l.url.get&&(n=l.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(h){}if(!$.isEmptyObject(i.routeData)){let h=w2utils.parseRoute(n);if(h.keys.length>0)for(let u=0;u<h.keys.length;u++)null!=i.routeData[h.keys[u].name]&&(n=n.replace(new RegExp(":"+h.keys[u].name,"g"),i.routeData[h.keys[u].name]))}let r={type:"POST",url:n,data:l.postData,headers:l.httpHeaders,dataType:"json"};null!=localStorage.getItem("token")&&(r.headers.Authorization="Bearer "+localStorage.getItem("token")),null!=localStorage.getItem("lang")&&(r.headers["Accept-Language"]=localStorage.getItem("lang"));let o=i.dataType||w2utils.settings.dataType;switch(l.dataType&&(o=l.dataType),o){case"HTTP":r.data=String($.param(r.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":r.data={request:JSON.stringify(r.data)};break;case"RESTFULL":r.type="GET",r.data=String($.param(r.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":r.type="GET",r.data=JSON.stringify(r.data),r.contentType="application/json";break;case"JSON":r.type="POST",r.data=JSON.stringify(r.data),r.contentType="application/json"}this.method&&(r.type=this.method),l.method&&(r.type=l.method),this.last.xhr=$.ajax(r).done((h,u,g)=>{i.unlock(),null==(h=g.responseJSON)&&(h={status:"error",message:w2utils.lang(i.msgNotJSON),responseText:g.responseText});let c=i.trigger({phase:"before",target:i.name,type:"load",data:h,xhr:g});!0!==c.isCancelled?("error"===c.data.status?i.error(w2utils.lang(c.data.message)):i.record=$.extend({},c.data.record),i.trigger($.extend(c,{phase:"after"})),i.refresh(),i.applyFocus(),"function"==typeof t&&t(c.data)):"function"==typeof t&&t({status:"error",message:w2utils.lang("Request aborted.")})}).fail((h,u,g)=>{let m=i.trigger({phase:"before",type:"error",error:{status:u,error:g,rawResponseText:h.responseText},xhr:h});if(!0!==m.isCancelled){if("abort"!==u){let w;try{w="object"==typeof h.responseJSON?h.responseJSON:JSON.parse(h.responseText)}catch(_){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof w?w:h.responseText),i.unlock()}i.trigger($.extend(m,{phase:"after"}))}}),this.trigger($.extend(l,{phase:"after"}))}submit(e,t){return this.save(e,t)}save(e,t){let i=this;if($(this.box).find(":focus").change(),"function"==typeof e&&(t=e,e=null),0===i.validate(!0).length){if(null==e&&(e={}),!i.url||"object"==typeof i.url&&!i.url.save)return void console.log("ERROR: Form cannot be saved because no url is defined.");i.lock(w2utils.lang(i.msgSaving)+' <span id="'+i.name+'_progress"></span>'),setTimeout(()=>{let l={cmd:"save"};l.recid=i.recid,l.name=i.name,$.extend(l,i.postData),$.extend(l,e),i.multipart||i.fields.forEach(g=>{"file"===g.type&&Array.isArray(i.getValue(g.field))&&i.getValue(g.field).forEach(c=>{delete c.file})}),l.record=$.extend(!0,{},i.record);let n=i.trigger({phase:"before",type:"submit",target:i.name,url:i.url,postData:l,httpHeaders:i.httpHeaders});if(!0===n.isCancelled)return;let r=n.url;if("object"==typeof n.url&&n.url.save&&(r=n.url.save),i.last.xhr)try{i.last.xhr.abort()}catch(g){}if(!$.isEmptyObject(i.routeData)){let g=w2utils.parseRoute(r);if(g.keys.length>0)for(let c=0;c<g.keys.length;c++)null!=i.routeData[g.keys[c].name]&&(r=r.replace(new RegExp(":"+g.keys[c].name,"g"),i.routeData[g.keys[c].name]))}let o={type:"POST",url:r,data:n.postData,headers:n.httpHeaders,dataType:"json",xhr(){let g=new window.XMLHttpRequest;return g.upload.addEventListener("progress",function(m){if(m.lengthComputable){let w=i.trigger({phase:"before",type:"progress",total:m.total,loaded:m.loaded,originalEvent:m});if(!0===w.isCancelled)return;let _=Math.round(m.loaded/m.total*100);(_&&100!=_||""!=$("#"+i.name+"_progress").text())&&$("#"+i.name+"_progress").text(_+"%"),i.trigger($.extend(w,{phase:"after"}))}},!1),g}};null!=localStorage.getItem("token")&&(o.headers.Authorization="Bearer "+localStorage.getItem("token")),null!=localStorage.getItem("lang")&&(o.headers["Accept-Language"]=localStorage.getItem("lang"));let h=i.dataType||w2utils.settings.dataType;switch(n.dataType&&(h=n.dataType),h){case"HTTP":o.data=String($.param(o.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":o.data={request:JSON.stringify(o.data)};break;case"RESTFULL":0!==i.recid&&null!=i.recid&&(o.type="PUT"),o.data=String($.param(o.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":0!==i.recid&&null!=i.recid&&(o.type="PUT"),o.data=JSON.stringify(o.data),o.contentType="application/json";break;case"JSON":if(o.type="POST",o.contentType="application/json",i.multipart){let g=function(m,w,_,k){function E(I,N,L){if("object"==typeof I&&I instanceof File&&m.append(L,I),"object"==typeof I)if(I&&I.constructor===Array)for(let f=0;f<I.length;f++)E(I[f],N&&N[f],L+"["+f+"]");else g(m,I,N,L)}null==k&&(k="");for(let I in w)E(w[I],_&&_[I],""==k?I:"${p}[${prop}]")},c=new FormData;c.append("__body",JSON.stringify(o.data)),g(c,o.data),o.data=c,o.contentType=!1,o.processData=!1}else o.data=JSON.stringify(o.data)}console.log(o),this.method&&(o.type=this.method),n.method&&(o.type=n.method),i.last.xhr=$.ajax(o).done((g,c,m)=>{i.unlock();let w=i.trigger({phase:"before",target:i.name,type:"save",xhr:m,status:c,data:g});!0!==w.isCancelled&&(null==(g=m.responseJSON)&&(g={status:"error",message:w2utils.lang(i.msgNotJSON),responseText:m.responseText}),"error"===g.status?i.error(w2utils.lang(g.message)):i.original=null,i.trigger($.extend(w,{phase:"after"})),i.refresh(),"function"==typeof t&&t(g,m))}).fail((g,c,m)=>{let w={status:c,error:m,rawResponseText:g.responseText},_=i.trigger({phase:"before",type:"error",error:w,xhr:g});if(!0!==_.isCancelled){var k=/(?<=\')([\w ]*)(?=\')/gm;g.responseJSON.message=g.responseJSON.Message?g.responseJSON.Message:g.responseJSON.message,g.responseJSON.message?(null!=g.responseJSON.message.match(k)&&g.responseJSON.message.match(k).forEach(E=>{g.responseJSON.message=g.responseJSON.message.replace(E,w2utils.lang(E.replaceAll(" ","")))}),i.error(w2utils.lang(g.responseJSON.message.replaceAll("--","</br>")))):i.error(w2utils.lang("UndefinedError")),console.log(g),console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",w),i.unlock(),i.trigger($.extend(_,{phase:"after"}))}}),i.trigger($.extend(n,{phase:"after"}))},50)}}lock(e,t){let i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),setTimeout(()=>{w2utils.lock.apply(window,i)},10)}unlock(e){let t=this.box;setTimeout(()=>{w2utils.unlock(t,e)},25)}lockPage(e,t,i){let s=$(this.box).find(".page-"+e);return!!s.length&&(w2utils.lock(s,t,i),!0)}unlockPage(e,t){let i=$(this.box).find(".page-"+e);return!!i.length&&(w2utils.unlock(i,t),!0)}goto(e){this.page!==e&&(null!=e&&(this.page=e),!0===$(this.box).data("auto-size")&&$(this.box).height(0),this.refresh())}generateHTML(){let i,s,l,n,r,e=[],t="";for(let h=0;h<this.fields.length;h++){l="",n=this.tabindexBase+h+1,r=' tabindex="'+n+'"';let u=this.fields[h];null==u.html&&(u.html={}),null==u.options&&(u.options={}),null!=u.html.caption&&null==u.html.label&&(console.log("NOTICE: form field.html.caption property is deprecated, please use field.html.label. Field ->",u),u.html.label=u.html.caption),null==u.html.label&&(u.html.label=u.field),u.html=$.extend(!0,{label:"",span:6,attr:"",text:"",style:"",page:0,column:0},u.html),null==i&&(i=u.html.page),null==s&&(s=u.html.column);let g='<input id="'+u.field+'" name="'+u.field+'" class="w2ui-input" type="text" '+u.html.attr+r+' autocomplete="off" >';switch(u.type){case"pass":case"password":g='<input id="'+u.field+'" name="'+u.field+'" class="w2ui-input" type = "password" '+u.html.attr+r+">";break;case"check":case"checks":{null==u.options.items&&null!=u.html.items&&(u.options.items=u.html.items);let c=u.options.items;g="",Array.isArray(c)||(c=[]),c.length>0&&(c=w2utils.normMenu.call(this,c,u));for(let m=0;m<c.length;m++)g+='<label class="w2ui-box-label">  <input id="'+u.field+m+'" name="'+u.field+'" class="w2ui-input" type="checkbox" '+u.html.attr+r+' data-value="'+c[m].id+'" data-index="'+m+'"><span>&#160;'+c[m].text+"</span></label><br>";break}case"checkbox":g='<label class="w2ui-box-label">   <input id="'+u.field+'" name="'+u.field+'" class="w2ui-input" type="checkbox" '+u.html.attr+r+">   <span>"+u.html.label+"</span></label>";break;case"radio":{g="",null==u.options.items&&null!=u.html.items&&(u.options.items=u.html.items);let c=u.options.items;Array.isArray(c)||(c=[]),c.length>0&&(c=w2utils.normMenu.call(this,c,u));for(let m=0;m<c.length;m++)g+='<label class="w2ui-box-label">  <input id="'+u.field+m+'" name="'+u.field+'" class="w2ui-input" type = "radio" '+u.html.attr+(0===m?r:"")+' value="'+c[m].id+'"><span>&#160;'+c[m].text+"</span></label><br>";break}case"select":{g='<select id="'+u.field+'" name="'+u.field+'" class="w2ui-input" '+u.html.attr+r+">",null==u.options.items&&null!=u.html.items&&(u.options.items=u.html.items);let c=u.options.items;Array.isArray(c)||(c=[]),c.length>0&&(c=w2utils.normMenu.call(this,c,u));for(let m=0;m<c.length;m++)g+='<option value="'+c[m].id+'">'+c[m].text+"</option>";g+="</select>";break}case"textarea":g='<textarea id="'+u.field+'" name="'+u.field+'" class="w2ui-input" '+u.html.attr+r+"></textarea>";break;case"toggle":g='<input id="'+u.field+'" name="'+u.field+'" type="checkbox" '+u.html.attr+r+' class="w2ui-input w2ui-toggle"><div><div></div></div>';break;case"map":case"array":u.html.key=u.html.key||{},u.html.value=u.html.value||{},u.html.tabindex_str=r,g='<span style="float: right">'+(u.html.text||"")+'</span><input id="'+u.field+'" name="'+u.field+'" type="hidden" '+u.html.attr+r+'><div class="w2ui-map-container"></div>';break;case"div":case"custom":g='<div id="'+u.field+'" name="'+u.field+'" '+u.html.attr+r+' class="w2ui-input">'+(u&&u.html&&u.html.html?u.html.html:"")+"</div>";break;case"html":case"empty":g=u&&u.html?(u.html.html||"")+(u.html.text||""):""}if(""!==t&&(i!=u.html.page||s!=u.html.column||u.html.group&&t!=u.html.group)&&(e[i][s]+="\n   </div>\n  </div>",t=""),u.html.group&&t!=u.html.group){let c="";u.html.groupCollapsible&&(c='<span class="w2ui-icon-collapse" style="width: 15px; display: inline-block; position: relative; top: -2px;"></span>'),l+='\n <div class="w2ui-group">\n   <div class="w2ui-group-title" style="'+(u.html.groupTitleStyle||"")+"; "+(""!=c?"cursor: pointer; user-select: none":"")+'"'+(""!=c?'data-group="'+w2utils.base64encode(u.html.group)+'"':"")+(""!=c?"onclick=\"w2ui['"+this.name+"'].toggleGroup('"+u.html.group+"')\"":"")+">"+c+u.html.group+'</div>\n   <div class="w2ui-group-fields" style="'+(u.html.groupStyle||"")+'">',t=u.html.group}if(null==u.html.anchor){let c=null!=u.html.span?"w2ui-span"+u.html.span:"";-1==u.html.span&&(c="w2ui-span-none");let m="<label"+("none"==c?' style="display: none"':"")+">"+w2utils.lang("checkbox"!=u.type?u.html.label:u.html.text,!0)+"</label>";u.html.label||(m=""),l+='\n      <div class="w2ui-field '+c+'" style="'+(u.hidden?"display: none;":"")+u.html.style+'">\n         '+m+("empty"===u.type?g:"\n         <div>"+g+("array"!=u.type&&"map"!=u.type?w2utils.lang("checkbox"!=u.type?u.html.text:"",!0):"")+"</div>")+"\n      </div>"}else e[u.html.page].anchors=e[u.html.page].anchors||{},e[u.html.page].anchors[u.html.anchor]='<div class="w2ui-field w2ui-field-inline" style="'+(u.hidden?"display: none;":"")+u.html.style+'">'+("empty"===u.type?g:"<div>"+w2utils.lang("checkbox"!=u.type?u.html.label:u.html.text,!0)+g+w2utils.lang("checkbox"!=u.type?u.html.text:"",!0)+"</div>")+"</div>";null==e[u.html.page]&&(e[u.html.page]={}),null==e[u.html.page][u.html.column]&&(e[u.html.page][u.html.column]=""),e[u.html.page][u.html.column]+=l,i=u.html.page,s=u.html.column}if(""!==t&&(e[i][s]+="\n   </div>\n  </div>"),this.tabs.tabs)for(let h=0;h<this.tabs.tabs.length;h++)null==e[h]&&(e[h]=[]);let o="";if(!$.isEmptyObject(this.actions)){o+='\n<div class="w2ui-buttons">',n=this.tabindexBase+this.fields.length+1;for(let h in this.actions){let u=this.actions[h],g={text:"",style:"",class:""};$.isPlainObject(u)?(null==u.text&&null!=u.caption&&(console.log("NOTICE: form action.caption property is deprecated, please use action.text. Action ->",u),u.text=u.caption),u.text&&(g.text=u.text),u.style&&(g.style=u.style),u.class&&(g.class=u.class)):(g.text=h,g.class=-1!==["save","update","create"].indexOf(h.toLowerCase())?"w2ui-btn-blue":""),o+='\n    <button name="'+h+'" class="w2ui-btn '+g.class+'" style="'+g.style+'" tabindex="'+n+'">'+w2utils.lang(g.text,!0)+"</button>",n++}o+="\n</div>"}l="";for(let h=0;h<e.length;h++){if(l+='<div class="w2ui-page page-'+h+'" style="'+(0!==h?"display: none;":"")+this.pageStyle+'">',!e[h])return console.log(`ERROR: Page ${h} does not exist`),!1;e[h].before&&(l+=e[h].before),l+='<div class="w2ui-column-container">',Object.keys(e[h]).sort().forEach((u,g)=>{u==parseInt(u)&&(l+='<div class="w2ui-column col-'+u+'">'+(e[h][u]||"")+"\n</div>")}),l+="\n</div>",e[h].after&&(l+=e[h].after),l+="\n</div>",e[h].anchors&&Object.keys(e[h].anchors).forEach((u,g)=>{l=l.replace(u,e[h].anchors[u])})}return l+=o,l}toggleGroup(e,t){let i=$(this.box).find('.w2ui-group-title[data-group="'+w2utils.base64encode(e)+'"]');if(!i||!i.length)return;let s=i.next();if(void 0===t&&(t="none"==s.css("display")),t)s.slideDown(300),s.next().remove(),i.find("span").addClass("w2ui-icon-collapse").removeClass("w2ui-icon-expand");else{s.slideUp(300);let l="width: "+s.css("width")+";padding-left: "+s.css("padding-left")+";padding-right: "+s.css("padding-right")+";margin-left: "+s.css("margin-left")+";margin-right: "+s.css("margin-right")+";";setTimeout(()=>{s.after('<div style="height: 5px;'+l+'"></div>')},100),i.find("span").addClass("w2ui-icon-expand").removeClass("w2ui-icon-collapse")}}action(e,t){let i=this.actions[e],s=i;$.isPlainObject(i)&&i.onClick&&(s=i.onClick);let l=this.trigger({phase:"before",target:e,type:"action",action:i,originalEvent:t});!0!==l.isCancelled&&("function"==typeof s&&s.call(this,t),this.trigger($.extend(l,{phase:"after"})))}resize(){let e=this,t=this.trigger({phase:"before",target:this.name,type:"resize"});if(!0===t.isCancelled)return;let i=$(this.box).find("> div.w2ui-form-box"),s=$(this.box).find("> div .w2ui-form-header"),l=$(this.box).find("> div .w2ui-form-toolbar"),n=$(this.box).find("> div .w2ui-form-tabs"),r=$(this.box).find("> div .w2ui-page"),o=$(this.box).find("> div .w2ui-page.page-"+this.page),h=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),u=$(this.box).find("> div .w2ui-buttons");function g(){i.width($(e.box).width()).height($(e.box).height()),l.css("top",""!==e.header?w2utils.getSize(s,"height"):0),n.css("top",(""!==e.header?w2utils.getSize(s,"height"):0)+("object"==typeof e.toolbar&&Array.isArray(e.toolbar.items)&&e.toolbar.items.length>0?w2utils.getSize(l,"height"):0)),r.css("top",(""!==e.header?w2utils.getSize(s,"height"):0)+("object"==typeof e.toolbar&&Array.isArray(e.toolbar.items)&&e.toolbar.items.length>0?w2utils.getSize(l,"height")+5:0)+("object"==typeof e.tabs&&Array.isArray(e.tabs.tabs)&&e.tabs.tabs.length>0?w2utils.getSize(n,"height")+5:0)),r.css("bottom",u.length>0?w2utils.getSize(u,"height"):0)}g(),this.autosize&&((0===parseInt($(this.box).height())||!0===$(this.box).data("auto-size"))&&($(this.box).height((s.length>0?w2utils.getSize(s,"height"):0)+("object"==typeof this.tabs&&Array.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?w2utils.getSize(n,"height"):0)+("object"==typeof this.toolbar&&Array.isArray(this.toolbar.items)&&this.toolbar.items.length>0?w2utils.getSize(l,"height"):0)+(r.length>0?w2utils.getSize(h,"height")+w2utils.getSize(o,"+height")+12:0)+(u.length>0?w2utils.getSize(u,"height"):0)),$(this.box).data("auto-size",!0)),g()),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.tabs&&this.tabs.resize&&this.tabs.resize(),e.trigger($.extend(t,{phase:"after"}))}refresh(){let e=(new Date).getTime(),t=this;if(!this.box||!this.isGenerated||null==$(this.box).html())return;let i=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:arguments[0],fields:arguments});if(!0===i.isCancelled)return;let s=Array.from(this.fields.keys());arguments.length>0?s=Array.from(arguments).map((n,r)=>("string"!=typeof n&&console.log("ERROR: Arguments in refresh functions should be field names"),this.get(n,!0))).filter((n,r)=>null!=n):($(this.box).find("input, textarea, select").each((n,r)=>{let o=null!=$(r).attr("name")?$(r).attr("name"):$(r).attr("id"),h=t.get(o);if(h){let u=$(r).closest(".w2ui-page");if(u.length>0)for(let g=0;g<100;g++)if(u.hasClass("page-"+g)){h.page=g;break}}}),$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&Array.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&Array.isArray(this.toolbar.items)&&this.toolbar.items.length>0?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide());for(let n=0;n<s.length;n++){let r=this.fields[s[n]];null==r.name&&null!=r.field&&(r.name=r.field),null==r.field&&null!=r.name&&(r.field=r.name),r.$el=$(this.box).find('[name="'+String(r.name).replace(/\\/g,"\\\\")+'"]'),r.el=r.$el[0],r.el&&(r.el.id=r.name);let o=$(r).data("w2field");if(o&&o.clear(),$(r.$el).off(".w2form").on("change.w2form",function(h){let u=this,g=t.get(this.name);if(null==g)return;if(1==$(this).data("skip_change"))return void $(this).data("skip_change",!1);let c=this.value,m=t.getValue(this.name);if(null==m&&(m=""),-1!==["list","enum","file"].indexOf(g.type)&&$(this).data("selected")){let k=$(this).data("selected"),E=t.getValue(this.name);if(Array.isArray(k)){c=[];for(let I=0;I<k.length;I++)c[I]=$.extend(!0,{},k[I])}if($.isPlainObject(k)&&(c=$.extend(!0,{},k)),Array.isArray(E)){m=[];for(let I=0;I<E.length;I++)m[I]=$.extend(!0,{},E[I])}$.isPlainObject(E)&&(m=$.extend(!0,{},E))}if(-1!==["toggle","checkbox"].indexOf(g.type)&&(c=!!$(this).prop("checked")&&("on"===$(this).prop("value")||$(this).prop("value"))),-1!==["check","checks"].indexOf(g.type)){Array.isArray(m)||(m=[]),c=m.slice();let k=g.options.items[$(this).attr("data-index")];$(this).prop("checked")?c.push(k.id):c.splice(c.indexOf(k.id),1)}if(-1!==["int","float","percent","money","currency"].indexOf(g.type)&&(c=$(this).data("w2field").clean(c)),c===m)return;let w=t.trigger({phase:"before",target:this.name,type:"change",value_new:c,value_previous:m,originalEvent:h});!0===w.isCancelled&&(w.value_new=t.getValue(this.name),$(this).val()!==w.value_new&&($(this).data("skip_change",!0),setTimeout(()=>{$(u).data("skip_change",!1)},10)),$(this).val(w.value_new));let _=w.value_new;if(-1!==["enum","file"].indexOf(g.type)&&_.length>0){let k=$(g.el).data("w2field").helpers.multi;$(k).removeClass("w2ui-error")}(""===_||null==_||Array.isArray(_)&&0===_.length||$.isPlainObject(_)&&$.isEmptyObject(_))&&(_=null),t.setValue(this.name,_),t.trigger($.extend(w,{phase:"after"}))}).on("input.w2form",function(h){let u=this.value;"checkbox"==h.target.type&&(u=h.target.checked),null==t.original&&(t.original=$.isEmptyObject(t.record)?{}:$.extend(!0,{},t.record));let g=t.trigger({phase:"before",target:this.name,type:"input",value_new:u,originalEvent:h});!0!==g.isCancelled&&t.trigger($.extend(g,{phase:"after"}))}),r.required?$(r.el).parent().parent().addClass("w2ui-required"):$(r.el).parent().parent().removeClass("w2ui-required"),null!=r.disabled){let h=$(r.el);r.disabled?(null==h.data("w2ui-tabIndex")&&h.data("w2ui-tabIndex",h.prop("tabIndex")),$(r.el).prop("readonly",!0).prop("tabindex",-1).closest(".w2ui-field").addClass("w2ui-disabled")):$(r.el).prop("readonly",!1).prop("tabIndex",h.data("w2ui-tabIndex")).closest(".w2ui-field").removeClass("w2ui-disabled")}o=r.el,o||(o=$(this.box).find("#"+r.field)),r.hidden?$(o).closest(".w2ui-field").hide():$(o).closest(".w2ui-field").show()}$(this.box).find("button, input[type=button]").each((n,r)=>{$(r).off("click").on("click",function(o){let h=this.value;this.id&&(h=this.id),this.name&&(h=this.name),t.action(h,o)})});for(let n=0;n<s.length;n++){let r=this.fields[s[n]],o=null!=this.getValue(r.name)?this.getValue(r.name):"";if(r.el)switch($(r.el).hasClass("w2ui-input")||$(r.el).addClass("w2ui-input"),r.type=String(r.type).toLowerCase(),r.options||(r.options={}),r.type){case"text":case"textarea":case"email":case"pass":case"password":r.el.value=o;break;case"int":case"float":case"money":case"currency":case"percent":case"hex":case"alphanumeric":case"color":case"date":case"time":case"datetime":r.el.value=o,$(r.el).w2field($.extend({},r.options,{type:r.type}));break;case"toggle":w2utils.isFloat(o)&&(o=parseFloat(o)),$(r.el).prop("checked",!!o),this.setValue(r.name,o||!1);break;case"radio":$(r.$el).prop("checked",!1).each((c,m)=>{$(m).val()==o&&$(m).prop("checked",!0)});break;case"checkbox":$(r.el).prop("checked",!!o),(!0===r.disabled||!1===r.disabled)&&$(r.el).prop("disabled",!!r.disabled);break;case"check":case"checks":Array.isArray(o)&&o.forEach(c=>{$(r.el).closest("div").find('[data-value="'+c+'"]').prop("checked",!0)}),r.disabled?$(r.el).closest("div").find("input[type=checkbox]").prop("disabled",!0):$(r.el).closest("div").find("input[type=checkbox]").removeProp("disabled");break;case"list":case"combo":if("list"===r.type){let c=$.isPlainObject(o)?o.id:$.isPlainObject(r.options.selected)?r.options.selected.id:o;r.options.items||(r.options.items=[]);let m=r.options.items;"function"==typeof m&&(m=m());let w=!1;if(Array.isArray(m))for(let _=0;_<m.length;_++){let k=m[_];if(k.id==c){o=$.extend(!0,{},k),t.setValue(r.name,o),w=!0;break}}!w&&null!=o&&""!==o&&r.$el.data("find_selected",o)}else r.el.value="combo"!==r.type||$.isPlainObject(o)?$.isPlainObject(o)&&null!=o.text?o.text:"":o;$.isPlainObject(o)||(o={}),$(r.el).w2field($.extend({},r.options,{type:r.type,selected:o}));break;case"enum":case"file":let h=[],u=!1;Array.isArray(o)||(o=[]),"function"!=typeof r.options.items&&(Array.isArray(r.options.items)||(r.options.items=[]),o.forEach(c=>{r.options.items.forEach(m=>{m&&(m.id==c||$.isPlainObject(c)&&m.id==c.id)&&(h.push($.isPlainObject(m)?$.extend(!0,{},m):m),u=!0)})})),!u&&null!=o&&0!==o.length&&(r.$el.data("find_selected",o),h=o);let g=$.extend({},r.options,{type:r.type,selected:h});Object.keys(r.options).forEach(c=>{"function"==typeof r.options[c]&&(g[c]=r.options[c])}),$(r.el).w2field(g);break;case"select":{let c=r.options.items;if(null!=c&&c.length>0){c=w2utils.normMenu.call(this,c,r),$(r.el).html("");for(let m=0;m<c.length;m++)$(r.el).append('<option value="'+c[m].id+'">'+c[m].text+"</option")}$(r.el).val(o);break}case"map":case"array":"map"==r.type&&"string"==typeof o&&""!=o&&(o=JSON.parse(o),o._order=Object.keys(o)),"map"==r.type&&(null==o||!$.isPlainObject(o))&&(this.setValue(r.field,{}),o=this.getValue(r.field)),"array"==r.type&&(null==o||!Array.isArray(o))&&(this.setValue(r.field,[]),o=this.getValue(r.field)),function(m,w){w.el.mapAdd=function(_,k,E){let I=(_.disabled?" readOnly ":"")+(_.html.tabindex_str||""),N='<div class="w2ui-map-field" style="margin-bottom: 5px"><input id="'+_.field+"_key_"+E+'" data-cnt="'+E+'" type="text" '+_.html.key.attr+I+` class="w2ui-input w2ui-map key" placeholder="${w2utils.lang("Key")}">`+(_.html.key.text||"")+'<span>=></span> <input id="'+_.field+"_value_"+E+'" data-cnt="'+E+'" type="text" '+_.html.value.attr+I+` class="w2ui-input w2ui-map value" placeholder="${w2utils.lang("Value")}">`+(_.html.value.text||"")+"</div>";k.append(N)},w.el.mapRefresh=function(_,k){let I,N,L,E=1;"map"==w.type&&($.isPlainObject(_)||(_={}),null==_._order&&(_._order=Object.keys(_)),I=_._order),"array"==w.type&&(Array.isArray(_)||(_=[]),I=_.map(B=>B.key)),I.forEach(B=>{N=k.find("#"+w2utils.escapeId(w.name)+"_key_"+E),L=k.find("#"+w2utils.escapeId(w.name)+"_value_"+E),(0==N.length||0==L.length)&&(w.el.mapAdd(w,k,E),N=k.find("#"+w2utils.escapeId(w.name)+"_key_"+E),L=k.find("#"+w2utils.escapeId(w.name)+"_value_"+E));let Q=_[B];if("array"==w.type){let X=_.filter(ne=>ne.key==B);X.length>0&&(Q=X[0].value)}N.val(B),L.val(Q),(!0===w.disabled||!1===w.disabled)&&(N.prop("readOnly",!!w.disabled),L.prop("readOnly",!!w.disabled)),N.parents(".w2ui-map-field").attr("data-key",B),E++});let f=k.find("#"+w2utils.escapeId(w.name)+"_key_"+E).parent(),H=k.find("#"+w2utils.escapeId(w.name)+"_key_"+(E+1)).parent();0===f.length&&!(N&&(!0===N.prop("readOnly")||!0===N.prop("disabled")))&&w.el.mapAdd(w,k,E),1==f.length&&1==H.length&&(f.removeAttr("data-key"),f.find(".key").val(H.find(".key").val()),f.find(".value").val(H.find(".value").val()),H.remove()),(!0===w.disabled||!1===w.disabled)&&(f.find(".key").prop("readOnly",!!w.disabled),f.find(".value").prop("readOnly",!!w.disabled)),$(w.el).next().find("input.w2ui-map").off(".mapChange").on("keyup.mapChange",function(B){let Q=$(B.target).parents(".w2ui-map-field");13==B.keyCode&&Q.next().find("input.key").focus()}).on("change.mapChange",function(){let B=$(event.target).parents(".w2ui-map-field"),Q=B.attr("data-key"),X=B.find(".key").val(),ne=B.find(".value").val(),re={},le={},J=null,ge=null;re[X]=ne,"array"==w.type&&(_.forEach((Ye,Xe)=>{Ye.key==Q&&(ge=Xe)}),J=_[ge]),null!=Q&&"map"==w.type&&(le[Q]=_[Q]),null!=Q&&"array"==w.type&&(le[Q]=J.value);let xe=m.trigger({phase:"before",target:w.field,type:"change",originalEvent:event,value_new:re,value_previous:le});if(!0!==xe.isCancelled){if("map"==w.type){delete _[Q];let Ye=_._order.indexOf(Q);if(""!=X){if(null!=_[X]){let Xe,Ve=0;do{Ve++,Xe=X+Ve}while(null!=_[Xe]);X=Xe,B.find(".key").val(Xe)}_[X]=ne,B.attr("data-key",X),-1!=Ye?_._order[Ye]=X:_._order.push(X)}else _._order.splice(Ye,1),B.find(".value").val("")}else"array"==w.type&&(""!=X?null==J?_.push({key:X,value:ne}):(J.key=X,J.value=ne):_.splice(ge,1));m.setValue(w.field,_),w.el.mapRefresh(_,k),m.trigger($.extend(xe,{phase:"after"}))}})},w.el.mapRefresh(o,$(w.el).parent().find(".w2ui-map-container"))}(this,r);break;case"div":case"custom":$(r.el).html(o);break;case"html":case"empty":break;default:$(r.el).val(o),$(r.el).w2field($.extend({},r.options,{type:r.type}))}}let l=$(this.box).find(".w2ui-page");for(let n=0;n<l.length;n++)$(l[n]).find("> *").length>1&&$(l[n]).wrapInner("<div></div>");return this.trigger($.extend(i,{phase:"after"})),this.resize(),(new Date).getTime()-e}render(e){let t=(new Date).getTime(),i=this;if("object"==typeof e&&($(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=e),!this.isGenerated||!this.box)return;let s=this.trigger({phase:"before",target:this.name,type:"render",box:null!=e?e:this.box});if(!0===s.isCancelled)return;let l='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>";return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(l),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=new w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(r){let o=i.trigger({phase:"before",type:"toolbar",target:r.target,originalEvent:r});!0!==o.isCancelled&&i.trigger($.extend(o,{phase:"after"}))})),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=new w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",function(r){i.goto(this.get(r.target,!0))})),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active)),this.trigger($.extend(s,{phase:"after"})),this.resize(),("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request():this.refresh(),0===$(".w2ui-layout").length&&(this.tmp_resize=function(o){null==w2ui[i.name]?$(window).off("resize.w2uiResize",i.tmp_resize):w2ui[i.name].resize()},$(window).off("resize.w2uiResize").on("resize.w2uiResize",i.tmp_resize)),-1!=this.focus&&setTimeout(()=>{0===$(i.box).find("input, select, textarea").length?setTimeout(i.applyFocus,500):i.applyFocus()},50),(new Date).getTime()-t}applyFocus(e){let t;if(void 0===e&&(e=this.focus),w2utils.isInt(e)){if(e<0)return;let i=$(this.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > :radio").not(".file-input");for(;$(i[e]).is(":hidden")&&i.length>=e;)e++;i[e]&&(t=$(i[e]))}else"string"==typeof e&&(t=$(this.box).find("[name='"+e+"']").first());return t&&t.trigger("focus"),t}destroy(){let e=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==e.isCancelled&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),$(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})),$(window).off("resize","body"))}}(function(v){if(!v)return;v.w2globals=function(){var i,s;i=window,s={w2ui,w2locale,w2event,w2utils,w2popup,w2alert,w2confirm,w2prompt,w2field,w2form,w2grid,w2layout,w2sidebar,w2tabs,w2toolbar,addType,removeType},Object.keys(s).forEach(l=>{i[l]=s[l]})};let e=String(void 0).split("?")[1]||"";function t(i,s){if(v.isPlainObject(i)){let l;return"w2form"==s&&(l=new w2form(i),this.find(".w2ui-field").length>0&&(l.formHTML=this.html())),"w2grid"==s&&(l=new w2grid(i)),"w2layout"==s&&(l=new w2layout(i)),"w2sidebar"==s&&(l=new w2sidebar(i)),"w2tabs"==s&&(l=new w2tabs(i)),"w2toolbar"==s&&(l=new w2toolbar(i)),0!==v(this).length&&l.render(this[0]),l}{let l=w2ui[v(this).attr("name")];return l?arguments.length>0?(l[i]&&l[i].apply(l,Array.prototype.slice.call(arguments,1)),this):l:null}}("globals"==e||"globals="==e.substr(0,8))&&v.w2globals(),v.fn.w2render=function(i){v(this).length>0&&("string"==typeof i&&w2ui[i]&&w2ui[i].render(v(this)[0]),"object"==typeof i&&i.render(v(this)[0]))},v.fn.w2destroy=function(i){!i&&this.length>0&&(i=this.attr("name")),"string"==typeof i&&w2ui[i]&&w2ui[i].destroy(),"object"==typeof i&&i.destroy()},v.fn.w2field=function(i,s){return 0===arguments.length?v(this).data("w2field"):this.each((l,n)=>{let r=v(n).data("w2field");return null==r?(r=new w2field(i,s),r.render(n),r):(r.clear(),"clear"===i?void 0:(r=new w2field(i,s),r.render(n),r))})},v.fn.w2form=function(i){return t.call(this,i,"w2form")},v.fn.w2grid=function(i){return t.call(this,i,"w2grid")},v.fn.w2layout=function(i){return t.call(this,i,"w2layout")},v.fn.w2sidebar=function(i){return t.call(this,i,"w2sidebar")},v.fn.w2tabs=function(i){return t.call(this,i,"w2tabs")},v.fn.w2toolbar=function(i){return t.call(this,i,"w2toolbar")},v.fn.w2popup=function(i){this.length>0?w2popup.template(this[0],null,i):i.url&&w2popup.load(i)},v.fn.w2marker=function(){let i=Array.prototype.slice.call(arguments,0);return Array.isArray(i[0])&&(i=i[0]),0!==i.length&&i[0]?v(this).each((l,n)=>{s(0,n);for(let o=0;o<i.length;o++){let h=i[o];"string"!=typeof h&&(h=String(h)),h=h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");let u=new RegExp(h+"(?!([^<]+)?>)","gi");n.innerHTML=n.innerHTML.replace(u,r)}function r(o){return'<span class="w2ui-marker">'+o+"</span>"}}):v(this).each(s);function s(l,n){for(;-1!==n.innerHTML.indexOf('<span class="w2ui-marker">');)n.innerHTML=n.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi,"$1")}},v.fn.w2tag=function(i,s){if(1===arguments.length&&"object"==typeof i&&null!=(s=i).html&&(i=s.html),null!=(s=v.extend({id:null,auto:null,html:i,position:"right|top",align:"none",left:0,top:0,maxWidth:null,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnFocus:!1,hideOnBlur:!1,hideOnClick:!1,hideOnChange:!0},s)).name&&null==s.id&&(s.id=s.name),""!==s.class&&""===s.inputClass&&(s.inputClass=s.class),0!==v(this).length)return!0===s.auto||null!=s.showOn||null!=s.hideOn?0!=arguments.length&&i?v(this).each((l,n)=>{let r="mouseenter",o="mouseleave";s.showOn&&(r=String(s.showOn).toLowerCase(),delete s.showOn),s.hideOn&&(o=String(s.hideOn).toLowerCase(),delete s.hideOn),s.position||(s.position="top|bottom"),v(n).off(".w2tooltip").on(r+".w2tooltip",function(){s.auto=!1,v(this).w2tag(i,s)}).on(o+".w2tooltip",function(){v(this).w2tag()})}):v(this).each((l,n)=>{v(n).off(".w2tooltip")}):v(this).each((l,n)=>{let r,o=s.id?s.id:n.id;""==o&&(o=v(n).find("input").attr("id")),o||(o="noid");let h=w2utils.escapeId(o);if(null!=v(this).data("w2tag")?(r=v(this).data("w2tag"),v.extend(r.options,s)):r={id:o,attachedTo:n,box:v("#w2ui-tag-"+h),options:v.extend({},s),init:u,hide:function g(){r.box.length<=0||(r.tmp.timer&&clearTimeout(r.tmp.timer),r.box.remove(),r.options.hideOnClick&&v("body").off(".w2tag"+(r.id||"")),v(r.attachedTo).off(".w2tag").removeClass(r.options.inputClass).removeData("w2tag"),v(r.attachedTo).length>0&&(v(r.attachedTo)[0].style.cssText=r.tmp.originalCSS),"function"==typeof r.options.onHide&&r.options.onHide())},getPos:m,isMoved:c,tmp:{}},""===i||null==i)r.hide();else if(0!==r.box.length)r.box.find(".w2ui-tag-body").css(r.options.css).attr("style",r.options.style).addClass(r.options.className).html(r.options.html);else{r.tmp.originalCSS="",v(r.attachedTo).length>0&&(r.tmp.originalCSS=v(r.attachedTo)[0].style.cssText);let w="white-space: nowrap;";r.options.maxWidth&&w2utils.getStrWidth(i)>r.options.maxWidth&&(w="width: "+r.options.maxWidth+"px"),v("body").append('<div onclick="event.stopPropagation()" style="display: none;" id="w2ui-tag-'+r.id+'"        class="w2ui-tag '+(v(r.attachedTo).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; '+w+'">      <div class="w2ui-tag-body '+r.options.className+'" style="'+(r.options.style||"")+'">'+i+"</div>   </div></div>"),r.box=v("#w2ui-tag-"+h),v(r.attachedTo).data("w2tag",r),setTimeout(u,1)}return;function u(){if(r.box.css("display","block"),!r||!r.box||!v(r.attachedTo).offset())return;let w=r.getPos();r.box.css({opacity:"1",left:w.left+"px",top:w.top+"px"}).data("w2tag",r).find(".w2ui-tag-body").addClass(w.posClass),r.tmp.pos=w.left+"x"+w.top,v(r.attachedTo).off(".w2tag").css(r.options.css).addClass(r.options.inputClass),r.options.hideOnKeyPress&&v(r.attachedTo).on("keypress.w2tag",r.hide),r.options.hideOnFocus&&v(r.attachedTo).on("focus.w2tag",r.hide),s.hideOnChange&&("INPUT"===n.nodeName?v(n).on("change.w2tag",r.hide):v(n).find("input").on("change.w2tag",r.hide)),r.options.hideOnBlur&&v(r.attachedTo).on("blur.w2tag",r.hide),r.options.hideOnClick&&v("body").on("click.w2tag"+(r.id||""),r.hide),"function"==typeof r.options.onShow&&r.options.onShow(),c()}function c(w){let _=v(r.attachedTo).offset();if(0===v(r.attachedTo).length||0===_.left&&0===_.top||0===r.box.find(".w2ui-tag-body").length)return void r.hide();let k=m();r.tmp.pos!==k.left+"x"+k.top&&(r.box.css(w2utils.cssPrefix({transition:w?"0s":".2s"})).css({left:k.left+"px",top:k.top+"px"}),r.tmp.pos=k.left+"x"+k.top),r.tmp.timer&&clearTimeout(r.tmp.timer),r.tmp.timer=setTimeout(c,100)}function m(){let w=v(r.attachedTo).offset(),_="w2ui-tag-right",k=parseInt(w.left+r.attachedTo.offsetWidth+(r.options.left?r.options.left:0)),E=parseInt(w.top+(r.options.top?r.options.top:0)),I=r.box.find(".w2ui-tag-body"),N=I[0].offsetWidth,L=I[0].offsetHeight;if("string"==typeof r.options.position&&-1!==r.options.position.indexOf("|")&&(r.options.position=r.options.position.split("|")),"top"===r.options.position)_="w2ui-tag-top",k=parseInt(w.left+(r.options.left?r.options.left:0))-14,E=parseInt(w.top+(r.options.top?r.options.top:0))-L-10;else if("bottom"===r.options.position)_="w2ui-tag-bottom",k=parseInt(w.left+(r.options.left?r.options.left:0))-14,E=parseInt(w.top+r.attachedTo.offsetHeight+(r.options.top?r.options.top:0))+10;else if("left"===r.options.position)_="w2ui-tag-left",k=parseInt(w.left+(r.options.left?r.options.left:0))-N-20,E=parseInt(w.top+(r.options.top?r.options.top:0));else if(Array.isArray(r.options.position)){let f=window.innerWidth,H=window.innerHeight;for(let B=0;B<r.options.position.length;B++){let Q=r.options.position[B];if("right"===Q){if(_="w2ui-tag-right",k=parseInt(w.left+r.attachedTo.offsetWidth+(r.options.left?r.options.left:0)),E=parseInt(w.top+(r.options.top?r.options.top:0)),k+N<=f)break}else if("left"===Q){if(_="w2ui-tag-left",k=parseInt(w.left+(r.options.left?r.options.left:0))-N-20,E=parseInt(w.top+(r.options.top?r.options.top:0)),k>=0)break}else if("top"===Q){if(_="w2ui-tag-top",k=parseInt(w.left+(r.options.left?r.options.left:0))-14,E=parseInt(w.top+(r.options.top?r.options.top:0))-L-10,k+N<=f&&E>=0)break}else if("bottom"===Q&&(_="w2ui-tag-bottom",k=parseInt(w.left+(r.options.left?r.options.left:0))-14,E=parseInt(w.top+r.attachedTo.offsetHeight+(r.options.top?r.options.top:0))+10,k+N<=f&&E+L<=H))break}I.data("posClass")!==_&&I.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(_).data("posClass",_)}return{left:k,top:E,posClass:_}}});v(".w2ui-tag").each((l,n)=>{let r=v(n).data("w2tag");r&&r.hide()})},v.fn.w2overlay=function(i,s){let o,l=this,n="",r={name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,minWidth:null,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"",class:"",overlayStyle:"",onShow:null,onHide:null,openAbove:null,tmp:{}};if(1===arguments.length&&(s="object"==typeof i?i:{html:i}),2===arguments.length&&(s.html=i),v.isPlainObject(s)||(s={}),(s=v.extend({},r,s)).name&&(n="-"+s.name),0===this.length||""===s.html||null==s.html)return v("#w2ui-overlay"+n).length>0?(o=v("#w2ui-overlay"+n)[0].hide,"function"==typeof o&&o()):v("#w2ui-overlay"+n).remove(),v(this);v("#w2ui-overlay"+n).length>0&&(o=v("#w2ui-overlay"+n)[0].hide,v(document).off(".w2overlay"+n),"function"==typeof o&&o()),l.length>0&&(null==l[0].tagName||"BODY"===l[0].tagName.toUpperCase())&&(s.contextMenu=!0),s.contextMenu&&s.originalEvent&&(s.pageX=s.originalEvent.pageX,s.pageY=s.originalEvent.pageY),s.contextMenu&&(null==s.pageX||null==s.pageY)&&console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY.");let h="";s.data&&Object.keys(s.data).forEach(E=>{h+="data-"+E+'="'+s.data[E]+'"'}),v("body").append('<div id="w2ui-overlay'+n+'" style="display: none; left: 0px; top: 0px; '+s.overlayStyle+'" '+h+'        class="w2ui-reset w2ui-overlay '+(v(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+s.style+'" class="'+s.class+'"></div></div>');let u=v("#w2ui-overlay"+n),g=u.find(" > div");g.html(s.html);let c=g.css("background-color");null!=c&&"rgba(0, 0, 0, 0)"!==c&&"transparent"!==c&&u.css({"background-color":c,"border-color":c});let m=v(l).offset()||{};return u.data("element",l.length>0?l[0]:null).data("options",s).data("position",m.left+"x"+m.top).fadeIn("fast").on("click",function(E){v("#w2ui-overlay"+n).data("keepOpen",!0),"LABEL"===E.target.tagName.toUpperCase()&&E.stopPropagation()}).on("mousedown",function(E){let I=E.target.tagName.toUpperCase();-1===["INPUT","TEXTAREA","SELECT"].indexOf(I)&&!s.selectable&&E.preventDefault()}),u[0].hide=_,u[0].resize=k,setTimeout(()=>{v(document).off(".w2overlay"+n).on("click.w2overlay"+n,_),"function"==typeof s.onShow&&s.onShow(),k()},10),w(),v(this);function w(){let E=v("#w2ui-overlay"+n);if(E.data("element")!==l[0]||0===E.length)return;let I=v(l).offset()||{},N=I.left+"x"+I.top;E.data("position")!==N?_():setTimeout(w,250)}function _(E){if(E&&0!==E.button)return;let N,I=v("#w2ui-overlay"+n);E&&v(v(E.target).closest(".w2ui-overlay").data("element")).closest(".w2ui-overlay")[0]===I[0]||(!0!==I.data("keepOpen")?("function"==typeof s.onHide&&(N=s.onHide()),!1!==N&&(I.remove(),v(document).off(".w2overlay"+n),clearInterval(I.data("timer")))):I.removeData("keepOpen"))}function k(){let E=v("#w2ui-overlay"+n),I=E.find(" > div"),N=v("#w2ui-overlay"+n+" div.w2ui-menu"),L={};if(N.length>0&&(N.css("overflow-y","hidden"),L.scrollTop=N.scrollTop(),L.scrollLeft=N.scrollLeft()),E.length>0){I.height("auto").width("auto");let f=!1,H=I.height(),B=I.width();s.width&&s.width<B&&(B=s.width),B<30&&(B=30),s.tmp.contentHeight&&(H=parseInt(s.tmp.contentHeight),I.height(H),setTimeout(()=>{let Be=I.find("div.w2ui-menu");H>Be.height()&&I.find("div.w2ui-menu").css("overflow-y","hidden")},1),setTimeout(()=>{let Be=I.find("div.w2ui-menu");"auto"!==Be.css("overflow-y")&&Be.css("overflow-y","auto")},10)),s.tmp.contentWidth&&"both"!==s.align&&(B=parseInt(s.tmp.contentWidth),I.width(B),setTimeout(()=>{B>I.find("div.w2ui-menu > table").width()&&I.find("div.w2ui-menu > table").css("overflow-x","hidden")},1),setTimeout(()=>{I.find("div.w2ui-menu > table").css("overflow-x","auto")},10)),I.find("div.w2ui-menu").css("width","100%");let Q=s.left,X=s.width,ne=s.tipLeft,re=s.minWidth,le=s.maxWidth,J=w2utils.getSize(v(l),"width");switch(s.align){case"both":Q=17,re="input",le="input";break;case"left":Q=17}if((!re||"auto"===re)&&(re=0),"input"===re&&(re=J),re=parseInt(re,10),(!le||"auto"===le)&&(le=0),"input"===le&&(le=J),le=parseInt(le,10),(!X||"auto"===X)&&(X=0),"input"===X&&(X=J),X=parseInt(X,10),re&&(X=Math.max(X,re)),le&&(X=Math.min(X,le)),"right"===s.align){let Be=Math.max(B-10,re-17);Q=J-Be,ne=Be-30}30===B&&!X&&(X=30);let xe,Ye,Xe,ge=((X||B)-17)/2;if(ge<25&&(ne=Math.floor(ge)),s.contextMenu)xe=s.pageX+8,Ye=s.pageY-0,Xe=s.pageY;else{let Be=l.offset()||{};xe=(Be.left>25?Be.left:25)+Q,Ye=Be.top+w2utils.getSize(l,"height")+s.top+7,Xe=Be.top}E.css({left:xe+"px",top:Ye+"px",width:X||"auto","min-width":re||"auto","max-width":le||"auto","min-height":s.height||"auto"});let Ve=I.offset()||{},He=window.innerHeight+v(document).scrollTop()-Ve.top-7;if(le=window.innerWidth+v(document).scrollLeft()-Ve.left-7,s.contextMenu&&(He=window.innerHeight+v(document).scrollTop()-s.pageY-15,le=window.innerWidth+v(document).scrollLeft()-s.pageX),(He>-50&&He<210||!0===s.openAbove)&&!1!==s.openAbove){let Be;s.contextMenu?(He=s.pageY-7,Be=5):(He=Ve.top-v(document).scrollTop()-7,Be=24),s.maxHeight&&He>s.maxHeight&&(He=s.maxHeight),H>He&&(f=!0,I.height(He).width(B).css({"overflow-y":"auto"}),H=He),E.addClass("bottom-arrow"),E.css("top",Xe-H-Be+s.top+"px"),E.find(">style").html("#w2ui-overlay"+n+":before { margin-left: "+parseInt(ne)+"px; }#w2ui-overlay"+n+":after { margin-left: "+parseInt(ne)+"px; }")}else s.maxHeight&&He>s.maxHeight&&(He=s.maxHeight),H>He&&(f=!0,I.height(He).width(B).css({"overflow-y":"auto"})),E.addClass("top-arrow"),E.find(">style").html("#w2ui-overlay"+n+":before { margin-left: "+parseInt(ne)+"px; }#w2ui-overlay"+n+":after { margin-left: "+parseInt(ne)+"px; }");B=I.width(),le=window.innerWidth+v(document).scrollLeft()-Ve.left-7,s.maxWidth&&le>s.maxWidth&&(le=s.maxWidth),B>le&&"both"!==s.align&&(s.align="right",setTimeout(()=>{k()},1)),(s.contextMenu||s.noTip)&&E.find(">style").html("#w2ui-overlay"+n+":before { display: none; }#w2ui-overlay"+n+":after { display: none; }"),f&&"both"!==s.align&&I.width(B+w2utils.scrollBarSize()+2)}N.length>0&&(N.css("overflow-y","auto"),N.scrollTop(L.scrollTop),N.scrollLeft(L.scrollLeft))}},v.fn.w2tmp={},v.fn.w2menu=function(i,s){s&&"function"==typeof s.items&&(s.items=s.items());let n,l={type:"normal",index:null,items:[],render:null,msgNoItems:w2utils.lang("No items found"),onSelect:null,hideOnRemove:!1,tmp:{}},r=this,o="";if("refresh"===i){v.fn.w2tmp.menuOptions&&v.fn.w2tmp.menuOptions.name&&(o="-"+v.fn.w2tmp.menuOptions.name),s.name&&(o="-"+s.name);let c=v("#w2ui-overlay"+o).data("element");if(0==v("#w2ui-overlay"+o).length||null!=c&&c!=this[0])v(this).w2menu(s);else{s=v.extend(v.fn.w2tmp.menuOptions,s);let m=v("#w2ui-overlay"+o+" div.w2ui-menu").scrollTop();v("#w2ui-overlay"+o+" div.w2ui-menu").html(g()),v("#w2ui-overlay"+o+" div.w2ui-menu").scrollTop(m),h()}}else if("refresh-index"===i){let c=v("#w2ui-overlay"+o+" div.w2ui-menu"),m=c.find("tr[index="+s.index+"]"),w=c.scrollTop();if(c.find("tr.w2ui-selected").removeClass("w2ui-selected"),m.addClass("w2ui-selected"),m.length>0){let _=m[0].offsetTop-5,k=c.height();c.scrollTop(w),(_<w||_+m.height()>w+k)&&c.animate({scrollTop:_-(k-2*m.height())/2},200,"linear")}h()}else{1===arguments.length?s=i:s.items=i,"object"!=typeof s&&(s={}),s=v.extend({},l,s),v.fn.w2tmp.menuOptions=s,s.name&&(o="-"+s.name),"function"==typeof s.select&&"function"!=typeof s.onSelect&&(s.onSelect=s.select),"function"==typeof s.remove&&"function"!=typeof s.onRemove&&(s.onRemove=s.remove),"function"==typeof s.onRender&&"function"!=typeof s.render&&(s.render=s.onRender),v.fn.w2tmp.menuClick=function(_,k,E){let N,I=!1,L=v(_.target).closest("tr");if((_.shiftKey||_.metaKey||_.ctrlKey)&&(I=!0),N=null==E?s.items:s.items[E].items,v(_.target).hasClass("remove"))"function"==typeof s.onRemove&&s.onRemove({index:k,parentIndex:E,item:N[k],keepOpen:I,originalEvent:_}),I=!s.hideOnRemove,v(_.target).closest("tr").remove(),h();else if(L.hasClass("has-sub-menu"))I=!0,L.hasClass("expanded")?(N[k].expanded=!1,L.removeClass("expanded").addClass("collapsed").next().hide()):(N[k].expanded=!0,L.addClass("expanded").removeClass("collapsed").next().show()),h();else if("function"==typeof s.onSelect){let f=N;"function"==typeof N&&(f=N(s.items[E])),null!=f[k].keepOpen&&(I=f[k].keepOpen),s.onSelect({index:k,parentIndex:E,item:f[k],keepOpen:I,originalEvent:_})}if(null==N[k]||!0!==N[k].keepOpen){let f=v("#w2ui-overlay"+o);f.removeData("keepOpen"),f.length>0&&"function"==typeof f[0].hide&&!I&&f[0].hide()}},v.fn.w2tmp.menuDown=function(w,_,k){let E,I=v(w.target).closest("tr"),N=v(I.get(0)).find(".w2ui-icon");E=null==k?s.items:s.items[k].items;let L=E[_];("check"===s.type||"radio"===s.type)&&!1!==L.group&&!v(w.target).hasClass("remove")&&!v(w.target).closest("tr").hasClass("has-sub-menu")&&(L.checked=!L.checked,L.checked?("radio"===s.type&&N.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),"check"===s.type&&null!=L.group&&E.forEach((f,H)=>{f.id!=L.id&&f.group===L.group&&f.checked&&(N.closest("table").find("tr[index="+H+"] .w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),E[H].checked=!1)}),N.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"===s.type&&null==L.group&&!1!==L.group&&N.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")),I.parent().find("tr").removeClass("w2ui-selected"),I.addClass("w2ui-selected")};let c="";if(s.search){c+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon w2ui-icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',s.style+=";background-color: #ECECEC",s.index=0;for(let w=0;w<s.items.length;w++)s.items[w].hidden=!1}c+=(s.topHTML||"")+'<div class="w2ui-menu" style="top: '+(s.search?40:0)+"px;"+(s.menuStyle||"")+'">'+g()+"</div>",n=v(this).w2overlay(c,s),setTimeout(()=>{if(v("#w2ui-overlay"+o+" #menu-search").on("keyup",u).on("keydown",function(w){9===w.keyCode&&(w.stopPropagation(),w.preventDefault())}),s.search){if(-1!==["text","password"].indexOf(v(r)[0].type)||"TEXTAREA"===v(r)[0].tagName.toUpperCase())return;v("#w2ui-overlay"+o+" #menu-search").focus()}h()},1),h();let m=v("#w2ui-overlay"+o);m.length>0&&(m[0].mresize=h,m[0].change=u)}return n;function h(){setTimeout(()=>{v("#w2ui-overlay"+o+" tr.w2ui-selected").removeClass("w2ui-selected");let c=v("#w2ui-overlay"+o+" tr[index="+s.index+"]"),m=v("#w2ui-overlay"+o+" div.w2ui-menu").scrollTop();if(c.addClass("w2ui-selected"),s.tmp&&(s.tmp.contentHeight=v("#w2ui-overlay"+o+" table").height()+(s.search?50:10)+(parseInt(v("#w2ui-overlay"+o+" .w2ui-menu").css("top"))||0)+(parseInt(v("#w2ui-overlay"+o+" .w2ui-menu").css("bottom"))||0),s.tmp.contentWidth=v("#w2ui-overlay"+o+" table").width()),v("#w2ui-overlay"+o).length>0&&v("#w2ui-overlay"+o)[0].resize(),c.length>0){let w=c[0].offsetTop-5,k=v("#w2ui-overlay"+o+" div.w2ui-menu").height();v("#w2ui-overlay"+o+" div.w2ui-menu").scrollTop(m),(w<m||w+c.height()>m+k)&&v("#w2ui-overlay"+o+" div.w2ui-menu").animate({scrollTop:w-(k-2*c.height())/2},200,"linear")}},1)}function u(c){let m=this.value,_=!1;switch(c.keyCode){case 13:v("#w2ui-overlay"+o).remove(),v.fn.w2tmp.menuClick(c,s.index);break;case 9:case 27:v("#w2ui-overlay"+o).remove(),v.fn.w2tmp.menuClick(c,-1);break;case 38:for(s.index=w2utils.isInt(s.index)?parseInt(s.index):0,s.index--;s.index>0&&s.items[s.index].hidden;)s.index--;if(0===s.index&&s.items[s.index].hidden)for(;s.items[s.index]&&s.items[s.index].hidden;)s.index++;s.index<0&&(s.index=0),_=!0;break;case 40:for(s.index=w2utils.isInt(s.index)?parseInt(s.index):0,s.index++;s.index<s.items.length-1&&s.items[s.index].hidden;)s.index++;if(s.index===s.items.length-1&&s.items[s.index].hidden)for(;s.items[s.index]&&s.items[s.index].hidden;)s.index--;s.index>=s.items.length&&(s.index=s.items.length-1),_=!0}if(!_){let k=0;for(let E=0;E<s.items.length;E++){let I=s.items[E],N="",L="";-1!==["is","begins with"].indexOf(s.match)&&(N="^"),-1!==["is","ends with"].indexOf(s.match)&&(L="$");try{I.hidden=!new RegExp(N+m+L,"i").test(I.text)&&"..."!==I.text}catch(f){}!0!==I.hidden&&k++}for(s.index=0;s.index<s.items.length-1&&s.items[s.index].hidden;)s.index++;k<=0&&(s.index=-1)}v(r).w2menu("refresh",s),h()}function g(c,m,w,_){if(s.spinner)return`<table><tr>\n                  <td style="padding: 5px 10px 13px 10px; text-align: center">\n                      <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>\n                      <div style="display: inline-block; padding: 3px; color: #999;">${w2utils.lang("Loading...")}</div>\n                  </td>\n              </tr></table>`;let k=0,E='<table cellspacing="0" cellpadding="0" class="'+(m?" sub-menu":"")+'"><tbody>',I=null,N=null;null==c&&(c=s.items),Array.isArray(c)||(c=[]);for(let L=0;L<c.length;L++){let f=c[L];if("string"==typeof f?f={id:f,text:f}:(null!=f.text&&null==f.id&&(f.id=f.text),null==f.text&&null!=f.id&&(f.text=f.id),null!=f.caption&&(f.text=f.caption),I=f.img,N=f.icon,null==I&&(I=null),null==N&&(N=null)),-1!=["radio","check"].indexOf(s.type)&&!Array.isArray(f.items)&&!1!==f.group&&(N=!0===f.checked?"w2ui-icon-check":"w2ui-icon-empty"),!0!==f.hidden){let H="",B=f.text,Q="";if("function"==typeof s.render&&(B=s.render(f,s)),"function"==typeof B&&(B=B(f,s)),I&&(H='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+I+'"></div></td>'),N&&(H='<td class="menu-icon" align="center"><span class="w2ui-icon '+N+'"></span></td>'),"break"!==f.type&&null!=B&&""!==B&&"--"!=String(B).substr(0,2)){let X=k%2==0?"w2ui-item-even":"w2ui-item-odd";!0!==s.altRows&&(X="");let ne=1;""===H&&ne++,null==f.count&&null==f.hotkey&&!0!==f.remove&&null==f.items&&ne++,null==f.tooltip&&null!=f.hint&&(f.tooltip=f.hint);let re="";if(!0===f.remove)re='<span class="remove">X</span>';else if(null!=f.items){let le=[];"function"==typeof f.items?le=f.items(f):Array.isArray(f.items)&&(le=f.items),re="<span></span>",Q='<tr style="'+(f.expanded?"":"display: none")+'">     <td colspan="3">'+g(le,!0,0,L)+"</td><tr>"}else null!=f.count&&(re+="<span>"+f.count+"</span>"),null!=f.hotkey&&(re+='<span class="hotkey">'+f.hotkey+"</span>");E+='<tr index="'+L+'" style="'+(f.style?f.style:"")+'" '+(f.tooltip?'title="'+w2utils.lang(f.tooltip,!0)+'"':"")+' class="'+X+(s.index===L?" w2ui-selected":"")+(!0===f.disabled?" w2ui-disabled":"")+(""!==Q?" has-sub-menu"+(f.expanded?" expanded":" collapsed"):"")+'"        onmousedown="if ('+(!0===f.disabled?"true":"false")+") return;               jQuery.fn.w2tmp.menuDown(event, "+L+",  "+_+');"        onclick="event.stopPropagation();                if ('+(!0===f.disabled?"true":"false")+") return;               jQuery.fn.w2tmp.menuClick(event, "+L+",  "+_+');">'+(m?"<td></td>":"")+H+'   <td class="menu-text" colspan="'+ne+'">'+w2utils.lang(B,!0)+'</td>   <td class="menu-count">'+re+"</td></tr>"+Q,k++}else{let X=B.replace(/^-+/g,"");E+='<tr><td colspan="3" class="menu-divider '+(""!=X?"divider-text":"")+'">   <div class="line">'+X+'</div>   <div class="text">'+X+"</div></td></tr>"}}c[L]=f}return 0===k&&s.msgNoItems&&(E+=`<tr>\n                  <td style="padding: 5px 10px 13px 10px; text-align: center">\n                      <div style="display: inline-block; padding-top: 3px; color: #999;">\n                          ${w2utils.lang(s.msgNoItems)}\n                      </div>\n                  </td>\n              </tr>`),E+="</tbody></table>",E}},v.fn.w2color=function(i,s){let l=v(this),n=l[0];if(l.data("skipInit"))return void l.removeData("skipInit");let r=[-1,-1];null==v.fn.w2colorPalette&&(v.fn.w2colorPalette=[["000000","333333","555555","777777","888888","999999","AAAAAA","CCCCCC","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFC300","FFFD59","86FF14","14FF7A","2EFFFC","2693FF","006CE7","9B24F4","FF21F5","FF0099"],["FFEAEA","FCEFE1","FCF4DC","FFFECF","EBFFD9","D9FFE9","E0FFFF","E8F4FF","ECF4FC","EAE6F4","FFF5FE","FCF0F7"],["F4CCCC","FCE5CD","FFF1C2","FFFDA1","D5FCB1","B5F7D0","BFFFFF","D6ECFF","CFE2F3","D9D1E9","FFE3FD","FFD9F0"],["EA9899","F9CB9C","FFE48C","F7F56F","B9F77E","84F0B1","83F7F7","B5DAFF","9FC5E8","B4A7D6","FAB9F6","FFADDE"],["E06666","F6B26B","DEB737","E0DE51","8FDB48","52D189","4EDEDB","76ACE3","6FA8DC","8E7CC3","E07EDA","F26DBD"],["CC0814","E69138","AB8816","B5B20E","6BAB30","27A85F","1BA8A6","3C81C7","3D85C6","674EA7","A14F9D","BF4990"],["99050C","B45F17","80650E","737103","395E14","10783D","13615E","094785","0A5394","351C75","780172","782C5A"]]);let o=v.fn.w2colorPalette;"string"==typeof i&&(i={color:i,transparent:!0}),null==i.onSelect&&null!=s&&(i.onSelect=s),i.transparent&&"333333"==o[0][1]&&(o[0].splice(1,1),o[0].push("")),!i.transparent&&"333333"!=o[0][1]&&(o[0].splice(1,0,"333333"),o[0].pop()),i.color&&(i.color=String(i.color).toUpperCase()),"string"==typeof i.color&&"#"===i.color.substr(0,1)&&(i.color=i.color.substr(1)),null==i.fireChange&&(i.fireChange=!0),0===v("#w2ui-overlay").length?v(n).w2overlay(L(i),i):(v("#w2ui-overlay .w2ui-colors").parent().html(L(i)),v("#w2ui-overlay").show()),v("#w2ui-overlay .w2ui-color").off(".w2color").on("mousedown.w2color",f=>{let H=v(f.originalEvent.target).attr("name");r=v(f.originalEvent.target).attr("index").split(":"),"INPUT"===n.tagName.toUpperCase()?(i.fireChange&&v(n).change(),v(n).next().find(">div").css("background-color",H)):v(n).data("_color",H),"function"==typeof i.onSelect&&i.onSelect(H)}).on("mouseup.w2color",()=>{setTimeout(()=>{v("#w2ui-overlay").length>0&&v("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),v("#w2ui-overlay .color-original").off(".w2color").on("click.w2color",f=>{let H=w2utils.parseColor(v(f.target).css("background-color"));null!=H&&(g=H,u=w2utils.rgb2hsv(g),c(u),m(),w())}),v("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",f=>{v("#w2ui-overlay").data("keepOpen",!0),setTimeout(()=>{v("#w2ui-overlay").data("keepOpen",!0)},10),f.stopPropagation()}).on("change.w2color",()=>{let f=v(this),H=parseFloat(f.val()),B=parseFloat(f.attr("max"));isNaN(H)&&(H=0),B>1&&(H=parseInt(H)),B>0&&H>B&&(f.val(B),H=B),H<0&&(f.val(0),H=0);let Q=f.attr("name"),X={};-1!==["r","g","b","a"].indexOf(Q)?(g[Q]=H,u=w2utils.rgb2hsv(g)):-1!==["h","s","v"].indexOf(Q)&&(X[Q]=H),c(X),m(),w()});let h,u,g=w2utils.parseColor(i.color);function c(f,H){null!=f.h&&(u.h=f.h),null!=f.s&&(u.s=f.s),null!=f.v&&(u.v=f.v),null!=f.a&&(g.a=f.a,u.a=f.a),g=w2utils.hsv2rgb(u);let B="rgba("+g.r+","+g.g+","+g.b+","+g.a+")",Q=[Number(g.r).toString(16).toUpperCase(),Number(g.g).toString(16).toUpperCase(),Number(g.b).toString(16).toUpperCase(),Math.round(255*Number(g.a)).toString(16).toUpperCase()];Q.forEach((X,ne)=>{1===X.length&&(Q[ne]="0"+X)}),B=Q[0]+Q[1]+Q[2]+Q[3],1===g.a&&(B=Q[0]+Q[1]+Q[2]),v("#w2ui-overlay .color-preview").css("background-color","#"+B),v("#w2ui-overlay input").each((X,ne)=>{ne.name&&(null!=g[ne.name]&&(ne.value=g[ne.name]),null!=u[ne.name]&&(ne.value=u[ne.name]),"a"===ne.name&&(ne.value=g.a))}),H?v("#w2ui-overlay .color-original").css("background-color","#"+B):("INPUT"===n.tagName.toUpperCase()?(v(n).val(B).data("skipInit",!0),i.fireChange&&v(n).change(),v(n).next().find(">div").css("background-color","#"+B)):v(n).data("_color",B),"function"==typeof i.onSelect&&i.onSelect(B))}function m(){let f=v("#w2ui-overlay .palette .value1"),H=v("#w2ui-overlay .rainbow .value2"),B=v("#w2ui-overlay .alpha .value2"),Q=parseInt(f.width())/2,X=parseInt(H.width())/2;f.css({left:150*u.s/100-Q,top:125*(100-u.v)/100-Q}),H.css("left",u.h/2.4-X),B.css("left",150*g.a-X)}function w(){let f=w2utils.hsv2rgb(u.h,100,100),H=f.r+","+f.g+","+f.b;v("#w2ui-overlay .palette").css("background-image","linear-gradient(90deg, rgba("+H+",0) 0%, rgba("+H+",1) 100%)")}function _(f){let H=v(this).find(".value1, .value2"),B=parseInt(H.width())/2;H.hasClass("move-x")&&H.css({left:f.offsetX-B+"px"}),H.hasClass("move-y")&&H.css({top:f.offsetY-B+"px"}),h={$el:H,x:f.pageX,y:f.pageY,width:H.parent().width(),height:H.parent().height(),left:parseInt(H.css("left")),top:parseInt(H.css("top"))},E(f),v("body").off(".w2color").on(N,E).on(I,k)}function k(f){v("body").off(".w2color")}function E(f){let H=h.$el,X=h.left+(f.pageX-h.x),ne=h.top+(f.pageY-h.y),re=parseInt(H.width())/2;X<-re&&(X=-re),ne<-re&&(ne=-re),X>h.width-re&&(X=h.width-re),ne>h.height-re&&(ne=h.height-re),H.hasClass("move-x")&&H.css({left:X+"px"}),H.hasClass("move-y")&&H.css({top:ne+"px"});let le=H.parent().attr("name"),J=parseInt(H.css("left"))+re,ge=parseInt(H.css("top"))+re;"palette"===le&&c({s:Math.round(J/h.width*100),v:Math.round(100-ge/h.height*100)}),"rainbow"===le&&(c({h:Math.round(2.4*J)}),w()),"alpha"===le&&c({a:parseFloat(Number(J/150).toFixed(2))})}null==g&&(g={r:140,g:150,b:160,a:1},u=w2utils.rgb2hsv(g)),u=w2utils.rgb2hsv(g),(!0===v.fn._colorAdvanced||!0===i.advanced)&&(v("#w2ui-overlay .w2ui-color-tabs :nth-child(2)").click(),v("#w2ui-overlay").removeData("keepOpen")),c({},!0),w(),m();let I="mouseup.w2color",N="mousemove.w2color";function L(f){let H,B='<div class="w2ui-colors" onmousedown="jQuery(this).parents(\'.w2ui-overlay\').data(\'keepOpen\', true)"><div class="w2ui-color-palette"><table cellspacing="5"><tbody>';for(let Q=0;Q<o.length;Q++){B+="<tr>";for(let X=0;X<o[Q].length;X++)H="FFFFFF"===o[Q][X]?";border: 1px solid #efefef":"",B+='<td>    <div class="w2ui-color '+(""===o[Q][X]?"w2ui-no-color":"")+'" style="background-color: #'+o[Q][X]+H+';"        name="'+o[Q][X]+'" index="'+Q+":"+X+'">'+(f.color==o[Q][X]?"&#149;":"&#160;")+"    </div></td>",f.color==o[Q][X]&&(r=[Q,X]);B+="</tr>",Q<2&&(B+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return B+="</tbody></table></div>",B+='<div class="w2ui-color-advanced" style="display: none">   <div class="color-info">       <div class="color-preview-bg"><div class="color-preview"></div><div class="color-original"></div></div>       <div class="color-part">           <span>H</span> <input name="h" maxlength="3" max="360" tabindex="101">           <span>R</span> <input name="r" maxlength="3" max="255" tabindex="104">       </div>       <div class="color-part">           <span>S</span> <input name="s" maxlength="3" max="100" tabindex="102">           <span>G</span> <input name="g" maxlength="3" max="255" tabindex="105">       </div>       <div class="color-part">           <span>V</span> <input name="v" maxlength="3" max="100" tabindex="103">           <span>B</span> <input name="b" maxlength="3" max="255" tabindex="106">       </div>       <div class="color-part" style="margin: 30px 0px 0px 2px">           <span style="width: 40px">'+w2utils.lang("Opacity")+'</span>            <input name="a" maxlength="5" max="1" style="width: 32px !important" tabindex="107">       </div>   </div>   <div class="palette" name="palette">       <div class="palette-bg"></div>       <div class="value1 move-x move-y"></div>   </div>   <div class="rainbow" name="rainbow">       <div class="value2 move-x"></div>   </div>   <div class="alpha" name="alpha">       <div class="alpha-bg"></div>       <div class="value2 move-x"></div>   </div></div>',B+="<div class=\"w2ui-color-tabs\">   <div class=\"w2ui-color-tab selected\" onclick=\"jQuery(this).addClass('selected').next().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').hide().parent().find('.w2ui-color-palette').show(); jQuery.fn._colorAdvanced = false; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-colors\"></span></div>   <div class=\"w2ui-color-tab\" onclick=\"jQuery(this).addClass('selected').prev().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').show().parent().find('.w2ui-color-palette').hide(); jQuery.fn._colorAdvanced = true; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-settings\"></span></div>   <div style=\"padding: 8px; text-align: right;\">"+("string"==typeof f.html?f.html:"")+'</div></div></div><div style="clear: both; height: 0"></div>',B}w2utils.isIOS&&(I="touchend.w2color",N="touchmove.w2color"),v("#w2ui-overlay .palette").off(".w2color").on("mousedown.w2color",_),v("#w2ui-overlay .rainbow").off(".w2color").on("mousedown.w2color",_),v("#w2ui-overlay .alpha").off(".w2color").on("mousedown.w2color",_),n.nav=f=>{switch(f){case"up":r[0]--;break;case"down":r[0]++;break;case"right":r[1]++;break;case"left":r[1]--}r[0]<0&&(r[0]=0),r[0]>o.length-2&&(r[0]=o.length-2),r[1]<0&&(r[1]=0),r[1]>o[0].length-1&&(r[1]=o[0].length-1);let H=o[r[0]][r[1]];return v(n).data("_color",H),H}}})(jQuery),function(v,e){if("function"==typeof define&&define.amd)return define(()=>e);if("undefined"!=typeof exports){if("undefined"!=typeof module&&module.exports)return exports=module.exports=e;v=exports}v&&Object.keys(e).forEach(t=>{v[t]=e[t]})}(self,{w2ui,w2locale,w2event,w2utils,w2popup,w2alert,w2confirm,w2prompt,w2field,w2form,w2grid,w2layout,w2sidebar,w2tabs,w2toolbar,addType,removeType});const getClassList=v=>{var e;return null!=(e=null==v?void 0:v.split(/\s+/))?e:[]},removeClicked=()=>{$(".side-menu li").removeClass("active"),$(".side-menu li").removeClass("current-page"),$(".side-menu li").removeClass("sub_menu"),$(".side-menu ul").css("display","none")},sidebarFunc=v=>{var t=$(v).parent(),i=t.parent(),s=getClassList(t.attr("class"));if(s.includes("parent_link")){if(s.includes("active"))return void setTimeout(()=>{t.removeClass("active"),t.find("ul").length&&t.children("ul").css("display","none")},100);removeClicked(),setTimeout(()=>{t.addClass("active"),t.children("ul").css("display","block")},100)}else if(s.includes("child_link")){if($parent_li=i.parent(),$parent_ul=$parent_li.children("ul"),s.includes("current-page"))return void setTimeout(()=>{t.removeClass("current-page"),t.find("ul").length&&t.children("ul").css("display","none")},100);removeClicked(),setTimeout(()=>{t.addClass("current-page"),t.children("ul").css("display","block"),$parent_li.addClass("active"),$parent_ul.css("display","block")},100)}else if(s.includes("inchild_link")){if($sub_li=i.parent(),$sub_ul=$sub_li.children("ul"),$parent_ul=$sub_li.parent(),$parent_li=$parent_ul.parent(),s.includes("current-page"))return;removeClicked(),setTimeout(()=>{t.addClass("sub_menu current-page"),t.children("ul").css("display","block"),$parent_li.addClass("active"),$parent_ul.css("display","block"),$sub_li.addClass("active"),$sub_ul.css("display","block")},100)}};var isInit=!1;const initSidebar=v=>{if(!isInit){isInit=!0,$(".side-menu a").on("click",function(i){sidebarFunc(this)});var e=window.location.href.split("#")[0].split("?")[0],t=$(".side-menu a").filter(function(){return this.href==e});sidebarFunc(t[0])}};function clearSpecialCharacter(v){var e={\u00c7:"c",\u00d6:"o",\u015e:"s",\u0130:"i",I:"i",\u00dc:"u",\u011e:"g",\u00e7:"c",\u00f6:"o",\u015f:"s",\u0131:"i",\u00fc:"u",\u011f:"g"};str_array=v.split("");for(var t=0,i=str_array.length;t<i;t++)str_array[t]=e[str_array[t]]||str_array[t];return(v=str_array.join("")).replace(" ","_").replace("__","_").replace(/[^a-z0-9-.\xe7\xf6\u015f\xfc\u011f\u0131]/gi,"").toLowerCase()}const BACKUP=[];function openPopup(v="",e="",t=null,i={},s=!1){$("#form").length>0&&$("#form").remove(),w2popup.open({title:v,body:'<div id="form" style="width: 100%; height: 100%;"></div>',style:"padding: 15px 0px 0px 0px",width:null==w2ui[e].width?600:w2ui[e].width,height:null==w2ui[e].height?400:w2ui[e].height,showMax:!0,innerContent:[e],showBack:BACKUP.filter(function(){return null==BACKUP[e]}).length>1,openMaximized:s,onToggle:function(l){$(w2ui[e].box).hide(),l.onComplete=function(){$(w2ui[e].box).show(),w2ui[e].resize(),Object.keys(w2ui).forEach(n=>{"w2form"==w2ui[n].constructor.name&&(w2ui[n].resize(),w2ui[n].tabs.click&&w2ui[n].tabs.click(w2ui[n].tabs.active))})}},onOpen:function(l){l.onComplete=function(){setTimeout(()=>{$("#form").html(""),null!=w2ui[e]&&(console.log(i),w2ui[e].record=i,w2ui[e].refresh()),w2ui[e].recid=t,null!=t&&w2ui[e].reload(),$("#w2ui-popup #form").w2render(e);let n={};n[e]="#form",0==BACKUP.filter(function(){return null==BACKUP[e]}).length&&BACKUP.push(n),w2ui[e].resize(),w2ui[e].refresh()},300)}},onClose:function(l){l.onComplete=function(){BACKUP.pop()}}})}function openPopupGrid(v="",e="",t={},i=!0){w2popup.open({title:v,width:700,height:500,innerContent:[e],showMax:i,showBack:BACKUP.filter(function(){return null==BACKUP[e]}).length>1,body:'<div id="popup-grid" style="position: absolute; left: 2px; right: 2px; top: 0px; bottom: 3px;"></div>',onToggle(s){s.done(()=>{w2ui[e].resize(),w2ui[e].refresh()})}}).then(s=>{const n=new URLSearchParams(t).toString();w2ui[e].url.get=w2ui[e].url.get.split("?")[0]+"?"+n,$("#w2ui-popup #popup-grid").w2render(e),setTimeout(()=>{BACKUP.push(e),w2ui[e].resize()},300)})}function openSelectedPopupGrid(v="",e="",t="",i={},s=!0){w2popup.open({title:v,width:700,height:500,showMax:s,body:'<div style="position: relative; height: calc(100% - 10px );">\n          <div id="grid1" style="position: absolute; left: 0px; width: 49.9%; height: 100%;"></div>\n          <div id="grid2" style="position: absolute; right: 0px; width: 49.9%; height: 100%;"></div>\n      </div>',onToggle(l){l.done(()=>{w2ui[e].resize(),w2ui[t].resize()})}}).then(l=>{const n=new URLSearchParams(i).toString();w2ui[e].url.get=w2ui[e].url.get.split("?")[0]+"?"+n,w2ui[t].url.get=w2ui[t].url.get.split("?")[0]+"?"+n,w2ui[t].url.save=w2ui[t].url.save.split("?")[0]+"?"+n,$("#w2ui-popup #grid1").w2render(e),$("#w2ui-popup #grid2").w2render(t),console.log(w2ui[e]),console.log(w2ui[t])})}let ExcelToJSON=async function(v,e=[],t){var i=new FileReader;i.onload=function(s){var n=XLSX.read(s.target.result,{type:"binary"}),r=XLSX.utils.sheet_to_row_object_array(n.Sheets[n.SheetNames[0]]),o=Object.keys(r[0]);console.log(r);var h=JSON.stringify(r),u=[{field:"recid",text:"Id",size:"60px"},{field:"excelDesc",text:w2utils.lang("excelDesc"),size:"100px"}],g=[{field:"overwrite",type:"toggle",html:{label:w2utils.lang("overwrite")}}],c=[];o.forEach((w,_)=>{h=h.replaceAll('"'+w+'"','"'+clearSpecialCharacter(w)+'"'),o[_]=clearSpecialCharacter(w),u[u.length]={field:o[_],text:w,size:"120px"},g[g.length]={field:o[_],type:"list",required:!1,html:{label:w,attr:'style="width: 100%;"'},options:{items:e}},c[c.length]={field:o[_],label:w,type:"text"}});var m=JSON.parse(h);m.forEach((w,_)=>{m[_].recid=_+1}),t({status:!0,headers:u,fields:g,json:m,searches:c})},i.onerror=function(s){t({status:!0,error:s})},setTimeout(()=>{i.readAsBinaryString(v)},300)};function SelectExcelImport(v=[],e=""){w2ui.ExcelImport&&w2ui.ExcelImport.destroy(),$().w2form({name:"ExcelImport",fields:[{field:"ExcelFile",html:{label:w2utils.lang("ExcelFile")},type:"file",options:{max:"1"},required:0,hidden:0,disabled:0}],actions:{Cancel:function(){w2popup.close()},Save:function(){this.save()}},record:{ExcelFile:""},onAction:function(t){var i=this;i.lock(w2utils.lang("ExcelReading"),!0);var s=this.record.ExcelFile;s.length>0&&"Save"==t.target&&ExcelToJSON(s[0].file,v,function(l){i.unlock(),l.status?ImportExcelSetting(e,l):w2alert(l.error)})}}),w2popup.open({title:"Excel",body:'<div id="excelImportForm" style="width: 100%; height: 100%;"></div>',style:"padding: 15px 0px 0px 0px",width:500,height:350,showMax:!0,onToggle:function(t){$(w2ui.ExcelImport.box).hide(),t.onComplete=function(){$(w2ui.ExcelImport.box).show(),w2ui.ExcelImport.resize()}},onOpen:function(t){t.onComplete=function(){$("#w2ui-popup #excelImportForm").w2render("ExcelImport"),setTimeout(function(){w2ui.ExcelImport.refresh()},300)}}})}function ImportExcelSetting(v="",e){let t={grid:{show:{toolbar:!0,footer:!0,toolbarDelete:!0,toolbarSave:!0},searches:e.searches,columns:e.headers,records:e.json,name:"ImportGrid",style:"border: 1px solid #efefef"},form:{url:v,header:w2utils.lang("SelectField"),name:"ImportForm",style:"border: 1px solid #efefef",fields:e.fields,actions:{Save(){this.validate().length>0||(console.log(this),this.record.data=JSON.stringify(w2ui.ImportGrid.records),this.save())}}}};w2ui.ImportGrid&&w2ui.ImportGrid.destroy(),w2ui.ImportForm&&w2ui.ImportForm.destroy(),new w2grid(t.grid),new w2form(t.form),w2popup.open({title:w2utils.lang("ImportFromExcel"),width:900,height:600,showMax:!0,body:'<div style="position: relative; height: calc(100% - 10px );">\n      <div id="grid1" style="position: absolute; left: 0px; width: 64.9%; height: 100%;"></div>\n      <div id="grid2" style="position: absolute; right: 0px; width: 34.9%; height: 100%;"></div>\n  </div>',onToggle(l){l.done(()=>{w2ui.ImportGrid.resize(),w2ui.ImportForm.resize()})},onOpen(l){l.done(()=>{setTimeout(()=>{w2ui.ImportGrid.resize(),w2ui.ImportForm.resize(),w2ui.ImportGrid.refresh(),w2ui.ImportForm.refresh()},300)})}}).then(l=>{$("#w2ui-popup #grid1").w2render("ImportGrid"),$("#w2ui-popup #grid2").w2render("ImportForm")})}function getOptionList(v,e,t,i,s){let n={type:"GET",url:s,data:{request:JSON.stringify({limit:-1,offset:0,searchLogic:"AND",search:[{field:t,type:"list",operator:"is",value:i.id,text:i.text}]})},dataType:"JSON",headers:{}};null!=localStorage.getItem("token")&&(n.headers.Authorization="Bearer "+localStorage.getItem("token")),$.ajax(n).done((r,o,h)=>{200==h.status?v.fields.forEach(u=>{u.name==e&&(u.options.items=r.records.map(g=>({id:g.Id,text:g.Name})),v.record[e]=null,v.refresh())}):w2alert(h.responseText)})}function initializeOptionData(v,e,t,i="Id",s="Name"){let l={type:"GET",url:t,dataType:"JSON",headers:{}};null!=localStorage.getItem("token")&&(l.headers.Authorization="Bearer "+localStorage.getItem("token")),$.ajax(l).done((n,r,o)=>{200==o.status?w2ui[v].fields.forEach(h=>{if(h.field==e){let u=[];n.Data.forEach(g=>{u.push({id:g[i],text:((m,w)=>{if(m.indexOf("{")>-1){var _=new RegExp("{(.*?)}","g");return[...m.matchAll(_)].forEach(E=>{m=m.replace(E[0],w[E[1]])}),m}return w[m]})(s,g),obj:g})}),h.options.items=u,w2ui[v].refresh(),w2ui[v].unlock()}}):w2alert(o.responseText)})}function urlParamsToObject(v){var e=v.split("?")[1];return JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}